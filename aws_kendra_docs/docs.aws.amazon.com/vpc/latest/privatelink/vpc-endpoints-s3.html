<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Gateway endpoints for Amazon S3 - Amazon Virtual Private Cloud</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="vpc-endpoints-s3" /><meta name="default_state" content="vpc-endpoints-s3" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html" /><meta name="description" content="You can access Amazon S3 from your VPC using gateway VPC endpoints. After you create the gateway endpoint, you can add it as a target in your route table for traffic destined from your VPC to Amazon S3." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Virtual Private Cloud" /><meta name="guide" content="AWS PrivateLink" /><meta name="abstract" content="Use AWS PrivateLink to connect your VPC to supported AWS services, services hosted by other AWS accounts, and supported AWS Marketplace partner services." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html" hreflang="x-default" /><meta name="feedback-item" content="PrivateLink" /><meta name="this_doc_product" content="Amazon Virtual Private Cloud" /><meta name="this_doc_guide" content="AWS PrivateLink" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'vpc'}"></script><meta id="panorama-serviceSubSection" value="AWS PrivateLink" /><meta id="panorama-serviceConsolePage" value="Gateway endpoints for Amazon S3" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Gateway endpoints for Amazon S3 - Amazon Virtual Private Cloud</title><meta name="pdf" content="/pdfs/vpc/latest/privatelink/aws-privatelink.pdf#vpc-endpoints-s3" /><meta name="rss" content="privatelink-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=58" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=PrivateLink&amp;topic_url=http://docs.aws.amazon.com/en_us/vpc/latest/privatelink/vpc-endpoints-s3.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/vpc/latest/privatelink/vpc-endpoints-s3.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/vpc/latest/privatelink/vpc-endpoints-s3.html" /><meta name="keywords" content="VPC,Amazon VPC,PrivateLink" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon VPC",
        "item" : "https://docs.aws.amazon.com/vpc/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "AWS PrivateLink",
        "item" : "https://docs.aws.amazon.com/vpc/latest/privatelink"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Access AWS services through AWS PrivateLink",
        "item" : "https://docs.aws.amazon.com/vpc/latest/privatelink/privatelink-access-aws-services.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Gateway endpoints",
        "item" : "https://docs.aws.amazon.com/vpc/latest/privatelink/gateway-endpoints.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Gateway endpoints for Amazon S3",
        "item" : "https://docs.aws.amazon.com/vpc/latest/privatelink/gateway-endpoints.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/vpc/latest/privatelink/aws-privatelink.pdf#vpc-endpoints-s3" target="_blank" rel="noopener noreferrer" title="Open PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/vpc/index.html">Amazon VPC</a><a href="what-is-privatelink.html">AWS PrivateLink</a></div><div id="page-toc-src"><a href="#gateway-endpoint-considerations-s3">Considerations</a><a href="#private-dns-s3">Private DNS</a><a href="#create-gateway-endpoint-s3">Create a gateway endpoint</a><a href="#bucket-policies-s3">Control access using bucket policies</a><a href="#associate-route-tables-s3">Associate route tables</a><a href="#edit-vpc-endpoint-policy-s3">Edit the VPC endpoint policy</a><a href="#delete-gateway-endpoint-s3">Delete a gateway endpoint</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="vpc-endpoints-s3">Gateway endpoints for Amazon S3</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can access Amazon S3 from your VPC using gateway VPC endpoints. After you create the
      gateway endpoint, you can add it as a target in your route table for traffic
      destined from your VPC to Amazon S3.</p><p>There is no additional charge for using gateway endpoints.</p><p>Amazon S3 supports both gateway endpoints and interface endpoints. With a gateway endpoint, 
      you can access Amazon S3 from your VPC, without requiring an internet gateway or NAT device for 
      your VPC, and with no additional cost. However, gateway endpoints do not allow access from 
      on-premises networks, from peered VPCs in other AWS Regions, or through a transit gateway. 
      For those scenarios, you must use an interface endpoint, which is available for an additional 
      cost. For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/privatelink-interface-endpoints.html#types-of-vpc-endpoints-for-s3">Types of VPC endpoints for Amazon S3</a> in the <em>Amazon S3 User Guide</em>.</p><div class="highlights" id="inline-topiclist"><h6>Contents</h6><ul><li><a href="#gateway-endpoint-considerations-s3">Considerations</a></li><li><a href="#private-dns-s3">Private DNS</a></li><li><a href="#create-gateway-endpoint-s3">Create a gateway endpoint</a></li><li><a href="#bucket-policies-s3">Control access using bucket policies</a></li><li><a href="#associate-route-tables-s3">Associate route tables</a></li><li><a href="#edit-vpc-endpoint-policy-s3">Edit the VPC endpoint policy</a></li><li><a href="#delete-gateway-endpoint-s3">Delete a gateway endpoint</a></li></ul></div>
      <h2 id="gateway-endpoint-considerations-s3">Considerations</h2>
      <div class="itemizedlist">
         
         
         
         
         
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>A gateway endpoint is available only in the Region where you created it. Be sure
            to create your gateway endpoint in the same Region as your S3 buckets.</p>
        </li><li class="listitem">
          <p>If you're using the Amazon DNS servers, you must enable both <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html#vpc-dns-updating">DNS hostnames and DNS resolution</a> 
            for your VPC. If you're using your own DNS server, ensure that requests to Amazon S3
            resolve correctly to the IP addresses maintained by AWS.</p>
        </li><li class="listitem">
          <p>Check whether you are using an AWS service that requires access to an S3 bucket.
            For example, a service might require access to buckets that contain log files, or might
            require you to download drivers or agents to your EC2 instances. If so, ensure that your
            endpoint policy allows the AWS service or resource to access these buckets using the
              <code class="code">s3:GetObject</code> action.</p>
        </li><li class="listitem">
          <p>You cannot use an IAM policy or bucket policy to allow access from an VPC IPv4
            CIDR range. VPC CIDR blocks can be overlapping or identical, which might lead to 
            unexpected results. Therefore, you can't use the <code class="code">aws:SourceIp</code> condition 
            in your IAM policies for requests to Amazon S3 through a VPC endpoint. This applies to 
            identity-based policies, and to any bucket policies. If a statement includes the 
            <code class="code">aws:SourceIp</code> condition, the value fails to match any provided  
            IP address or range. Instead, you can do the following:</p>
          <div class="itemizedlist">
             
             
          <ul class="itemizedlist"><li class="listitem">
              <p>Use route tables to control which instances can access resources in
                Amazon S3 through the gateway endpoint.</p>
            </li><li class="listitem">
              <p>Use <a href="#bucket-policies-s3">bucket policies</a> to restrict  
                access to a specific endpoint, VPC, or IP address range.</p>
            </li></ul></div>
        </li><li class="listitem">
          <p>The outbound rules for the security group for instances that access Amazon S3 through 
            the gateway endpoint must allow traffic to Amazon S3. You can use the prefix list ID for 
            Amazon S3 as the destination in the outbound rule.</p>
        </li><li class="listitem">
          <p>Gateway endpoints support only IPv4 traffic.</p>
        </li><li class="listitem">
          <p>The source IPv4 addresses from instances in your affected subnets as received by
            Amazon S3 change from public IPv4 addresses to the private IPv4 addresses in your VPC. An
            endpoint switches network routes, and disconnects open TCP connections. The previous
            connections that used public IPv4 addresses are not resumed. We recommend that you
            do not have any critical tasks running when you create or modify an endpoint; or
            that you test to ensure that your software can automatically reconnect to Amazon S3 after
            the connection break.</p>
        </li><li class="listitem">
          <p>Endpoint connections cannot be extended out of a VPC. Resources on the other side of a
            VPN connection, VPC peering connection, transit gateway, or AWS Direct Connect connection in your 
            VPC cannot use a gateway endpoint to communicate with Amazon S3.</p>
        </li><li class="listitem">
          <p>Your account has a default quota of 20 gateway endpoints per Region, which is adjustable. 
            There is also a limit of 255 gateway endpoints per VPC.</p>
        </li></ul></div>
     
      <h2 id="private-dns-s3">Private DNS</h2>
      <p>You can configure private DNS to optimize costs when you create both a gateway endpoint
        and an interface endpoint for Amazon S3.</p>

       
        <h6>Route 53 Resolver</h6>
        <p>Amazon provides a DNS server, called the <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resolver.html">Route 53 Resolver</a>, for your VPC. The
          Route 53 Resolver automatically resolves local VPC domain names and records in private hosted zones.
          However, you can't use the Route 53 Resolver from outside your VPC. Route 53 provides Resolver endpoints
          and Resolver rules so that you can use the Route 53 Resolver from outside your VPC. An
            <em>inbound Resolver endpoint</em> forwards DNS queries from the on-premises
          network to Route 53 Resolver. An <em>outbound Resolver endpoint</em> forwards DNS queries
          from the Route 53 Resolver to the on-premises network.</p>
       
      <p>When you configure your interface endpoint for Amazon S3 to use private DNS only for the
        inbound Resolver endpoint, we create an inbound Resolver endpoint. The inbound Resolver
        endpoint resolves DNS queries to Amazon S3 from on-premises to the private IP addresses of the
        interface endpoint. We also add ALIAS records for the Route 53 Resolver to the public hosted zone for
        Amazon S3, so that DNS queries from your VPC resolve to the Amazon S3 public IP addresses, which
        routes traffic to the gateway endpoint.</p>
      
       
        <h6>Private DNS</h6>
        <p>If you configure private DNS for your interface endpoint for Amazon S3 but do not configure
          private DNS only for the inbound Resolver endpoint, requests from both your on-premises
          network and your VPC use the interface endpoint to access Amazon S3. Therefore, you pay to use
          the interface endpoint for traffic from the VPC, instead of using the gateway endpoint for
          no additional charge.</p>
       
      <div class="mediaobject">
         
          <img src="/images/vpc/latest/privatelink/images/s3-private-dns-default.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;          Conceptual graphic that shows how Amazon S3 requests are routed by default when&#xA;            you have both endpoint types.&#xA;        " />
         
         
      </div>
      
       
        <h6>Private DNS only for the inbound Resolver endpoint</h6>
        <p>If you configure private DNS only for the inbound Resolver endpoint, requests from your 
          on-premises network use the interface endpoint to access Amazon S3, and requests from your VPC 
          use the gateway endpoint to access Amazon S3. Therefore, you optimize your costs, because you 
          pay to use the interface endpoint only for traffic that can't use the gateway endpoint.</p>
       
      <div class="mediaobject">
         
          <img src="/images/vpc/latest/privatelink/images/s3-private-dns-inbound-endpoint.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;          Conceptual graphic that shows how Amazon S3 requests are routed when you have both &#xA;            endpoint types and you configure private DNS with an inbound Resolver endpoint.&#xA;        " />
         
         
      </div>
      
       
        <h6>Configure private DNS</h6>
        <p>You can configure private DNS for an interface endpoint for Amazon S3 when you create 
          it or after you create it. For more information, see <a href="./create-interface-endpoint.html#create-interface-endpoint-aws">Create a VPC endpoint</a> (configure during creation) or <a href="./interface-endpoints.html#enable-private-dns-names">Enable private DNS names</a> (configure after creation).</p>
       
     
      <h2 id="create-gateway-endpoint-s3">Create a gateway endpoint</h2>
      <p>Use the following procedure to create a gateway endpoint that connects to Amazon S3.</p>
      <div class="procedure"><h6>To create a gateway endpoint using the console</h6><ol><li><p>Open the Amazon VPC console at
         <a href="https://console.aws.amazon.com/vpc/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/vpc/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
          <p>In the navigation pane, choose <b>Endpoints</b>.</p>
        </li><li>
          <p>Choose <b>Create endpoint</b>.</p>
        </li><li>
          <p>For <b>Service category</b>, choose <b>AWS services</b>.</p>
        </li><li>
          <p>For <b>Services</b>, add the filter <b>Type: Gateway</b> 
            and select <b>com.amazonaws.</b><code class="replaceable">region</code><b>.s3</b>.</p>
        </li><li>
          <p>For <b>VPC</b>, select the VPC in which to create the
            endpoint.</p>
        </li><li>
          <p>For <b>Route tables</b>, select the route tables to be used 
            by the endpoint. We automatically add a route that points traffic destined for 
            the service to the endpoint network interface.</p>
        </li><li>
          <p>For <b>Policy</b>, select <b>Full access</b> to allow
            all operations by all principals on all resources over the VPC endpoint. Otherwise, select 
            <b>Custom</b> to attach a VPC endpoint policy that controls the permissions
            that principals have to perform actions on resources over the VPC endpoint.</p>
        </li><li>
          <p>(Optional) To add a tag, choose <b>Add new tag</b> and enter the tag
            key and the tag value.</p>
        </li><li>
          <p>Choose <b>Create endpoint</b>.</p>
        </li></ol></div>
      <div class="itemizedlist">
        <h6>To create a gateway endpoint using the command line</h6>
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/create-vpc-endpoint.html">create-vpc-endpoint</a> (AWS CLI)</p>
        </li><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/New-EC2VpcEndpoint.html">New-EC2VpcEndpoint</a> (Tools for Windows PowerShell)</p>
        </li></ul></div>
     
      <h2 id="bucket-policies-s3">Control access using bucket policies</h2>
      <p>You can use bucket policies to control access to buckets from specific endpoints, VPCs,
        IP address ranges, and AWS accounts. These examples assume that there are also policy
        statements that allow the access required for your use cases.</p>
      <div class="example"><h6>Example: Restrict access to a specific endpoint</h6><div class="example-contents"><p>You can create a bucket policy that restricts access to a specific endpoint by using
          the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourcevpce">aws:sourceVpce</a> condition key. The following policy denies access to the
          specified bucket unless the specified gateway endpoint is used. Using this policy blocks
          access to the bucket that doesn't come through the VPC endpoint, including access through
          the AWS Management Console.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Id": "Access-to-bucket-using-specific-endpoint",
  "Statement": [
    <span>{</span>
      "Sid": "Access-to-specific-VPCE-only",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": ["arn:aws:s3:::<code class="replaceable">bucket_name</code>",
                   "arn:aws:s3:::<code class="replaceable">bucket_name</code>/*"],
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:sourceVpce": "<code class="replaceable">vpce-1a2b3c4d</code>"
        }
      }
    }
  ]
}</code></pre></div></div>
      <div class="example"><h6>Example: Restrict access to a specific VPC</h6><div class="example-contents"><p>You can create a bucket policy that restricts access to specific VPCs by using the
            <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-sourcevpc">aws:sourceVpc</a> condition key. This is useful if you have multiple endpoints
          configured in the same VPC. The following policy denies access to the specified bucket and
          its objects that does not come from the specified VPC.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Id": "Access-to-bucket-using-specific-VPC",
  "Statement": [
    <span>{</span>
      "Sid": "Access-to-specific-VPC-only",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": ["arn:aws:s3:::<code class="replaceable">example_bucket</code>",
                   "arn:aws:s3:::<code class="replaceable">example_bucket</code>/*"],
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:sourceVpc": "<code class="replaceable">vpc-111bbb22</code>"
        }
      }
    }
  ]
}</code></pre></div></div>
      <div class="example"><h6>Example: Restrict access to a specific IP address range</h6><div class="example-contents"><p>You can create a policy that restricts access to specific IP address ranges by using
          the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-vpcsourceip">aws:VpcSourceIp</a> condition key. The following policy denies access to the
          specified bucket and its objects that does not come from the specified IP address.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Id": "Policy1415115909152",
  "Statement": [
    <span>{</span>
      "Sid": "Access-to-specific-VPC-CIDR-only",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": ["arn:aws:s3:::<code class="replaceable">bucket_name</code>",
                   "arn:aws:s3:::<code class="replaceable">bucket_name</code>/*"],
      "Condition": <span>{</span>
        "NotIpAddress": <span>{</span>
          "aws:VpcSourceIp": "<code class="replaceable">172.31.0.0/16</code>"
        }
      }
    }
  ]
}</code></pre></div></div>
      <div class="example"><h6>Example: Restrict access to buckets in a specific AWS account</h6><div class="example-contents"><p>You can create a policy that restricts access to the S3 buckets in a specific
          AWS account by using the <code class="code">s3:ResourceAccount</code> condition key. The 
          following policy denies access to resources that are not owned by the specified 
          AWS account. This example assumes that there is also a policy statement that 
          allows the access required for your use cases.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Id": "Policy1415115909152",
  "Statement": [
    <span>{</span>
      "Sid": "Access-to-bucket-in-specific-account-only",
      "Effect": "Deny",
      "Principal": "*",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::*",
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "s3:ResourceAccount": "<code class="replaceable">111122223333</code>"
        }
      }
    }
  ]
}</code></pre></div></div>
     
      <h2 id="associate-route-tables-s3">Associate route tables</h2>
      <p>You can change the route tables that are associated with the gateway endpoint.
        When you associate a route table, we automatically add a route that points traffic 
        destined for the service to the endpoint network interface. When you disassociate
        a route table, we automatically remove the endpoint route from the route table.</p>
      <div class="procedure"><h6>To associate route tables using the console</h6><ol><li><p>Open the Amazon VPC console at
         <a href="https://console.aws.amazon.com/vpc/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/vpc/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
          <p>In the navigation pane, choose <b>Endpoints</b>.</p>
        </li><li>
          <p>Select the gateway endpoint.</p>
        </li><li>
          <p>Choose <b>Actions</b>, <b>Manage route tables</b>.</p>
        </li><li>
          <p>Select or deselect route tables as needed.</p>
        </li><li>
          <p>Choose <b>Modify route tables</b>.</p>
        </li></ol></div>
      <div class="itemizedlist">
        <h6>To associate route tables using the command line</h6>
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/modify-vpc-endpoint.html">modify-vpc-endpoint</a> (AWS CLI)</p>
        </li><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Edit-EC2VpcEndpoint.html">Edit-EC2VpcEndpoint</a> (Tools for Windows PowerShell)</p>
        </li></ul></div>
     
      <h2 id="edit-vpc-endpoint-policy-s3">Edit the VPC endpoint policy</h2>
      <p>You can edit the endpoint policy for a gateway endpoint, which controls access to Amazon S3 
        from the VPC through the endpoint. The default policy allows full access. For more information,
        see <a href="./vpc-endpoints-access.html">Endpoint policies</a>.</p>
      <div class="procedure"><h6>To change the endpoint policy using the console</h6><ol><li><p>Open the Amazon VPC console at
         <a href="https://console.aws.amazon.com/vpc/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/vpc/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
          <p>In the navigation pane, choose <b>Endpoints</b>.</p>
        </li><li>
          <p>Select the gateway endpoint.</p>
        </li><li>
          <p>Choose <b>Actions</b>, <b>Manage policy</b>.</p>
        </li><li>
          <p>Choose <b>Full Access</b> to allow full access to the service, or
            choose <b>Custom</b> and attach a custom policy.</p>
        </li><li>
          <p>Choose <b>Save</b>.</p>
        </li></ol></div>

      <p>The following are example endpoint policies for accessing Amazon S3.</p>
      <div class="example"><h6>Example: Restrict access to a specific bucket</h6><div class="example-contents"><p>You can create a policy that restricts access to specific S3 buckets only. This is
          useful if you have other AWS services in your VPC that use S3 buckets.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Sid": "AccessToSpecificBucket",
  "Effect": "Allow",
  "Principal": "*",
  "Action": [
     "s3:ListBucket",
     "s3:GetObject",
     "s3:PutObject"
  ],
  "Resource": [
     "arn:aws:s3:::<code class="replaceable">bucket_name</code>",
     "arn:aws:s3:::<code class="replaceable">bucket_name</code>/*"
  ]
}</code></pre></div></div>
      <div class="example"><h6>Example: Restrict access to a specific IAM role</h6><div class="example-contents"><p>You can create a policy that restricts access to a specific IAM role. You must use
            <code class="code">aws:PrincipalArn</code> to grant access to a principal.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Sid": "Restrict-access-to-specific-IAM-role",
  "Effect": "Allow",
  "Principal": "*",
  "Action": "*",
  "Resource": "*",
  "Condition": <span>{</span>
    "ArnEquals": <span>{</span>
      "aws:PrincipalArn": "arn:aws:iam::<code class="replaceable">111122223333</code>:role/<code class="replaceable">role_name</code>"
    }
  }
}</code></pre></div></div>
      <div class="example"><h6>Example: Restrict access to users in a specific account</h6><div class="example-contents"><p>You can create a policy that restricts access to a specific account.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Sid": "AllowCallersFromAccount111122223333",
  "Effect": "Allow",
  "Principal": "*",
  "Action": "*",
  "Resource": "*",
  "Condition": <span>{</span>
    "StringEquals": <span>{</span>
      "aws:PrincipalAccount": "<code class="replaceable">111122223333</code>"
    }
  }
}</code></pre></div></div>
     
      <h2 id="delete-gateway-endpoint-s3">Delete a gateway endpoint</h2>
      <p>When you are finished with a gateway endpoint, you can delete it. When you delete a
        gateway endpoint, we remove the endpoint route from the subnet route tables.</p>
      <p>You can't delete a gateway endpoint if private DNS is enabled.</p>
      <div class="procedure"><h6>To delete a gateway endpoint using the console</h6><ol><li><p>Open the Amazon VPC console at
         <a href="https://console.aws.amazon.com/vpc/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/vpc/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
          <p>In the navigation pane, choose <b>Endpoints</b>.</p>
        </li><li>
          <p>Select the gateway endpoint.</p>
        </li><li>
          <p>Choose <b>Actions</b>, <b>Delete VPC endpoints</b>. </p>
        </li><li>
          <p>When prompted for confirmation, enter <code class="userinput">delete</code>.</p>
        </li><li>
          <p>Choose <b>Delete</b>.</p>
        </li></ol></div>
      <div class="itemizedlist">
        <h6>To delete a gateway endpoint using the command line</h6>
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/delete-vpc-endpoints.html">delete-vpc-endpoints</a> (AWS CLI)</p>
        </li><li class="listitem">
          <p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Remove-EC2VpcEndpoint.html">Remove-EC2VpcEndpoint</a> (Tools for Windows PowerShell)</p>
        </li></ul></div>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./gateway-endpoints.html">Gateway endpoints</div><div id="next" class="next-link" accesskey="n" href="./vpc-endpoints-ddb.html">Endpoints for DynamoDB</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=PrivateLink&amp;topic_url=https://docs.aws.amazon.com/en_us/vpc/latest/privatelink/vpc-endpoints-s3.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=PrivateLink&amp;topic_url=https://docs.aws.amazon.com/en_us/vpc/latest/privatelink/vpc-endpoints-s3.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>