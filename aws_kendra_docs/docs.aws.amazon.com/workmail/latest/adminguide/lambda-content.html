<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Retrieving message content with AWS Lambda - Amazon WorkMail</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="lambda-content" /><meta name="default_state" content="lambda-content" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/workmail/latest/adminguide/lambda-content.html" /><meta name="description" content="Learn how to use AWS Lambda functions to retrieve email message content in Amazon WorkMail." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon WorkMail" /><meta name="guide" content="Administrator Guide" /><meta name="abstract" content="Amazon WorkMail is a managed email and calendaring service that offers strong security controls and support for existing desktop and mobile clients." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/workmail/latest/adminguide/lambda-content.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/workmail/latest/adminguide/lambda-content.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/workmail/latest/adminguide/lambda-content.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/workmail/latest/adminguide/lambda-content.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/workmail/latest/adminguide/lambda-content.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/workmail/latest/adminguide/lambda-content.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/workmail/latest/adminguide/lambda-content.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/workmail/latest/adminguide/lambda-content.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/workmail/latest/adminguide/lambda-content.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/workmail/latest/adminguide/lambda-content.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/workmail/latest/adminguide/lambda-content.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/workmail/latest/adminguide/lambda-content.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/workmail/latest/adminguide/lambda-content.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/workmail/latest/adminguide/lambda-content.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/workmail/latest/adminguide/lambda-content.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/workmail/latest/adminguide/lambda-content.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/workmail/latest/adminguide/lambda-content.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/workmail/latest/adminguide/lambda-content.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/workmail/latest/adminguide/lambda-content.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/workmail/latest/adminguide/lambda-content.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/workmail/latest/adminguide/lambda-content.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/workmail/latest/adminguide/lambda-content.html" hreflang="x-default" /><meta name="feedback-item" content="WorkMail" /><meta name="this_doc_product" content="Amazon WorkMail" /><meta name="this_doc_guide" content="Administrator Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'workmail'}"></script><meta id="panorama-serviceSubSection" value="Administrator Guide" /><meta id="panorama-serviceConsolePage" value="Retrieving message content with AWS Lambda" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Retrieving message content with AWS Lambda - Amazon WorkMail</title><meta name="pdf" content="/pdfs/workmail/latest/adminguide/workmail-ag.pdf#lambda-content" /><meta name="github" content="https://github.com/awsdocs/amazon-workmail-administration-guide/tree/main/doc_source/lambda-content.md" /><meta name="rss" content="amazon-workmail-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=3" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=WorkMail&amp;topic_url=http://docs.aws.amazon.com/en_us/workmail/latest/adminguide/lambda-content.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/workmail/latest/adminguide/lambda-content.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/workmail/latest/adminguide/lambda-content.html" /><meta name="keywords" content="WorkMail,Amazon WorkMail,WorkMail directory,WorkMail administration" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon WorkMail",
        "item" : "https://docs.aws.amazon.com/workmail/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Administrator Guide",
        "item" : "https://docs.aws.amazon.com/workmail/latest/adminguide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Working with organizations",
        "item" : "https://docs.aws.amazon.com/workmail/latest/adminguide/organizations_overview.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Working with organization settings",
        "item" : "https://docs.aws.amazon.com/workmail/latest/adminguide/org-settings.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Managing email flows",
        "item" : "https://docs.aws.amazon.com/workmail/latest/adminguide/email-flows.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Configuring AWS Lambda for Amazon WorkMail",
        "item" : "https://docs.aws.amazon.com/workmail/latest/adminguide/lambda.html"
      },
      {
        "@type" : "ListItem",
        "position" : 8,
        "name" : "Retrieving message content with AWS Lambda",
        "item" : "https://docs.aws.amazon.com/workmail/latest/adminguide/lambda.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/workmail/latest/adminguide/workmail-ag.pdf#lambda-content" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/amazon-workmail-administration-guide/tree/main/doc_source/lambda-content.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/workmail/index.html">Amazon WorkMail</a><a href="what_is.html">Administrator Guide</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="lambda-content">Retrieving message content with AWS Lambda</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>After you configure an AWS Lambda function to manage email flows for Amazon WorkMail, you can
                access the full content of the email messages that are processed using Lambda. For
                more information about getting started with Lambda for Amazon WorkMail, see <a href="./lambda.html">Configuring AWS Lambda for
            Amazon WorkMail</a>.</p><p>To access the full content of email messages, use the
                    <code class="code">GetRawMessageContent</code> action in the Amazon WorkMail Message Flow API. The email
                message ID that is passed to your Lambda function upon invocation sends a request to
                the API. Then, the API responds with the full MIME content of the email message. For
                more information, see <a href="https://docs.aws.amazon.com/workmail/latest/APIReference/API_Operations_Amazon_WorkMail_Message_Flow.html">Amazon WorkMail Message Flow</a> in the <em>Amazon WorkMail API
                Reference</em>.</p><p>The following example shows how a Lambda function using the Python runtime
                environment can retrieve the full message content.</p><div class="awsdocs-note awsdocs-tip"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>If you start by deploying the Amazon WorkMail <a href="https://console.aws.amazon.com/lambda/home#/create/app?applicationId=arn:aws:serverlessrepo:us-east-1:489970191081:applications/workmail-hello-world-python" rel="noopener noreferrer" target="_blank"><span> Hello World Lambda function </span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> from the AWS Serverless Application Repository to your
                            account, the system creates a Lambda function in your account with all
                            the necessary resources and permission. You can then add your business
                            logic to the lambda function based on your use-case.</p></div></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">import boto3
import email
import os

def email_handler(event, context):
    workmail = boto3.client('workmailmessageflow', region_name=os.environ["<code class="replaceable">AWS_REGION</code>"])
    msg_id = event['messageId']
    raw_msg = workmail.get_raw_message_content(messageId=<code class="replaceable">msg_id</code>)

    parsed_msg = email.message_from_bytes(raw_msg['messageContent'].read())
    print(parsed_msg)</code></pre><p>For more detailed examples of ways to analyze the content of messages that are in transit, see the <a href="https://github.com/aws-samples/amazon-workmail-lambda-templates" rel="noopener noreferrer" target="_blank"><span>amazon-workmail-lambda-templates</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> repository on GitHub.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>You only use the Amazon WorkMail Message Flow API to access email messages in transit. You can only access the messages within 
                24 hours of being sent or received. To programmatically access messages in a user’s mailbox,
                    use one of the other protocols supported by Amazon WorkMail, such as IMAP or Exchange Web
                    Services (EWS).</p></div></div><awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./lambda.html">Configuring AWS Lambda for
            Amazon WorkMail</div><div id="next" class="next-link" accesskey="n" href="./update-with-lambda.html">Updating message content with AWS Lambda</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=WorkMail&amp;topic_url=https://docs.aws.amazon.com/en_us/workmail/latest/adminguide/lambda-content.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=WorkMail&amp;topic_url=https://docs.aws.amazon.com/en_us/workmail/latest/adminguide/lambda-content.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>