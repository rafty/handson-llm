<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Enriquecendo seus documentos durante a ingestão - Amazon Kendra</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="custom-document-enrichment" /><meta name="default_state" content="custom-document-enrichment" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" /><meta name="description" content="Como criar, modificar ou excluir os atributos e o conteúdo do documento durante o processo de ingestão de documentos noAmazon Kendra." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Kendra" /><meta name="guide" content="Guia do desenvolvedor" /><meta name="abstract" content="Fornece uma visão geral conceitual do Amazon Kendra. Saiba mais sobre osAmazon Kendra recursos e comece a indexar seus documentos usando o console, a CLI e a API." /><meta name="guide-locale" content="pt_br" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kendra/latest/dg/custom-document-enrichment.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kendra/latest/dg/custom-document-enrichment.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kendra/latest/dg/custom-document-enrichment.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kendra/latest/dg/custom-document-enrichment.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/kendra/latest/dg/custom-document-enrichment.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/kendra/latest/dg/custom-document-enrichment.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kendra/latest/dg/custom-document-enrichment.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kendra/latest/dg/custom-document-enrichment.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kendra/latest/dg/custom-document-enrichment.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kendra/latest/dg/custom-document-enrichment.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kendra/latest/dg/custom-document-enrichment.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kendra/latest/dg/custom-document-enrichment.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kendra/latest/dg/custom-document-enrichment.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kendra/latest/dg/custom-document-enrichment.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kendra/latest/dg/custom-document-enrichment.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kendra/latest/dg/custom-document-enrichment.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/kendra/latest/dg/custom-document-enrichment.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/kendra/latest/dg/custom-document-enrichment.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/kendra/latest/dg/custom-document-enrichment.html" hreflang="x-default" /><meta name="feedback-item" content="Kendra" /><meta name="this_doc_product" content="Amazon Kendra" /><meta name="this_doc_guide" content="Guia do desenvolvedor" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'kendra'}"></script><meta id="panorama-serviceSubSection" value="Guia do desenvolvedor" /><meta id="panorama-serviceConsolePage" value="Enriquecendo seus documentos durante a ingestão" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Enriquecendo seus documentos durante a ingestão - Amazon Kendra</title><meta name="pdf" content="kendra-dg.pdf#custom-document-enrichment" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Kendra&amp;topic_url=http://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html" /><meta name="keywords" content="Kendra,Amazon Kendra,pesquisa,pesquisa inteligente,linguagem natural,índice,question,palavra-chave,fonte de dados,conectora,Perguntas frequentes,pergunta frequente" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Kendra",
        "item" : "https://docs.aws.amazon.com/kendra/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Guia do desenvolvedor",
        "item" : "https://docs.aws.amazon.com/pt_br/kendra/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Enriquecendo seus documentos durante a ingestão",
        "item" : "https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="kendra-dg.pdf#custom-document-enrichment" target="_blank" rel="noopener noreferrer" title="Abrir em PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentação</a><a href="/kendra/index.html">Amazon Kendra</a><a href="what-is-kendra.html">Guia do desenvolvedor</a></div><div id="page-toc-src"><a href="#how-custom-document-enrichment-works">Como funciona o enriquecimento de documentos personalizados</a><a href="#basic-data-maniplation">Operações básicas para alterar metadados</a><a href="#advanced-data-manipulation">Funções do Lambda: extrair e alterar metadados ou conteúdo</a><a href="#cde-data-contracts-lambda">Contratos de dados para funções do Lambda</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>As traduções são geradas por tradução automática. Em caso de conflito entre o conteúdo da tradução e da versão original em inglês, a versão em inglês prevalecerá.</p></awsui-alert><h1 class="topictitle" id="custom-document-enrichment">Enriquecendo seus documentos durante a ingestão</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Você pode alterar os campos ou atributos de conteúdo e os metadados do documento durante o processo de ingestão de documentos. ComAmazon Kendra o recurso de <em>enriquecimento personalizado de documentos</em>, você pode criar, modificar ou excluir atributos e conteúdo do documento ao ingerir seus documentosAmazon Kendra. Isso significa que você pode manipular e ingerir seus dados conforme necessário.</p><p>Esse recurso permite que você controle como seus documentos são tratados e ingeridosAmazon Kendra. Por exemplo, você pode apagar informações de identificação pessoal nos metadados do documento enquanto ingere seus documentosAmazon Kendra.</p><p>Outra forma de usar esse recurso é invocar uma função LambdaAWS Lambda para executar o reconhecimento óptico de caracteres (OCR) em imagens, tradução em texto e outras tarefas para preparar os dados para pesquisa ou análise. Por exemplo, você pode invocar uma função para executar o OCR em imagens. A função pode interpretar texto de imagens e tratar cada imagem como um documento textual. Uma empresa que recebe pesquisas de clientes enviadas por correio e armazena essas pesquisas como imagens pode ingerir essas imagens como documentos textuaisAmazon Kendra. A empresa pode então pesquisar informações valiosas sobre pesquisas com clientes emAmazon Kendra.</p><p>Você pode usar operações básicas para aplicar como uma primeira análise de seus dados e, em seguida, usar uma função Lambda para aplicar operações mais complexas em seus dados. Por exemplo, você pode usar uma operação básica para simplesmente remover todos os valores no campo de metadados do documento 'Customer_ID' e, em seguida, aplicar uma função Lambda para extrair texto das imagens do texto nos documentos.</p>
        <h2 id="how-custom-document-enrichment-works">Como funciona o enriquecimento de documentos personalizados</h2>
        <p>O processo geral de enriquecimento de documentos personalizados é o seguinte:</p>
        <div class="orderedlist">
             
             
             
             
        <ol><li>
                <p>Você configura o enriquecimento personalizado de documentos ao criar ou atualizar sua fonte de dados ou indexa seus documentos diretamente emAmazon Kendra.</p>
            </li><li>
                <p>Amazon Kendraaplica configurações em linha ou lógica básica para alterar seus dados. Para obter mais informações, consulte <a href="#basic-data-maniplation">Operações básicas para alterar metadados</a>.</p>
            </li><li>
                <p>Se você optar por configurar a manipulação avançada de dados,Amazon Kendra poderá aplicar isso em seus documentos originais, brutos ou em documentos estruturados e analisados. Para obter mais informações, consulte <a href="#advanced-data-manipulation">Funções do Lambda: extrair e alterar metadados ou conteúdo</a>.</p>
            </li><li>
                <p>Seus documentos alterados são ingeridosAmazon Kendra.</p>
            </li></ol></div>
        <p>Em qualquer ponto desse processo, se sua configuração não for válida,Amazon Kendra gerará um erro.</p>
        <p>Ao chamar <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_CreateDataSource.html">CreateDataSource<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_UpdateDataSource.html">UpdateDataSource</a></a>, ou <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_BatchPutDocument.html">BatchPutDocument</a>APIs, você fornece sua configuração personalizada de enriquecimento de documentos. Se você ligar<code class="code">BatchPutDocument</code>, deverá configurar o Enriquecimento Personalizado de Documentos com cada solicitação. Se você usa o console, seleciona seu índice e, em seguida, seleciona <b>Enriquecimento de documentos</b> para configurar o Enriquecimento personalizado de documentos.</p>
        <p>Se você usar <b>enriquecimento de documentos</b> no console, poderá optar por configurar somente operações básicas ou somente funções do Lambda ou ambas, como você pode usar a API. Você pode selecionar <b>Avançar</b> nas etapas do console para optar por não configurar as operações básicas e somente as funções do Lambda, incluindo se deseja aplicar aos dados originais (pré-extração) ou estruturados (pós-extração). Você só pode salvar suas configurações concluindo todas as etapas no console. As configurações do seu documento não serão salvas se você não concluir todas as etapas.</p>
     
        <h2 id="basic-data-maniplation">Operações básicas para alterar metadados</h2>
        <p>Você pode manipular os campos e o conteúdo do seu documento usando a lógica básica. Isso inclui remover valores em um campo, modificar valores em um campo usando uma condição ou criar um campo. Para manipulações avançadas que vão além do que você pode manipular usando a lógica básica, invoque uma função Lambda. Para obter mais informações, consulte <a href="#advanced-data-manipulation">Funções do Lambda: extrair e alterar metadados ou conteúdo</a>.</p>
        <p>Para aplicar a lógica básica, você especifica o campo de destino que deseja manipular usando o <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_DocumentAttributeTarget.html">DocumentAttributeTarget</a>objeto. Você fornece a chave do atributo. Por exemplo, a chave “Department” (Departamento) é um campo ou atributo que contém todos os nomes de departamento associados aos documentos. Você também pode especificar um valor a ser usado no campo de destino se uma determinada condição for atendida. Você define a condição usando o <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_DocumentAttributeCondition.html">DocumentAttributeCondition</a>objeto. Por exemplo, se o campo “Source_URI” contiver “financial” (financeiro) como valor de URI, o campo de destino “Department” (Departamento) será preenchido previamente com o valor de destino “Financeiro” para o documento. Você também pode excluir os valores do documento de destino.</p>
        <p>Para aplicar a lógica básica usando o console, selecione seu índice e selecione <b>Enriquecimento de documentos</b> no menu de navegação. Acesse <b>Configurar operações básicas</b> para aplicar manipulações básicas aos campos e ao conteúdo do documento.</p>
        <p>A seguir, um exemplo do uso da lógica básica para remover todos os números de identificação do cliente no campo “Customer_ID”.</p>
        <p><b>Exemplo 1: Removendo números de identificação do cliente associados aos documentos</b></p>
        <p>Dados antes da aplicação da manipulação básica.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c13c15"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Texto_corporal</b></th>
                        <th><b>ID do cliente</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>Lorem Ipsum.</td>
                        <td>CID1234</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lorem Ipsum.</td>
                        <td>CID1235</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Lorem Ipsum.</td>
                        <td>CID1236</td>
                    </tr>
                </table></div></div>
        <p>Dados após a manipulação básica aplicada.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c13c19"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Texto_corporal</b></th>
                        <th><b>ID do cliente</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>Lorem Ipsum.</td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lorem Ipsum.</td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Lorem Ipsum.</td>
                        <td> </td>
                    </tr>
                </table></div></div>
        <p>Veja a seguir um exemplo de como usar a lógica básica para criar um campo chamado 'Departamento' e preencher esse campo com os nomes dos departamentos com base nas informações do campo 'Source_URI'. Isso usa a condição determinando que, se o campo “Source_URI” contiver “financial” (financeiro) como valor de URI, o campo de destino “Department” (Departamento) será preenchido previamente com o valor de destino “Financeiro” para o documento.</p>
        <p><b>Exemplo 2: Criar o campo “Departamento” e preenchê-lo previamente com nomes de departamentos associados aos documentos usando uma condição.</b></p>
        <p>Dados antes da aplicação da manipulação básica.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c13c27"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Texto_corporal</b></th>
                        <th><b>Fonte_URI</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>Lorem Ipsum.</td>
                        <td>financeiros (1 1)</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lorem Ipsum.</td>
                        <td>financeiros ou 2 2 2 Financeiro</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Lorem Ipsum.</td>
                        <td>financeiros ou 3 3 3 Financeiro</td>
                    </tr>
                </table></div></div>
        <p>Dados após a manipulação básica aplicada.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c13c31"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Texto_corporal</b></th>
                        <th><b>Fonte_URI</b></th>
                        <th><b>Departamento</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>Lorem Ipsum.</td>
                        <td>financeiros (1 1)</td>
                        <td>Finanças</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lorem Ipsum.</td>
                        <td>financeiros ou 2 2 2 Financeiro</td>
                        <td>Finanças</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Lorem Ipsum.</td>
                        <td>financeiros ou 3 3 3 Financeiro</td>
                        <td>Finanças</td>
                    </tr>
                </table></div></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>nota</h6></div><div class="awsdocs-note-text"><p>Amazon Kendranão poderá criar um campo de documento de destino se ele ainda não tiver sido criado como um campo de índice. Depois de criar o campo de índice, você poderá criar um campo de documento usando<code class="code">DocumentAttributeTarget</code>. Amazon Kendraem seguida, mapeia o campo de metadados do documento recém-criado para o campo de índice.</p></div></div>
        <p>O código a seguir é um exemplo de configuração da manipulação básica de dados para remover os números de identificação do cliente associados aos documentos.</p>
        <awsdocs-tabs><dl style="display: none">
            <dt>Console</dt><dd tab-id="console">
                    
                    <div class="procedure"><h6>Para configurar a manipulação básica de dados para remover números de identificação do cliente</h6><ol><li>
                            <p>No painel de navegação esquerdo, em <b>Índices</b>, selecione <b>Enriquecimento de documentos</b> e selecione <b>Adicionar enriquecimento de documento</b>.</p>
                        </li><li>
                            <p>Na página <b>Configurar operações básicas</b>, escolha na lista suspensa sua fonte de dados que você deseja alterar os campos e o conteúdo do documento. Em seguida, escolha no menu suspenso o nome do campo do documento 'Customer_ID', selecione no menu suspenso o nome do campo de índice 'Customer_ID' e selecione no menu suspenso a ação de destino <b>Excluir</b>. Em seguida, selecione <b>Adicionar operação básica</b>.</p>
                        </li></ol></div>
                </dd>
            <dt>CLI</dt><dd tab-id="cli">
                    <p><b>Para configurar a manipulação básica de dados para remover números de identificação do cliente</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws kendra create-data-source \
 --name <code class="replaceable">data-source-name</code> \
 --index-id <code class="replaceable">index-id</code> \
 --role-arn <code class="replaceable">arn:aws:iam::account-id:role/role-name</code> \
 --type S3 \
 --configuration '<span>{</span>"S3Configuration":<span>{</span>"BucketName":"<code class="replaceable">S3-bucket-name</code>"}}' \
 --custom-document-enrichment-configuration '<span>{</span>"InlineConfigurations":[<span>{</span>"Target":<span>{</span>"TargetDocumentAttributeKey":"Customer_ID", "TargetDocumentAttributeValueDeletion": true}}]}' 
</code></pre>
                </dd>
            <dt>Python</dt><dd tab-id="python">
                    <p><b>Para configurar a manipulação básica de dados para remover números de identificação do cliente</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import boto3&#xD;
from botocore.exceptions import ClientError&#xD;
import pprint&#xD;
import time&#xD;
&#xD;
kendra = boto3.client("kendra")&#xD;
&#xD;
print("Create a data source with customizations")&#xD;
&#xD;
# Provide the name of the data source&#xD;
name = "data-source-name"&#xD;
# Provide the index ID for the data source&#xD;
index_id = "index-id"&#xD;
# Provide the IAM role ARN required for data sources&#xD;
role_arn = "arn:aws:iam::$<span>{</span>account-id}:role/$<span>{</span>role-name}"&#xD;
# Provide the data source connection information&#xD;
data_source_type = "S3"&#xD;
S3_bucket_name = "S3-bucket-name"&#xD;
# Configure the data source with Custom Document Enrichment&#xD;
configuration = <span>{</span>"S3Configuration":&#xD;
        <span>{</span>&#xD;
            "BucketName": S3_bucket_name&#xD;
        }&#xD;
    }&#xD;
custom_document_enrichment_configuration = <span>{</span>"InlineConfigurations":[&#xD;
        <span>{</span>&#xD;
            "Target":<span>{</span>"TargetDocumentAttributeKey":"Customer_ID",&#xD;
                       "TargetDocumentAttributeValueDeletion": True}&#xD;
        }]&#xD;
    }&#xD;
&#xD;
try:&#xD;
    data_source_response = kendra.create_data_source(&#xD;
        Name = name,&#xD;
        IndexId = index_id,&#xD;
        RoleArn = role_arn,&#xD;
        Type = data_source_type&#xD;
        Configuration = configuration&#xD;
        CustomDocumentEnrichmentConfiguration = custom_document_enrichment_configuration&#xD;
    )&#xD;
&#xD;
    pprint.pprint(data_source_response)&#xD;
&#xD;
    data_source_id = data_source_response["Id"]&#xD;
&#xD;
    print("Wait for Amazon Kendra to create the data source with your customizations.")&#xD;
&#xD;
    while True:&#xD;
        # Get the details of the data source, such as the status&#xD;
        data_source_description = kendra.describe_data_source(&#xD;
            Id = data_source_id,&#xD;
            IndexId = index_id&#xD;
        )&#xD;
        status = data_source_description["Status"]&#xD;
        print(" Creating data source. Status: "+status)&#xD;
        time.sleep(60)&#xD;
        if status != "CREATING":&#xD;
            break&#xD;
&#xD;
    print("Synchronize the data source.")&#xD;
&#xD;
    sync_response = kendra.start_data_source_sync_job(&#xD;
        Id = data_source_id,&#xD;
        IndexId = index_id&#xD;
    )&#xD;
&#xD;
    pprint.pprint(sync_response)&#xD;
&#xD;
    print("Wait for the data source to sync with the index.")&#xD;
&#xD;
    while True:&#xD;
&#xD;
        jobs = kendra.list_data_source_sync_jobs(&#xD;
            Id= data_source_id,&#xD;
            IndexId= index_id&#xD;
        )&#xD;
&#xD;
        # For this example, there should be one job&#xD;
        status = jobs["History"][0]["Status"]&#xD;
&#xD;
        print(" Syncing data source. Status: "+status)&#xD;
        time.sleep(60)&#xD;
        if status != "SYNCING":&#xD;
            break&#xD;
&#xD;
except  ClientError as e:&#xD;
        print("%s" % e)&#xD;
&#xD;
print("Program ends.")</code></pre>
                </dd>
            <dt>Java</dt><dd tab-id="java">
                    <p><b>Para configurar a manipulação básica de dados para remover números de identificação do cliente</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="java ">package com.amazonaws.kendra;

import java.util.concurrent.TimeUnit;
import software.amazon.awssdk.services.kendra.KendraClient;
import software.amazon.awssdk.services.kendra.model.CreateDataSourceRequest;
import software.amazon.awssdk.services.kendra.model.CreateDataSourceResponse;
import software.amazon.awssdk.services.kendra.model.CreateIndexRequest;
import software.amazon.awssdk.services.kendra.model.CreateIndexResponse;
import software.amazon.awssdk.services.kendra.model.DataSourceConfiguration;
import software.amazon.awssdk.services.kendra.model.DataSourceStatus;
import software.amazon.awssdk.services.kendra.model.DataSourceSyncJob;
import software.amazon.awssdk.services.kendra.model.DataSourceSyncJobStatus;
import software.amazon.awssdk.services.kendra.model.DataSourceType;
import software.amazon.awssdk.services.kendra.model.DescribeDataSourceRequest;
import software.amazon.awssdk.services.kendra.model.DescribeDataSourceResponse;
import software.amazon.awssdk.services.kendra.model.DescribeIndexRequest;
import software.amazon.awssdk.services.kendra.model.DescribeIndexResponse;
import software.amazon.awssdk.services.kendra.model.IndexStatus;
import software.amazon.awssdk.services.kendra.model.ListDataSourceSyncJobsRequest;
import software.amazon.awssdk.services.kendra.model.ListDataSourceSyncJobsResponse;
import software.amazon.awssdk.services.kendra.model.S3DataSourceConfiguration;
import software.amazon.awssdk.services.kendra.model.StartDataSourceSyncJobRequest;
import software.amazon.awssdk.services.kendra.model.StartDataSourceSyncJobResponse;

public class CreateDataSourceWithCustomizationsExample <span>{</span>

    public static void main(String[] args) throws InterruptedException <span>{</span>
        System.out.println("Create a data source with customizations");
        
        String dataSourceName = "data-source-name";
        String indexId = "index-id";
        String dataSourceRoleArn = "arn:aws:iam::account-id:role/role-name";
        String s3BucketName = "S3-bucket-name"

        KendraClient kendra = KendraClient.builder().build();
        
        CreateDataSourceRequest createDataSourceRequest = CreateDataSourceRequest
            .builder()
            .name(dataSourceName)
            .description(experienceDescription)
            .roleArn(experienceRoleArn)
            .type(DataSourceType.S3)
            .configuration(
                DataSourceConfiguration
                    .builder()
                    .s3Configuration(
                        S3DataSourceConfiguration
                            .builder()
                            .bucketName(s3BucketName)
                            .build()
                    ).build()
            )
            .customDocumentEnrichmentConfiguration(
                CustomDocumentEnrichmentConfiguration
                    .builder()
                    .inlineConfigurations(Arrays.asList(
                        InlineCustomDocumentEnrichmentConfiguration
                            .builder()
                            .target(
                                DocumentAttributeTarget
                                    .builder()
                                    .targetDocumentAttributeKey("Customer_ID")
                                    .targetDocumentAttributeValueDeletion(true)
                                    .build())
                            .build()
                    )).build();
        
        CreateDataSourceResponse createDataSourceResponse = kendra.createDataSource(createDataSourceRequest);
        System.out.println(String.format("Response of creating data source: %s", createDataSourceResponse));

        String dataSourceId = createDataSourceResponse.id();
        System.out.println(String.format("Waiting for Kendra to create the data source %s", dataSourceId));
        DescribeDataSourceRequest describeDataSourceRequest = DescribeDataSourceRequest
            .builder()
            .indexId(indexId)
            .id(dataSourceId)
            .build();

        while (true) <span>{</span>
            DescribeDataSourceResponse describeDataSourceResponse = kendra.describeDataSource(describeDataSourceRequest);

            DataSourceStatus status = describeDataSourceResponse.status();
            System.out.println(String.format("Creating data source. Status: %s", status));
            TimeUnit.SECONDS.sleep(60);
            if (status != DataSourceStatus.CREATING) <span>{</span>
                break;
            }
        }

        System.out.println(String.format("Synchronize the data source %s", dataSourceId));
        StartDataSourceSyncJobRequest startDataSourceSyncJobRequest = StartDataSourceSyncJobRequest
            .builder()
            .indexId(indexId)
            .id(dataSourceId)
            .build();
        StartDataSourceSyncJobResponse startDataSourceSyncJobResponse = kendra.startDataSourceSyncJob(startDataSourceSyncJobRequest);
        System.out.println(String.format("Waiting for the data source to sync with the index %s for execution ID %s", indexId, startDataSourceSyncJobResponse.executionId()));

        // For this example, there should be one job
        ListDataSourceSyncJobsRequest listDataSourceSyncJobsRequest = ListDataSourceSyncJobsRequest
            .builder()
            .indexId(indexId)
            .id(dataSourceId)
            .build();

        while (true) <span>{</span>
            ListDataSourceSyncJobsResponse listDataSourceSyncJobsResponse = kendra.listDataSourceSyncJobs(listDataSourceSyncJobsRequest);
            DataSourceSyncJob job = listDataSourceSyncJobsResponse.history().get(0);
            System.out.println(String.format("Syncing data source. Status: %s", job.status()));

            TimeUnit.SECONDS.sleep(60);
            if (job.status() != DataSourceSyncJobStatus.SYNCING) <span>{</span>
                break;
            }

        }

        System.out.println("Data source creation with customizations is complete");
    }
}</code></pre>
                </dd>
        </dl></awsdocs-tabs>
     
        <h2 id="advanced-data-manipulation">Funções do Lambda: extrair e alterar metadados ou conteúdo</h2>
        <p>Você pode manipular os campos e o conteúdo do seu documento usando as funções do Lambda. Isso é útil se você quiser ir além da lógica básica e aplicar manipulações avançadas de dados. Por exemplo, usando o reconhecimento óptico de caracteres (OCR), que interpreta o texto das imagens e trata cada imagem como um documento textual. Ou, recuperando a data e hora atual em um determinado fuso horário e inserindo a data e hora onde há um valor vazio para um campo de data.</p>
        <p>Você pode aplicar primeiro a lógica básica e depois usar uma função Lambda para manipular ainda mais seus dados, ou vice-versa. Você também pode optar por aplicar somente uma função Lambda.</p>
        <p>Amazon Kendrapode invocar uma função Lambda para aplicar manipulações avançadas de dados durante o processo de ingestão como parte do seu <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_CustomDocumentEnrichmentConfiguration.html">CustomDocumentEnrichmentConfiguration</a>. Você especifica uma função que inclui permissão para executar a função Lambda e acessar seuAmazon S3 bucket para armazenar a saída de suas manipulações de dados — consulte <a href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html">funções deIAM acesso</a>.</p>
        <p>Amazon Kendrapode aplicar uma função Lambda nos documentos originais ou brutos ou brutos ou brutos ou os documentos estruturados e analisados. Você pode configurar uma função Lambda que pega seus dados originais ou brutos e aplica suas manipulações de dados usando <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_CustomDocumentEnrichmentConfiguration.html">PreExtractionHookConfiguration</a>. Você também pode configurar uma função Lambda que pega seus documentos estruturados e aplica suas manipulações de dados usando <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_CustomDocumentEnrichmentConfiguration.html">PostExtractionHookConfiguration</a>. Amazon Kendraextrai os metadados e o texto do documento para estruturar seus documentos. Suas funções do Lambda devem seguir as estruturas obrigatórias de solicitação e resposta. Para obter mais informações, consulte <a href="#cde-data-contracts-lambda">Contratos de dados para funções do Lambda</a>.</p>
        <p>Para configurar uma função Lambda no console, selecione seu índice e selecione <b>Enriquecimento de documentos</b> no menu de navegação. Acesse <b>Configurar funções do Lambda</b> para configurar uma função do Lambda.</p>
        <p>Você pode configurar somente uma função Lambda para<code class="code">PreExtractionHookConfiguration</code> e somente uma função Lambda para<code class="code">PostExtractionHookConfiguration</code>. No entanto, sua função Lambda pode invocar outras funções necessárias. Você pode configurar ambos<code class="code">PreExtractionHookConfiguration</code> e<code class="code">PostExtractionHookConfiguration</code> ou qualquer um deles. Sua função Lambda para não<code class="code">PreExtractionHookConfiguration</code> deve exceder um tempo de execução de 5 minutos e sua função Lambda para não<code class="code">PostExtractionHookConfiguration</code> deve exceder um tempo de execução de 1 minuto. A configuração do enriquecimento personalizado de documentos naturalmente leva mais tempo para ingerir seus documentosAmazon Kendra do que se você não o configurasse.</p>
        <p>Você pode configurarAmazon Kendra para invocar uma função Lambda somente se uma condição for atendida. Por exemplo, você pode especificar uma condição determinando que, se houver valores de data e hora vazios,Amazon Kendra deverá invocar uma função para inserir a data e hora atuais.</p>
        <p>Veja a seguir um exemplo do uso de uma função Lambda para executar o OCR para interpretar texto de imagens e armazenar esse texto em um campo chamado 'Document_Image_Text'.</p>
        <p><b>Exemplo 1: Extraindo texto de imagens para criar documentos textuais</b></p>
        <p>Dados antes da aplicação da manipulação avançada.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c15c23"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Documento_Imagem</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>image_1.png</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>image_2.png</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>image_3.png</td>
                    </tr>
                </table></div></div>
        <p>Dados após manipulação avançada aplicada.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c15c27"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Documento_Imagem</b></th>
                        <th><b>Documento_Imagem_Texto</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>image_1.png</td>
                        <td>Resposta de pesquisa enviada por correio</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>image_2.png</td>
                        <td>Resposta de pesquisa enviada por correio</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>image_3.png</td>
                        <td>Resposta de pesquisa enviada por correio</td>
                    </tr>
                </table></div></div>
        <p>A seguir está um exemplo do uso de uma função Lambda para inserir a data e hora atual para valores de data vazios. Isso usa a condição de que, se o valor de um campo de data for 'nulo', substitua-o pela data e hora atual.</p>
        <p><b>Exemplo 2: Substituindo valores vazios no campo Last_Updated pela data e hora atual.</b></p>
        <p>Dados antes da aplicação da manipulação avançada.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c15c35"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Texto_corporal</b></th>
                        <th><b>Última atualização</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>Lorem Ipsum.</td>
                        <td>1º de janeiro de 2020 de janeiro de 2020</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lorem Ipsum.</td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Lorem Ipsum.</td>
                        <td>1.º de julho de 2020</td>
                    </tr>
                </table></div></div>
        <p>Dados após manipulação avançada aplicada.</p>
        <div class="table-container"><div class="table-contents"><table id="w1460aac27c15c39"><thead>
                    <tr>
                        <th><b>ID do documento</b></th>
                        <th><b>Texto_corporal</b></th>
                        <th><b>Última atualização</b></th>
                    </tr>
                </thead>
                    <tr>
                        <td>1</td>
                        <td>Lorem Ipsum.</td>
                        <td>1º de janeiro de 2020 de janeiro de 2020</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Lorem Ipsum.</td>
                        <td>1.º de dezembro de 2021</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Lorem Ipsum.</td>
                        <td>1.º de julho de 2020</td>
                    </tr>
                </table></div></div>
        <p>O código a seguir é um exemplo de configuração de uma função Lambda para manipulação avançada de dados nos dados originais brutos.</p>
        <awsdocs-tabs><dl style="display: none">
            <dt>Console</dt><dd tab-id="console">
                    
                    <div class="procedure"><h6>Para configurar uma função Lambda para manipulação avançada de dados nos dados originais brutos</h6><ol><li>
                            <p>No painel de navegação esquerdo, em <b>Índices</b>, selecione <b>Enriquecimento de documentos</b> e selecione <b>Adicionar enriquecimento de documento</b>.</p>
                        </li><li>
                            <p>Na página <b>Configurar funções do Lambda</b>, na seção <b>Lambda para pré-extração</b>, selecione nas listas suspensas o ARN da função do Lambda e seuAmazon S3 bucket. Adicione sua função deIAM acesso selecionando a opção de criar uma nova função no menu suspenso. Isso cria asAmazon Kendra permissões necessárias para criar o enriquecimento do documento.</p>
                        </li></ol></div>
                </dd>
            <dt>CLI</dt><dd tab-id="cli">
                    <p><b>Para configurar uma função Lambda para manipulação avançada de dados nos dados originais brutos</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws kendra create-data-source \
 --name <code class="replaceable">data-source-name</code> \
 --index-id <code class="replaceable">index-id</code> \
 --role-arn <code class="replaceable">arn:aws:iam::account-id:role/role-name</code> \
 --type S3 \
 --configuration '<span>{</span>"S3Configuration":<span>{</span>"BucketName":"<code class="replaceable">S3-bucket-name</code>"}}' \
 --custom-document-enrichment-configuration '<span>{</span>"PreExtractionHookConfiguration":<span>{</span>"LambdaArn":"<code class="replaceable">arn:aws:iam::account-id:function/function-name</code>", "S3Bucket":"<code class="replaceable">S3-bucket-name</code>"}, "RoleArn": "<code class="replaceable">arn:aws:iam:account-id:role/cde-role-name</code>"}'
</code></pre>
                </dd>
            <dt>Python</dt><dd tab-id="python">
                    <p><b>Para configurar uma função Lambda para manipulação avançada de dados nos dados originais brutos</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import boto3&#xD;
from botocore.exceptions import ClientError&#xD;
import pprint&#xD;
import time&#xD;
&#xD;
kendra = boto3.client("kendra")&#xD;
&#xD;
print("Create a data source with customizations.")&#xD;
&#xD;
# Provide the name of the data source&#xD;
name = "data-source-name"&#xD;
# Provide the index ID for the data source&#xD;
index_id = "index-id"&#xD;
# Provide the IAM role ARN required for data sources&#xD;
role_arn = "arn:aws:iam::$<span>{</span>account-id}:role/$<span>{</span>role-name}"&#xD;
# Provide the data source connection information&#xD;
data_source_type = "S3"&#xD;
S3_bucket_name = "S3-bucket-name"&#xD;
# Configure the data source with Custom Document Enrichment&#xD;
configuration = <span>{</span>"S3Configuration":&#xD;
        <span>{</span>&#xD;
            "BucketName": S3_bucket_name&#xD;
        }&#xD;
    }&#xD;
custom_document_enrichment_configuration = <span>{</span>"PreExtractionHookConfiguration":&#xD;
        <span>{</span>&#xD;
            "LambdaArn":"arn:aws:iam::account-id:function/function-name",&#xD;
            "S3Bucket":"S3-bucket-name"&#xD;
        }&#xD;
    "RoleArn":"arn:aws:iam::account-id:role/cde-role-name"&#xD;
    }&#xD;
&#xD;
try:&#xD;
    data_source_response = kendra.create_data_source(&#xD;
        Name = name,&#xD;
        IndexId = index_id,&#xD;
        RoleArn = role_arn,&#xD;
        Type = data_source_type&#xD;
        Configuration = configuration&#xD;
        CustomDocumentEnrichmentConfiguration = custom_document_enrichment_configuration&#xD;
    )&#xD;
&#xD;
    pprint.pprint(data_source_response)&#xD;
&#xD;
    data_source_id = data_source_response["Id"]&#xD;
&#xD;
    print("Wait for Amazon Kendra to create the data source with your customizations.")&#xD;
&#xD;
    while True:&#xD;
        # Get the details of the data source, such as the status&#xD;
        data_source_description = kendra.describe_data_source(&#xD;
            Id = data_source_id,&#xD;
            IndexId = index_id&#xD;
        )&#xD;
        status = data_source_description["Status"]&#xD;
        print(" Creating data source. Status: "+status)&#xD;
        time.sleep(60)&#xD;
        if status != "CREATING":&#xD;
            break&#xD;
&#xD;
    print("Synchronize the data source.")&#xD;
&#xD;
    sync_response = kendra.start_data_source_sync_job(&#xD;
        Id = data_source_id,&#xD;
        IndexId = index_id&#xD;
    )&#xD;
&#xD;
    pprint.pprint(sync_response)&#xD;
&#xD;
    print("Wait for the data source to sync with the index.")&#xD;
&#xD;
    while True:&#xD;
&#xD;
        jobs = kendra.list_data_source_sync_jobs(&#xD;
            Id = data_source_id,&#xD;
            IndexId = index_id&#xD;
        )&#xD;
&#xD;
        # For this example, there should be one job&#xD;
        status = jobs["History"][0]["Status"]&#xD;
&#xD;
        print(" Syncing data source. Status: "+status)&#xD;
        time.sleep(60)&#xD;
        if status != "SYNCING":&#xD;
            break&#xD;
&#xD;
except  ClientError as e:&#xD;
        print("%s" % e)&#xD;
&#xD;
print("Program ends.")&#xD;
</code></pre>
                </dd>
            <dt>Java</dt><dd tab-id="java">
                    <p><b>Para configurar uma função Lambda para manipulação avançada de dados nos dados originais brutos</b></p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="java ">package com.amazonaws.kendra;

import java.util.concurrent.TimeUnit;
import software.amazon.awssdk.services.kendra.KendraClient;
import software.amazon.awssdk.services.kendra.model.CreateDataSourceRequest;
import software.amazon.awssdk.services.kendra.model.CreateDataSourceResponse;
import software.amazon.awssdk.services.kendra.model.CreateIndexRequest;
import software.amazon.awssdk.services.kendra.model.CreateIndexResponse;
import software.amazon.awssdk.services.kendra.model.DataSourceConfiguration;
import software.amazon.awssdk.services.kendra.model.DataSourceStatus;
import software.amazon.awssdk.services.kendra.model.DataSourceSyncJob;
import software.amazon.awssdk.services.kendra.model.DataSourceSyncJobStatus;
import software.amazon.awssdk.services.kendra.model.DataSourceType;
import software.amazon.awssdk.services.kendra.model.DescribeDataSourceRequest;
import software.amazon.awssdk.services.kendra.model.DescribeDataSourceResponse;
import software.amazon.awssdk.services.kendra.model.DescribeIndexRequest;
import software.amazon.awssdk.services.kendra.model.DescribeIndexResponse;
import software.amazon.awssdk.services.kendra.model.IndexStatus;
import software.amazon.awssdk.services.kendra.model.ListDataSourceSyncJobsRequest;
import software.amazon.awssdk.services.kendra.model.ListDataSourceSyncJobsResponse;
import software.amazon.awssdk.services.kendra.model.S3DataSourceConfiguration;
import software.amazon.awssdk.services.kendra.model.StartDataSourceSyncJobRequest;
import software.amazon.awssdk.services.kendra.model.StartDataSourceSyncJobResponse;


public class CreateDataSourceWithCustomizationsExample <span>{</span>

    public static void main(String[] args) throws InterruptedException <span>{</span>
        System.out.println("Create a data source with customizations");
        
        String dataSourceName = "data-source-name";
        String indexId = "index-id";
        String dataSourceRoleArn = "arn:aws:iam::account-id:role/role-name";
        String s3BucketName = "S3-bucket-name"

        KendraClient kendra = KendraClient.builder().build();
        
        CreateDataSourceRequest createDataSourceRequest = CreateDataSourceRequest
            .builder()
            .name(dataSourceName)
            .description(experienceDescription)
            .roleArn(experienceRoleArn)
            .type(DataSourceType.S3)
            .configuration(
                DataSourceConfiguration
                    .builder()
                    .s3Configuration(
                        S3DataSourceConfiguration
                            .builder()
                            .bucketName(s3BucketName)
                            .build()
                    ).build()
            )
            .customDocumentEnrichmentConfiguration(
                CustomDocumentEnrichmentConfiguration
                    .builder()
                    .preExtractionHookConfiguration(
                        HookConfiguration
                            .builder()
                            .lambdaArn("arn:aws:iam::account-id:function/function-name")
                            .s3Bucket("S3-bucket-name")
                            .build())
                    .roleArn("arn:aws:iam::account-id:role/cde-role-name")
                    .build();
        
        CreateDataSourceResponse createDataSourceResponse = kendra.createDataSource(createDataSourceRequest);
        System.out.println(String.format("Response of creating data source: %s", createDataSourceResponse));

        String dataSourceId = createDataSourceResponse.id();
        System.out.println(String.format("Waiting for Kendra to create the data source %s", dataSourceId));
        DescribeDataSourceRequest describeDataSourceRequest = DescribeDataSourceRequest
            .builder()
            .indexId(indexId)
            .id(dataSourceId)
            .build();

        while (true) <span>{</span>
            DescribeDataSourceResponse describeDataSourceResponse = kendra.describeDataSource(describeDataSourceRequest);

            DataSourceStatus status = describeDataSourceResponse.status();
            System.out.println(String.format("Creating data source. Status: %s", status));
            TimeUnit.SECONDS.sleep(60);
            if (status != DataSourceStatus.CREATING) <span>{</span>
                break;
            }
        }

        System.out.println(String.format("Synchronize the data source %s", dataSourceId));
        StartDataSourceSyncJobRequest startDataSourceSyncJobRequest = StartDataSourceSyncJobRequest
            .builder()
            .indexId(indexId)
            .id(dataSourceId)
            .build();
        StartDataSourceSyncJobResponse startDataSourceSyncJobResponse = kendra.startDataSourceSyncJob(startDataSourceSyncJobRequest);
        System.out.println(String.format("Waiting for the data source to sync with the index %s for execution ID %s", indexId, startDataSourceSyncJobResponse.executionId()));

        // For this example, there should be one job
        ListDataSourceSyncJobsRequest listDataSourceSyncJobsRequest = ListDataSourceSyncJobsRequest
            .builder()
            .indexId(indexId)
            .id(dataSourceId)
            .build();

        while (true) <span>{</span>
            ListDataSourceSyncJobsResponse listDataSourceSyncJobsResponse = kendra.listDataSourceSyncJobs(listDataSourceSyncJobsRequest);
            DataSourceSyncJob job = listDataSourceSyncJobsResponse.history().get(0);
            System.out.println(String.format("Syncing data source. Status: %s", job.status()));

            TimeUnit.SECONDS.sleep(60);
            if (job.status() != DataSourceSyncJobStatus.SYNCING) <span>{</span>
                break;
            }

        }

        System.out.println("Data source creation with customizations is complete");
    }
}</code></pre>
                </dd>
        </dl></awsdocs-tabs>
     
        <h2 id="cde-data-contracts-lambda">Contratos de dados para funções do Lambda</h2>
        <p>Suas funções do Lambda para manipulação avançada de dados interagem com contratosAmazon Kendra de dados. Os contratos são as estruturas obrigatórias de solicitação e resposta de suas funções do Lambda. Se suas funções do Lambda não seguirem essas estruturas,Amazon Kendra gerará um erro.</p>
        <p>Sua função Lambda para<code class="code">PreExtractionHookConfiguration</code> deve esperar a seguinte estrutura de solicitação:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "version": &lt;str&gt;,
    "dataBlobStringEncodedInBase64": &lt;str&gt;, //In the case of a data blob
    "s3Bucket": &lt;str&gt;, //In the case of an S3 bucket
    "s3ObjectKey": &lt;str&gt;, //In the case of an S3 bucket
    "metadata": &lt;Metadata&gt;
}</code></pre>
        <p>A<code class="code">metadata</code> estrutura, que inclui a<code class="code">CustomerDocumentAttribute</code> estrutura, é a seguinte:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "attributes": [&lt;CustomerDocumentAttribute&lt;]
}

CustomerDocumentAttribute
<span>{</span>
    "name": &lt;str&gt;,
    "value": &lt;CustomerDocumentAttributeValue&gt;
}

CustomerDocumentAttributeValue
<span>{</span>
    "stringValue": &lt;str&gt;,
    "integerValue": &lt;int&gt;,
    "longValue": &lt;long&gt;,
    "stringListValue": list&lt;str&gt;,
    "dateValue": &lt;str&gt;
}</code></pre>
        <p>Sua função Lambda para<code class="code">PreExtractionHookConfiguration</code> deve seguir a seguinte estrutura de resposta:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "version": &lt;str&gt;,
    "dataBlobStringEncodedInBase64": &lt;str&gt;, //In the case of a data blob
    "s3ObjectKey": &lt;str&gt;, //In the case of an S3 bucket
    "metadataUpdates": [&lt;CustomDocumentAttribute&gt;]
}</code></pre>
        <p>Sua função Lambda para<code class="code">PostExtractionHookConfiguration</code> deve esperar a seguinte estrutura de solicitação:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "version": &lt;str&gt;,
    "s3Bucket": &lt;str&gt;,
    "s3ObjectKey": &lt;str&gt;,
    "metadata": &lt;Metadata&gt;
}</code></pre>
        <p>Sua função Lambda para<code class="code">PostExtractionHookConfiguration</code> deve seguir a seguinte estrutura de resposta:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">PostExtractionHookConfiguration Lambda Response
<span>{</span>
    "version": &lt;str&gt;,
    "s3ObjectKey": &lt;str&gt;,
    "metadataUpdates": [&lt;CustomDocumentAttribute&gt;]
}</code></pre>
        <p>Seu documento alterado é enviado para seuAmazon S3 bucket. O documento alterado deve seguir o formato mostrado em<a href="#structured-document-format">Formato de documento estruturados</a>.</p>
         
            <h3 id="structured-document-format">Formato de documento estruturados</h3>
            <p>Amazon Kendracarrega seu documento estruturado para oAmazon S3 bucket fornecido. O documento estruturado segue este formato:</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">Kendra document

<span>{</span>
   "textContent": &lt;TextContent&gt;
}

TextContent
<span>{</span>
  "documentBodyText": &lt;str&gt;
}</code></pre>
         
         
            <h3 id="example-lambda-function-advanced-manipulation">Exemplo de uma função Lambda que adere a contratos de dados</h3>
            <p>O código Python a seguir é um exemplo de uma função Lambda que aplica manipulação avançada dos campos<code class="code">_authors</code> de metadados e do conteúdo do corpo nos documentos brutos ou originais.<code class="code">_document_title</code></p>
            <p><b>No caso do conteúdo corporal residir em umAmazon S3 balde</b></p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import json&#xD;
import boto3&#xD;
     &#xD;
s3 = boto3.client("s3")&#xD;
&#xD;
# Lambda function for advanced data manipulation    &#xD;
def lambda_handler(event, context):&#xD;
    # Get the value of "S3Bucket" key name or item from the given event input&#xD;
    s3_bucket = event.get("s3Bucket")&#xD;
    # Get the value of "S3ObjectKey" key name or item from the given event input&#xD;
    s3_object_key = event.get("s3ObjectKey")&#xD;
    &#xD;
    content_object_before_CDE = s3.get_object(Bucket = s3_bucket, Key = s3_object_key)&#xD;
    content_before_CDE = content_object_before_CDE["Body"].read().decode("utf-8");&#xD;
    content_after_CDE = "CDEInvolved " + content_before_CDE&#xD;
    &#xD;
    # Get the value of "metadata" key name or item from the given event input&#xD;
    metadata = event.get("metadata")&#xD;
    # Get the document "attributes" from the metadata &#xD;
    document_attributes = metadata.get("attributes")&#xD;
    &#xD;
    s3.put_object(Bucket = s3_bucket, Key = "dummy_updated_kendra_document", Body=json.dumps(content_after_CDE))&#xD;
    return <span>{</span>&#xD;
        "version": "v0",&#xD;
        "s3ObjectKey": "dummy_updated_kendra_document",&#xD;
        "metadataUpdates": [&#xD;
            <span>{</span>"name":"_document_title", "value":<span>{</span>"stringValue":"title_from_pre_extraction_lambda"}},&#xD;
            <span>{</span>"name":"_authors", "value":<span>{</span>"stringListValue":["author1", "author2"]}}&#xD;
        ]&#xD;
    }</code></pre>
            <p><b>No caso do conteúdo do corpo residente em um blob de dados</b></p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import json&#xD;
import boto3&#xD;
import base64&#xD;
&#xD;
# Lambda function for advanced data manipulation&#xD;
def lambda_handler(event, context):&#xD;
    &#xD;
    # Get the value of "dataBlobStringEncodedInBase64" key name or item from the given event input &#xD;
    data_blob_string_encoded_in_base64 = event.get("dataBlobStringEncodedInBase64")&#xD;
    # Decode the data blob string in UTF-8&#xD;
    data_blob_string = base64.b64decode(data_blob_string_encoded_in_base64).decode("utf-8")&#xD;
    # Get the value of "metadata" key name or item from the given event input    &#xD;
    metadata = event.get("metadata")&#xD;
    # Get the document "attributes" from the metadata&#xD;
    document_attributes = metadata.get("attributes")&#xD;
    &#xD;
    new_data_blob = "This should be the modified data in the document by pre processing lambda ".encode("utf-8")&#xD;
    return <span>{</span>&#xD;
        "version": "v0",&#xD;
        "dataBlobStringEncodedInBase64": base64.b64encode(new_data_blob).decode("utf-8"),&#xD;
        "metadataUpdates": [&#xD;
            <span>{</span>"name":"_document_title", "value":<span>{</span>"stringValue":"title_from_pre_extraction_lambda"}},&#xD;
            <span>{</span>"name":"_authors", "value":<span>{</span>"stringListValue":["author1", "author2"]}}&#xD;
        ]&#xD;
    }</code></pre>
            <p>O código Python a seguir é um exemplo de uma função Lambda que aplica manipulação avançada dos campos<code class="code">_authors</code> de metadados e do conteúdo do corpo nos documentos estruturados ou analisados.<code class="code">_document_title</code></p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copiar"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">import json&#xD;
import boto3&#xD;
import time&#xD;
&#xD;
s3 = boto3.client("s3")&#xD;
&#xD;
# Lambda function for advanced data manipulation&#xD;
def lambda_handler(event, context):&#xD;
    &#xD;
    # Get the value of "S3Bucket" key name or item from the given event input&#xD;
    s3_bucket = event.get("s3Bucket")&#xD;
    # Get the value of "S3ObjectKey" key name or item from the given event input&#xD;
    s3_key = event.get("s3ObjectKey")&#xD;
    # Get the value of "metadata" key name or item from the given event input&#xD;
    metadata = event.get("metadata")&#xD;
    # Get the document "attributes" from the metadata &#xD;
    document_attributes = metadata.get("attributes")&#xD;
    &#xD;
    kendra_document_object = s3.get_object(Bucket = s3_bucket, Key = s3_key)&#xD;
    kendra_document_string = kendra_document_object['Body'].read().decode('utf-8')&#xD;
    kendra_document = json.loads(kendra_document_string)&#xD;
    kendra_document["textContent"]["documentBodyText"] = "Changing document body to a short sentence."&#xD;
    &#xD;
    s3.put_object(Bucket = s3_bucket, Key = "dummy_updated_kendra_document", Body=json.dumps(kendra_document))&#xD;
&#xD;
    return <span>{</span>&#xD;
        "version" : "v0",&#xD;
        "s3ObjectKey": "dummy_updated_kendra_document",&#xD;
        "metadataUpdates": [&#xD;
            <span>{</span>"name": "_document_title", "value":<span>{</span>"stringValue": "title_from_post_extraction_lambda"}},&#xD;
            <span>{</span>"name": "_authors", "value":<span>{</span>"stringListValue":["author1", "author2"]}}&#xD;
        ]&#xD;
    }</code></pre>
         
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Atenção" /> <strong>O Javascript está desativado ou não está disponível no seu navegador.</strong></p><p>Para usar a documentação da AWS, o Javascript deve estar ativado. Consulte as páginas de Ajuda do navegador para obter instruções.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Convenções do documento</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./delete-data-source.html">Excluar origens de dados</div><div id="next" class="next-link" accesskey="n" href="./searching.html">Pesquisando índices</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Essa página foi útil? - Sim</div><div class="content"><p>Obrigado por nos informar que estamos fazendo um bom trabalho!</p><p>Se tiver tempo, conte-nos sobre o que você gostou para que possamos melhorar ainda mais.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Kendra&amp;topic_url=https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Essa página foi útil? - Não</div><div class="content"><p>Obrigado por nos informar que precisamos melhorar a página. Lamentamos ter decepcionado você.</p><p>Se tiver tempo, conte-nos como podemos melhorar a documentação.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Kendra&amp;topic_url=https://docs.aws.amazon.com/pt_br/kendra/latest/dg/custom-document-enrichment.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>