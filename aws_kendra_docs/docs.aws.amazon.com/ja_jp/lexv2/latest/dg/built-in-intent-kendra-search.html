<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>アマゾン。 KendraSearchIntent - Amazon Lex</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="built-in-intent-kendra-search" /><meta name="default_state" content="built-in-intent-kendra-search" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="description" content="Amazon Kendra でインデックス付けしたドキュメントを検索するには、 AMAZON.KendraSearchIntent インテントを使用します。Amazon Lex V2 がユーザーとの会話の次のアクションを決定できない場合、検索インテントをトリガーします。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Lex" /><meta name="guide" content="V2 デベロッパーガイド" /><meta name="abstract" content="Amazon Lex V2 の概念的な概要について説明します。ストリーミング会話など、さまざまな機能の使用に関する詳細な手順と、V2 API の完全なリファレンスを提供します。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="x-default" /><meta name="feedback-item" content="Lex" /><meta name="this_doc_product" content="Amazon Lex" /><meta name="this_doc_guide" content="V2 デベロッパーガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lex'}"></script><meta id="panorama-serviceSubSection" value="V2 デベロッパーガイド" /><meta id="panorama-serviceConsolePage" value="アマゾン。 KendraSearchIntent" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>アマゾン。 KendraSearchIntent - Amazon Lex</title><meta name="pdf" content="lex2.0.pdf#built-in-intent-kendra-search" /><meta name="rss" content="amazon-lex-v2-document-history.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=251" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=http://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Lex",
        "item" : "https://docs.aws.amazon.com/lex/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "V2 デベロッパーガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "ボットの構築",
        "item" : "https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/building-bots.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "組み込みインテントとスロットタイプ",
        "item" : "https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "組み込みのインテント",
        "item" : "https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/howitworks-builtins-intents.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "アマゾン。 KendraSearchIntent",
        "item" : "https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/howitworks-builtins-intents.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="lex2.0.pdf#built-in-intent-kendra-search" target="_blank" rel="noopener noreferrer" title="PDF を開く"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/lex/index.html">Amazon Lex</a><a href="what-is.html">V2 デベロッパーガイド</a></div><div id="page-toc-src"><a href="#kendra-search-iam">IAM ポリシー</a><a href="#kendra-search-filter">フィルタとしてのリクエスト属性とセッション属性の使用</a><a href="#kendra-search-response">検索レスポンスの使用</a><a href="#kendra-search-lambda">Lambda 関数を使用したリクエストとレスポンスの管理</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>翻訳は機械翻訳により提供されています。提供された翻訳内容と英語版の間で齟齬、不一致または矛盾がある場合、英語版が優先します。</p></awsui-alert><h1 class="topictitle" id="built-in-intent-kendra-search">アマゾン。 KendraSearchIntent</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon Kendra でインデックス付けしたドキュメントを検索するには、<code class="code">AMAZON.KendraSearchIntent</code> インテントを使用します。Amazon Lex V2 がユーザーとの会話の次のアクションを決定できない場合、検索インテントをトリガーします。</p><p><code class="code">AMAZON.KendraSearchIntent</code> は、英語 (米国) (en-US)ロケール、および米国東部 (バージニア北部)、米国西部 (オレゴン)、欧州 (アイルランド) のリージョンでのみ使用できます。</p><p>Amazon Kendra は、PDF ドキュメントや Microsoft Word machine-learning-based  ファイルなどの自然言語ドキュメントにインデックス付けする検索サービスです。インデックス付けされたドキュメントを検索し、質問に対して以下のタイプのレスポンスを返すことができます。</p><div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>回答 </p>
                </li><li class="listitem">
                    <p>質問への回答になる可能性がある FAQ のエントリ</p>
                </li><li class="listitem">
                    <p>質問に関連するドキュメント</p>
                </li></ul></div><p><code class="code">AMAZON.KendraSearchIntent</code> の使用例については、「<a href="./faq-bot-kendra-search.html">例: Amazon Kendra インデックスを使用する FAQ ボットを作成する</a>」を参照してください。</p><p><code class="code">AMAZON.KendraSearchIntent</code>ボットにインテントを設定した場合、Amazon Lex V2 は、インテントのユーザー発話を判別できないときは常に、そのインテントを呼び出します。Amazon Kendra からのレスポンスがない場合、会話はボットで設定されたとおりに進みます。</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p> Amazon Lex V2 は現在、<code class="code">AMAZON.KendraSearchIntent</code>スロットエリシテーション中の機能をサポートしていません。Amazon Lex V2 がスロットのユーザー発話を判別できない場合、を呼び出します<code class="code">AMAZON.FallbackIntent</code>。</p></div></div><p>同じボットで <code class="code">AMAZON.KendraSearchIntent</code> と <code class="code">AMAZON.FallbackIntent</code> の両方を使用する場合、Amazon Lex V2 は以下のようにインテントを使用します。</p><div class="orderedlist">
                 
                 
                 
                 
            <ol><li>
                    <p>Amazon Lex V2 が <code class="code">AMAZON.KendraSearchIntent</code> を呼び出します。インテントは Amazon Kendra <code class="code">Query</code> オペレーションを呼び出します。</p>
                </li><li>
                    <p>Amazon Kendra がレスポンスを返す場合、Amazon Lex V2 はユーザーに結果を表示します。</p>
                </li><li>
                    <p>Amazon Kendra からのレスポンスがない場合、Amazon Lex V2 はユーザーに再度プロンプトを表示します。以下のアクションは、ユーザーからのレスポンスによって異なります。</p>
                    <div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p>ユーザーからのレスポンスに、スロット値の入力やインテントの確認など、Amazon Lex V2 が認識する発話が含まれている場合、ユーザーとの会話はボットで設定されたとおりに進みます。</p>
                        </li><li class="listitem">
                            <p>ユーザーからのレスポンスに Amazon Lex V2 が認識する発話が含まれていない場合、Amazon Lex V2 は <code class="code">Query</code> オペレーションを再度呼び出します。</p>
                        </li></ul></div>
                </li><li>
                    <p>設定された再試行回数の後にレスポンスがない場合、Amazon Lex V2 は <code class="code">AMAZON.FallbackIntent</code> を呼び出し、ユーザーとの会話を終了します。</p>
                </li></ol></div><p>Amazon Kendra を使用して <code class="code">AMAZON.KendraSearchIntent</code> へのリクエストを作成するには、3 つの方法があります。</p><div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>検索インテントにリクエストを作成させます。Amazon Lex V2 は、ユーザーの発話を検索文字列として Amazon Kendra を呼び出します。インテントを作成するときに、Amazon Kendra が返すレスポンスの数を制限するクエリフィルター文字列を定義できます。Amazon Lex V2 は、クエリリクエストでフィルターを使用します。</p>
                </li><li class="listitem">
                    <p>Lambda 関数を使用して検索結果を絞り込むために、リクエストにクエリパラメータを追加します。Amazon Kendra クエリパラメータを含む <code class="code">kendraQueryFilterString</code> フィールドを <code class="code">delegate</code> ダイアログアクションに追加します。Lambda 関数を使用してクエリパラメータをリクエストに追加すると、それらのパラメータは、インテントを作成したときに定義したクエリフィルタよりも優先されます。</p>
                </li><li class="listitem">
                    <p>Lambda 関数を使用して、新しいクエリを作成します。Amazon Lex V2 によって送信される完全な Amazon Kendra クエリリクエストを作成できます。<code class="code">delegate</code> ダイアログアクションの <code class="code">kendraQueryRequestPayload</code> フィールドでクエリを指定します。<code class="code">kendraQueryRequestPayload</code> フィールドは <code class="code">kendraQueryFilterString</code> フィールドよりも優先されます。</p>
                </li></ul></div><p>ボットを作成するときに <code class="code">queryFilterString</code> パラメータを指定したり、ダイアログ Lambda 関数で <code class="code">delegate</code> アクションを呼び出すときに <code class="code">kendraQueryFilterString</code> フィールドを指定したりするには、Amazon Kendra クエリの属性フィルターとして使用する文字列を指定します。文字列が有効な属性フィルターでないと、実行時に <code class="code">InvalidBotConfigException</code> 例外が発生します。属性フィルターの詳細については、[<a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">Amazon Kendra デベロッパーガイド</a>] の [<em>ドキュメント属性を使用してクエリをフィルタリングする</em>] を参照してください。</p><p>Amazon Lex V2 が Amazon Kendra に送信するクエリを制御するには、ダイアログ Lambda 関数の <code class="code">kendraQueryRequestPayload</code> フィールドでクエリを指定できます。クエリが有効でない場合、Amazon Lex V2 は <code class="code">InvalidLambdaResponseException</code> 例外を返します。詳細については、[<em>Amazon Kendra デベロッパーガイド</em>] の [<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html">クエリ操作</a>] を参照してください。</p><p><code class="code">AMAZON.KendraSearchIntent</code> の使用方法の例については、「<a href="./faq-bot-kendra-search.html">例: Amazon Kendra インデックスを使用する FAQ ボットを作成する</a>」を参照してください。</p>
                <h2 id="kendra-search-iam">Amazon Kendra 検索の IAM ポリシー</h2>
                <p><code class="code">AMAZON.KendraSearchIntent</code> インテントを使用するには、AWS Identity and Access Management (IAM) ポリシーがアタッチされたロールを使用して、Amazon Kendra <code class="code">Query</code> インテントを呼び出すアクセス許可を持つランタイムロールを Amazon Lex V2 が引き受けられるようにする必要があります。使用する IAM 設定は、<code class="code">AMAZON.KendraSearchIntent</code> の作成に Amazon Lex V2 コンソールを使用するか、AWS SDK または AWS Command Line Interface (AWS CLI) を使用するかによって異なります。コンソールを使用する場合、Amazon Lex V2 サービスにリンクされたロールに Amazon Kendra を呼び出すアクセス許可を追加するか、Amazon Kendra <code class="code">Query</code> オペレーションを呼び出すための専用のロールを使用するかを選択できます。AWS CLI または SDK を使用してインテントを作成するときは、<code class="code">Query</code> オペレーションを呼び出すための専用のロールを使用する必要があります。</p>
                 
                    <h3 id="kendra-iam-attach">アクセス許可のアタッチ </h3>
                    <p>コンソールを使用して、Amazon Kendra <code class="code">Query</code> オペレーションに対するアクセス許可をデフォルトの Amazon Lex V2 サービスにリンクされたロールにアタッチできます。サービスにリンクされたロールにアクセス許可をアタッチする場合は、Amazon Kendra インデックスに接続するための専用のランタイムロールを作成して管理する必要はありません。</p>
                    <p>Amazon Lex V2 コンソールへのアクセスに使用するユーザー、ロール、またはグループには、ロールポリシーを管理するアクセス許可が必要です。以下の IAM ポリシーをコンソールのアクセスロールにアタッチします。これらのアクセス許可を付与すると、既存のサービスにリンクされたロールポリシーを変更するアクセス許可がロールに付与されます。</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "iam:AttachRolePolicy",
                "iam:PutRolePolicy",
                "iam:GetRolePolicy"
            ],
            "Resource": "arn:aws:iam::*:role/aws-service-role/lexv2.amazonaws.com/AWSServiceRoleForLexBots*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "iam:ListRoles",
            "Resource": "*"
        }
    ]
}</code></pre>
                 
                 
                    <h3 id="kendra-iam-role">ロールの指定 </h3>
                    <p>コンソール、AWS CLI、または API を使用して、Amazon Kendra <code class="code">Query</code> オペレーションを呼び出すときに使用するランタイムロールを指定できます。</p>
                    <p>ランタイムロールの指定に使用するユーザー、ロール、またはグループには、<code class="code">iam:PassRole</code>アクセス許可が必要です。以下のポリシーでは、このアクセス許可を定義しています。<code class="code">iam:AssociatedResourceArn</code> および <code class="code">iam:PassedToService</code> 条件コンテキストキーを使用して、アクセス許可の範囲をさらに制限できます。詳細については、[<em>AWS STS ユーザーガイド</em>] で [<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_iam-condition-keys.html">IAM と AWS Identity and Access Management 条件コンテキストキー</a>] を参照してください。</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": "iam:PassRole",
            "Resource": "arn:aws:iam::<code class="replaceable">account</code>:role/<code class="replaceable">role</code>"
        }
    ]
}</code></pre>
                    <p>Amazon Lex V2 が Amazon Kendra の呼び出しに使用する必要があるランタイムロールには、<code class="code">kendra:Query</code> アクセス許可が必要です。Amazon Kendra <code class="code">Query</code> オペレーションを呼び出すアクセス許可に既存の IAM ロールを使用する場合、そのロールには以下のポリシーがアタッチされている必要があります。</p>
                    <p>IAM コンソール、IAM API、または AWS CLI を使用して、ポリシーを作成し、ロールにアタッチすることができます。以下の手順では、AWS CLI を使用してロールとポリシーを作成します。</p>
                    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>次のコードは、Linux と MacOS 用にフォーマットされています。Windows の場合、Linux 行連結記号 (\) をキャレット (^) に置き換えます。</p></div></div>
                    <div class="procedure"><h6>Query オペレーションのアクセス許可をロールに追加するには</h6><ol><li>
                            <p>現在のディレクトリに <code class="userinput">KendraQueryPolicy.json</code> という名前でドキュメントを作成し、以下のコードを追加して保存します。</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kendra:Query"
            ],
            "Resource": [
                "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account</code>:index/<code class="replaceable">index ID</code>"
            ]
        }
    ]
}</code></pre>
                        </li><li>
                            <p>AWS CLI で次のコマンドを実行して、Amazon Kendra <code class="code">Query</code> オペレーションを実行するための IAM ポリシーを作成します。</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iam create-policy \
    --policy-name <code class="replaceable">query-policy-name</code> \
    --policy-document file://KendraQueryPolicy.json</code></pre>
                        </li><li>
                            <p><code class="code">Query</code> オペレーションの呼び出しに使用している IAM ロールに、そのポリシーをアタッチします。</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iam attach-role-policy \
    --policy-arn arn:aws:iam::<code class="replaceable">account-id</code>:policy/<code class="replaceable">query-policy-name</code>
    --role-name <code class="replaceable">role-name</code></code></pre>
                        </li></ol></div>
                    <p>Amazon Lex V2 サービスにリンクされたロールを更新するか、ボット用に <code class="code">AMAZON.KendraSearchIntent</code> を作成したときに作成したロールを使用するかを選択できます。以下の手順は、使用する IAM ロール を選択する方法を示しています。</p>
                    <div class="procedure"><h6>AMAZON のランタイムロールを指定するには。 KendraSearchIntent</h6><ol><li>
                            <p>AWS Management Console にサインインし、Amazon Lex コンソール (<a href="https://console.aws.amazon.com/lex/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/lex/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>) を開きます。</p>
                        </li><li>
                            <p><code class="code">AMAZON.KendraSearchIntent</code> を追加するボットを選択します。</p>
                        </li><li>
                            <p>[<b>インテント</b>] の横のプラス (+) を選択します。</p>
                        </li><li>
                            <p>[<b>インテントの追加</b>] で、[<b>既存のインテントの検索</b>] を選択します。</p>
                        </li><li>
                            <p>[<b>インテントの検索</b>] に「<code class="userinput">AMAZON.KendraSearchIntent</code>」と入力し、[<b>追加</b>] を選択します。</p>
                        </li><li>
                            <p>[<b>組み込みインテントのコピー</b>] にインテントの名前 (「<code class="userinput">KendraSearchIntent</code>」など) を入力し、[<b>追加</b>] を選択します。</p>
                        </li><li>
                            <p>[<b>Amazon Kendra クエリ</b>] セクションを開きます。</p>
                        </li><li>
                            <p>[<b>IAM ロール</b>] で、以下のいずれかのオプションを選択します。</p>
                            <div class="itemizedlist">
                                 
                                 
                            <ul class="itemizedlist"><li class="listitem">
                                    <p>ボットが Amazon Kendra インデックスをクエリできるように Amazon Lex V2 サービスにリンクされたロールを更新するには、[<b>Amazon Kendra アクセス許可の追加</b>] を選択します。</p>
                                </li><li class="listitem">
                                    <p>Amazon Kendra <code class="code">Query</code> オペレーションを呼び出すアクセス許可を持つロールを使用するには、[<b>既存のロールを使用</b>] を選択します。</p>
                                </li></ul></div>
                        </li></ol></div>
                 
             
                <h2 id="kendra-search-filter">フィルタとしてのリクエスト属性とセッション属性の使用</h2>
                <p>Amazon Kendra から現在の会話に関連するアイテムへのレスポンスをフィルター処理するには、ボットの作成時に <code class="code">queryFilterString</code> パラメータを追加して、セッション属性とリクエスト属性をフィルターとして使用します。インテントを作成するときに属性のプレースホルダーを指定します。それにより、Amazon Lex V2 が Amazon Kendra を呼び出す前にプレースホルダーを値に置き換えます。リクエスト属性の詳細については、「<a href="./context-mgmt-request-attribs.html">リクエスト属性を設定する</a>」を参照してください。セッション属性の詳細については、「<a href="./context-mgmt-session-attribs.html">セッション属性を設定する</a>」を参照してください。</p>
                <p>以下に示しているのは、string to filter というリクエスト属性を使用して Amazon Kendra クエリをフィルター処理する <code class="code">queryFilterString</code> パラメータの例です。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "City", "value": <span>{</span>"stringValue": "Seattle"}}}"</code></pre>
                <p>以下に示しているのは、<code class="code">"SourceURI"</code> というセッション属性を使用して Amazon Kendra クエリをフィルター処理する <code class="code">queryFilterString</code> パラメータの例です。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "SourceURI","value": <span>{</span>"stringValue": "[FileURL]"}}}"</code></pre>
                <p>以下に示しているのは、<code class="code">"DepartmentName"</code> というリクエスト属性を使用して Amazon Kendra クエリをフィルター処理する <code class="code">queryFilterString</code> パラメータの例です。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "Department","value": <span>{</span>"stringValue": "((DepartmentName))"}}}"</code></pre>
                <p><code class="code">AMAZON.KendraSearchInteng</code> フィルターは Amazon Kendra 検索フィルターと同じ形式を使用します。詳細については、[<em>Amazon Kendra デベロッパーガイド</em>] の [<a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">ドキュメント属性を使用して検索結果をフィルターする</a>] を参照してください。</p>
                <p><code class="code">AMAZON.KendraSearchIntent</code> で使用されるクエリフィルタ文字列は、各フィルターの最初の文字には小文字を使用する必要があります。例えば、次は <code class="code">AMAZON.KendraSearchIntent</code> の有効なクエリフィルターです。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "andAllFilters": [
        <span>{</span>
            "equalsTo": <span>{</span>
                "key": "City",
                "value": <span>{</span>
                    "stringValue": "Seattle"
                }
            }
        },
        <span>{</span>
            "equalsTo": <span>{</span>
                "key": "State",
                "value": <span>{</span>
                    "stringValue": "Washington"
                }
            }
        }
    ]
}</code></pre>
             
                <h2 id="kendra-search-response">検索レスポンスの使用</h2>
                <p>Amazon Kendra は、インテントの <code class="code">IntentClosingSetting</code> ステートメントから、検索に対するレスポンスを返します。Lambda 関数が終了応答メッセージを生成しない限り、インテントには <code class="code">closingResponse</code> ステートメントが必要です。</p>
                <p>Amazon Kendra には 5 タイプのレスポンスがあります。</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>次の 2 つの応答では、Amazon Kendra インデックスに関するよくある質問を設定する必要があります。詳細については、「<a href="https://docs.aws.amazon.com/kendra/latest/dg/in-creating-faq.html">索引への質問と回答の直接追加</a>」を参照してください。</p>
                        <div class="itemizedlist">
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p> <code class="code">x-amz-lex:kendra-search-response-question_answer-question-&lt;N&gt;</code> - 検索に一致する FAQ からの質問。</p>
                            </li><li class="listitem">
                                <p> <code class="code">x-amz-lex:kendra-search-response-question_answer-answer-&lt;N&gt;</code> - 検索に一致する FAQ からの回答。</p>
                            </li></ul></div>                        
                    </li><li class="listitem">
                        <p>次の 3 つのレスポンスでは、Amazon Kendra インデックスのデータソースを設定する必要があります。詳細については、「<a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source.html">データソースの作成</a>」を参照してください。</p>
                        <div class="itemizedlist">
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">x-amz-lex:kendra-search-response-document-&lt;N&gt;</code> - 発話のテキストに関連するインデックス内のドキュメントからの抜粋。</p>
                            </li><li class="listitem">
                                <p><code class="code">x-amz-lex:kendra-search-response-document-link-&lt;N&gt;</code> - 発話のテキストに関連するインデックス内のドキュメントからの抜粋。</p>
                            </li><li class="listitem">
                                <p><code class="code">x-amz-lex:kendra-search-response-answer-&lt;N&gt;</code> - 質問への回答があるインデックス内のドキュメントからの抜粋。</p>
                            </li></ul></div>
                    </li></ul></div>
                <p>レスポンスは <code class="code">request</code> 属性で返されます。各属性には、最大 5 つのレスポンスがあり 1～5 の番号が付けられます。レスポンスの詳細については、[<em>Amazon Kendra デベロッパーガイド</em>] の [<a href="https://docs.aws.amazon.com/kendra/latest/dg/response-types.html">レスポンスのタイプ</a>] を参照してください。</p>
                <p><code class="code">closingResponse</code> ステートメントには、1 つ以上のメッセージグループが必要です。各メッセージグループには、1 つ以上のメッセージが含まれます。各メッセージには、Amazon Kendra からのレスポンスでリクエスト属性によって置き換えられる 1 つ以上のプレースホルダー変数を含めることができます。メッセージ内のすべての変数がランタイムレスポンスのリクエスト属性値で置き換えられるメッセージグループには、1 つ以上のメッセージが必要です。プレースホルダー変数のないメッセージグループには、1 つのメッセージが必要です。リクエスト属性は二重かっこ (( )) で囲みます。以下のメッセージグループのメッセージは Amazon Kendra からのレスポンスに一致します。</p>
                <div class="itemizedlist">
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>「よくある質問を見つけました:((x-amz-lex:kendra-search-response-question _answerer-question-1))、答えは ((x-amz-lex:kendra-search-response-question _answer-anser-1))」</p>
                    </li><li class="listitem">
                        <p>「役に立つドキュメントからの抜粋を見つけました:((x-amz-lex:kendra-search-response-document -1))」</p>
                    </li><li class="listitem">
                        <p>「あなたの質問に対する答えは ((x-amz-lex:kendra-search-response-answer -1)) だと思います」</p>
                    </li></ul></div>
             
                <h2 id="kendra-search-lambda">Lambda 関数を使用したリクエストとレスポンスの管理</h2>
                <p><code class="code">AMAZON.KendraSearchIntent</code> インテントでは、ダイアログコードフックとフルフィルメントコードフックを使用して、Amazon Kendra へのリクエストとレスポンスを管理できます。Amazon Kendra に送信するクエリを変更する場合はダイアログコードフック Lambda 関数を使用し、レスポンスを変更する場合はフルフィルメントコードフック Lambda 関数を使用します。</p>
                 
                    <h3 id="kendra-search-lambda-dialog">ダイアログコードフックを使用したクエリの作成</h3>
                    <p>ダイアログコードフックを使用して、Amazon Kendra に送信するクエリを作成できます。ダイアログコードフックを使用するかどうかはオプションです。ダイアログコードフックを指定しない場合、Amazon Lex V2 によってユーザー発話からクエリが作成され、<code class="code">queryFilterString</code> が使用されます (インテントの設定時に指定した場合)。</p>
                    <p>ダイアログコードフックレスポンスで 2 つのフィールドを使用して、Amazon Kendra へのリクエストを変更できます。</p>
                    <div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p><code class="code">kendraQueryFilterString</code> - この文字列を使用して、Amazon Kendra リクエストの属性フィルタを指定します。インデックスで定義されたインデックスフィールドのいずれかを使用して、クエリをフィルタ処理できます。フィルター文字列の構造については、<em>「Amazon Kendra Developer Guide」</em>(Amazon Kendra デベロッパーガイド) の<a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">「Using document attributes to filter queries」</a>(ドキュメント属性を使用してクエリをフィルタリングする) を参照してください。指定したフィルタ文字列が有効でないと、<code class="code">InvalidLambdaResponseException</code> 例外が発生します。<code class="code">kendraQueryFilterString</code> 文字列は、インテント用に設定された <code class="code">queryFilterString</code> で指定されたクエリ文字列を上書きします。</p>
                        </li><li class="listitem">
                            <p><code class="code">kendraQueryRequestPayload</code> - この文字列を使用して、Amazon Kendra クエリを指定します。クエリでは、Amazon Kendra の任意の機能を使用できます。有効なクエリを指定しないと、<code class="code">InvalidLambdaResponseException</code> 例外が発生します。これらの制限の詳細については、[<em>Amazon Kendra デベロッパーガイド</em>]の [<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html">クエリ</a>] を参照してください。</p>
                        </li></ul></div>
                    <p>フィルターまたはクエリ文字列を作成したら、レスポンスの <code class="code">dialogAction</code> フィールドを <code class="code">delegate</code> に設定してAmazon Lex V2 にレスポンスを送信します。Amazon Lex V2 は、クエリを Amazon Kendra に送信し、クエリレスポンスをフルフィルメントコードフックに返します。</p>
                 
                 
                    <h3 id="kendra-search-lambda-fulfillment">レスポンスでのフルフィルメントコードフックの使用</h3>
                    <p>Amazon Lex V2 がクエリを Amazon Kendra に送信した後、クエリレスポンスが <code class="code">AMAZON.KendraSearchIntent</code> フルフィルメント Lambda 関数に返されます。コードフックへの入力イベントには、Amazon Kendra からの完全なレスポンスが含まれます。クエリデータは、Amazon Kendra <code class="code">Query</code> オペレーションによって返されるものと同じ構造になります。詳細については、[<em>Amazon Kendra デベロッパーガイド</em>] の [<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html#API_Query_ResponseSyntax">クエリレスポンス構文</a>] を参照してください。</p>
                    <p>フルフィルメントコードフックはオプションです。フルフィルメントコードフックがない場合、またはレスポンスでメッセージを返さない場合、Amazon Lex V2 はレスポンスに <code class="code">closingResponse</code> ステートメントを使用します。</p>
                 
            <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./built-in-intent-help.html">アマゾン。 HelpIntent</div><div id="next" class="next-link" accesskey="n" href="./faq-bot-kendra-search.html">例: Amazon Kendra インデックスを使用する FAQ ボットを作成する</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>