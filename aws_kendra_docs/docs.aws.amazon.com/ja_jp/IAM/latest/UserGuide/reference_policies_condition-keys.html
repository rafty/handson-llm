<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS グローバル条件コンテキストキー - AWS Identity and Access Management</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="reference_policies_condition-keys" /><meta name="default_state" content="reference_policies_condition-keys" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="description" content="IAM ポリシーで使用できる AWS グローバル条件キーのそれぞれについて説明します。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Identity and Access Management" /><meta name="guide" content="ユーザーガイド" /><meta name="abstract" content="ユーザー ID (認証) および特定のアクセス許可 (承認) を定義するポリシーで AWS リソースへのアクセスを制限します。" /><meta name="guide-locale" content="ja_jp" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="x-default" /><meta name="feedback-item" content="IAM" /><meta name="this_doc_product" content="AWS Identity and Access Management" /><meta name="this_doc_guide" content="ユーザーガイド" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'iam'}"></script><meta id="panorama-serviceSubSection" value="ユーザーガイド" /><meta id="panorama-serviceConsolePage" value="AWS グローバル条件コンテキストキー" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS グローバル条件コンテキストキー - AWS Identity and Access Management</title><meta name="pdf" content="iam-ug.pdf#reference_policies_condition-keys" /><meta name="rss" content="aws-iam-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=76" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="keywords" content="IAM,AWS Identity and Access Management,IAM ユーザー,user,IAM グループ,グループ,[IAM role] (IAM ロール),ロール,アクセス許可ポリシー,信頼ポリシー,ポリシー,アクセスキー,パスワード,リソース OU ID" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Identity and Access Management",
        "item" : "https://docs.aws.amazon.com/iam/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "ユーザーガイド",
        "item" : "https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS Identity and Access Management のリファレンス情報",
        "item" : "https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "IAM JSON ポリシーリファレンス",
        "item" : "https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "AWS グローバル条件コンテキストキー",
        "item" : "https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="iam-ug.pdf#reference_policies_condition-keys" target="_blank" rel="noopener noreferrer" title="PDF を開く"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">ドキュメント</a><a href="/iam/index.html">AWS Identity and Access Management</a><a href="introduction.html">ユーザーガイド</a></div><div id="page-toc-src"><a href="#condition-keys-calledvia">CalledVia</a><a href="#condition-keys-calledviafirst">CalledViaFirst</a><a href="#condition-keys-calledvialast">CalledViaLast</a><a href="#condition-keys-currenttime">CurrentTime</a><a href="#condition-keys-ec2instancesourcevpc">Ec2InstanceSourceVpc</a><a href="#condition-keys-ec2instancesourceprivateip4">Ec2InstanceSourcePrivateIPv4</a><a href="#condition-keys-epochtime">EpochTime</a><a href="#condition-keys-federatedprovider">フェデレーションプロバイダー</a><a href="#condition-keys-multifactorauthage">MultiFactorAuthAge</a><a href="#condition-keys-multifactorauthpresent">MultiFactorAuthPresent</a><a href="#condition-keys-principalaccount">PrincipalAccount</a><a href="#condition-keys-principalarn">PrincipalArn</a><a href="#condition-keys-principalisawsservice">PrincipalIsAWSService</a><a href="#condition-keys-principalorgid">PrincipalOrgID</a><a href="#condition-keys-principalorgpaths">PrincipalOrgPaths</a><a href="#condition-keys-principalservicename">プリンシパルサービス名</a><a href="#condition-keys-principalservicenameslist">プリンシパルサービス名リスト</a><a href="#condition-keys-principaltag">PrincipalTag</a><a href="#condition-keys-principaltype">PrincipalType</a><a href="#condition-keys-referer">Referer</a><a href="#condition-keys-requestedregion">RequestedRegion</a><a href="#condition-keys-requesttag">RequestTag</a><a href="#condition-keys-resourceaccount">ResourceAccount</a><a href="#condition-keys-resourceorgid">ResourceOrgID</a><a href="#condition-keys-resourceorgpaths">ResourceOrgPaths</a><a href="#condition-keys-resourcetag">ResourceTag</a><a href="#condition-keys-securetransport">SecureTransport</a><a href="#condition-keys-sourceaccount">SourceAccount</a><a href="#condition-keys-sourcearn">SourceArn</a><a href="#condition-keys-sourceidentity">ソースアイデンティティ</a><a href="#condition-keys-sourceip">SourceIp</a><a href="#condition-keys-sourcevpc">SourceVpc</a><a href="#condition-keys-sourcevpce">SourceVpce</a><a href="#condition-keys-tagkeys">TagKeys</a><a href="#condition-keys-tokenissuetime">TokenIssueTime</a><a href="#condition-keys-useragent">UserAgent</a><a href="#condition-keys-userid">Userid</a><a href="#condition-keys-username">ユーザー名</a><a href="#condition-keys-viaawsservice">ViaAWSService</a><a href="#condition-keys-vpcsourceip">VpcSourceIp</a><a href="#condition-keys-other">その他のクロスサービスキー</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="reference_policies_condition-keys">AWS グローバル条件コンテキストキー</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p><a href="./intro-structure.html#intro-structure-principal">プリンシパル</a>が AWS に<a href="./intro-structure.html#intro-structure-request">リクエスト</a>を行うと、AWS はリクエスト情報を<a href="./intro-structure.html#intro-structure-request">リクエストコンテキスト</a>に収集します。JSON ポリシーの <code class="code">Condition</code> 要素を使用して、リクエストコンテキストのキーを、ポリシーで指定したキー値と比較できます。グローバルキーがリクエストコンテキストに含まれる状況の詳細については、各グローバル条件キーの<b>可用性</b>情報を参照してください。JSON ポリシーで <code class="code">Condition</code> 要素を使用する方法の詳細については、「<a href="./reference_policies_elements_condition.html">IAM JSON ポリシー要素Condition</a>」を参照してください。</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>いくつかの状況でのみ利用可能な条件キーを使用する場合は、条件演算子の <a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">IfExists</a> バージョンを使用できます。リクエストコンテキストに条件キーがない場合、ポリシーは評価に失敗する可能性があります。たとえば、<code class="code">...IfExists</code> 演算子を使用する以下の条件ブロックでは、リクエストの送信元が特定の IP 範囲または VPC である場合、この条件に一致となります。いずれかまたは両方のキーがリクエストコンテキストに含まれていない場合でも、条件は引き続き <code class="code">true</code> を返します。これらの値は、指定したキーがリクエストコンテキスト内に含まれる場合にのみ確認されます。</p><pre class="programlisting"><div class="code-btn-container"></div><code class="json ">"Condition": <span>{</span>
    "IpAddressIfExists": <span>{</span>"aws:SourceIp" : ["xxx"] },
    "StringEqualsIfExists" : <span>{</span>"aws:SourceVpc" : ["yyy"]} 
}</code></pre></div></div><p>グローバル条件キーは、<code class="code">aws:</code> プレフィックスが付いた条件キーです。AWS のサービスは、グローバル条件キーをサポートするか、サービスプレフィックスを含むサービス固有のキーを提供できます。たとえば、IAM 条件キーには <code class="code">iam:</code> プレフィックスが含まれます。詳細については、「<a href="reference_policies_actions-resources-contextkeys.html" rel="noopener noreferrer" target="_blank">AWS のサービスのアクション、リソース、および条件キー</a>」を参照し、キーを表示するサービスを選択します。</p><div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>条件を複数のキー値を持つ要求コンテキストと比較するには、<code class="code">ForAllValues</code> または <code class="code">ForAnyValue</code> 集合演算子を使用する必要があります。セット演算子は、複数値の条件キーでのみ使用してください。単一値の条件キーで集合演算子を使用しないでください。詳細については、「<a href="./reference_policies_multi-value-conditions.html">複数のキーまたは値による条件の作成</a>」を参照してください。</p></div></div>
        <h2 id="condition-keys-calledvia">aws:CalledVia</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、ポリシー内のサービスと、IAM プリンシパル (ユーザーまたはロール) に代わってリクエストを実行したサービスを比較します。プリンシパルが AWS サービスに対してリクエストを実行すると、そのサービスはプリンシパルの認証情報を使用して、後続のリクエストを他のサービスに対して実行することがあります。<code class="code">aws:CalledVia</code> キーには、プリンシパルに代わってリクエストを実行したチェーン内の各サービスの順序付きリストが含まれます。</p>
        <p>例えば、AWS CloudFormation を使用して Amazon DynamoDB テーブルからの読み取りと書き込みを行うことができます。次に、DynamoDB は AWS Key Management Service（AWS KMS）によって提供される暗号化を使用します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性 </b> – このキーは、<code class="code">aws:CalledVia</code> をサポートするサービスが IAM プリンシパルの認証情報を使用して別のサービスにリクエストを実行する場合に、リクエスト内に存在します。サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合、このキーは存在しません。また、プリンシパルが直接呼び出しを行う場合にも存在しません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 複数値</p>
            </li></ul></div>
        <a id="calledvia-services"></a>
        <p>ポリシーで <code class="code">aws:CalledVia</code> 条件キーを使用するには、AWS サービスリクエストを許可または拒否するサービスプリンシパルを提供する必要があります。AWS は、<code class="code">aws:CalledVia</code> で次のサービスの使用をサポートしています。</p>
        <div class="table-container"><div class="table-contents"><table id="w338aac25c19c19c13c15"><thead>
                    <tr>
                        <th>サービスプリンシパル</th>
                    </tr>
                </thead>
                    <tr>
                        <td>athena.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>cloud9.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>cloudformation.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>databrew.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>dataexchange.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>dynamodb.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>kms.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>servicecatalog-appregistry.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>sqlworkbench.amazonaws.com</td>
                    </tr>
                </table></div></div>
        <p><em>いずれかの</em>サービスがプリンシパルの認証情報を使用してリクエストを実行したときにアクセスを許可または拒否するには、<code class="code"><a href="#condition-keys-viaawsservice">aws:ViaAWSService</a></code> 条件キーを使用します。この条件キーは、AWS サービスをサポートします。</p>
        <p><code class="code">aws:CalledVia</code> キーは<a href="./reference_policies_multi-value-conditions.html">複数値を持つキー</a>です。ただし、条件でこのキーを使用して順序を強制することはできません。上記の例を使用すると、<b>ユーザー 1</b>は、AWS CloudFormation に対してリクエストを実行し、それにより AWS KMS が呼び出され、DynamoDB が呼び出されます。これらは 3 つの個別のリクエストです。AWS KMS への最後の呼び出しは、AWS CloudFormation を<em>介し</em>、次に DynamoDB を介して、ユーザー 1 によって実行されます。</p>
        <div class="mediaobject">
             
                <img src="images/condition-key-calledvia-example-diagram.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                aws:CalledVia の使用例&#xA;            " style="max-width:100%" />
             
             
        </div>
        <p>この場合、リクエストコンテキストの <code class="code">aws:CalledVia</code> キーには、<code class="code">cloudformation.amazonaws.com</code>、<code class="code">dynamodb.amazonaws.com</code> がこの順序で含まれます。呼び出しがリクエストのチェーン内のどこかで、DynamoDB を介して行われたことだけが重要である場合は、ポリシーでこの条件キーを使用できます。</p>
        <p>たとえば、次のポリシーでは、AWS KMS という名前の <code class="code">my-example-key</code> キーを管理できますが、DynamoDB がリクエスト元のサービスの 1 つである場合に限ります。<code class="code"><a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">ForAnyValue:StringEquals</a></code> 条件演算子により、DynamoDB が呼び出し元サービスの 1 つであることが保証されます。プリンシパルが AWS KMS を直接呼び出す場合、条件は <code class="code">false</code> を返し、リクエストはこのポリシーで許可されません。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "KmsActionsIfCalledViaDynamodb",
            "Effect": "Allow",
            "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey",
                "kms:DescribeKey"
            ],
            "Resource": "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">111122223333</code>:key/<code class="replaceable">my-example-key</code>",
            "Condition": <span>{</span>
                "ForAnyValue:StringEquals": <span>{</span>
                    "aws:CalledVia": ["dynamodb.amazonaws.com"]
                }
            }
        }
    ]
}</code></pre>
        <p>チェーン内の最初または最後の呼び出しを行うサービスを強制する場合は、<code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaLast</a></code> キー <code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaFirst</a></code> とキーを使用できます。たとえば、次のポリシーでは、<code class="code">my-example-key</code> という名前のキーを AWS KMS で管理できます。これらの AWS KMS オペレーションは、複数のリクエストがチェーンに含まれている場合にのみ許可されます。最初のリクエストは AWS CloudFormation を介して、最後のリクエストは DynamoDB を介して実行される必要があります。他のサービスがチェーンの途中でリクエストを実行しても、オペレーションは許可されます。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "KmsActionsIfCalledViaChain",
            "Effect": "Allow",
            "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey",
                "kms:DescribeKey"
            ],
            "Resource": "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">111122223333</code>:key/<code class="replaceable">my-example-key</code>",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:CalledViaFirst": "cloudformation.amazonaws.com",
                    "aws:CalledViaLast": "dynamodb.amazonaws.com"
                }
            }
        }
    ]
}</code></pre>
        <p>サービスで IAM プリンシパルの認証情報を使用して別のサービスを呼び出す場合、<code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaFirst</a></code> キーと <code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaLast</a></code> キーはリクエスト内に存在します。これらは、リクエストのチェーンで呼び出しを行った最初と最後のサービスを示します。たとえば、AWS CloudFormation が <code class="code">X
                Service</code> という名前の別のサービスを呼び出し、それにより DynamoDB が呼び出され、AWS KMS が呼び出されるとします。AWS KMS への最後の呼び出しは、<code class="code">User 1</code> を<em>介して</em> AWS CloudFormation、DynamoDBの順に <code class="code">X Service</code> によって実行されます。これは、最初に AWS CloudFormation を介して呼び出され、最後に DynamoDB を介して呼び出されました。</p>
        <div class="mediaobject">
             
                <img src="images/condition-key-calledviafirstlast-example-diagram.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                aws:CalledViaFirst および aws:CalledViaLast の使用例&#xA;            " style="max-width:100%" />
             
             
        </div>
        
     
        <h2 id="condition-keys-calledviafirst">aws:CalledViaFirst</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、ポリシー内のサービスと、IAM プリンシパル (ユーザーまたはロール) に代わってリクエストを実行した<em><b>最初のサービス</b></em>を比較します。詳細については、「<code class="code"><a href="#condition-keys-calledvia">aws:CalledVia</a></code>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、サービスが IAM プリンシパルの認証情報を使用して、別のサービスに対して少なくとも 1 つの他のリクエストを実行する場合に、リクエスト内に存在します。サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合、このキーは存在しません。また、プリンシパルが直接呼び出しを行う場合にも存在しません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-calledvialast">aws:CalledViaLast</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、ポリシー内のサービスと、IAM プリンシパル (ユーザーまたはロール) に代わってリクエストを実行した<em>最後のサービス</em>を比較します。詳細については、「<code class="code"><a href="#condition-keys-calledvia">aws:CalledVia</a></code>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、サービスが IAM プリンシパルの認証情報を使用して、別のサービスに対して少なくとも 1 つの他のリクエストを実行する場合に、リクエスト内に存在します。サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合、このキーは存在しません。また、プリンシパルが直接呼び出しを行う場合にも存在しません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-currenttime">aws:CurrentTime</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Date">日付演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストの日時と、ポリシーで指定した日時を比較します。この条件キーを使用するポリシーの例を表示するには、「<a href="./reference_policies_examples_aws-dates.html">AWS: 日付と時刻に基づいてアクセスを許可します</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常にリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-ec2instancesourcevpc">aws: Ec2InstanceSourceVpc</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーは、Amazon EC2 IAM ロール認証情報が配信された VPC を識別します。<a href="#condition-keys-sourcevpc">aws:SourceVPC</a>グローバルキーを含むポリシーでこのキーを使用すると、認証情報が配信された VPC (<code class="code">aws:SourceVPC</code>) と一致する VPC から呼び出しが行われたかどうかを確認できます (<code class="code">aws:Ec2InstanceSourceVpc</code>)。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — リクエスターが Amazon EC2 ロールクレデンシャルでリクエストに署名しているときはいつでも、このキーがリクエストコンテキストに含まれます。IAM ポリシー、サービスコントロールポリシー、VPC エンドポイントポリシー、リソースポリシーで使用できます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>このキーは VPC 識別子の値と共に使用できますが、<code class="code">aws:SourceVpc</code> コンテキストキーと組み合わせた変数として使用すると最も便利です。この <code class="code">aws:SourceVpc</code> コンテキストキーは、リクエスタが VPC エンドポイントを使用してリクエストを行う場合にのみリクエストコンテキストに含まれます。<code class="code">aws:Ec2InstanceSourceVpc</code> と<code class="code">aws:SourceVpc</code> を使用すると、通常は一緒に変化する値を比較できるため、<code class="code">aws:Ec2InstanceSourceVpc</code> をより幅広く使用できます。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>この条件キーは、EC2-Classic では使用できません。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "RequireSameVPC",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
            "aws:SourceVpc": "$<span>{</span>aws:Ec2InstanceSourceVpc}"
        },
        "Null": <span>{</span>
          "ec2:SourceInstanceARN": "false"
        },
        "BoolIfExists": <span>{</span>
          "aws:ViaAWSService": "false"
        }
      }
    }
  ]
}</code></pre>
        <p>上記の例では、<code class="code">aws:SourceVpc</code> 値が <code class="code">aws:Ec2InstanceSourceVpc</code> 値と等しくない場合、アクセスは拒否されます。ポリシーステートメントは、<code class="code">ec2:SourceInstanceARN</code> 条件キーの有無をテストして Amazon EC2 インスタンスのロールとして使用されるロールのみに限定されます。</p>
        <p>このポリシーでは、Amazon EC2 インスタンスロールに代わってリクエストが行われた場合に、<code class="code">aws:ViaAWSService</code> が AWS リクエストを許可するようにしています。たとえば、Amazon EC2 インスタンスから暗号化された Amazon S3 バケットにリクエストを行うと、Amazon S3 がお客様に代わって AWS KMS を呼び出します。リクエストが AWS KMS に行われたときに、一部のキーが表示されません。</p>
     
        <h2 id="condition-keys-ec2instancesourceprivateip4">aws:Ec2InstanceSourcePrivateIPv4</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_IPAddress">IP アドレス演算子</a>で動作します。</p>
        <p>このキーは、Amazon EC2 IAM ロール認証情報が配信されたプライマリ elastic network interface プライベート IPv4 アドレスを識別します。VPC ID とソースプライベート IP をグローバルに一意に組み合わせるには、この条件キーをコンパニオンキー <code class="code">aws:Ec2InstanceSourceVpc</code> と一緒に使用する必要があります。このキー <code class="code">aws:Ec2InstanceSourceVpc</code> を使用して、認証情報が配信されたのと同じプライベート IP アドレスからリクエストが行われたことを確認します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — このキーは、リクエスターが Amazon EC2 ロールクレデンシャルでリクエストに署名しているときはいつでも、リクエストコンテキストに含まれます。IAM ポリシー、サービスコントロールポリシー、VPC エンドポイントポリシー、リソースポリシーで使用できます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>このキーは <code class="code">Allow</code> ステートメント内で単独で使用しないでください。プライベートIPアドレスは、定義上、グローバルに一意ではありません。Amazon EC2 インスタンスの認証情報を使用できる VPC を指定するには、<code class="code">aws:Ec2InstanceSourcePrivateIPv4</code>キーを使用するたびに <code class="code">aws:Ec2InstanceSourceVpc</code> キーを使用する必要があります。</p></div></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>この条件キーは、EC2-Classicでは使用できません。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Deny",
            "Action":  "*",
            "Resource": "*",
            "Condition": <span>{</span>
                "StringNotEquals": <span>{</span>
                    "aws:Ec2InstanceSourceVpc": "$<span>{</span>aws:SourceVpc}"
                },                
                "Null": <span>{</span>
                    "ec2:SourceInstanceARN": "false"
                },
                "BoolIfExists": <span>{</span>
                    "aws:ViaAWSService": "false"
                }
            }
        },
        <span>{</span>
            "Effect": "Deny",
            "Action":  "*",
            "Resource": "*",
            "Condition": <span>{</span>
                "StringNotEquals": <span>{</span>
                    "aws:Ec2InstanceSourcePrivateIPv4": "$<span>{</span>aws:VpcSourceIp}"
                },                               
                "Null": <span>{</span>
                    "ec2:SourceInstanceARN": "false"
                },
                "BoolIfExists": <span>{</span>
                    "aws:ViaAWSService": "false"
                }
            }
        }
    ]
}</code></pre>
     
        <h2 id="condition-keys-epochtime">aws:EpochTime</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Date">日付演算子</a>または<a href="./reference_policies_elements_condition_operators.html#Conditions_Numeric">数値演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストの日時（epoch または Unix 時間）をポリシーで指定した値と比較します。このキーは、1970 年 1 月 1 日からの秒数も受け付けます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常にリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-federatedprovider">aws:FederatedProvider</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、プリンシパルが発行した ID プロバイダー (IdP) とポリシーで指定した識別子とを比較します。つまり IAM ロールは、<code class="code">AssumeRoleWithWebIdentity</code> または<code class="code">AssumeRoleWithSAML</code> AWS STS オペレーションを使用して引き受けられたということです。結果のロールセッションの一時認証情報を使用してリクエストを作成する場合、リクエストコンテキストは、元のフェデレーティッド ID を認証した IdP を識別します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — このキーは、プリンシパルがロールセッションプリンシパルであり、サードパーティ ID プロバイダーを使用してそのセッションが発行された場合に存在します。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>例えば、ユーザーが Amazon Cognito を使用して認証された場合、リクエストコンテキストには <code class="code">cognito-identity.amazonaws.com</code> という値が含まれます。同様に、ユーザーが Login with Amazon を使用して認証された場合、リクエストコンテキストには <code class="code">www.amazon.com</code> という値が含まれます。</p>
        <p>単一値の条件キーは、<a href="./reference_policies_variables.html">変数</a>として使用できます。次のリソースベースのポリシーの例では、リソースの ARN において <code class="code">aws:FederatedProvider</code> キーをポリシー変数として使用しています。このポリシーでは、IdP を使用して認証されたプリンシパルが、発行元の ID プロバイダーに特有のパスを使用して、Amazon S3 からオブジェクトを取得できます。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::<code class="replaceable"><code class="replaceable">DOC-EXAMPLE-BUCKET</code></code>/$<span>{</span>aws:FederatedProvider}/*"
  }
}</code></pre>
     
        <h2 id="condition-keys-multifactorauthage">aws:MultiFactorAuthAge</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Numeric">桁演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスト元のプリンシパルが MFA を使用して承認されてからの秒数と、ポリシーで指定した数値を比較します。MFA の詳細については、「<a href="./id_credentials_mfa.html">AWS での多要素認証 (MFA) の使用</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、呼び出しを行うプリンシパルが MFA を使用して認証された場合にのみリクエストコンテキストに含まれます。MFA が使用されていなかった場合、このキーは存在しません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-multifactorauthpresent">aws:MultiFactorAuthPresent</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">ブール演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストを行った一時的なセキュリティ認証情報を検証するために多要素認証 (MFA) を使用したか確認します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、プリンシパルが一時的な認証情報を使用してリクエストを行う場合にのみ、リクエストコンテキストに含まれます。このキーは、長期的な認証情報を使用して行われた AWS CLI、AWS API、または AWS SDK リクエストには存在しません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>一時的な認証情報は、IAM ロール、フェデレーティッドユーザー、<code class="code">sts:GetSessionToken</code> の一時トークンを持つ IAM ユーザー、および AWS Management Console のユーザーを認証するために使用されます。IAM ユーザーアクセスキーは、長期的な認証情報ですが、場合によっては AWS は、IAM ユーザーの代わりに一時的な認証情報を作成し、操作を実行します。このような場合、<code class="code">aws:MultiFactorAuthPresent</code> キーはリクエストに存在し、<code class="code">false</code> の値に設定されます。これが起こる一般的なケースは、次の 2 つです。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>AWS Management Console の IAM ユーザーが、知らないうちに一時的認証情報を使用します。ユーザーは、長期的な認証情報であるユーザー名とパスワードを使用してコンソールにサインインします。ただし、バックグラウンドでは、コンソールがユーザーに代わって一時的な認証情報を生成します。</p>
            </li><li class="listitem">
                <p>IAM ユーザーがサービスを呼び出すと、AWS のサービスはユーザーの認証情報を再利用して、別のサービスに対して別のリクエストを行います。たとえば、Athena を呼び出して Amazon S3 バケットにアクセスする場合、または AWS CloudFormation Amazon EC2 インスタンスを作成するには、次の手順に従います。後続のリクエストで、AWS は一時的認証情報を使用します。</p>
            </li></ul></div>
        <p>一時的認証情報の使用がサポートされているサービスについては、「<a href="./reference_aws-services-that-work-with-iam.html">IAM と連携する AWS のサービス</a>」を参照してください。</p>
        <p><code class="code">aws:MultiFactorAuthPresent</code> キーは、API または CLI コマンドがアクセスキーペアなど長期的な認証情報で呼び出された場合には表示されません。したがって、このキーを確認する場合は <code class="code"><a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">...IfExists</a></code> バージョンの条件演算子の使用をお勧めします。</p>
        <p>以下の <code class="code">Condition</code> 要素は、MFA を使用してリクエストが認証されるかどうかを確認する信頼性の高い方法<em><b>ではない</b></em>点に注意してください。</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class="json ">#####   WARNING: NOT RECOMMENDED   #####
"Effect" : "Deny",
"Condition" : <span>{</span> "Bool" : <span>{</span> "aws:MultiFactorAuthPresent" : "false" } }</code></pre>
        <p><code class="code">Deny</code> 効果、<code class="code">Bool</code> 要素、<code class="code">false</code> 値のこの組み合わせは、MFA を使用して認証できるが認証されなかったリクエストを拒否します。このステートメントは、MFA の使用をサポートする一時的認証情報にのみ適用されます。このステートメントは、長期的認証情報を使用して行われるリクエスト、または MFA を使用して認証されるリクエストへのアクセスを拒否しません。ロジックが複雑で MFA 認証が実際に使用されたかどうかをテストしないため、この例は慎重に使用してください。</p>
        <p>また、<code class="code">Deny</code> 効果、<code class="code">Null</code> 要素、<code class="code">true</code> の組み合わせは使用しないでください。この組み合わせも同様に、ロジックはさらに複雑になるためです。</p>
         
            <h6>推奨される組み合わせ</h6>
            <p><a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">BoolIfExists</a> 演算子を使用して、リクエストが MFA を使用して認証されたかどうかを確認することをお勧めします。</p>
         
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Effect" : "Deny",
"Condition" : <span>{</span> "BoolIfExists" : <span>{</span> "aws:MultiFactorAuthPresent" : "false" } }</code></pre>
        <p><code class="code">Deny</code>、<code class="code">BoolIfExists</code>、<code class="code">false</code> のこの組み合わせは、MFA を使用して認証されないリクエストを拒否します。具体的には、MFA を使用しないで一時的認証情報を使用して行われたリクエストを拒否します。また、AWS CLI などの長期的な認証情報またはアクセスキーを使用して行われる AWS API オペレーションを使用して行われるリクエストも拒否されます。<code class="code">*IfExists</code> 演算子は、<code class="code">aws:MultiFactorAuthPresent</code> キーが存在するかどうか、MFA が使用されているかどうかを確認します。これは、MFA を使用して認証されないリクエストを拒否する場合に使用します。これはより安全ですが、AWS CLI または AWS API にアクセスするためにアクセスキーを使用するコードやスクリプトを破損する可能性があります。</p>
         
            <h6>代替の組み合わせ</h6>
            <p>また、<a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">BoolIfExists</a> 演算子を使用して、長期的認証情報を使用して行われる MFA 認証リクエストおよび AWS CLI または AWS API リクエストを許可することもできます。</p>
         
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Effect" : "Allow",
"Condition" : <span>{</span> "BoolIfExists" : <span>{</span> "aws:MultiFactorAuthPresent" : "true" } }</code></pre>
        <p>キーが存在して MFA が使用されている場合<b>または</b>キーが存在しない場合、この条件に一致となります。<code class="code">Allow</code>、<code class="code">BoolIfExists</code>、<code class="code">true</code> のこの組み合わせは、MFA を使用して認証されたリクエスト、または MFA を使用して認証できないリクエストを許可します。つまり、リクエスタが長期的なアクセスキーを使用する場合、AWS CLI、AWS API、および AWS SDK オペレーションが許可されます。この組み合わせでは、MFA を含むことはできるが含んでいない、一時的な認証情報からのリクエストが許可されません。</p>
        <p>IAM コンソールのビジュアルエディタを使用してポリシーを作成し、[<b>MFA required (MFA 必須)</b>,] を選択すると、この組み合わせが適用されます。この設定では、コンソールアクセスに MFA が必要ですが、MFA なしでプログラムによるアクセスを許可します。</p>
        <p>または、<code class="code">Bool</code> 演算子を使用して、MFA を使用して認証された場合にのみ、プログラムによるリクエストとコンソールによるリクエストを許可できます。</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class="json ">"Effect" : "Allow",
"Condition" : <span>{</span> "Bool" : <span>{</span> "aws:MultiFactorAuthPresent" : "true" } }</code></pre>
        <p><code class="code">Allow</code>、<code class="code">Bool</code>、<code class="code">true</code> のこの組み合わせは、MFA 認証リクエストのみを許可します。このステートメントは、MFA の使用をサポートする一時的認証情報にのみ適用されます。このステートメントは、長期的アクセスキーを使用して行われたリクエスト、または MFA を使用しないで一時的認証情報を使用して行われたリクエストへのアクセスを許可しません。</p>
        <p>MFA キーが存在するかを確認する場合、以下のようなポリシーは使用<b><em>しない</em></b>でください。</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class="json ">#####   WARNING: USE WITH CAUTION   #####

"Effect" : "Allow",
"Condition" : <span>{</span> "Null" : <span>{</span> "aws:MultiFactorAuthPresent" : "false" } }</code></pre>
        <p><code class="code">Allow</code> 効果、<code class="code">Null</code> 要素、<code class="code">false</code> 値のこの組み合わせは、リクエストが実際に認証されたかどうかにかかわらず、MFA を使用して認証できるリクエストのみを許可します。これにより、一時的認証情報を使用して行われるすべてのリクエストが許可され、長期的認証情報を使用して行われたリクエストは拒否されます。MFA 認証が実際に使用されたかどうかをテストしないため、この例は慎重に使用してください。</p>
     
        <h2 id="condition-keys-principalaccount">aws:PrincipalAccount</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスト元のプリンシパルが属するアカウントと、ポリシーで指定したアカウント識別子を比較します。匿名リクエストの場合、リクエストコンテキストは <code class="code">anonymous</code> を返します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、匿名リクエストなどのすべてのリクエストのリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>次の例では、アカウント番号が <code class="code">123456789012</code> のプリンシパル以外に対するアクセスは拒否されます。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "DenyAccessFromPrincipalNotInSpecificAccount",
      "Action": "<code class="replaceable">service</code>:*",
      "Effect": "Deny",
      "Resource": [
        "arn:aws:<code class="replaceable">service:region:accountID:resource</code>"
      ],
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:PrincipalAccount": [
            "123456789012"
          ]
        }
      }
    }
  ]
}
        </code></pre>

     
        <h2 id="condition-keys-principalarn">aws:PrincipalArn</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_ARN">ARN 演算子</a>と<a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>とともに使用します。</p>
        <p>このキーを使用して、リクエストを行ったプリンシパルの <a href="./reference_identifiers.html#identifiers-arns">Amazon リソースネーム</a> (ARN) をポリシーで指定した ARN と比較します。IAM ロールの場合、リクエストコンテキストは、ロールを引き受けたユーザーの ARN ではなく、ロールの ARN を返します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、すべての署名付きリクエストのリクエストコンテキストに含まれます。匿名リクエストには、このキーは含まれません。この条件キーで指定できるプリンシパルのタイプは次のとおりです。</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>[IAM role] (IAM ロール)</p>
                    </li><li class="listitem">
                        <p>IAM ユーザー</p>
                    </li><li class="listitem">
                        <p>AWS STS フェデレーションユーザーセッション</p>
                    </li><li class="listitem">
                        <p>AWS アカウント ルートユーザー</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>次のリストは、<code class="code">aws:PrincipalArn</code> 条件キーで指定できるさまざまなタイプのプリンシパルに対して返されるリクエストコンテキスト値を示しています。</p>
        <div class="itemizedlist">
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>IAM ロール</b> — リクエストコンテキストには、条件キー <code class="code">aws:PrincipalArn</code> に次の値が含まれています。引き受けたロールのセッション ARN をこの条件キーの値として指定しないでください。引き受けたロールセッションのプリンシパルの詳細については、「<a href="./reference_policies_elements_principal.html#principal-role-session">ロールセッションプリンシパル</a>」を参照してください。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:iam::123456789012:role/role-name</code></code></pre>
            </li><li class="listitem">
                <p><b>IAM ユーザー</b> — リクエストコンテキストには、条件キー <code class="code">aws:PrincipalArn</code> に次の値が含まれています。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:iam::123456789012:user/<code class="replaceable">user-name</code></code></code></pre>
            </li><li class="listitem">
                <p><b>AWS STS フェデレーションユーザーセッション</b> — リクエストコンテキストには、条件キー <code class="code">aws:PrincipalArn</code> に次の値が含まれています。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:sts::123456789012:federated-user/<code class="replaceable">user-name</code></code></code></pre>
            </li><li class="listitem">
                <p><b>AWS アカウント ルートユーザー</b> — リクエストコンテキストには、条件キー <code class="code">aws:PrincipalArn</code> に次の値が含まれています。ルートユーザー ARN を <code class="code">aws:PrincipalArn</code> 条件キーの値として指定すると、アクセス許可が AWS アカウント のルートユーザーのみに制限されます。これは、リソースベースポリシーのプリンシパル要素でルートユーザー ARN を指定して、AWS アカウント.に権限を委任することとは異なります。リソースベースのポリシーのプリンシパル要素でルートユーザー ARN を指定する方法については、「<a href="./reference_policies_elements_principal.html#principal-accounts">AWS アカウント プリンシパル</a>」を参照してください。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:iam::123456789012:root</code></code></pre>
                <p>AWS Organizations サービスコントロールポリシー (SCP) の条件キー <code class="code">aws:PrincipalArn</code> の値としてルートユーザー ARN を指定することができます。SCP は、組織のアクセス許可の管理に使用される組織ポリシーの一種で、組織内のメンバーアカウントにのみ影響します。SCP は、メンバーアカウントのルートユーザーを含む、メンバーアカウントの IAM ユーザーとロールのアクセス許可を制限します。SCP がアクセス許可に与える影響については、「Organizations ユーザーガイド」の「<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html#scp-effects-on-permissions">アクセス許可における SCP 効果</a>」を参照してください。</p>
            </li></ul></div>
        
     
        <h2 id="condition-keys-principalisawsservice">aws:PrincipalIsAWSService</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">ブール演算子</a>で動作します。</p>
        <p>このキーを使用して、リソースへの呼び出しが AWS <a href="./reference_policies_elements_principal.html#principal-services">サービスプリンシパル</a>によって直接行われているかどうかを確認します。たとえば、AWS CloudTrail はサービスプリンシパル <code class="code">cloudtrail.amazonaws.com</code> を使用して、Amazon S3 バケットにログを書き込みます。サービスがサービスプリンシパルを使用してリソースに対して直接アクションを実行する場合、リクエストコンテキストキーは true に設定されます。サービスが IAM プリンシパルの認証情報を使用し、プリンシパルに代わってリクエストを行う場合、コンテキストキーは false に設定されます。また、サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合も、false に設定されます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — このキーは、AWS 認証情報を使用するすべての署名済み API リクエストのリクエストコンテキストに存在します。匿名リクエストには、このキーは含まれません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>この条件キーを使用して、AWS サービスへのアクセスを安全に許可しながら、信頼できる ID と予想されるネットワークの場所へのアクセスを制限できます。</p>
        <p>次の Amazon S3 バケットポリシーの例では、リクエストが <code class="code">vpc-111bbb22</code> から発信されているか、CloudTrail などのサービスプリンシパルから発信されていない限り、バケットへのアクセスが制限されています。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "Expected-network+service-principal",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::<code class="replaceable"><code class="replaceable">DOC-EXAMPLE-BUCKET1</code></code>/AWSLogs/<code class="replaceable">AccountNumber</code>/*",
      "Condition": <span>{</span>
        "StringNotEqualsIfExists": <span>{</span>
          "aws:SourceVpc": "vpc-111bbb22"
        },
        "BoolIfExists": <span>{</span>
          "aws:PrincipalIsAWSService": "false"
        }
      }
    }
  ]
}</code></pre>
        
        <p>次のビデオでは、ポリシーで <code class="code">aws:PrincipalIsAWSService</code> 条件キーを使用する方法について詳しく説明します。</p>
        <div class="mediaobject">
             
                <iframe width="720" height="330" frameborder="0" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" sandbox="allow-scripts allow-same-origin allow-popups" src="https://www.youtube-nocookie.com/embed/gv-_H8a42G4"></iframe>
             
             
        </div>
        
        
        
     
        <h2 id="condition-keys-principalorgid">aws:PrincipalOrgID</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスト元のプリンシパルが属する AWS Organizations の組織の識別子と、ポリシーで指定された識別子を比較します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、プリンシパルが組織のメンバーである場合にのみリクエストコンテキストに含まれます。匿名リクエストには、このキーは含まれません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>このグローバルキーは、組織内のすべての AWS アカウントのすべてのアカウント ID を一覧表示する代わりに使用できます。この条件キーを使用して、<a href="./access_policies_identity-vs-resource.html">リソースベースのポリシー</a>での <code class="code">Principal</code> 要素の指定を簡素化します。<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_org_details.html">組織 ID</a> は、条件要素で指定できます。アカウントを追加したり削除したりすると、<code class="code">aws:PrincipalOrgID</code> を含むポリシーには正しいアカウントが自動的に組み込まれ、手動で更新する必要はありません。</p>
        <p>たとえば、以下の <code class="code">o-xxxxxxxxxxx</code> バケットポリシーでは、<code class="code">policy-ninja-dev</code> 組織の任意のアカウントのメンバーに Amazon S3 バケットへのオブジェクトの追加を許可します。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "> <span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Sid": "AllowPutObject",
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:PutObject",
    "Resource": "arn:aws:s3:::policy-ninja-dev/*",
    "Condition": <span>{</span>"StringEquals":
      <span>{</span>"aws:PrincipalOrgID":"o-xxxxxxxxxxx"}
    }
  }
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>また、このグローバル条件は、AWS 組織の管理アカウントにも適用されます。このポリシーは、指定した組織以外のすべてのプリンシパルが、Amazon S3 バケットにアクセスできないようにします。これには、AWS CloudTrail がログデータを Amazon S3 バケットに送信する場合など、お客様の内部リソースと相互にやり取りを行う AWS サービスも含まれます。AWS サービスでアクセス許可を安全に付与する方法については、「<a href="#condition-keys-principalisawsservice">aws:PrincipalIsAWSService</a>」を参照してください。</p></div></div>
        <p>AWS Organizations の詳細については、<em>AWS Organizationsユーザーガイド</em>の「<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_introduction.html">AWS Organizations とは</a>」を参照してください。</p>
     
        <h2 id="condition-keys-principalorgpaths">aws:PrincipalOrgPaths</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストを行っているプリンシパルの AWS Organizations パスをポリシー内のパスと比較します。そのプリンシパルは、IAM ユーザー、IAM ロール、フェデレーションユーザー、または AWS アカウントのルートユーザー です。ポリシーでは、この条件キーによって、リクエスタが AWS Organizations で指定された組織ルートまたは組織単位 (OU) 内のアカウントメンバーであることが保証されます。AWS Organizations パスは、Organizations エンティティの構造をテキストで表記したものです。パスの使用と理解の詳細については、「<a href="./access_policies_access-advisor-view-data-orgs.html#access_policies_access-advisor-viewing-orgs-entity-path">AWS Organizations エンティティパスを理解する</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、プリンシパルが組織のメンバーである場合にのみリクエストコンテキストに含まれます。匿名リクエストには、このキーは含まれません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 複数値</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>組織 ID はグローバルに一意ですが、OU ID とルート ID は組織内でのみ一意です。これは、2 つの組織が同じ組織 ID を共有しないことを意味します。ただし、別の組織が自分と同じ ID を持つ OU またはルートを持っている可能性があります。OU またはルートを指定するときは、必ず組織 ID を含めることをお勧めします。</p></div></div>
        
        <p>たとえば、次の条件は、<code class="code">true</code> OU に直接アタッチされているが、子の OU にはアタッチされていないアカウントのプリンシパルに対して <code class="code">ou-ab12-22222222</code> を返します。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringEquals" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/"]
}}</code></pre>
        
        <p>次の条件は、OU またはその子の OU に直接アタッチされているアカウントのプリンシパルに対して <code class="code">true</code> を返します。ワイルドカードを含める場合は、<code class="code">StringLike</code> 条件演算子を使用する必要があります。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/*"]
}}</code></pre>
        <p>次の条件は、OU またはその子の OU に直接アタッチされているアカウントのプリンシパルに対して <code class="code">true</code> を返します。以前の条件は、OU または任意の子を対象としています。以下の条件は、子のみ (およびそれらの子のすべての子) を対象としています 。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/ou-*"]
}}</code></pre>
        <p>次の条件は、親 OU に関係なく、<code class="code">o-a1b2c3d4e5</code> 組織内のすべてのプリンシパルへのアクセスを許可します。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/*"]
}}</code></pre>
        <p><code class="code">aws:PrincipalOrgPaths</code> は複数の値を持つ条件キーです。複数値のキーは、リクエストコンテキストに複数の値を持つことができます。<code class="code">ForAnyValue</code> 条件演算子で複数の値を使用する場合、プリンシパルのパスはポリシーに一覧表示されているパスの 1 つと一致する必要があります。複数値を持つ条件キーの詳細については、「<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">複数のキーバリューの使用</a>」を参照してください。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">    "Condition": <span>{</span>
        "ForAnyValue:StringLike": <span>{</span>
            "aws:PrincipalOrgPaths": [
                "o-a1b2c3d4e5/r-ab12/ou-ab12-33333333/*",
                "o-a1b2c3d4e5/r-ab12/ou-ab12-22222222/*"
            ]
        }
    }</code></pre>
     
        <h2 id="condition-keys-principalservicename">aws:PrincipalServiceName</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、<a href="./reference_policies_elements_principal.html#principal-services">サービスプリンシパル</a>の名前を、リソースにリクエストするサービスプリンシパルとともに設定します。このキーを使用して、この呼び出しが特定のサービスプリンシパルによって行われたかどうかを確認できます。サービスプリンシパルがリソースに直接リクエストする場合、<code class="code">aws:PrincipalServiceName</code> キーには、サービスプリンシパルの名前が含まれます。たとえば、AWS CloudTrail のサービスプリンシパル名は <code class="code">cloudtrail.amazonaws.com</code> です。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — このキーは、呼び出しがAWSサービスプリンシパル。このキーは、次のような他の状況では存在しません。</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合。</p>
                    </li><li class="listitem">
                        <p>サービスが IAM プリンシパルの認証情報を使用し、プリンシパルに代わってリクエストを行う場合。</p>
                    </li><li class="listitem">
                        <p>呼び出しが IAM プリンシパルによって直接行われた場合。</p>
                    </li><li class="listitem">
                        <p>匿名の依頼者によって電話された場合。</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>この条件キーを使用して、AWS サービスへのアクセスを安全に許可しながら、信頼できる ID と予想されるネットワークの場所へのアクセスを制限できます。</p>
        <p>次の Amazon S3 バケットポリシーの例では、リクエストが <code class="code">vpc-111bbb22</code> から発信されているか、CloudTrail などのサービスプリンシパルから発信されていない限り、バケットへのアクセスが制限されています。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "expected-network+service-principal",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::<code class="replaceable"><code class="replaceable">DOC-EXAMPLE-BUCKET1</code></code>/AWSLogs/<code class="replaceable">AccountNumber</code>/*",
      "Condition": <span>{</span>
        "StringNotEqualsIfExists": <span>{</span>
          "aws:SourceVpc": "vpc-111bbb22",
          "aws:PrincipalServiceName": "cloudtrail.amazonaws.com"
        }
      }
    }
  ]
}
        </code></pre>
     
        <h2 id="condition-keys-principalservicenameslist">aws:PrincipalServiceNamesList</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーは、サービスに属するすべての<a href="./reference_policies_elements_principal.html#principal-services">サービスプリンシパル</a>名のリストを提供します。これは高度な条件キーです。これを使用して、サービスが特定のリージョンからのみリソースにアクセスすることを制限できます。一部のサービスでは、特定のリージョン内のサービスの特定のインスタンスを示すために、リージョナルサービスプリンシパルを作成できます。リソースへのアクセスをサービスの特定のインスタンスに制限できます。サービスプリンシパルがリソースに直接リクエストを行うと、<code class="code">aws:PrincipalServiceNamesList</code> には、サービスのリージョナルインスタンスに関連付けられているすべてのサービスプリンシパル名の順序付けられていないリストが含まれます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — このキーは、呼び出しがAWSサービスプリンシパル。このキーは、次のような他の状況では存在しません。</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合。</p>
                    </li><li class="listitem">
                        <p>サービスが IAM プリンシパルの認証情報を使用し、プリンシパルに代わってリクエストを行う場合。</p>
                    </li><li class="listitem">
                        <p>呼び出しが IAM プリンシパルによって直接行われた場合。</p>
                    </li><li class="listitem">
                        <p>匿名の依頼者によって電話された場合。</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 複数値</p>
            </li></ul></div>
        <p><code class="code">aws:PrincipalServiceNamesList</code> は複数の値を持つ条件キーです。複数値のキーは、リクエストコンテキストに複数の値を持つことができます。このキーを使用する場合は、<a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列条件演算子</a>とともに <code class="code">ForAnyValue</code> または <code class="code">ForAllValues</code> の集合演算子を使用する必要があります。複数値を持つ条件キーの詳細については、「<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">複数のキーバリューの使用</a>」を参照してください。</p>
     
        <h2 id="condition-keys-principaltag">aws:PrincipalTag/tag-key</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストを行うプリンシパルにアタッチされたタグと、ポリシーで指定したタグを比較します。プリンシパルに複数のタグがアタッチされている場合、リクエストコンテキストには、アタッチされたタグキーごとに 1 つの <code class="code">aws:PrincipalTag</code> キーが含まれます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、プリンシパルが、タグがアタッチされた IAM ユーザーである場合にリクエストコンテキストに含まれます。これは、タグまたは<a href="./id_session-tags.html">セッションタグ</a>がアタッチされた IAM ロールを使用するプリンシパルのために含まれます。匿名リクエストには、このキーは含まれません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>カスタム属性は、キーバリューのペアの形式でユーザーまたはロールに追加できます。IAM タグの使用の詳細については、「<a href="./id_tags.html">IAM リソースのタグ付け</a>」を参照してください。<code class="code">aws:PrincipalTag</code> を使用して AWS プリンシパルの<a href="./access_iam-tags.html#access_iam-tags_control-principals">アクセスをコントロール</a>できます。</p>
        <p>この例では、<code class="userinput">department=hr</code> タグを持つユーザーが IAM ユーザー、グループ、またはロールを管理できるようにするID ベースポリシーを作成する方法を示しています。このポリシーを使用するには、サンプルポリシーの<code class="replaceable">イタリック体のプレースホルダーテキスト</code>を独自の情報に置き換えます。次に、「<a href="./access_policies_create.html">ポリシーの作成</a>または<a href="./access_policies_manage-edit.html">ポリシーの編集</a>」の手順に従います。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "iam:*",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:PrincipalTag/<code class="replaceable">department</code>": "<code class="replaceable">hr</code>"
        }
      }
    }
  ]
}</code></pre>
        <p>この例では、リソースに ARN <code class="code">aws:PrincipalTag</code> キーを使用してリソースベースのポリシーを作成する方法を示します。このポリシーでは、バケット名が <code class="code"><code class="replaceable">team</code></code> プリンシパルタグのチーム名で終わる場合にのみ <code class="code">s3:GetObject</code> アクションが許可されます。このポリシーを使用するには、サンプルポリシーの<code class="replaceable">イタリック体のプレースホルダーテキスト</code>を独自の情報に置き換えます。次に、「<a href="./access_policies_create.html">ポリシーの作成</a>または<a href="./access_policies_manage-edit.html">ポリシーの編集</a>」の手順に従います。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET</code>-$<span>{</span>aws:PrincipalTag/<code class="replaceable">team</code>}/"
  }
}</code></pre>
     
        <h2 id="condition-keys-principaltype">aws:PrincipalType</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストを行うプリンシパルと、ポリシーで指定したプリンシパルのタイプを比較します。詳細については、「<a href="./reference_policies_elements_principal.html#Principal_specifying">プリンシパルの指定</a>」を参照してください。<code class="code">principal</code> キーの値の具体的な例については、「<a href="./reference_policies_variables.html#principaltable">プリンシパルキーの値</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、匿名リクエストなどのすべてのリクエストのリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-referer">aws:referer</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、クライアントブラウザでリクエストを参照したユーザーとポリシーで指定したリファラーを比較します。<code class="code">aws:referer</code> リクエストコンテキストの値は、HTTP ヘッダーで呼び出し元によって提供されます。<code class="code">Referer</code> ヘッダーは、ウェブページ上のリンクを選択すると、ウェブブラウザリクエストに含まれます。<code class="code">Referer</code> ヘッダーには、リンクが選択されたウェブページの URL が含まれます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、ブラウザでウェブページ URL からリンクすることによって AWS リソースへのリクエストが呼び出された場合にのみ、リクエストコンテキストに含まれます。このキーは、AWS リソースへのアクセスにブラウザリンクを使用しないため、プログラムによるリクエストには含まれません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>例えば、URL または直接 API 呼び出しを使用して、Amazon S3 オブジェクトに直接アクセスできます。詳細については、「<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-4">ウェブブラウザを使用して Amazon S3 API オペレーションを直接呼び出す</a>」をご参照ください。ウェブページに存在する URL から Amazon S3 オブジェクトにアクセスすると、ソースウェブページの URL が <code class="code">aws:referer</code> で使用されます。ブラウザに URL を入力して Amazon S3 オブジェクトにアクセスすると、<code class="code">aws:referer</code> は存在しません。API を直接呼び出すと、<code class="code">aws:referer</code> も存在していません。ポリシーで <code class="code">aws:referer</code> 条件キーを使用して、会社のドメイン内のウェブページ上のリンクなど、特定のリファラーからのリクエストを許可できます。</p>
        <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>警告</h6></div><div class="awsdocs-note-text"><p>このキーは慎重に使用する必要があります。一般に知られている参照子のヘッダー値を含めるのは危険です。不正な当事者は、変更されたブラウザまたはカスタムブラウザを使用して任意の <code class="code">aws:referer</code> 値を提供することができます。そのため <code class="code">aws:referer</code> は、不正な当事者から AWS にリクエストが直接行われることを防止するために使用しないでください。このキーは、Amazon S3 に保存されているデジタルコンテンツなど、不正なサードパーティーサイトで参照されることから保護するためにのみ、お客様に提供されています。</p></div></div>
     
        <h2 id="condition-keys-requestedregion">aws:RequestedRegion</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストで呼び出された AWS リージョンとポリシーで指定したリージョンを比較します。このグローバル条件キーを使用して、リクエストできるリージョンを制御できます。各サービスの AWS リージョンを表示するには、「Amazon Web Services 全般のリファレンス」の「<a href="https://docs.aws.amazon.com/general/latest/gr/aws-service-information.html">サービスエンドポイントとクォータ</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常にリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>IAM などのグローバルサービスには、単一のエンドポイントがあります。このエンドポイントは、物理的に米国東部 (バージニア北部) リージョンにあるため、IAM 呼び出しは常に us-east-1 リージョンで行われます。たとえば、リクエストされたリージョンが us-west-2 でない場合にすべてのサービスへのアクセスを拒否するポリシーを作成すると、IAM 呼び出しは必ず失敗します。これを回避する方法の例を表示するには、「<a href="./reference_policies_elements_notaction.html">Deny での NotAction の使用</a>」を参照してください。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p><code class="code">aws:RequestedRegion</code> 条件キーを使用すると、呼び出されるサービスのエンドポイントを制御できますが、オペレーションの影響を制御することはできません。一部のサービスではリージョン間の影響があります。たとえば、Amazon S3 にはリージョン間レプリケーションを制御する API オペレーションがあります。1 つのリージョン（<code class="code">aws:RequestedRegion</code> の条件キーの影響を受ける）で <code class="code">s3:PutBucketReplication</code> を呼び出すことはできますが、他のリージョンはレプリケーションの構成設定に基づいて影響を受けます。</p></div></div>
        <p>このコンテキストキーを使用して、指定された一連のリージョン内の AWS サービスへのアクセスを制限できます。たとえば、以下のポリシーでは、AWS Management Console でのすべての Amazon EC2 インスタンスの表示をユーザーに許可します。ただし、変更できるインスタンスは、アイルランド (eu-west-1)、ロンドン (eu-west-2)、パリ (eu-west-3) のみです。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "InstanceConsoleReadOnly",
            "Effect": "Allow",
            "Action": [
                "ec2:Describe*",
                "ec2:Export*",
                "ec2:Get*",
                "ec2:Search*"
            ],
            "Resource": "*"
        },
        <span>{</span>
            "Sid": "InstanceWriteRegionRestricted",
            "Effect": "Allow",
            "Action": [
                "ec2:Associate*",
                "ec2:Import*",
                "ec2:Modify*",
                "ec2:Monitor*",
                "ec2:Reset*",
                "ec2:Run*",
                "ec2:Start*",
                "ec2:Stop*",
                "ec2:Terminate*"
            ],
            "Resource": "*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestedRegion": [
                        "eu-west-1",
                        "eu-west-2",
                        "eu-west-3"
                    ]
                }
            }
        }
    ]
}       </code></pre>
     
        <h2 id="condition-keys-requesttag">aws:RequestTag/<em>tag-key</em></h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストで渡されたタグキーバリューのペアと、ポリシーで指定したタグペアを比較します。たとえば、リクエストに「<code class="code">"Dept"</code>」タグキーが含まれ、「<code class="code">"Accounting"</code>」という値が含まれているかどうかを確認できます。詳細については、「<a href="./access_tags.html#access_tags_control-requests">AWS リクエスト時のアクセスの制御</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リクエストでタグのキー/値のペアが渡されたときにリクエストコンテキストに含まれます。複数のタグがリクエストで渡されると、タグキーバリューのペアごとに 1 つのコンテキストキーがあります。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>このコンテキストキーは <code class="code">"aws:RequestTag/<code class="replaceable">tag-key</code>":"<code class="replaceable">tag-value</code>"</code> という形式です。ここで <code class="replaceable">tag-key</code> および <code class="replaceable">tag-value</code> はタグキーバリューのペアです。タグのキーと値は大文字と小文字が区別されません。つまり、ポリシーの条件要素で <code class="code">"aws:RequestTag/TagKey1": "Value1"</code> で指定した場合、その条件は <code class="code">TagKey1</code> または <code class="code">tagkey1</code> という名前のリクエストタグキーに一致しますが、その両方には一致しません。</p>
        <p>この例では、キーが単一値であっても、キーが異なる場合でもリクエストで複数のキー/値のペアが使用できることを示しています。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Action": "ec2:CreateTags",
    "Resource": "arn:aws:ec2:::instance/*",
    "Condition": <span>{</span>
      "StringEquals": <span>{</span>
        "aws:RequestTag/environment": [
          "preprod",
          "production"
        ],
        "aws:RequestTag/team": [
          "engineering"
        ]
      }
    }
  }
}
</code></pre>
     
        <h2 id="condition-keys-resourceaccount">aws:ResourceAccount</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、ポリシーのリソースアカウントと要求されたリソース所有者の <a href="https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html">AWS アカウント ID</a> を比較します。その後、リソースを所有するアカウントに応じて、そのリソースへのアクセスを許可または拒否することができます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> - このキーは常時ほとんどのサービスアクションのリクエストコンテキストに含まれます。以下のアクションではこのキーをサポートしていません。</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon Elastic Block Store - すべてのアクション</p>
                    </li><li class="listitem">
                        <p>Amazon EC2</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">ec2:AcceptTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CopySnapshot</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVolume</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcEndpoint</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcPeeringConnection</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon EventBridge — すべてのアクション</p>
                    </li><li class="listitem">
                        <p>Amazon Route 53</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">route53:AssociateVpcWithHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:CreateVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DeleteVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DisassociateVPCFromHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:ListHostedZonesByVPC</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon WorkSpaces</p>
                        <div class="itemizedlist">
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">workspaces:DescribeWorkspaceImages</code></p>
                            </li></ul></div>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>上記のサポートされていないアクションに関するその他の考慮事項については、<a href="https://github.com/aws-samples/data-perimeter-policy-examples" rel="noopener noreferrer" target="_blank"><span>data-perimeter-policy-examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> リポジトリを参照してください。</p></div></div>
        <p>このキーはリクエストで評価されたリソースを持つアカウントの AWS アカウント ID に相当します。</p>
        <p>アカウントのリソースのほとんどで、<a href="./reference_policies_elements_condition_operators.html#Conditions_ARN">ARN</a> にそのリソースの所有者アカウント ID が含まれています。Amazon S3 バケットなどの特定のリソースでは、リソース ARN にアカウント ID は含まれていません。次の 2 つの例は、ARN にアカウント ID を持つリソースと、アカウント ID を持たない Amazon S3 ARN の違いを示しています。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code">arn:aws:iam::123456789012:role/AWSExampleRole</code> – アカウント 123456789012 内で作成および所有されている IAM ロール。</p>
            </li><li class="listitem">
                <p><code class="code">arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET2</code></code> — ARN に表示されていない <code class="code">111122223333</code> アカウント内で作成および所有されている Amazon S3 バケット。</p>
            </li></ul></div>
        <p>AWS コンソールや API、または CLI を使用して、すべてのリソースおよび対応する ARN を検索します。</p>
        <p>リソース所有者のアカウント ID に応じて、リソースへのアクセス権を拒否するポリシーを記述します。例えば、リソースが<em>指定されたアカウント</em>に属さない場合に、以下の ID ベースポリシーでは<em>指定されたリソース</em>へのアクセスを拒否します。</p>
        <p>このポリシーを使用するには、イタリック体のプレースホルダーテキストをお客様のアカウント情報と置き換えます。</p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>このポリシーでは、アクションを許可しません。代わりに、ステートメントに記載され、リストされたアカウントに属さないすべてのリソースへのアクセスを明示的に拒否する <code class="code">Deny</code> 効果を使用します。特定のリソースへのアクセスを許可する他のポリシーと組み合わせてこのポリシーを使用します。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "DenyInteractionWithResourcesNotInSpecificAccount",
      "Action": "<code class="replaceable">service</code>:*",
      "Effect": "Deny",
      "Resource": [
        "arn:aws:<code class="replaceable">service</code>:<code class="replaceable">region</code>:<code class="replaceable">account</code>:<code class="replaceable">*</code>"
      ],
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:ResourceAccount": [
            "<code class="replaceable">account</code>"
          ]
        }
      }
    }
  ]
}</code></pre>
        <p>このポリシーでは、特定の AWS アカウント でリソースを所有する場合を除き、特定の AWS サービスのすべてのリソースへのアクセスを拒否します。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>一部の AWS のサービス では他の AWS アカウント でホストされている AWS 所有リソースへのアクセスを必要とします。ID ベースのポリシーで <code class="code">aws:ResourceAccount</code> を使用する場合は、これらのリソースにアクセスする ID の機能に影響を与える可能性があります。</p></div></div>
        <p>AWS Data Exchange などの特定の AWS サービスでは、通常のオペレーションで AWS アカウント の外部のリソースへのアクセスに依存しています。ポリシーに <code class="code">aws:ResourceAccount</code> 要素を使う場合、それらのサービスの免除を指定するために追加のステートメントを含めます。ポリシー <a href="./reference_policies_examples_resource_account_data_exch.html">AWS: AWS Data Exchange を除くアカウント外の Amazon S3 リソースへのアクセスを拒否する</a> の例では、サービスが所有するリソースの例外を定義しながら、リソースアカウントに応じてアクセスを拒否する方法を示しています。</p>
        <p>独自のカスタムポリシーを作成する場合に、このポリシーの例をテンプレートとして使用します。詳細については、サービスの<a href="https://docs.aws.amazon.com/index.html">ドキュメント</a>を参照してください。</p>
     
        <h2 id="condition-keys-resourceorgid">aws:ResourceOrgID</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、ポリシーで指定した識別子とリクエストしたリソースが属する AWS の Organizations 内の組織の識別子を比較します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リソースを所有するアカウントが組織のメンバーである場合にのみ、リクエストコンテキストに含まれます。このグローバル条件キーでは以下のアクションがサポートされません。</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon Elastic Block Store - すべてのアクション</p>
                    </li><li class="listitem">
                        <p>Amazon EC2</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">ec2:AcceptTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CopySnapshot</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVolume</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcEndpoint</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcPeeringConnection</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon EventBridge — すべてのアクション</p>
                    </li><li class="listitem">
                        <p>Amazon Route 53</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">route53:AssociateVpcWithHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:CreateVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DeleteVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DisassociateVPCFromHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:ListHostedZonesByVPC</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon WorkSpaces</p>
                        <div class="itemizedlist">
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">workspaces:DescribeWorkspaceImages</code></p>
                            </li></ul></div>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>上記のサポートされていないアクションに関するその他の考慮事項については、<a href="https://github.com/aws-samples/data-perimeter-policy-examples" rel="noopener noreferrer" target="_blank"><span>data-perimeter-policy-examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> リポジトリを参照してください。</p></div></div>
        <p>このグローバルキーは、与えられたリクエストのリソース組織 ID を返します。これにより、<a href="./access_policies_identity-vs-resource.html">ID ベースポリシー</a>の <code class="code">Resource</code> 要素で指定した組織のすべてのリソースに適用されるルールが作成できます。<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_org_details.html">組織 ID</a> は、条件要素で指定できます。アカウントを追加および削除する場合、<code class="code">aws:ResourceOrgID</code> のキーを含むポリシーには正しいアカウントが自動的に組み込まれ、手動で更新する必要はありません。</p>
        <p>例えば、以下のポリシーでは、Amazon S3 リソースがリクエストを行うプリンシパルと同じ組織に属している場合を除き、プリンシパルは <code class="code">policy-genius-dev</code> リソースにオブジェクトを追加できません。</p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>このポリシーでは、アクションを許可しません。代わりに、ステートメントに記載され、リストされたアカウントに属さないすべてのリソースへのアクセスを明示的に拒否する <code class="code">Deny</code> 効果を使用します。特定のリソースへのアクセスを許可する他のポリシーと組み合わせてこのポリシーを使用します。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Sid": "DenyPutObjectToS3ResourcesOutsideMyOrganization",
    "Effect": "Deny",
    "Action": "s3:PutObject",
    "Resource": "arn:<code class="replaceable">partition</code>:s3:::policy-genius-dev/*",
    "Condition": <span>{</span>
      "StringNotEquals": <span>{</span>
        "aws:ResourceOrgID": "$<span>{</span>aws:PrincipalOrgID}"
      }
    }
  }
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>一部の AWS のサービス では他の AWS アカウント でホストされている AWS 所有リソースへのアクセスを必要とします。ID ベースのポリシーで <code class="code">aws:ResourceOrgID</code> を使用する場合は、これらのリソースにアクセスする ID の機能に影響を与える可能性があります。</p></div></div>
        
        <p>AWS Data Exchange などの特定の AWS サービスでは、通常のオペレーションで AWS アカウント の外部のリソースへのアクセスに依存しています。ポリシーに <code class="code">aws:ResourceOrgID</code> キーを使う場合、それらのサービスの免除を指定するために追加のステートメントを含めます。ポリシー <a href="./reference_policies_examples_resource_account_data_exch.html">AWS: AWS Data Exchange を除くアカウント外の Amazon S3 リソースへのアクセスを拒否する</a> の例では、サービスが所有するリソースの例外を定義しながら、リソースアカウントに応じてアクセスを拒否する方法を示しています。類似ポリシーを作成して、サービス所有のリソースを考慮しながら、<code class="code">aws:ResourceOrgID</code> キーを使用して組織内のリソースへのアクセスを制限できます。</p>
        <p>独自のカスタムポリシーを作成する場合に、このポリシーの例をテンプレートとして使用します。詳細については、サービスの<a href="https://docs.aws.amazon.com/index.html">ドキュメント</a>を参照してください。</p>
        
        <p>次のビデオでは、ポリシーで <code class="code">aws:ResourceOrgID</code> 条件キーを使用する方法について詳しく説明します。</p>
        <div class="mediaobject">
             
                <iframe width="720" height="330" frameborder="0" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" sandbox="allow-scripts allow-same-origin allow-popups" src="https://www.youtube-nocookie.com/embed/cWVW0xAiWwc"></iframe>
             
             
        </div>
        
        
        
     
        <h2 id="condition-keys-resourceorgpaths">aws:ResourceOrgPaths</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用してアクセス済みリソースの AWS Organizations パスをポリシー内のパスと比較します。ポリシーでは、この条件キーによって、このリソースが AWS Organizations の指定した組織ルートまたは組織単位 (OU) 内のアカウントメンバーに属していることを保証します。AWS Organizations パスは、Organizations エンティティの構造をテキストで表記したものです。パスの使用と理解の詳細については、「<a href="./access_policies_access-advisor-view-data-orgs.html#access_policies_access-advisor-viewing-orgs-entity-path">AWS Organizations エンティティパスを理解する</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リソースを所有するアカウントが組織のメンバーである場合にのみ、リクエストコンテキストに含まれます。このグローバル条件キーでは以下のアクションがサポートされません。</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon Elastic Block Store - すべてのアクション</p>
                    </li><li class="listitem">
                        <p>Amazon EC2</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">ec2:AcceptTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CopySnapshot</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVolume</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcEndpoint</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcPeeringConnection</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon EventBridge — すべてのアクション</p>
                    </li><li class="listitem">
                        <p>Amazon Route 53</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">route53:AssociateVpcWithHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:CreateVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DeleteVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DisassociateVPCFromHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:ListHostedZonesByVPC</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon WorkSpaces</p>
                        <div class="itemizedlist">
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">workspaces:DescribeWorkspaceImages</code></p>
                            </li></ul></div>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 複数値</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>上記のサポートされていないアクションに関するその他の考慮事項については、<a href="https://github.com/aws-samples/data-perimeter-policy-examples" rel="noopener noreferrer" target="_blank"><span>data-perimeter-policy-examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> リポジトリを参照してください。</p></div></div>
        <p><code class="code">aws:ResourceOrgPaths</code> は複数の値を持つ条件キーです。複数値のキーは、リクエストコンテキストに複数の値を持つことができます。このキーを使用する場合は、<a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列条件演算子</a>とともに <code class="code">ForAnyValue</code> または <code class="code">ForAllValues</code> の集合演算子を使用する必要があります。複数値を持つ条件キーの詳細については、「<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">複数のキーバリューの使用</a>」を参照してください。</p>
        <p>例えば次の条件では、その組織 <code class="code">o-a1b2c3d4e5</code> に属するリソースに <code class="code">True</code> を返します。ワイルドカードを含める場合は、条件演算子 <a href="./reference_policies_elements_condition_operators.html">StringLike</a> を使用する必要があります。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition": <span>{</span> 
      "ForAnyValue:StringLike": <span>{</span>
             "aws:ResourceOrgPaths":["o-a1b2c3d4e5/*"]
   }
}</code></pre>
        <p>次の条件では、OU ID <code class="code">ou-ab12-11111111</code> を持つリソースには <code class="code">True</code> が返されます。OU ou-ab12-11111111、または子 OU のいずれかにアタッチするアカウントが所有するリソースと一致することになります。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition": <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:ResourceOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/*"]
}}</code></pre>
        <p>次の条件が OU ID <code class="code">ou-ab12-22222222</code> に直接アタッチしたアカウントが所有するリソースに <code class="code">True</code> が返されますが、子 OU には返されません。次の例では <a href="./reference_policies_elements_condition_operators.html">StringEquals</a> 条件演算子を使用して、ワイルドカード一致ではなく OU ID の完全一致要件を指定します。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition": <span>{</span> "ForAnyValue:StringEquals" : <span>{</span>
     "aws:ResourceOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/"]
}}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p>一部の AWS のサービス では他の AWS アカウント でホストされている AWS 所有リソースへのアクセスを必要とします。ID ベースのポリシーで <code class="code">aws:ResourceOrgPaths</code> を使用する場合は、これらのリソースにアクセスする ID の機能に影響を与える可能性があります。</p></div></div>
        
        <p>AWS Data Exchange などの特定の AWS サービスでは、通常のオペレーションで AWS アカウント の外部のリソースへのアクセスに依存しています。ポリシーに <code class="code">aws:ResourceOrgPaths</code> キーを使う場合、それらのサービスの免除を指定するために追加のステートメントを含めます。ポリシー <a href="./reference_policies_examples_resource_account_data_exch.html">AWS: AWS Data Exchange を除くアカウント外の Amazon S3 リソースへのアクセスを拒否する</a> の例では、サービスが所有するリソースの例外を定義しながら、リソースアカウントに応じてアクセスを拒否する方法を示しています。類似ポリシーを作成して、サービス所有のリソースを考慮しながら、<code class="code">aws:ResourceOrgPaths</code> キーを使用して組織単位 (OU) 内のリソースへのアクセスを制限できます。</p>
        <p>独自のカスタムポリシーを作成する場合に、このポリシーの例をテンプレートとして使用します。詳細については、サービスの<a href="https://docs.aws.amazon.com/index.html">ドキュメント</a>を参照してください。</p>
     
        <h2 id="condition-keys-resourcetag">aws:ResourceTag/<em>tag-key</em></h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、ポリシーで指定したタグキーバリューのペアと、リソースにアタッチされているキーバリューのペアを比較します。たとえば、リソースに値 <code class="code">"Marketing"</code> の付いたタグキー <code class="code">"Dept"</code> がアタッチされている場合にのみ、そのリソースへのアクセスを許可するように要求することができます。詳細については、「<a href="./access_tags.html#access_tags_control-resources">AWS のリソースへのアクセスの制御</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リクエストコンテキスト (リクエストされたリソースにすでにアタッチしたタグがある場合) またはアタッチしたタグを持つリソースを作成するリクエストに含まれます。このキーは、<a href="./reference_aws-services-that-work-with-iam.html">タグに基づいて認証をサポートする</a>リソースに対してのみ返されます。タグキーバリューのペアごとに 1 つのコンテキストキーがあります。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>このコンテキストキーは <code class="code">"aws:ResourceTag/<code class="replaceable">tag-key</code>":"<code class="replaceable">tag-value</code>"</code> という形式です。ここで <code class="replaceable">tag-key</code> および <code class="replaceable">tag-value</code> はタグキーバリューのペアです。タグのキーと値は大文字と小文字が区別されません。つまり、ポリシーの条件要素で <code class="code">"aws:ResourceTag/TagKey1": "Value1"</code> で指定した場合、その条件は <code class="code">TagKey1</code> または <code class="code">tagkey1</code> という名前のリソースタグキーに一致しますが、その両方には一致しません。</p>
        <p><code class="code">aws:ResourceTag</code> キーを使用して IAM リソースへのアクセスを制御する例については、「<a href="./access_tags.html#access_tags_control-resources">AWS のリソースへのアクセスの制御</a>」を参照してください。</p>
        <p><code class="code">aws:ResourceTag</code> キーを使用して他の AWS リソースへのアクセスを制御する例については、「<a href="./access_tags.html">タグを使用した AWS リソースへのアクセスの制御</a>」をご参照ください。</p>
        <p>属性ベースのアクセス制御 (ABAC) の <code class="code">aws:ResourceTag</code> 条件キーの使用に関するチュートリアルについては、「<a href="./tutorial_attribute-based-access-control.html">IAM チュートリアル: タグに基づいて AWS リソースにアクセスするためのアクセス許可を定義する</a>」をご参照ください。</p>
     
        <h2 id="condition-keys-securetransport">aws:SecureTransport</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">ブール演算子</a>で動作します。</p>
        <p>このキーを使用してリクエストが SSL を使用して送信されたかどうかを確認します。リクエストコンテキストは <code class="code">true</code> または <code class="code">false</code> を返します。ポリシーでは、リクエストが SSL を使用して送信された場合にのみ、特定のアクションを許可できます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常にリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-sourceaccount">aws:SourceAccount</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、サービス間リクエストを行っているリソースのアカウント IDを、ポリシーで指定したアカウント ID と比較します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リソース所有者に代わって別のサービスを呼び出すようリソースへのアクセスで AWS サービスをトリガーした場合にのみ、リクエストコンテキストに含まれます。呼び出し元のサービスは、ソースのリソースアカウアカウント ID を呼び出し先のサービスに渡す必要があります。この アカウント ID には、ソースアカウント ID が含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>この条件キーを使用して、サービス間のトランザクション中に AWS サービスが<a href="./confused-deputy.html">混乱した代理</a>として使用されるのを防ぐことができます。この条件キーの値を、リクエスト内のリソースのアカウントに設定します。たとえば、Amazon S3 バケットの更新によって Amazon SNS トピック投稿がトリガーされると、Amazon S3 サービスは <code class="code">sns:Publish</code> API オペレーションを呼び出します。<code class="code">sns:Publish</code> 操作を許可するポリシーで、条件キーの値を Amazon S3 バケットのアカウント ID に設定します。これらの条件キーが推奨される方法とタイミングについては、「使用している AWS サービスのドキュメント」を参照してください。</p>
     
        <h2 id="condition-keys-sourcearn">aws:SourceArn</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_ARN">ARN 演算子</a>と<a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>と連携します。AWS では、ARN を比較する場合には、文字列演算子の代わりに ARN 演算子を使用することをお勧めします。</p>
        <p>このキーを使用して、サービス間リクエストを行っているリソースの <a href="./reference_identifiers.html#identifiers-arns">Amazon リソースネーム (ARN)</a> を、ポリシーで指定した ARN と比較します。</p>
        <p>このキーは、リクエストを行うプリンシパルの ARN では機能しません。代わりに <a href="#condition-keys-principalarn">aws:PrincipalArn</a> を使用してください。ソースの ARN にはアカウント ID が含まれているため、<code class="code">aws:SourceArn</code> で <code class="code">aws:SourceAccount</code> を使用する必要はありません 。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リソース所有者に代わって別のサービスを呼び出すようリソースへのアクセスで AWS サービスをトリガーした場合にのみ、リクエストコンテキストに含まれます。呼び出し元のサービスは、元のリソースの ARN を呼び出し先のサービスに渡す必要があります。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>この条件キーを使用して、サービス間のトランザクション中に AWS サービスが<a href="./confused-deputy.html">混乱した代理</a>として使用されるのを防ぐことができます。この条件キーの値を、リクエスト内のリソースの ARN に設定します。たとえば、Amazon S3 バケットの更新によって Amazon SNS トピック投稿がトリガーされると、Amazon S3 サービスは <code class="code">sns:Publish</code> API オペレーションを呼び出します。<code class="code">sns:Publish</code> オペレーションを許可するポリシーで、条件キーの値を Amazon S3 バケットの ARN に設定します。これらの条件キーが推奨される方法とタイミングについては、「使用している AWS サービスのドキュメント」を参照してください。</p>
     
        <h2 id="condition-keys-sourceidentity">aws:SourceIdentity</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>プリンシパルによって設定されたソース ID と、ポリシーで指定したソース ID を比較するには、このキーを使用します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — このキーは、AWS STS assume-role CLI コマンドまたは AWS STS <code class="code">AssumeRole</code> API オペレーションを使用してロールが引き継がれるときに、ソース ID が設定された後、リクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>ポリシーでこのキーを使用して、ロールを引き受けるときにソースIDを設定したプリンシパルによる AWS でのアクションを許可できます。ロールの指定されたソースIDのアクティビティが <a href="./cloudtrail-integration.html#cloudtrail-integration_signin-tempcreds">AWS CloudTrail</a> に表示されます。これにより、管理者は AWS のロールで誰または何がアクションを実行したかを簡単に判断できます。</p>
        <p><a href="./reference_policies_iam-condition-keys.html#ck_rolesessionname">sts:RoleSessionName</a> とは異なり、ソースIDを設定した後は、値を変更できません。これは、ロールが実行するすべてのアクションのリクエストコンテキストに存在します。この値は、セッション認証情報を使用して別のロールを引き受けるときに、後続のロールセッションに保持されます。別のロールからあるロールを引き受けると、<a href="./id_roles_terms-and-concepts.html#iam-term-role-chaining">ロールの連鎖</a>と呼ばれます。</p>
        <p><a href="./reference_policies_iam-condition-keys.html#ck_sourceidentity">sts:SourceIdentity</a> キーは、プリンシパルが、AWS STS assume-role CLI コマンドまたは AWS STS <code class="code">AssumeRole</code> API オペレーションを使用してロールを引き受けるときに、最初にソース ID を設定するときに、リクエストに存在します。<code class="code">aws:SourceIdentity</code> キーは、ソースIDが設定されているロールセッションで実行されるすべてのアクションの要求に存在します。</p>
        <p>アカウント <code class="code">CriticalRole</code> の <code class="code">111122223333</code> の次のロール信頼ポリシーには、Saanvi または Diego に設定されているソース ID を持たないプリンシパルがロールを引き受けることを防ぐ <code class="code">aws:SourceIdentity</code> のための条件が含まれています。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AssumeRoleIfSourceIdentity",
            "Effect": "Allow",
            "Principal": <span>{</span>"AWS": "arn:aws:iam::123456789012:role/CriticalRole"},
            "Action": [
                "sts:AssumeRole",
                "sts:SetSourceIdentity"
            ],
            "Condition": <span>{</span>
                "StringLike": <span>{</span>
                    "aws:SourceIdentity": ["Saanvi","Diego"]
                }
            }
        }
    ]
}
</code></pre>
        <p>ソース ID 情報の使用の詳細については、「<a href="./id_credentials_temp_control-access_monitor.html">引き受けたロールで実行されるアクションのモニタリングと制御</a>」を参照してください。</p>
     
        <h2 id="condition-keys-sourceip">aws:SourceIp</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_IPAddress">IP アドレス演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスタの IP アドレスをポリシーで指定した IP アドレスと比較します。<code class="code">aws:SourceIp</code> 条件キーは、パブリック IP アドレス範囲にのみ使用できます。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リクエスタが VPC エンドポイントを使用してリクエストを行う場合を除き、リクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p><code class="code">aws:SourceIp</code> 条件キーをポリシーで使用して、プリンシパルが指定された IP 範囲内からのみリクエストを行うことを許可できます。ただし、AWS サービスがプリンシパルの代わりに呼び出しを行う場合、このポリシーはアクセスを拒否します。この場合、<code class="code"><a href="#condition-keys-viaawsservice">aws:ViaAWSService</a></code> キーと共に <code class="code">aws:SourceIp</code> を使用して、プリンシパルによって直接行われたリクエストにのみソース IP 制限が適用されるようにできます。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注記</h6></div><div class="awsdocs-note-text"><p> <code class="code">aws:SourceIp</code> は IPv4 と IPv6 の両方の IP アドレスおよびレンジをサポートしています。詳細については、「<a href="https://docs.aws.amazon.com/marketplace/latest/buyerguide/buyer-security-ipv6-upgrade.html">IAM ポリシーを IPv6 にアップグレード</a>」を参照してください。</p></div></div>
        <p>たとえば、IAM ユーザーに次のポリシーをアタッチできます。このポリシーでは、指定された IP アドレスから呼び出しを行う場合に、ユーザーがオブジェクトを直接 <code class="code"><code class="replaceable">DOC-EXAMPLE-BUCKET3</code></code> Amazon S3 バケットに入れることができます。ただし、ユーザーがサービスで Amazon S3 を呼び出す別のリクエストを実行する場合、IP アドレスの制限は適用されません。<code class="code">PrincipalPutObjectIfIpAddress</code> ステートメントは、リクエストがサービスによって実行されない場合にのみ、IP アドレスを制限します。<code class="code">ServicePutObject</code> ステートメントは、リクエストがサービスによって実行された場合、IP アドレスの制限なしでオペレーションを許可します。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="コピー"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "PrincipalPutObjectIfIpAddress",
            "Effect": "Allow",
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET3</code>/*",
            "Condition": <span>{</span>
                "Bool": <span>{</span>"aws:ViaAWSService": "false"},
                "IpAddress": <span>{</span>"aws:SourceIp": "<code class="replaceable">203.0.113.0</code>"}
            }
        },
        <span>{</span>
            "Sid": "ServicePutObject",
            "Effect": "Allow",
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET</code>/*",
            "Condition": <span>{</span>
                "Bool": <span>{</span>"aws:ViaAWSService": "true"}
            }
        }
    ]
}</code></pre>
        <p>リクエスト実行元が VPC エンドポイントを使用するホストである場合、<code class="code">aws:SourceIp</code> キーは使用できません。代わりに、aws:VpcSourceIpなどの VPC 固有のキーを使用する必要があります。VPC エンドポイント使用の詳細については、「AWS PrivateLink ガイド」の「<a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-iam.html">VPC エンドポイントおよび VPC エンドポイントサービスの ID およびアクセス管理</a>」を参照してください。</p>
     
        <h2 id="condition-keys-sourcevpc">aws:SourceVpc</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストがポリシーで指定した VPC からのものであるかどうかを確認します。ポリシーでは、このキーを使用して、特定の VPC にのみアクセスを許可できます。詳細については、<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies-vpc-endpoint.html#example-bucket-policies-restrict-access-vpc">Amazon Simple Storage Service ユーザーガイド</a>の「<em>特定の VPC へのアクセスの制限</em>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リクエスタが VPC エンドポイントを使用してリクエストを行う場合にのみリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-sourcevpce">aws:SourceVpce</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストの VPC エンドポイント識別子をポリシーで指定したエンドポイント ID と比較します。ポリシーでは、このキーを使用して、特定の VPC エンドポイントへのアクセスを制限できます。詳細については、<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies-vpc-endpoint.html#example-bucket-policies-restrict-access-vpc-endpoint">Amazon Simple Storage Service ユーザーガイド</a>の「<em>特定の VPC エンドポイントへのアクセスの制限</em>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リクエスタが VPC エンドポイントを使用してリクエストを行う場合にのみリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-tagkeys">aws:TagKeys</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスト内のタグキーとポリシーで指定したキーを比較します。ポリシーでタグを使用してアクセスを制御する場合は、<code class="code">aws:TagKeys</code> 条件キーを使用して、許可されるタグキーを定義することをお勧めします。ポリシー例と詳細については、「<a href="./access_tags.html#access_tags_control-tag-keys">タグキーに基づいたアクセスの制御</a>」を参照してください</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、オペレーションがリクエストのタグを渡すサポートしている場合にのみ、リクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 複数値</p>
            </li></ul></div>
        <p>このコンテキストキーは <code class="code">"aws:TagKeys":"<code class="replaceable">tag-key</code>"</code> という形式であり、ここで <code class="replaceable">tag-key</code> は値 (<code class="code">["Dept","Cost-Center"]</code> など) のないタグキーのリストです。</p>
        <p>1 つのリクエストに複数のタグとキーバリューのペアを含めることができるため、リクエストのコンテンツは<a href="./reference_policies_multi-value-conditions.html">複数の値を</a>持つリクエストである場合があります。この場合、<code class="code">ForAllValues</code> または <code class="code">ForAnyValue</code> 集合演算子を使用する必要があります。詳細については、「<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">複数のキーバリューの使用</a>」を参照してください。</p>
        <p>一部のサービスでは、リソースの作成、変更、削除などのリソースオペレーションを使用したタグ付けをサポートしています。1 回の呼び出しでタグ付けとオペレーションを許可するには、タグ付けアクションとリソース変更アクションの両方を含むポリシーを作成する必要があります。次に、<code class="code">aws:TagKeys</code> 条件キーを使用して、リクエストで特定のタグキーを使用して適用できます。たとえば、だれかが Amazon EC2 スナップショットを作成するときにタグを制限するには、ポリシーに <em><b><code class="code">ec2:CreateSnapshot</code> の作成アクション</b></em>および <code class="code">ec2:CreateTags</code> のタグ付けアクションを含める必要があります。を使用するこのシナリオのポリシーを表示するには、<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html#iam-creating-snapshot-with-tags">Linux インスタンス用 Amazon EC2 ユーザーガイド</a>の<code class="code">aws:TagKeys</code>「<em>タグ付きのスナップショットの作成</em>」を参照してください。</p>
     
        <h2 id="condition-keys-tokenissuetime">aws:TokenIssueTime</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Date">日付演算子</a>で動作します。</p>
        <p>このキーを使用して、一時的なセキュリティ認証情報が発行された日時と、ポリシーで指定した日時を比較します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、プリンシパルが一時的な認証情報を使用してリクエストを行う場合にのみ、リクエストコンテキストに含まれます。このキーは、アクセスキーを使用して行われたAWS CLI、AWS API、または AWS SDK リクエストには存在しません。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>一時的認証情報の使用がサポートされているサービスについては、「<a href="./reference_aws-services-that-work-with-iam.html">IAM と連携する AWS のサービス</a>」を参照してください。</p>
     
        <h2 id="condition-keys-useragent">aws:UserAgent</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスタのクライアントアプリケーションとポリシーで指定したアプリケーションを比較します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常にリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>警告</h6></div><div class="awsdocs-note-text"><p>このキーは慎重に使用する必要があります。しかし、<code class="code">aws:UserAgent</code> 値は HTTP ヘッダー内の発信者によって渡されるため、不正な当事者が改造またはカスタムブラウザを使用して任意の <code class="code">aws:UserAgent</code> 値を渡すことができます。そのため <code class="code">aws:UserAgent</code> は、不正な当事者から AWS にリクエストが直接行われることを防止するために使用しないでください。このステートメントを使用して、ポリシーをテストした後にのみ、特定のクライアントアプリケーションのみを許可できます。</p></div></div>
     
        <h2 id="condition-keys-userid">aws:userid</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスタのプリンシパル ID とポリシーで指定した識別子を比較します。IAM ユーザーの場合、リクエストコンテキスト値はユーザー ID です。IAM ロールの場合、この値の形式はさまざまです。さまざまなプリンシパルで情報がどのように表示されるかについては、「<a href="./reference_policies_elements_principal.html#Principal_specifying">プリンシパルの指定</a>」を参照してください。<code class="code">principal</code> キーの値の具体的な例については、「<a href="./reference_policies_variables.html#principaltable">プリンシパルキーの値</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、匿名リクエストなどのすべてのリクエストのリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-username">aws:username</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_String">文字列演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエスタのユーザー名をポリシーで指定したユーザー名と比較します。さまざまなプリンシパルで情報がどのように表示されるかについては、「<a href="./reference_policies_elements_principal.html#Principal_specifying">プリンシパルの指定</a>」を参照してください。<code class="code">principal</code> キーの値の具体的な例については、「<a href="./reference_policies_variables.html#principaltable">プリンシパルキーの値</a>」を参照してください。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常に IAM ユーザーのリクエストコンテキストに含まれます。匿名のリクエストと AWS アカウントのルートユーザー または IAM ロールを使用して行われたリクエストには、このキーは含まれません。IAM Identity Center の認証情報を使用して行われたリクエストでは、このキーはコンテキストに含まれません。IAM Identity Center でユーザーへのアクセスを制御する方法については、「<a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/using-predefined-attributes.html">AWS でのアクセス制御に IAM Identity Center の ID ストアから定義済みの属性を使用する</a>」の「<code class="code">identitystore:UserId</code>」をご参照ください。IAM Identity Center のユーザーとは、お客様の AWS アカウント またはクラウドアプリケーションにアクセスする必要がある従業員のことです。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
     
        <h2 id="condition-keys-viaawsservice">aws:ViaAWSService</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">ブール演算子</a>で動作します。</p>
        <p>このキーを使用して、AWS サービスがユーザーに代わって別のサービスにリクエストを実行するかどうか確認します。</p>
        <p>サービスが IAM プリンシパルの認証情報を使用し、プリンシパルに代わってリクエストを実行すると、リクエストコンテキストキーは <code class="code">true</code> を返します。サービスが<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">サービスロール</a>または<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">サービスリンクロール</a>を使用してプリンシパルに代わって呼び出しを行う場合、コンテキストキーは <code class="code">false</code> を返します。リクエストコンテキストキーは、プリンシパルが直接呼び出しを行ったときも <code class="code">false</code> を返します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは常にリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>この条件キーを使用して、リクエストがサービスによって行われたかどうかに基づいてアクセスを許可または拒否できます。ポリシーの例を表示するには、「<a href="./reference_policies_examples_aws_deny-ip.html">AWS: 送信元 IP に基づいて AWS へのアクセスを拒否する</a>」を参照してください。</p>
     
        <h2 id="condition-keys-vpcsourceip">aws:VpcSourceIp</h2>
        <p><a href="./reference_policies_elements_condition_operators.html#Conditions_IPAddress">IP アドレス演算子</a>で動作します。</p>
        <p>このキーを使用して、リクエストの作成元の IP アドレスと、ポリシーで指定した IP アドレスを比較します。ポリシーでは、リクエストが指定された IP アドレスから送信され、VPC エンドポイントを経由する場合にのみキーが一致します。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – このキーは、リクエストが VPC エンドポイントを使用して行われた場合にのみリクエストコンテキストに含まれます。</p>
            </li><li class="listitem">
                <p><b>値タイプ</b> — 単一値</p>
            </li></ul></div>
        <p>詳細については、<em>Amazon VPC ユーザーガイド</em> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints-access.html">VPC エンドポイントによるサービスのアクセスコントロール</a>を参照してください。</p>
     
        <h2 id="condition-keys-other">その他のクロスサービス条件キー</h2>
        <p>グローバル条件キーは、<code class="code">aws:</code> プレフィックスを持つ条件キーです。個々のサービスは独自の条件キーを作成できます。これらのサービス固有の条件キーには、<code class="code">iam:</code> または <code class="code">sts:</code> など、サービスの名前に一致するプレフィクスが含まれます。</p>
        <p>サービスは、他のサービスのリクエストコンテキストで使用可能なサービス固有のキーを作成できます。これらのキーは、複数のサービスで利用できますが、グローバル条件キーではありません。例えば、AWS STS は <a href="./reference_policies_iam-condition-keys.html#condition-keys-saml">SAML ベースのフェデレーション条件キー</a>をサポートします。これらのキーは、SAML を使用してフェデレーションされたユーザーが他のサービスで AWS オペレーションを実行するときに使用できます。その他の例には、<code class="code"><a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/using-predefined-attributes.html">identitystore:UserId</a></code> および <code class="code"><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-policy-structure.html#amazon-ec2-keys">ec2:SourceInstanceArn</a></code> が含まれます。</p>
        <p>サービスのサービス固有の条件キーを表示するには、「<a href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">AWS サービスのアクション、リソース、および条件キー</a>」を参照し、キーを表示するサービスを選択します。</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>ブラウザで JavaScript が無効になっているか、使用できません。</strong></p><p>AWS ドキュメントを使用するには、JavaScript を有効にする必要があります。手順については、使用するブラウザのヘルプページを参照してください。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">ドキュメントの表記規則</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./access_policies_job-functions_create-policies.html">ロールの作成とポリシーのアタッチ (コンソール)</div><div id="next" class="next-link" accesskey="n" href="./reference_policies_iam-condition-keys.html">IAM 条件キー</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">このページは役に立ちましたか? - はい</div><div class="content"><p>ページが役に立ったことをお知らせいただき、ありがとうございます。</p><p>お時間がある場合は、何が良かったかお知らせください。今後の参考にさせていただきます。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">このページは役に立ちましたか? - いいえ</div><div class="content"><p>このページは修正が必要なことをお知らせいただき、ありがとうございます。ご期待に沿うことができず申し訳ありません。</p><p>お時間がある場合は、ドキュメントを改善する方法についてお知らせください。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="フィードバック" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>