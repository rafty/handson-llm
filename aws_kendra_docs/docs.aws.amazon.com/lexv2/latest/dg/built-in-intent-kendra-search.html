<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AMAZON.KendraSearchIntent - Amazon Lex</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="built-in-intent-kendra-search" /><meta name="default_state" content="built-in-intent-kendra-search" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="description" content="To search documents that you have indexed with Amazon Kendra, use the AMAZON.KendraSearchIntent intent. When Amazon Lex V2 can't determine the next action in a conversation with the user, it triggers the search intent." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Lex" /><meta name="guide" content="V2 Developer Guide" /><meta name="abstract" content="Provides a conceptual overview of Amazon Lex V2. Includes detailed instructions for using various features, such as streaming conversations, and provides a complete reference for the V2 APIs." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="x-default" /><meta name="feedback-item" content="Lex" /><meta name="this_doc_product" content="Amazon Lex" /><meta name="this_doc_guide" content="V2 Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lex'}"></script><meta id="panorama-serviceSubSection" value="V2 Developer Guide" /><meta id="panorama-serviceConsolePage" value="AMAZON.KendraSearchIntent" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AMAZON.KendraSearchIntent - Amazon Lex</title><meta name="pdf" content="/pdfs/lexv2/latest/dg/lex2.0.pdf#built-in-intent-kendra-search" /><meta name="github" content="https://github.com/awsdocs/amazon-lexv2-developer-guide/tree/main/doc_source/built-in-intent-kendra-search.md" /><meta name="rss" content="amazon-lex-v2-document-history.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=251" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=http://docs.aws.amazon.com/en_us/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lexv2/latest/dg/built-in-intent-kendra-search.html" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Lex",
        "item" : "https://docs.aws.amazon.com/lex/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "V2 Developer Guide",
        "item" : "https://docs.aws.amazon.com/lexv2/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Building bots",
        "item" : "https://docs.aws.amazon.com/lexv2/latest/dg/building-bots.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Adding intents",
        "item" : "https://docs.aws.amazon.com/lexv2/latest/dg/add-intents.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Built-in intents",
        "item" : "https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intents.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "AMAZON.KendraSearchIntent",
        "item" : "https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intents.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/lexv2/latest/dg/lex2.0.pdf#built-in-intent-kendra-search" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/amazon-lexv2-developer-guide/tree/main/doc_source/built-in-intent-kendra-search.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/lex/index.html">Amazon Lex</a><a href="what-is.html">V2 Developer Guide</a></div><div id="page-toc-src"><a href="#kendra-search-iam">IAM Policy</a><a href="#kendra-search-filter">Using Request and
                    Session Attributes as Filters</a><a href="#kendra-search-response">Using the Search
                    Response</a><a href="#kendra-search-lambda">Using a Lambda
                    Function to Manage the Request and Response</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="built-in-intent-kendra-search">AMAZON.KendraSearchIntent</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>To search documents that you have indexed with Amazon Kendra, use the
                <code class="code">AMAZON.KendraSearchIntent</code> intent. When Amazon Lex V2
            can't determine the next action in a conversation with the user,
            it triggers the search intent.</p><p>The <code class="code">AMAZON.KendraSearchIntent</code> is available only
            in the English (US) (en-US) locale and in the
            US East (N. Virginia), US West (Oregon) and Europe (Ireland)
            Regions.</p><p>Amazon Kendra is a machine-learning-based search service that indexes
            natural language documents such as PDF documents or Microsoft
            Word files. It can search indexed documents and return the
            following types of responses to a question:</p><div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>An answer </p>
            </li><li class="listitem">
                <p>An entry from a FAQ that might answer the
                    question</p>
            </li><li class="listitem">
                <p>A document that is related to the question</p>
            </li></ul></div><p>For an example of using the
                <code class="code">AMAZON.KendraSearchIntent</code>, see <a href="./faq-bot-kendra-search.html">Example: Creating a
                    FAQ Bot for an Amazon Kendra Index</a>.</p><p>If you configure an <code class="code">AMAZON.KendraSearchIntent</code>
            intent for your bot, Amazon Lex V2 calls the intent whenever it can't
            determine the user utterance for an intent. If there is no response 
            from Amazon Kendra, the conversation continues as configured in the bot.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                Amazon Lex V2 currently does not support the <code class="code">AMAZON.KendraSearchIntent</code> 
                during slot elicitation. If Amazon Lex V2 can't determine the user utterance 
                for a slot, it calls the <code class="code">AMAZON.FallbackIntent</code>.
            </p></div></div><p>When you use the <code class="code">AMAZON.KendraSearchIntent</code> with
            the <code class="code">AMAZON.FallbackIntent</code> in the same bot, Amazon Lex V2
            uses the intents as follows:</p><div class="orderedlist">
             
             
             
             
        <ol><li>
                <p>Amazon Lex V2 calls the
                        <code class="code">AMAZON.KendraSearchIntent</code>. The intent
                    calls the Amazon Kendra <code class="code">Query</code> operation.</p>
            </li><li>
                <p>If Amazon Kendra returns a response, Amazon Lex V2 displays the
                    result to the user.</p>
            </li><li>
                <p>If there is no response from Amazon Kendra, Amazon Lex V2 re-prompts
                    the user. The next action depends on response from the
                    user.</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>If the response from the user contains an
                            utterance that Amazon Lex V2 recognizes, such as
                            filling a slot value or confirming an intent,
                            the conversation with the user proceeds as
                            configured for the bot.</p>
                    </li><li class="listitem">
                        <p>If the response from the user does not contain
                            an utterance that Amazon Lex V2 recognizes, Amazon Lex V2
                            makes another call to the <code class="code">Query</code>
                            operation.</p>
                    </li></ul></div>
            </li><li>
                <p>If there is no response after the configured number of
                    retries, Amazon Lex V2 calls the
                        <code class="code">AMAZON.FallbackIntent</code> and ends the
                    conversation with the user.</p>
            </li></ol></div><p>There are three ways to use the
                <code class="code">AMAZON.KendraSearchIntent</code> to make a request to
            Amazon Kendra:</p><div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Let the search intent make the request for you. Amazon Lex V2
                    calls Amazon Kendra with the user's utterance as the search
                    string. When you create the intent, you can define a
                    query filter string that limits the number of responses
                    that Amazon Kendra returns. Amazon Lex V2 uses the filter in the query
                    request.</p>
            </li><li class="listitem">
                <p>Add additional query parameters to the request to
                    narrow the search results using your Lambda function. You
                    add a <code class="code">kendraQueryFilterString</code> field that
                    contains Amazon Kendra query parameters to the
                        <code class="code">delegate</code> dialog action. When you add
                    query parameters to the request with the Lambda function,
                    they take precedence over the query filter that you
                    defined when you created the intent.</p>
            </li><li class="listitem">
                <p>Create a new query using the Lambda function. You can
                    create a complete Amazon Kendra query request that Amazon Lex V2 sends.
                    You specify the query in the
                        <code class="code">kendraQueryRequestPayload</code> field in the
                        <code class="code">delegate</code> dialog action. The
                        <code class="code">kendraQueryRequestPayload</code> field takes
                    precedence over the <code class="code">kendraQueryFilterString</code>
                    field.</p>
            </li></ul></div><p>To specify the <code class="code">queryFilterString</code> parameter when
            you create a bot, or to specify the
                <code class="code">kendraQueryFilterString</code> field when you call the
                <code class="code">delegate</code> action in a dialog Lambda function, you
            specify a string that is used as the attribute filter for the
            Amazon Kendra query. If the string isn't a valid attribute filter,
            you'll get an <code class="code">InvalidBotConfigException</code> exception
            at runtime. For more information about attribute filters, see
                <a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">Using
                document attributes to filter queries</a> in the
                <em>Amazon Kendra Developer Guide</em>.</p><p>To have control over the query that Amazon Lex V2 sends to Amazon Kendra, you
            can specify a query in the
                <code class="code">kendraQueryRequestPayload</code>field in your Lambda
            function. If the query isn't valid, Amazon Lex V2 returns an
                <code class="code">InvalidLambdaResponseException</code> exception. For
            more information, see the <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html">Query
                operation</a> in the <em>Amazon Kendra Developer
                Guide</em>.</p><p>For an example of how to use the
                <code class="code">AMAZON.KendraSearchIntent</code>, see <a href="./faq-bot-kendra-search.html">Example: Creating a
                    FAQ Bot for an Amazon Kendra Index</a>.</p>
            <h2 id="kendra-search-iam">IAM Policy for Amazon Kendra
                    Search</h2>
            <p>To use the <code class="code">AMAZON.KendraSearchIntent</code> intent,
                you must use a role that provides AWS Identity and Access Management (IAM) policies
                that enable Amazon Lex V2 to assume a runtime role that has
                permission to call the Amazon Kendra <code class="code">Query</code> intent. The
                IAM settings that you use depend on whether you create the
                    <code class="code">AMAZON.KendraSearchIntent</code> using the Amazon Lex V2
                console, or using an AWS SDK or the AWS Command Line Interface (AWS CLI). When
                you use the console, you can choose between adding
                permission to call Amazon Kendra to the Amazon Lex V2 service-linked role
                or using a role specifically for calling the Amazon Kendra
                    <code class="code">Query</code> operation. When you use the AWS CLI or
                an SDK to create the intent, you must use a role
                specifically for calling the <code class="code">Query</code>
                operation.</p>
             
                <h3 id="kendra-iam-attach">Attaching
                        Permissions </h3>
                <p>You can use the console to attach permissions to
                    access the Amazon Kendra <code class="code">Query</code> operation to the
                    default Amazon Lex V2 service-linked role. When you attach
                    permissions to the service-linked role, you don't have
                    to create and manage a runtime role specifically to
                    connect to the Amazon Kendra index.</p>
                <p>The user, role, or group that you use to access the
                    Amazon Lex V2 console must have permissions to manage role
                    policies. Attach the following IAM policy to the
                    console access role. When you grant these permissions,
                    the role has permissions to change the existing
                    service-linked role policy. </p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
"Version": "2012-10-17",
"Statement": [
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "iam:AttachRolePolicy",
            "iam:PutRolePolicy",
            "iam:GetRolePolicy"
        ],
        "Resource": "arn:aws:iam::*:role/aws-service-role/lexv2.amazonaws.com/AWSServiceRoleForLexBots*"
    },
    <span>{</span>
        "Effect": "Allow",
        "Action": "iam:ListRoles",
        "Resource": "*"
    }
]
}</code></pre>
             
             
                <h3 id="kendra-iam-role">Specifying a Role
                    </h3>
                <p>You can use the console, the AWS CLI, or the API to
                    specify a runtime role to use when calling the Amazon Kendra
                        <code class="code">Query</code> operation. </p>
                <p>The user, role, or group that you use to specify
                    the runtime role must have the <code class="code">iam:PassRole</code>
                    permission. The following policy defines the permission.
                    You can use the <code class="code">iam:AssociatedResourceArn</code>
                    and <code class="code">iam:PassedToService</code> condition context
                    keys to further limit the scope of the permissions. For
                    more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_iam-condition-keys.html"> IAM and AWS STS Condition Context Keys</a> in
                    the <em>AWS Identity and Access Management User Guide</em>.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
"Version": "2012-10-17",
"Statement": [
    <span>{</span>
        "Effect": "Allow",
        "Action": "iam:PassRole",
        "Resource": "arn:aws:iam::<code class="replaceable">account</code>:role/<code class="replaceable">role</code>"
    }
]
}</code></pre>
                <p>The runtime role that Amazon Lex V2 needs to use to call
                    Amazon Kendra must have the <code class="code">kendra:Query</code>
                    permissions. When you use an existing IAM role for
                    permission to call the Amazon Kendra <code class="code">Query</code>
                    operation, the role must have the following policy
                    attached.</p>
                <p>You can use the IAM console, the IAM API, or the
                    AWS CLI to create a policy and attach it to a role. These
                    instructions use the AWS CLI to create the role and
                    policies.</p>
                <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The following code is formatted for Linux and
                        MacOS. For Windows, replace the Linux line
                        continuation character (\) with a caret (^).</p></div></div>
                <div class="procedure"><h6>To add Query operation permission to a
                        role</h6><ol><li>
                        <p>Create a document called
                                <code class="userinput">KendraQueryPolicy.json</code>
                            in the current directory, add the following code
                            to it, and save it</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
"Version": "2012-10-17",
"Statement": [
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "kendra:Query"
        ],
        "Resource": [
            "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account</code>:index/<code class="replaceable">index ID</code>"
        ]
    }
]
}</code></pre>
                    </li><li>
                        <p>In the AWS CLI, run the following command to
                            create the IAM policy for running the Amazon Kendra
                                <code class="code">Query</code> operation.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iam create-policy \
--policy-name <code class="replaceable">query-policy-name</code> \
--policy-document file://KendraQueryPolicy.json</code></pre>
                    </li><li>
                        <p>Attach the policy to the IAM role that you
                            are using to call the <code class="code">Query</code>
                            operation.</p>
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iam attach-role-policy \
--policy-arn arn:aws:iam::<code class="replaceable">account-id</code>:policy/<code class="replaceable">query-policy-name</code>
--role-name <code class="replaceable">role-name</code></code></pre>
                    </li></ol></div>
                <p>You can choose to update the Amazon Lex V2 service-linked
                    role or to use a role that you created when you create
                    the <code class="code">AMAZON.KendraSearchIntent</code> for your bot.
                    The following procedure shows how to choose the IAM
                    role to use.</p>
                <div class="procedure"><h6>To specify the runtime role for
                        AMAZON.KendraSearchIntent</h6><ol><li>
                        <p>Sign in to the AWS Management Console and open the Amazon Lex console at
    <a href="https://console.aws.amazon.com/lex/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/lex/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
                    </li><li>
                        <p>Choose the bot that you want to add the
                                <code class="code">AMAZON.KendraSearchIntent</code>
                            to.</p>
                    </li><li>
                        <p>Choose the plus (+) next to
                                <b>Intents</b>.</p>
                    </li><li>
                        <p>In <b>Add intent</b>, choose
                                <b>Search existing
                            intents</b>.</p>
                    </li><li>
                        <p>In <b>Search intents</b>, enter
                                <code class="userinput">AMAZON.KendraSearchIntent</code>
                            and then choose <b>Add</b>.</p>
                    </li><li>
                        <p>In <b>Copy built-in intent</b>,
                            enter a name for the intent, such as
                                <code class="userinput">KendraSearchIntent</code>,
                            and then choose <b>Add</b>.</p>
                    </li><li>
                        <p>Open the <b>Amazon Kendra
                                query</b> section.</p>
                    </li><li>
                        <p>For <b>IAM role</b> choose one
                            of the following options:</p>
                        <div class="itemizedlist">
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p>To update the Amazon Lex V2 service-linked
                                    role to enable your bot to query Amazon Kendra
                                    indexes, choose <b>Add Amazon Kendra
                                    permissions</b>.</p>
                            </li><li class="listitem">
                                <p>To use a role that has permission to
                                    call the Amazon Kendra <code class="code">Query</code>
                                    operation, choose <b>Use an
                                    existing role</b>.</p>
                            </li></ul></div>
                    </li></ol></div>
             
         
            <h2 id="kendra-search-filter">Using Request and
                    Session Attributes as Filters</h2>
            <p>To filter the response from Amazon Kendra to items related to
                current conversation, use session and request attributes as
                filters by adding the <code class="code">queryFilterString</code>
                parameter when you create your bot. You specify a
                placeholder for the attribute when you create the intent,
                and then Amazon Lex V2 substitutes a value before it calls Amazon Kendra.
                For more information about request attributes, see <a href="./context-mgmt-request-attribs.html">Setting request
                attributes</a>. For more
                information about session attributes, see <a href="./context-mgmt-session-attribs.html">Setting session
                attributes</a>.</p>
            <p>The following is a example of a
                    <code class="code">queryFilterString</code> parameter that uses a
                string to filter the Amazon Kendra query.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "City", "value": <span>{</span>"stringValue": "Seattle"}}}"</code></pre>
            <p>The following is an example of a
                    <code class="code">queryFilterString</code> parameter that uses a
                session attribute called <code class="code">"SourceURI"</code> to filter
                the Amazon Kendra query.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "SourceURI","value": <span>{</span>"stringValue": "[FileURL]"}}}"</code></pre>
            <p>The following is an example of a
                    <code class="code">queryFilterString</code> parameter that uses a
                request attribute called <code class="code">"DepartmentName"</code> to
                filter the Amazon Kendra query.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "Department","value": <span>{</span>"stringValue": "((DepartmentName))"}}}"</code></pre>
            <p>The <code class="code">AMAZON.KendraSearchInteng</code> filters use the
                same format as the Amazon Kendra search filters. For more
                information, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">Using document attributes to filter search
                    results</a> in the <em>Amazon Kendra developer
                    guide</em>.</p>
            <p>The query filter string used with the
                    <code class="code">AMAZON.KendraSearchIntent</code> must use
                lower-case letters for the first letter of each filter. For
                example, the following is a valid query filter for the
                    <code class="code">AMAZON.KendraSearchIntent</code>.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
"andAllFilters": [
    <span>{</span>
        "equalsTo": <span>{</span>
            "key": "City",
            "value": <span>{</span>
                "stringValue": "Seattle"
            }
        }
    },
    <span>{</span>
        "equalsTo": <span>{</span>
            "key": "State",
            "value": <span>{</span>
                "stringValue": "Washington"
            }
        }
    }
]
}</code></pre>
         
            <h2 id="kendra-search-response">Using the Search
                    Response</h2>
            <p>Amazon Kendra returns the response to a search in a response from
                the intent's <code class="code">IntentClosingSetting</code> statement.
                The intent must have a <code class="code">closingResponse</code>
                statement unless a Lambda function produces a closing
                response message.</p>
            <p>Amazon Kendra has five types of responses. </p>
            <div class="itemizedlist">
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>The following two responses require an FAQ to be set up for 
                    your Amazon Kendra index. For more details, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/in-creating-faq.html">Adding questions 
                    and answers directly to a index</a>.</p>
                    <div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p>
                                <code class="code">x-amz-lex:kendra-search-response-question_answer-question-&lt;N&gt;</code>
                                – The question from a FAQ that matches the
                                search.
                            </p>
                        </li><li class="listitem">
                            <p>
                                <code class="code">x-amz-lex:kendra-search-response-question_answer-answer-&lt;N&gt;</code>
                                – The answer from a FAQ that matches the
                                search.
                            </p>
                        </li></ul></div>                        
                </li><li class="listitem">
                    <p>The following three responses require a data source to be set 
                        up for your Amazon Kendra index. For more details, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source.html">Creating a data source</a>.
                    </p>
                    <div class="itemizedlist">
                         
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p><code class="code">x-amz-lex:kendra-search-response-document-&lt;N&gt;</code>
                                – An excerpt from a document in the index that
                                is related to the text of the utterance.</p>
                        </li><li class="listitem">
                            <p><code class="code">x-amz-lex:kendra-search-response-document-link-&lt;N&gt;</code>
                                – The URL of a document in the index that is
                                related to the text of the utterance.</p>
                        </li><li class="listitem">
                            <p><code class="code">x-amz-lex:kendra-search-response-answer-&lt;N&gt;</code>
                                – An excerpt from a document in the index that
                                answers the question.</p>
                        </li></ul></div>
                </li></ul></div>
            <p>The responses are returned in <code class="code">request</code>
                attributes. There can be up to five responses for each
                attribute, numbered 1 through 5. For more information about
                responses, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/response-types.html">Types of
                    response</a> in the <em>Amazon Kendra Developer
                    Guide</em>. </p>
            <p>The <code class="code">closingResponse</code> statement must have one
                or more message groups. Each message group contains one or
                more messages. Each message can contain one or more
                placeholder variables that are replaced by request
                attributes in the response from Amazon Kendra. There must be at
                least one message in the message group where all of the
                variables in the message are replaced by request attribute
                values in the runtime response, or there must be a message
                in the group with no placeholder variables. The request
                attributes are set off with double parentheses ("((" "))").
                The following message group messages match any response from
                Amazon Kendra:</p>
            <div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>“I found a FAQ question for you:
                        ((x-amz-lex:kendra-search-response-question_answer-question-1)),
                        and the answer is
                        ((x-amz-lex:kendra-search-response-question_answer-answer-1))”</p>
                </li><li class="listitem">
                    <p>“I found an excerpt from a helpful document:
                        ((x-amz-lex:kendra-search-response-document-1))”</p>
                </li><li class="listitem">
                    <p>“I think the answer to your questions is
                        ((x-amz-lex:kendra-search-response-answer-1))”</p>
                </li></ul></div>
         
            <h2 id="kendra-search-lambda">Using a Lambda
                    Function to Manage the Request and Response</h2>
            <p>The <code class="code">AMAZON.KendraSearchIntent</code> intent can use
                your dialog code hook and fulfillment code hook to manage
                the request to Amazon Kendra and the response. Use the dialog code
                hook Lambda function when you want to modify the query that
                you send to Amazon Kendra, and the fulfillment code hook Lambda
                function when you want to modify the response.</p>
             
                <h3 id="kendra-search-lambda-dialog">Creating a
                        Query with the Dialog Code Hook</h3>
                <p>You can use the dialog code hook to create a query to
                    send to Amazon Kendra. Using the dialog code hook is optional.
                    If you don't specify a dialog code hook, Amazon Lex V2
                    constructs a query from the user utterance and uses the
                        <code class="code">queryFilterString</code> that you provided
                    when you configured the intent, if you provided
                    one.</p>
                <p>You can use two fields in the dialog code hook
                    response to modify the request to Amazon Kendra:</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p><code class="code">kendraQueryFilterString</code> –
                            Use this string to specify attribute filters for
                            the Amazon Kendra request. You can filter the query
                            using any of the index fields defined in your
                            index. For the structure of the filter string,
                            see <a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">Using document attributes to filter
                                queries</a> in the <em>Amazon Kendra
                                Developer Guide</em>. If the specified
                            filter string isn't valid, you will get an
                                <code class="code">InvalidLambdaResponseException</code>
                            exception. The
                                <code class="code">kendraQueryFilterString</code> string
                            overrides any query string specified in the
                                <code class="code">queryFilterString</code> configured
                            for the intent.</p>
                    </li><li class="listitem">
                        <p><code class="code">kendraQueryRequestPayload</code> –
                            Use this string to specify an Amazon Kendra query. Your
                            query can use any of the features of Amazon Kendra. If
                            you don't specify a valid query, you get a
                                <code class="code">InvalidLambdaResponseException</code>
                            exception. For more information, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html">Query</a> in the <em>Amazon Kendra
                                Developer Guide</em>.</p>
                    </li></ul></div>
                <p>After you have created the filter or query string, you
                    send the response to Amazon Lex V2 with the
                        <code class="code">dialogAction</code> field of the response set
                    to <code class="code">delegate</code>. Amazon Lex V2 sends the query to
                    Amazon Kendra and then returns the query response to the
                    fulfillment code hook.</p>
             
             
                <h3 id="kendra-search-lambda-fulfillment">Using
                        the Fulfillment Code Hook for the Response</h3>
                <p>After Amazon Lex V2 sends a query to Amazon Kendra, the query
                    response is returned to the
                        <code class="code">AMAZON.KendraSearchIntent</code> fulfillment
                    Lambda function. The input event to the code hook
                    contains the complete response from Amazon Kendra. The query
                    data is in the same structure as the one returned by the
                    Amazon Kendra <code class="code">Query</code> operation. For more
                    information, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html#API_Query_ResponseSyntax"> Query response syntax</a> in the
                        <em>Amazon Kendra Developer Guide</em>.</p>
                <p>The fulfillment code hook is optional. If one does not
                    exist, or if the code hook doesn't return a message in
                    the response, Amazon Lex V2 uses the
                        <code class="code">closingResponse</code> statement for
                    responses.</p>
             
        <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./built-in-intent-help.html">AMAZON.HelpIntent</div><div id="next" class="next-link" accesskey="n" href="./faq-bot-kendra-search.html">Example: Creating a
                    FAQ Bot for an Amazon Kendra Index</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=https://docs.aws.amazon.com/en_us/lexv2/latest/dg/built-in-intent-kendra-search.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=https://docs.aws.amazon.com/en_us/lexv2/latest/dg/built-in-intent-kendra-search.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>