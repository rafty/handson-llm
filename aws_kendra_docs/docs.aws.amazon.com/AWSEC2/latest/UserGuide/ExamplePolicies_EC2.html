<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Example policies for working with the AWS CLI or an AWS SDK - Amazon Elastic Compute Cloud</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="ExamplePolicies_EC2" /><meta name="default_state" content="ExamplePolicies_EC2" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" /><meta name="description" content="Learn to create policy statements to control the permissions that users have to Amazon EC2." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Elastic Compute Cloud" /><meta name="guide" content="User Guide for Linux Instances" /><meta name="abstract" content="Use Amazon EC2 to configure, launch, and manage virtual servers in the AWS cloud." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" hreflang="x-default" /><meta name="feedback-item" content="EC2" /><meta name="this_doc_product" content="Amazon Elastic Compute Cloud" /><meta name="this_doc_guide" content="User Guide for Linux Instances" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'ec2'}"></script><meta id="panorama-serviceSubSection" value="User Guide for Linux Instances" /><meta id="panorama-serviceConsolePage" value="Example policies for working with the AWS CLI or an AWS SDK" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Example policies for working with the AWS CLI or an AWS SDK - Amazon Elastic Compute Cloud</title><meta name="pdf" content="/pdfs/AWSEC2/latest/UserGuide/ec2-ug.pdf#ExamplePolicies_EC2" /><meta name="github" content="https://github.com/awsdocs/amazon-ec2-user-guide/tree/master/doc_source/ExamplePolicies_EC2.md" /><meta name="rss" content="amazon-ec2-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=30" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html" /><meta name="keywords" content="EC2,Amazon EC2,EC2 instance,instance,VM,virtual machine" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon EC2",
        "item" : "https://docs.aws.amazon.com/ec2/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide for Linux Instances",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Security in Amazon EC2",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Identity and access management for Amazon EC2",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-iam.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "IAM policies for Amazon EC2",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-policies-for-amazon-ec2.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Example policies for working with the AWS CLI or an AWS SDK",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-policies-for-amazon-ec2.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/AWSEC2/latest/UserGuide/ec2-ug.pdf#ExamplePolicies_EC2" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/amazon-ec2-user-guide/tree/master/doc_source/ExamplePolicies_EC2.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/ec2/index.html">Amazon EC2</a><a href="concepts.html">User Guide for Linux Instances</a></div><div id="page-toc-src"><a href="#iam-example-read-only">Read-only access</a><a href="#iam-example-region">Restrict access to a specific Region</a><a href="#iam-example-instances">Work with instances</a><a href="#iam-example-manage-volumes">Work with volumes</a><a href="#iam-example-manage-snapshots">Work with snapshots</a><a href="#iam-example-runinstances">Launch instances (RunInstances)</a><a href="#iam-example-spot-instances">Work with Spot Instances</a><a href="#iam-example-reservedinstances">Work with Reserved Instances</a><a href="#iam-example-taggingresources">Tag resources</a><a href="#iam-example-iam-roles">Work with IAM roles</a><a href="#iam-example-route-tables">Work with route
                tables</a><a href="#iam-example-source-instance">Allow a specific
                instance to view resources in other AWS services</a><a href="#iam-example-launch-templates">Work with launch
                templates</a><a href="#iam-example-instance-metadata">Work with instance
                metadata</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="ExamplePolicies_EC2">Example policies for working with the AWS CLI or an AWS
      SDK</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You must grant users the permissions they require for Amazon EC2 using IAM policies. The
        following examples show policy statements that you could use to control the permissions that
        users have to Amazon EC2. These policies are designed for requests that are made with the AWS CLI
        or an AWS SDK. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html">Creating IAM policies</a> in
        the IAM User Guide. For example policies for working in the Amazon EC2 console, see <a href="./iam-policies-ec2-console.html">Example policies for working in the Amazon EC2
			console</a>. For
        examples of IAM policies specific to Amazon VPC, see <a href="https://docs.aws.amazon.com/vpc/latest/userguide/security-iam.html">Identity and Access Management for
        Amazon VPC</a>.</p><p>In the following examples, replace each <code class="replaceable">user input placeholder</code> with your own information.</p><div class="highlights" id="inline-topiclist"><h6>Examples</h6><ul><li><a href="#iam-example-read-only">Read-only access</a></li><li><a href="#iam-example-region">Restrict access to a specific Region</a></li><li><a href="#iam-example-instances">Work with instances</a></li><li><a href="#iam-example-manage-volumes">Work with volumes</a></li><li><a href="#iam-example-manage-snapshots">Work with snapshots</a></li><li><a href="#iam-example-runinstances">Launch instances (RunInstances)</a></li><li><a href="#iam-example-spot-instances">Work with Spot Instances</a></li><li><a href="#iam-example-reservedinstances">Work with Reserved Instances</a></li><li><a href="#iam-example-taggingresources">Tag resources</a></li><li><a href="#iam-example-iam-roles">Work with IAM roles</a></li><li><a href="#iam-example-route-tables">Work with route
                tables</a></li><li><a href="#iam-example-source-instance">Allow a specific
                instance to view resources in other AWS services</a></li><li><a href="#iam-example-launch-templates">Work with launch
                templates</a></li><li><a href="#iam-example-instance-metadata">Work with instance
                metadata</a></li></ul></div>
				<h2 id="iam-example-read-only">Example: Read-only access</h2>
				
				<p>The following policy grants users permissions to use all Amazon EC2 API actions whose names
            begin with <code class="code">Describe</code>. The <code class="code">Resource</code> element uses a wildcard to
            indicate that users can specify all resources with these API actions. The * wildcard is
            also necessary in cases where the API action does not support resource-level
            permissions. For more information about which ARNs you can use with which Amazon EC2 API
            actions, see <a href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonec2.html">Actions, resources, and condition keys for Amazon EC2</a>.</p>
				<p>Users don't have permission to perform any actions on the resources (unless
					another statement grants them permission to do so) because they're denied
					permission to use API actions by default.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:Describe*",
      "Resource": "*"
    }
   ]
}</code></pre>
			 
				<h2 id="iam-example-region">Example: Restrict access to a specific Region</h2>
				
				<p>The following policy denies users permission to use all Amazon EC2 API actions unless the
      Region is Europe (Frankfurt). It uses the global condition key
        <code class="code">aws:RequestedRegion</code>, which is supported by all Amazon EC2 API actions.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version":"2012-10-17",
  "Statement": [
       <span>{</span>
      "Effect": "Deny",
      "Action": "ec2:*",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:RequestedRegion": "eu-central-1"
        }
      }
    }  
  ]
}</code></pre>

        <p>Alternatively, you can use the condition key <code class="code">ec2:Region</code>, which is specific to
            Amazon EC2 and is supported by all Amazon EC2 API actions.</p>
			  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version":"2012-10-17",
  "Statement": [
       <span>{</span>
      "Effect": "Deny",
      "Action": "ec2:*",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "ec2:Region": "eu-central-1"
        }
      }
    }  
  ]
}</code></pre>
			 
				<h2 id="iam-example-instances">Work with instances</h2>

				<div class="highlights" id="inline-topiclist"><h6>Examples</h6><ul><li><a href="#iam-example-instances-all">Example: Describe, launch, stop, start, and terminate
          all instances</a></li><li><a href="#iam-example-instances-specific">Example: Describe all instances, and stop, start,
          and terminate only particular instances</a></li></ul></div>
				 
					<h3 id="iam-example-instances-all">Example: Describe, launch, stop, start, and terminate
          all instances</h3>
					
					<p>The following policy grants users permissions to use the API actions specified in the
                    <code class="code">Action</code> element. The <code class="code">Resource</code> element uses a * wildcard
                to indicate that users can specify all resources with these API actions. The *
                wildcard is also necessary in cases where the API action does not support
                resource-level permissions. For more information about which ARNs you can use with
                which Amazon EC2 API actions, see <a href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonec2.html">Actions, resources, and condition keys for Amazon EC2</a>.</p>
					<p>The users don't have permission to use any other API actions (unless
						another statement grants them permission to do so) because users are denied
						permission to use API actions by default.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeInstances", 
        "ec2:DescribeImages",
        "ec2:DescribeKeyPairs", 
        "ec2:DescribeSecurityGroups",
        "ec2:DescribeAvailabilityZones",
        "ec2:RunInstances", 
        "ec2:TerminateInstances",
        "ec2:StopInstances", 
        "ec2:StartInstances"
      ],
      "Resource": "*"
    }
   ]
}</code></pre>
				 
				 
					<h3 id="iam-example-instances-specific">Example: Describe all instances, and stop, start,
          and terminate only particular instances</h3>
					
					<p>The following policy allows users to describe all instances, to start and
						stop only instances i-1234567890abcdef0 and i-0598c7d356eba48d7,
						and to terminate only instances in the US East (N. Virginia) Region
							(<code class="code">us-east-1</code>) with the resource tag
							"<code class="code">purpose=test</code>". </p>
					<p>The first statement uses a * wildcard for the <code class="code">Resource</code> element to indicate
                that users can specify all resources with the action; in this case, they can list
                all instances. The * wildcard is also necessary in cases where the API action does
                not support resource-level permissions (in this case,
                    <code class="code">ec2:DescribeInstances</code>). For more information about which ARNs you
                can use with which Amazon EC2 API actions, see <a href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonec2.html">Actions, resources, and condition keys for Amazon EC2</a>.</p>
					<p>The second statement uses resource-level permissions for the
							<code class="code">StopInstances</code> and <code class="code">StartInstances</code> actions. The
						specific instances are indicated by their ARNs in the <code class="code">Resource</code>
						element.</p>
					<p>The third statement allows users to terminate all instances in the
						US East (N. Virginia) Region (<code class="code">us-east-1</code>) that belong to the
						specified AWS account, but only where the instance has the tag
							<code class="code">"purpose=test"</code>. The <code class="code">Condition</code> element
						qualifies when the policy statement is in effect. </p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
   <span>{</span>
   "Effect": "Allow",
      "Action": "ec2:DescribeInstances",
      "Resource": "*"
   },
   <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:StopInstances", 
        "ec2:StartInstances"
      ],
      "Resource": [
        "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:instance/i-1234567890abcdef0",
        "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:instance/i-0598c7d356eba48d7"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:TerminateInstances",
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:instance/*",
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
            "aws:ResourceTag/purpose": "test"
         }
      }
   }

   ]
}</code></pre>
				 
			 
				<h2 id="iam-example-manage-volumes">Work with volumes</h2>
				
				<div class="highlights" id="inline-topiclist"><h6>Examples</h6><ul><li><a href="#iam-example-manage-volumes-attach-detach">Example: Attach and detach
                    volumes</a></li><li><a href="#iam-example-manage-volumes-create">Example: Create a volume</a></li><li><a href="#iam-example-manage-volumes-tags">Example: Create a volume with tags</a></li></ul></div>
				 
					<h3 id="iam-example-manage-volumes-attach-detach">Example: Attach and detach
                    volumes</h3>
					
					<p>When an API action requires a caller to specify multiple resources, you
						must create a policy statement that allows users to access all required
						resources. If you need to use a <code class="code">Condition</code> element with one or
						more of these resources, you must create multiple statements as shown in
						this example.</p>
					<p>The following policy allows users to attach volumes with the tag
                    "<code class="code">volume_user</code>=<em>iam-user-name</em>" to instances with
                the tag "<code class="code">department=dev</code>", and to detach those volumes from those
                instances. If you attach this policy to an IAM group, the
                    <code class="code">aws:username</code> policy variable gives each user in the group
                permission to attach or detach volumes from the instances with a tag named
                    <code class="code">volume_user</code> that has their username as a value.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
       <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:AttachVolume",
        "ec2:DetachVolume"
      ],
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:instance/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:ResourceTag/department": "dev"
        }
      }
   },
   <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:AttachVolume",
        "ec2:DetachVolume"
      ],
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:ResourceTag/volume_user": "$<span>{</span>aws:username}"
        }
      }
   }
  ]
}</code></pre>
				 
				 
					<h3 id="iam-example-manage-volumes-create">Example: Create a volume</h3>
					
					<p>The following policy allows users to use the <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateVolume.html">CreateVolume</a> API
						action. The user is allowed to create a volume only if the volume is
						encrypted and only if the volume size is less than 20 GiB.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
         <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:CreateVolume"
      ],
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
      "Condition":<span>{</span>
         "NumericLessThan": <span>{</span>
             "ec2:VolumeSize" : "20"
          },
          "Bool":<span>{</span>
              "ec2:Encrypted" : "true"
          }
       }
    }
  ]
}</code></pre>
				 
				 
					<h3 id="iam-example-manage-volumes-tags">Example: Create a volume with tags</h3>

					<p>The following policy includes the <code class="code">aws:RequestTag</code> condition key that requires 
					    users to tag any volumes they create with the tags <code class="code">costcenter=115</code> and 
					    <code class="code">stack=prod</code>. If users don't pass these specific tags, or if they don't specify 
					    tags at all, the request fails. </p>
					<p>For resource-creating actions that apply tags, users must also have permissions to use
                the <code class="code">CreateTags</code> action. The second statement uses the
                    <code class="code">ec2:CreateAction</code> condition key to allow users to create tags only
                in the context of <code class="code">CreateVolume</code>. Users cannot tag existing volumes or
                any other resources. For more information, see <a href="./supported-iam-actions-tagging.html">Grant permission to tag resources
					during creation</a>.</p>

					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
        <span>{</span>
      "Sid": "AllowCreateTaggedVolumes",
      "Effect": "Allow",
      "Action": "ec2:CreateVolume",
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:RequestTag/costcenter": "115",
          "aws:RequestTag/stack": "prod"
         }
       }
     },
     <span>{</span>
       "Effect": "Allow",
       "Action": [
         "ec2:CreateTags"
       ],
       "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
       "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "ec2:CreateAction" : "CreateVolume"
        }
      }
    }
  ]
}</code></pre>
					<p>The following policy allows users to create a volume without having to
						specify tags. The <code class="code">CreateTags</code> action is only evaluated if tags
						are specified in the <code class="code">CreateVolume</code> request. If users do specify
						tags, the tag must be <code class="code">purpose=test</code>. No other tags are allowed
						in the request.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:CreateVolume",
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "aws:RequestTag/purpose": "test",
             "ec2:CreateAction" : "CreateVolume"
          },
         "ForAllValues:StringEquals": <span>{</span>
             "aws:TagKeys": "purpose"
          }
       }
    }
  ]
}</code></pre>
				 
			 
    <h2 id="iam-example-manage-snapshots">Work with snapshots</h2>
    <p>The following are example policies for both <code class="code">CreateSnapshot</code> (point-in-time
      snapshot of an EBS volume) and <code class="code">CreateSnapshots</code> (multi-volume snapshots).</p>
    <div class="highlights" id="inline-topiclist"><h6>Examples</h6><ul><li><a href="#iam-creating-snapshot">Example: Create a snapshot</a></li><li><a href="#iam-creating-snapshots">Example: Create snapshots</a></li><li><a href="#iam-creating-snapshot-with-tags">Example: Create a snapshot with
                    tags</a></li><li><a href="#iam-creating-snapshots-with-tags">Example: Create multi-volume snapshots with
                    tags</a></li><li><a href="#iam-copy-snapshot">Example: Copying snapshots</a></li><li><a href="#iam-modifying-snapshot-with-tags">Example: Modify permission settings for
                    snapshots</a></li></ul></div>
   
    
     
      <h3 id="iam-creating-snapshot">Example: Create a snapshot</h3>
      <p>The following policy allows customers to use the <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSnapshot.html">CreateSnapshot</a> API action. The customer
        can create snapshots only if the volume is encrypted and only if the volume size is less
        than 20 GiB.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*"
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
         "Condition":<span>{</span>
            "NumericLessThan":<span>{</span>
               "ec2:VolumeSize":"20"
            },
            "Bool":<span>{</span>
               "ec2:Encrypted":"true"
            }
         }
      }
   ]
}</code></pre>
     
       
        <h3 id="iam-creating-snapshots">Example: Create snapshots</h3>
        <p>The following policy allows customers to use the <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateSnapshots.html">CreateSnapshots</a> API action. The
        customer can create snapshots only if all of the volumes on the instance are type
        GP2.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":[
"arn:aws:ec2:us-east-1::snapshot/*",
"arn:aws:ec2:*:*:instance/*"
   ]
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":"arn:aws:ec2:us-east-1:*:volume/*",
         "Condition":<span>{</span>
            "StringLikeIfExists":<span>{</span>
               "ec2:VolumeType":"gp2"
             }
	    }
            
      }
   ]
}</code></pre>

     
     
      <h3 id="iam-creating-snapshot-with-tags">Example: Create a snapshot with
                    tags</h3>
      <p>The following policy includes the <code class="code">aws:RequestTag</code> condition key that requires the 
          customer to apply the tags <code class="code">costcenter=115</code> and <code class="code">stack=prod</code> to any new 
          snapshot. If users don't pass these specific tags, or if they don't specify tags at all, the 
          request fails.</p>
      <p>For resource-creating actions that apply tags, customers must also have permissions to
        use the <code class="code">CreateTags</code> action. The third statement uses the
          <code class="code">ec2:CreateAction</code> condition key to allow customers to create tags only in the
        context of <code class="code">CreateSnapshot</code>. Customers cannot tag existing volumes or any other
        resources. For more information, see <a href="./supported-iam-actions-tagging.html">Grant permission to tag resources
					during creation</a>.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*"
      },
      <span>{</span>
         "Sid":"AllowCreateTaggedSnapshots",
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:RequestTag/costcenter":"115",
               "aws:RequestTag/stack":"prod"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateTags",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "ec2:CreateAction":"CreateSnapshot"
            }
         }
      }
   ]
}</code></pre>
     
     
      <h3 id="iam-creating-snapshots-with-tags">Example: Create multi-volume snapshots with
                    tags</h3>
      <p>The following policy includes the <code class="code">aws:RequestTag</code> condition key that requires the 
          customer to apply the tags <code class="code">costcenter=115</code> and <code class="code">stack=prod</code> when creating 
          a multi-volume snapshot set. If users don't pass these specific tags, or if they don't specify 
          tags at all, the request fails.</p>
 
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":[
"arn:aws:ec2:us-east-1::snapshot/*",
"arn:aws:ec2:*:*:instance/*",
"arn:aws:ec2:*:*:volume/*"

   ]
      },
      <span>{</span>
         "Sid":"AllowCreateTaggedSnapshots",
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:RequestTag/costcenter":"115",
               "aws:RequestTag/stack":"prod"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateTags",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "ec2:CreateAction":"CreateSnapshots"
            }
         }
      }
   ]
}</code></pre>
      <p>The following policy allows customers to create a snapshot without having to specify
        tags. The <code class="code">CreateTags</code> action is evaluated only if tags are specified in the
          <code class="code">CreateSnapshot</code> or <code class="code">CreateSnapshots</code> request. Tags can be omitted 
          in the request. If a tag is specified, the tag must be <code class="code">purpose=test</code>. No 
          other tags are allowed in the request.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"*"
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateTags",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:RequestTag/purpose":"test",
               "ec2:CreateAction":"CreateSnapshot"
            },
            "ForAllValues:StringEquals":<span>{</span>
               "aws:TagKeys":"purpose"
            }
         }
      }
   ]
}</code></pre>
        <p>The following policy allows customers to create multi-volume snapshot sets without having 
            to specify tags. The <code class="code">CreateTags</code> action is evaluated only if tags are specified 
            in the <code class="code">CreateSnapshot</code> or <code class="code">CreateSnapshots</code> request. Tags can be 
            omitted in the request. If a tag is specified, the tag must be <code class="code">purpose=test</code>. No 
            other tags are allowed in the request.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":"*"
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateTags",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:RequestTag/purpose":"test",
               "ec2:CreateAction":"CreateSnapshots"
            },
            "ForAllValues:StringEquals":<span>{</span>
               "aws:TagKeys":"purpose"
            }
         }
      }
   ]
}</code></pre>
      <p>The following policy allows snapshots to be created only if the source volume is tagged
        with <code class="code">User:<em>username</em></code> for the customer, and the
        snapshot itself is tagged with <code class="code">Environment:Dev</code> and <code class="code">User:<em>username</em></code>. The customer can add additional tags to the
        snapshot.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
           <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:ResourceTag/User":"$<span>{</span>aws:<em>username</em>}"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:RequestTag/Environment":"Dev",
               "aws:RequestTag/User":"$<span>{</span>aws:<em>username</em>}"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateTags",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*"
      }
   ]
}</code></pre>
      <p>The following policy for <code class="code">CreateSnapshots</code> allows snapshots to be created
        only if the source volume is tagged with <code class="code">User:<em>username</em></code> for the customer, and the snapshot itself is tagged with
          <code class="code">Environment:Dev</code> and <code class="code">User:<em>username</em></code>. </p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":"arn:aws:ec2:us-east-1:*:instance/*",
	},
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":"arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:ResourceTag/User":"$<span>{</span>aws:username}"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateSnapshots",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:RequestTag/Environment":"Dev",
               "aws:RequestTag/User":"$<span>{</span>aws:username}"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:CreateTags",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*"
      }
   ]
}</code></pre>
      <p>The following policy allows deletion of a snapshot only if the snapshot is tagged with
          User:<em>username</em> for the customer.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
            <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:DeleteSnapshot",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:ResourceTag/User":"$<span>{</span>aws:<em>username</em>}"
            }
         }
      }
   ]
}</code></pre>
      <p>The following policy allows a customer to create a snapshot but denies the action if the
        snapshot being created has a tag key <code class="code">value=stack</code>.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":[
            "ec2:CreateSnapshot",
            "ec2:CreateTags"
         ],
         "Resource":"*"
      },
      <span>{</span>
         "Effect":"Deny",
         "Action":"ec2:CreateSnapshot",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "ForAnyValue:StringEquals":<span>{</span>
               "aws:TagKeys":"stack"
            }
         }
      }
   ]
}</code></pre>
      <p>The following policy allows a customer to create snapshots but denies the action if the
        snapshots being created have a tag key <code class="code">value=stack</code>.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
      <span>{</span>
         "Effect":"Allow",
         "Action":[
            "ec2:CreateSnapshots",
            "ec2:CreateTags"
         ],
         "Resource":"*"
      },
      <span>{</span>
         "Effect":"Deny",
         "Action":"ec2:CreateSnapshots",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "ForAnyValue:StringEquals":<span>{</span>
               "aws:TagKeys":"stack"
            }
         }
      }
   ]
}</code></pre>
      <p>The following policy allows you to combine multiple actions into a single policy. You
        can only create a snapshot (in the context of
          <code class="code">CreateSnapshots</code>)
        when the snapshot is created in Region <code class="code">us-east-1</code>. You can only create snapshots
        (in the context of <code class="code">CreateSnapshots</code>) when the snapshots are being created in the
        Region <code class="code">us-east-1</code> and when the instance type is
        <code class="code">t2*</code>.</p>
      
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
          <span>{</span>
         "Effect":"Allow",
         "Action":[
            "ec2:CreateSnapshots",
            "ec2:CreateSnapshot",
            "ec2:CreateTags"
         ],
         "Resource": [
            "arn:aws:ec2:*:*:instance/*",
            "arn:aws:ec2:*:*:snapshot/*",
            "arn:aws:ec2:*:*:volume/*"
         ],
         "Condition":<span>{</span>
            "StringEqualsIgnoreCase": <span>{</span>
              "ec2:Region": "us-east-1"
            },
            "StringLikeIfExists": <span>{</span>
              "ec2:InstanceType": ["t2.*"]
            }
         }
      }
   ]
}</code></pre>
      
     
    
    
  	 
  		<h3 id="iam-copy-snapshot">Example: Copying snapshots</h3>
  		<p>Resource-level permissions specified for the <em>CopySnapshot</em> action apply to the new snapshot 
  			only. They cannot be specified for the source snapshot.</p>
  		<p>The following example policy allows principals to copy snapshots only if the new snapshot is created with 
  			tag key of <code class="code">purpose</code> and a tag value of <code class="code">production</code> (<code class="code">purpose=production</code>).</p>
  		<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowCopySnapshotWithTags",
            "Effect": "Allow",
            "Action": "ec2:CopySnapshot",
            "Resource": "arn:aws:ec2:*:<code class="replaceable">account-id</code>:snapshot/*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestTag/purpose": "production"
                }
            }
        }
    ]
}</code></pre>
   
  	
  	
  	
  	
  	
     
      <h3 id="iam-modifying-snapshot-with-tags">Example: Modify permission settings for
                    snapshots</h3>
      <p>The following policy allows modification of a snapshot only if the snapshot is tagged
        with <code class="code">User:<code class="replaceable">username</code></code>, where
          <code class="replaceable">username</code> is the customer's AWS account user name. The request
        fails if this condition is not met.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement": [
           <span>{</span>
         "Effect":"Allow",
         "Action":"ec2:ModifySnapshotAttribute",
         "Resource":"arn:aws:ec2:us-east-1::snapshot/*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "aws:ResourceTag/user-name":"$<span>{</span>aws:<code class="replaceable">username</code>}"
            }
         }
      }
   ]
}</code></pre>
     
  	
  	
  	
   
				<h2 id="iam-example-runinstances">Launch instances (RunInstances)</h2>
				
				<p>The <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-RunInstances.html">RunInstances</a>
      API action launches one or more On-Demand Instances or one or more Spot Instances. <code class="code">RunInstances</code> requires an AMI and
      creates an instance. Users can specify a key pair and security group in the request. Launching
      into a VPC requires a subnet, and creates a network interface. Launching from an Amazon EBS-backed
      AMI creates a volume. Therefore, the user must have permissions to use these Amazon EC2 resources.
      You can create a policy statement that requires users to specify an optional parameter on
        <code class="code">RunInstances</code>, or restricts users to particular values for a parameter.</p>
        <p>For more information about the resource-level permissions that are required to
            launch an instance, see <a href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazonec2.html">Actions, resources, and condition keys for Amazon EC2</a>.</p>
		<p>By default, users don't have permissions to describe, start, stop, or terminate the
            resulting instances. One way to grant the users permission to manage the resulting
            instances is to create a specific tag for each instance, and then create a statement
            that enables them to manage instances with that tag. For more information, see <a href="#iam-example-instances">Work with instances</a>.</p>
				<div class="highlights" id="inline-topiclist"><h6>Resources</h6><ul><li><a href="#iam-example-runinstances-ami">AMIs</a></li><li><a href="#iam-example-runinstances-instance-type">Instance types</a></li><li><a href="#iam-example-runinstances-subnet">Subnets</a></li><li><a href="#iam-example-runinstances-volumes">EBS volumes</a></li><li><a href="#iam-example-runinstances-tags">Tags</a></li><li><a href="#iam-example-tags-launch-template">Tags in a launch template</a></li><li><a href="#iam-example-runinstances-egpu">Elastic GPUs</a></li><li><a href="#iam-example-runinstances-launch-templates">Launch templates</a></li></ul></div>
				 
					<h3 id="iam-example-runinstances-ami">AMIs</h3>
					<p>The following policy allows users to launch instances using only the specified AMIs,
                            <code class="code">ami-9e1670f7</code> and <code class="code">ami-45cf5c3c</code>. The users can't
                        launch an instance using other AMIs (unless another statement grants the
                        users permission to do so).</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [
        "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-9e1670f7",
        "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-45cf5c3c",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*"
      ]
    }
   ]
}</code></pre>
					<p>Alternatively, the following policy allows users to launch instances from all AMIs owned
					    by Amazon, or certain trusted and verified partners. The <code class="code">Condition</code> element of the first statement tests
                        whether <code class="code">ec2:Owner</code> is <code class="code">amazon</code>. The users can't
                        launch an instance using other AMIs (unless another statement grants the
                        users permission to do so).</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
         <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [ 
         "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-*"
      ],
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
            "ec2:Owner": "amazon"
         }
      }
   },
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [ 
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*"
         ]
      }
   ]
}</code></pre>
				 

				 
					<h3 id="iam-example-runinstances-instance-type">Instance types</h3>
					
					<p>The following policy allows users to launch instances using only the
							<code class="code">t2.micro</code> or <code class="code">t2.small</code> instance type, which you
						might do to control costs. The users can't launch larger instances because
						the <code class="code">Condition</code> element of the first statement tests whether
							<code class="code">ec2:InstanceType</code> is either <code class="code">t2.micro</code> or
							<code class="code">t2.small</code>. </p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
        <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*"
      ],
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
            "ec2:InstanceType": ["t2.micro", "t2.small"]
         }
      }
   },
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*"
         ]
      }
   ]
}</code></pre>
					<p>Alternatively, you can create a policy that denies users permissions to launch any
                instances except <code class="code">t2.micro</code> and <code class="code">t2.small</code> instance
                types.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
        <span>{</span> 
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*"
      ],
      "Condition": <span>{</span>
         "StringNotEquals": <span>{</span>
            "ec2:InstanceType": ["t2.micro", "t2.small"]
         }
      }
   },
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*"
         ]
      }
   ]
}</code></pre>
				 
				 
					<h3 id="iam-example-runinstances-subnet">Subnets</h3>
					
					<p>The following policy allows users to launch instances using only the specified subnet,
                        <code class="code">subnet-<code class="replaceable">12345678</code></code>. The group can't
                launch instances into any another subnet (unless another statement grants the users
                permission to do so).</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/subnet-<code class="replaceable">12345678</code>",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
        "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*"
      ]
    }
   ]
}</code></pre>
					<p>Alternatively, you could create a policy that denies users permissions to launch an
                instance into any other subnet. The statement does this by denying permission to
                create a network interface, except where subnet
                        <code class="code">subnet-<code class="replaceable">12345678</code></code> is specified. This
                denial overrides any other policies that are created to allow launching instances
                into other subnets.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
         <span>{</span>
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*"
      ],
      "Condition": <span>{</span>
         "ArnNotEquals": <span>{</span>
            "ec2:Subnet": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/subnet-<code class="replaceable">12345678</code>"
         }
      }
   },
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>::image/ami-*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*"
         ]
      }
   ]
}</code></pre>
				 
				 
					<h3 id="iam-example-runinstances-volumes">EBS volumes</h3>
					
					<p>The following policy allows users to launch instances only if the EBS
						volumes for the instance are encrypted. The user must launch an instance
						from an AMI that was created with encrypted snapshots, to ensure that the
						root volume is encrypted. Any additional volume that the user attaches to
						the instance during launch must also be encrypted.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
                <span>{</span>
            "Effect": "Allow",
            "Action": "ec2:RunInstances",
            "Resource": [
                "arn:aws:ec2:*:*:volume/*"
            ],
            "Condition": <span>{</span>
                "Bool": <span>{</span>
                    "ec2:Encrypted": "true"
                }
            }
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "ec2:RunInstances",
            "Resource": [
                "arn:aws:ec2:*::image/ami-*",
                "arn:aws:ec2:*:*:network-interface/*",
                "arn:aws:ec2:*:*:instance/*",
                "arn:aws:ec2:*:*:subnet/*",
                "arn:aws:ec2:*:*:key-pair/*",
                "arn:aws:ec2:*:*:security-group/*"
            ]
        }
    ]
}</code></pre>
				 
    
    
    
				 
					<h3 id="iam-example-runinstances-tags">Tags</h3>
					
					<p><b>Tag instances on creation</b></p>
					<p>The following policy allows users to launch instances and tag the instances during
        creation. For resource-creating actions that apply tags, users must have permissions to use
        the <code class="code">CreateTags</code> action. The second statement uses the
          <code class="code">ec2:CreateAction</code> condition key to allow users to create tags only in the
        context of <code class="code">RunInstances</code>, and only for instances. Users cannot tag existing
        resources, and users cannot tag volumes using the <code class="code">RunInstances</code> request. </p>
					<p>For more information, see <a href="./supported-iam-actions-tagging.html">Grant permission to tag resources
					during creation</a>.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:instance/*",
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "ec2:CreateAction" : "RunInstances"
          }
       }
    }
  ]
}</code></pre>
      <p><b>Tag instances and volumes on creation with specific
        tags</b></p>
					<p>The following policy includes the <code class="code">aws:RequestTag</code> condition key that requires users 
					    to tag any instances and volumes that are created by <code class="code">RunInstances</code> with the tags
					    <code class="code">environment=production</code> and <code class="code">purpose=webserver</code>. If users don't pass these 
					    specific tags, or if they don't specify tags at all, the request fails.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
   <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances"
      ],
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>::image/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances"
      ],
      "Resource": [
          "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
          "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*"
      ],
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "aws:RequestTag/environment": "production" ,
             "aws:RequestTag/purpose": "webserver"
          }
       }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:*/*",
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "ec2:CreateAction" : "RunInstances"
          }
       }
    }
  ]
}</code></pre>
      <p><b>Tag instances and volumes on creation with at least one specific
          tag</b></p>
					<p>The following policy uses the <code class="code">ForAnyValue</code> modifier on the
							<code class="code">aws:TagKeys</code> condition to indicate that at least one tag
						must be specified in the request, and it must contain the key
							<code class="code">environment</code> or <code class="code">webserver</code>. The tag must be
						applied to both instances and volumes. Any tag values can be specified in
						the request. </p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
   <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances"
      ],
      "Resource": [
         "arn:aws:ec2:<code class="replaceable">region</code>::image/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:security-group/*",
         "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:key-pair/*"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
          "ec2:RunInstances"
      ],
      "Resource": [
          "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:volume/*",
          "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*"
      ],
      "Condition": <span>{</span>
          "ForAnyValue:StringEquals": <span>{</span>
              "aws:TagKeys": ["environment","webserver"]
          }
       }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
          "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:*/*",
      "Condition": <span>{</span>
          "StringEquals": <span>{</span>
              "ec2:CreateAction" : "RunInstances"
          }
       }
    }
  ]
}</code></pre>
      <p><b>If instances are tagged on creation, they must be tagged with a
          specific tag</b></p>
					<p>In the following policy, users do not have to specify tags in the request,
						but if they do, the tag must be <code class="code">purpose=test</code>. No other tags are
						allowed. Users can apply the tags to any taggable resource in the
							<code class="code">RunInstances</code> request.</p>
					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:*/*",
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "aws:RequestTag/purpose": "test",
             "ec2:CreateAction" : "RunInstances"
          },
          "ForAllValues:StringEquals": <span>{</span>
              "aws:TagKeys": "purpose"
          }
       }
    }
  ]
}</code></pre>
				  
				  <p>To disallow anyone called tag on create for RunInstances</p>
				  <p></p>
				  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*",
                "arn:aws:ec2:us-east-1:*:spot-instances-request/*"
            ]
        },
        <span>{</span>
            "Sid": "VisualEditor0",
            "Effect": "Deny",
            "Action": "ec2:CreateTags",
            "Resource": "*"
        }
    ]
}</code></pre>
				  
				  <p></p>
				  <p>Only allow specific tags for spot-instances-request. Surprise inconsistency number 2 comes into play here. Under normal circumstances, specifying no tags will result in Unauthenticated. In the case of spot-instances-request, this policy will not be evaluated if there are no spot-instances-request tags, so a non-tag Spot on Run request will succeed.
				  </p>
				  <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*",
            ]
        },
        <span>{</span>
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:us-east-1:*:spot-instances-request/*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestTag/environment": "production"
                }
            }
        }
    ]
}</code></pre>
				  				  
				 
    
			     
			        <h3 id="iam-example-tags-launch-template">Tags in a launch template</h3>
			        <p>In the following example, users can launch instances, but only if they use a
        specific launch template (<code class="code">lt-09477bcd97b0d310e</code>). The
          <code class="code">ec2:IsLaunchTemplateResource</code> condition key prevents users from overriding any
        of the resources specified in the launch template. The second part of the statement allows
        users to tag instances on creationthis part of the statement is necessary if tags
        are specified for the instance in the launch template.</p>
			        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": "*",
      "Condition": <span>{</span>
         "ArnLike": <span>{</span>
             "ec2:LaunchTemplate": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/lt-09477bcd97b0d310e" 
          },
          "Bool": <span>{</span>
             "ec2:IsLaunchTemplateResource": "true"
          }
       }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
      "Condition": <span>{</span>
         "StringEquals": <span>{</span>
             "ec2:CreateAction" : "RunInstances"
          }
       }
    }
  ]
}</code></pre>
			     
			     
			        <h3 id="iam-example-runinstances-egpu">Elastic GPUs</h3>
                    <p>In the following policy, users can launch an instance and specify an
        elastic GPU to attach to the instance. Users can launch instances in any Region, but they
        can only attach an elastic GPU during a launch in the <code class="code">us-east-2</code> Region. </p>
			        <p>The <code class="code">ec2:ElasticGpuType</code> condition key uses the <code class="code">ForAnyValue</code>
                        modifier to indicate that only the elastic GPU types <code class="code">eg1.medium</code>
                        and <code class="code">eg1.large</code> are allowed in the request. </p>
			        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
             <span>{</span>
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:elastic-gpu/*"
            ],
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "ec2:Region": "us-east-2"
                },
                "ForAnyValue:StringLike": <span>{</span>
                    "ec2:ElasticGpuType": [
                        "eg1.medium",
                        "eg1.large"
                    ]
                }  
            }
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "ec2:RunInstances",
            "Resource": [
                "arn:aws:ec2:*::image/ami-*",
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:network-interface/*",
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:instance/*",
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:subnet/*",
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:volume/*",
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:key-pair/*",
                "arn:aws:ec2:*:<code class="replaceable">account-id</code>:security-group/*"
            ]
        }
    ]
}</code></pre>
			     
			     
			        <h3 id="iam-example-runinstances-launch-templates">Launch templates</h3>
			        <p>In the following example, users can launch instances, but only if they use a
                specific launch template (<code class="code">lt-09477bcd97b0d310e</code>). Users can override any
                parameters in the launch template by specifying the parameters in the
                    <code class="code">RunInstances</code> action.</p>
			        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
         <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": "*",
      "Condition": <span>{</span>
         "ArnLike": <span>{</span>
             "ec2:LaunchTemplate": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/lt-09477bcd97b0d310e" 
          }
       }
    }
  ]
}</code></pre>
			        <p>In this example, users can launch instances only if they use a launch template. The
        policy uses the <code class="code">ec2:IsLaunchTemplateResource</code> condition key to prevent users
        from overriding any pre-existing ARNs in the launch template.</p>
			        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
         <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": "*",
      "Condition": <span>{</span>
         "ArnLike": <span>{</span>
             "ec2:LaunchTemplate": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*" 
          },
          "Bool": <span>{</span>
             "ec2:IsLaunchTemplateResource": "true"
          }
       }
    }
  ]
}</code></pre>
			        <p>The following example policy allows user to launch instances, but only if they use
                a launch template. Users cannot override the subnet and network interface parameters
                in the request; these parameters can only be specified in the launch template. The
                first part of the statement uses the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_notresource.html">NotResource</a> element to allow all other resources except subnets and
                network interfaces. The second part of the statement allows the subnet and network
                interface resources, but only if they are sourced from the launch template.</p>
			        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
        <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "NotResource": ["arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
                      "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*" ],
      "Condition": <span>{</span>
         "ArnLike": <span>{</span>
             "ec2:LaunchTemplate": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*" 
          }
       }
    },
   <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": ["arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:subnet/*",
                   "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:network-interface/*" ],
      "Condition": <span>{</span>
         "ArnLike": <span>{</span>
             "ec2:LaunchTemplate": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*" 
          },
          "Bool": <span>{</span>
             "ec2:IsLaunchTemplateResource": "true"
          }
       }
    }
  ]
}</code></pre>
                <p>The following example allows users to launch instances only if they use a
                    launch template, and only if the launch template has the tag
                        <code class="code">Purpose=Webservers</code>. Users cannot override any of the launch
                    template parameters in the <code class="code">RunInstances</code> action.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17", 
  "Statement": [
        <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "NotResource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*",
      "Condition": <span>{</span>
         "ArnLike": <span>{</span>
             "ec2:LaunchTemplate": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*" 
          },
         "Bool": <span>{</span>
             "ec2:IsLaunchTemplateResource": "true"
          }
       }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:RunInstances",
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*",
      "Condition": <span>{</span>
       "StringEquals": <span>{</span>
           "aws:ResourceTag/Purpose": "Webservers" 
        }
       }
     }
  ]
}</code></pre>
			 
			 
        <h2 id="iam-example-spot-instances">Work with Spot Instances</h2>
        <p>You can use the RunInstances action to create Spot Instance requests, and tag the Spot Instance requests
            on create. The resource to specify for RunInstances is
                <code class="code">spot-instances-request</code>.</p>
        <p>The <code class="code">spot-instances-request</code> resource is evaluated in the IAM policy as
            follows:</p>
      <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>If you don't tag a Spot Instance request on create, Amazon EC2 does not evaluate the
                        <code class="code">spot-instances-request</code> resource in the RunInstances
                    statement.</p>
            </li><li class="listitem">
                <p>If you tag a Spot Instance request on create, Amazon EC2 evaluates the
                        <code class="code">spot-instances-request</code> resource in the RunInstances
                    statement.</p>
            </li></ul></div>
      <p>Therefore, for the <code class="code">spot-instances-request</code> resource, the following rules
            apply to the IAM policy:</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>If you use RunInstances to create a Spot Instance request and you don't intend to tag
                    the Spot Instance request on create, you dont need to explicitly allow the
                        <code class="code">spot-instances-request</code> resource; the call will succeed.</p>
            </li><li class="listitem">
                <p>If you use RunInstances to create a Spot Instance request and intend to tag the Spot Instance
                    request on create, you must include the <code class="code">spot-instances-request</code>
                    resource in the RunInstances allow statement, otherwise the call will
                    fail.</p>
            </li><li class="listitem">
                <p>If you use RunInstances to create a Spot Instance request and intend to tag the Spot Instance
                    request on create, you must specify the <code class="code">spot-instances-request</code>
                    resource or <code class="code">*</code> wildcard in the CreateTags allow statement, otherwise
                    the call will fail. </p>
            </li></ul></div>
        <p>You can request Spot Instances using RunInstances or RequestSpotInstances. The following
            example IAM policies apply only when requesting Spot Instances using RunInstances.</p>
        <p><b>Example: Request Spot Instances using RunInstances</b></p>
        <p>The following policy allows users to request Spot Instances by using the RunInstances action.
            The <code class="code">spot-instances-request</code> resource, which is created by RunInstances,
            requests Spot Instances.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>To use RunInstances to create Spot Instance requests, you can omit
                    <code class="code">spot-instances-request</code> from the <code class="code">Resource</code> list if you
                do not intend to tag the Spot Instance requests on create. This is because Amazon EC2 does not
                evaluate the <code class="code">spot-instances-request</code> resource in the RunInstances
                statement if the Spot Instance request is not tagged on create.</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*",
                "arn:aws:ec2:us-east-1:*:spot-instances-request/*"
            ]
        }
    ]
}</code></pre>
      
      <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p><b>NOT SUPPORTED  Example: Deny users permission to request Spot Instances
                using RunInstances</b></p><p>The following policy is not supported for the <code class="code">spot-instances-request</code>
                resource.</p><p>The following policy is meant to give users the permission to launch On-Demand Instances, but deny
                users the permission to request Spot Instances. The <code class="code">spot-instances-request</code>
                resource, which is created by RunInstances, is the resource that requests Spot Instances. The
                second statement is meant to deny the RunInstances action for the
                    <code class="code">spot-instances-request</code> resource. However, this condition is not
                supported because Amazon EC2 does not evaluate the <code class="code">spot-instances-request</code>
                resource in the RunInstances statement if the Spot Instance request is not tagged on
                create.</p><pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*"
            ]
        },
        <span>{</span>
            "Sid": "DenySpotInstancesRequests - NOT SUPPORTED - DO NOT USE!",
            "Effect": "Deny",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:us-east-1:*:spot-instances-request/*"
        }
    ]
}</code></pre></div></div>
      
        <p><b>Example: Tag Spot Instance requests on create</b></p>
        <p>The following policy allows users to tag all resources that are created during
            instance launch. The first statement allows RunInstances to create the listed resources.
            The <code class="code">spot-instances-request</code> resource, which is created by RunInstances, is
            the resource that requests Spot Instances. The second statement provides a <code class="code">*</code>
            wildcard to allow all resources to be tagged when they are created at instance
            launch.</p>
      <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If you tag a Spot Instance request on create, Amazon EC2 evaluates the
                    <code class="code">spot-instances-request</code> resource in the RunInstances statement.
                Therefore, you must explicitly allow the <code class="code">spot-instances-request</code>
                resource for the RunInstances action, otherwise the call will fail.</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*",
                "arn:aws:ec2:us-east-1:*:spot-instances-request/*"
            ]
        },
        <span>{</span>
            "Sid": "TagResources",
            "Effect": "Allow",
            "Action": "ec2:CreateTags",
            "Resource": "*"
        }
    ]
}</code></pre>
      
        <p><b>Example: Deny tag on create for Spot Instance requests</b></p>
        <p>The following policy denies users the permission to tag the resources that are created
            during instance launch.</p>
        <p>The first statement allows RunInstances to create the listed resources. The
                <code class="code">spot-instances-request</code> resource, which is created by RunInstances, is
            the resource that requests Spot Instances. The second statement provides a <code class="code">*</code>
            wildcard to deny all resources being tagged when they are created at instance launch. If
                <code class="code">spot-instances-request</code> or any other resource is tagged on create, the
            RunInstances call will fail.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*",
                "arn:aws:ec2:us-east-1:*:spot-instances-request/*"
            ]
        },
        <span>{</span>
            "Sid": "DenyTagResources",
            "Effect": "Deny",
            "Action": "ec2:CreateTags",
            "Resource": "*"
        }
    ]
}</code></pre>
      
      <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p><b>NOT SUPPORTED  Example: Allow creating a Spot Instance request
                    only if it is assigned a specific tag</b></p><p>The following policy is not supported for the <code class="code">spot-instances-request</code>
                resource.</p><p>The following policy is meant to grant RunInstances the permission to create a Spot Instance
                request only if the request is tagged with a specific tag. </p><p>The first statement allows RunInstances to create the listed resources.</p><p>The second statement is meant to grant users the permission to create a Spot Instance request
                only if the request has the tag <code class="code">environment=production</code>. If this
                condition is applied to other resources created by RunInstances, specifying no tags
                results in an <code class="code">Unauthenticated</code> error. However, if no tags are specified
                for the Spot Instance request, Amazon EC2 does not evaluate the
                    <code class="code">spot-instances-request</code> resource in the RunInstances statement,
                which results in non-tagged Spot Instance requests being created by RunInstances.</p><p>Note that specifying another tag other than <code class="code">environment=production</code>
                results in an <code class="code">Unauthenticated</code> error, because if a user tags a Spot Instance
                request, Amazon EC2 evaluates the <code class="code">spot-instances-request</code> resource in the
                RunInstances statement.</p><pre class="programlisting"><div class="code-btn-container"></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*"
            ]
        },
        <span>{</span>
            "Sid": "RequestSpotInstancesOnlyIfTagIs_environment=production - NOT SUPPORTED - DO NOT USE!",
            "Effect": "Allow",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:us-east-1:*:spot-instances-request/*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestTag/environment": "production"
                }
            }
        },
        <span>{</span>
            "Sid": "TagResources",
            "Effect": "Allow",
            "Action": "ec2:CreateTags",
            "Resource": "*"
        }

    ]
}</code></pre></div></div>
      
        <p><b>Example: Deny creating a Spot Instance request if it is assigned a
                    specific tag</b></p>
            <p>The following policy denies RunInstances the permission to create a Spot Instance request
            if the request is tagged with <code class="code">environment=production</code>. </p>
            <p>The first statement allows RunInstances to create the listed resources.</p>
            <p>The second statement denies users the permission to create a Spot Instance request if the
            request has the tag <code class="code">environment=production</code>. Specifying
                <code class="code">environment=production</code> as a tag results in an
                <code class="code">Unauthenticated</code> error. Specifying other tags or specifying no tags will
            result in the creation of a  Spot Instance request.</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AllowRun",
            "Effect": "Allow",
            "Action": [
                "ec2:RunInstances"
            ],
            "Resource": [
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:*:subnet/*",
                "arn:aws:ec2:us-east-1:*:network-interface/*",
                "arn:aws:ec2:us-east-1:*:security-group/*",
                "arn:aws:ec2:us-east-1:*:key-pair/*",
                "arn:aws:ec2:us-east-1:*:volume/*",
                "arn:aws:ec2:us-east-1:*:instance/*",
                "arn:aws:ec2:us-east-1:*:spot-instances-request/*"
            ]
        },
        <span>{</span>
            "Sid": "DenySpotInstancesRequests",
            "Effect": "Deny",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:us-east-1:*:spot-instances-request/*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestTag/environment": "production"
                }
            }
        },
        <span>{</span>
            "Sid": "TagResources",
            "Effect": "Allow",
            "Action": "ec2:CreateTags",
            "Resource": "*"
        }
    ]
}</code></pre>
      
     
				<h2 id="iam-example-reservedinstances">Example: Work with Reserved Instances</h2>
				
				<p>The following policy gives users permission to view, modify, and purchase Reserved Instances in your
            account.</p>
				<p>It is not possible to set resource-level permissions for individual Reserved Instances. This policy
            means that users have access to all the Reserved Instances in the account.</p>
				<p>The <code class="code">Resource</code> element uses a * wildcard to indicate that users can specify all
            resources with the action; in this case, they can list and modify all Reserved Instances in the
            account. They can also purchase Reserved Instances using the account credentials. The * wildcard is
            also necessary in cases where the API action does not support resource-level
            permissions.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version": "2012-10-17",
   "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeReservedInstances", 
        "ec2:ModifyReservedInstances",
        "ec2:PurchaseReservedInstancesOffering", 
        "ec2:DescribeAvailabilityZones",
        "ec2:DescribeReservedInstancesOfferings"
      ],
      "Resource": "*"
    }
   ]
}</code></pre>
				<p>To allow users to view and modify the Reserved Instances in your account, but not purchase new
            Reserved Instances.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
   "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeReservedInstances", 
        "ec2:ModifyReservedInstances",
        "ec2:DescribeAvailabilityZones"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
			 
				<h2 id="iam-example-taggingresources">Example: Tag resources</h2>

				<p>The following policy allows users to use the <code class="code">CreateTags</code> action to
					apply tags to an instance only if the tag contains the key<code class="code">environment</code> 
				    and the value <code class="code">production</code>. No other tags are allowe and the user cannot 
				    tag any other resource types.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">
<span>{</span>
    "Version": "2012-10-17",
    "Statement": [
              <span>{</span>
            "Effect": "Allow",
            "Action": [
                "ec2:CreateTags"
            ],
            "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestTag/environment": "production"
                }
            }
        }
    ]
}</code></pre>
				<p>The following policy allows users to tag any taggable resource that already has a tag with
            a key of <code class="code">owner</code> and a value of the username. In addition, users must specify
            a tag with a key of <code class="code">anycompany:environment-type</code> and a value of either
                <code class="code">test</code> or <code class="code">prod</code> in the request. Users can specify additional
            tags in the request.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
               <span>{</span>
            "Effect": "Allow",
            "Action": [
                "ec2:CreateTags"
            ],
            "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:*/*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestTag/anycompany:environment-type": ["test","prod"],
                    "aws:ResourceTag/owner": "$<span>{</span>aws:username}"
                } 
            }
        }
    ]
}</code></pre>
				<p>You can create an IAM policy that allows users to delete specific tags for a
					resource. For example, the following policy allows users to delete tags for a
					volume if the tag keys specified in the request are <code class="code">environment</code> or
						<code class="code">cost-center</code>. Any value can be specified for the tag but the tag
					key must match either of the specified keys.</p>
				<div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If you delete a resource, all tags associated with the resource are also deleted. Users
                do not need permissions to use the <code class="code">ec2:DeleteTags</code> action to delete a
                resource that has tags; they only need permissions to perform the deleting
                action.</p></div></div>

				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
       <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:DeleteTags",
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:volume/*",
      "Condition": <span>{</span>
        "ForAllValues:StringEquals": <span>{</span>
          "aws:TagKeys": ["environment","cost-center"]
        }
      }
    }
  ]
}</code></pre>

				<p>This policy allows users to delete only the <code class="code">environment=prod</code> tag on any
            resource, and only if the resource is already tagged with a key of <code class="code">owner</code>
            and a value of the username. Users can't delete any other tags for a resource.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
      <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DeleteTags"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:*/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:RequestTag/environment": "prod",
          "aws:ResourceTag/owner": "$<span>{</span>aws:username}"
        },
        "ForAllValues:StringEquals": <span>{</span>
          "aws:TagKeys": ["environment"]
        }
      }
    }
  ]
}</code></pre>
			 
				<h2 id="iam-example-iam-roles">Example: Work with IAM roles</h2>

				<p>The following policy allows users to attach, replace, and detach an IAM role
					to instances that have the tag <code class="code">department=test</code>. Replacing or
					detaching an IAM role requires an association ID, therefore the policy also
					grants users permission to use the
						<code class="code">ec2:DescribeIamInstanceProfileAssociations</code> action. </p>
				<p>Users must have permission to use the <code class="code">iam:PassRole</code> action in order to pass
            the role to the instance. </p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:AssociateIamInstanceProfile",
        "ec2:ReplaceIamInstanceProfileAssociation",
        "ec2:DisassociateIamInstanceProfile"
      ],
      "Resource": "arn:aws:ec2:us-east-1:<code class="replaceable">account-id</code>:instance/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:ResourceTag/department":"test"
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": "ec2:DescribeIamInstanceProfileAssociations",
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "arn:aws:iam::<code class="replaceable">account-id</code>:role/DevTeam*"
    }
  ]
}</code></pre>
				<p>The following policy allows users to attach or replace an IAM role for any
					instance. Users can only attach or replace IAM roles with names that begin
					with <code class="code">TestRole-</code>. For the <code class="code">iam:PassRole</code> action, ensure
					that you specify the name of the IAM role and not the instance profile (if the
					names are different). For more information, see <a href="./iam-roles-for-amazon-ec2.html#ec2-instance-profile">Instance profiles</a>.</p>
				<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "ec2:AssociateIamInstanceProfile",
                "ec2:ReplaceIamInstanceProfileAssociation"
            ],
            "Resource": "*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "ec2:DescribeIamInstanceProfileAssociations",
            "Resource": "*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "iam:PassRole",
            "Resource": "arn:aws:iam::<code class="replaceable">account-id</code>:role/TestRole-*"
        }
    ]
}</code></pre>
			 
		        <h2 id="iam-example-route-tables">Example: Work with route tables</h2>
		        
		        <p>The following policy allows users to add, remove, and replace routes for route
                    tables that are associated with VPC <code class="code">vpc-ec43eb89</code> only. To specify a
                    VPC for the <code class="code">ec2:Vpc</code> condition key, you must specify the full ARN of
                    the VPC.</p>
		        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
              <span>{</span>
            "Effect": "Allow",
            "Action": [
                "ec2:DeleteRoute",
                "ec2:CreateRoute",
                "ec2:ReplaceRoute"
            ],
            "Resource": [
                "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:route-table/*"
            ],
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "ec2:Vpc": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:vpc/vpc-ec43eb89"
                }
            }
        }
    ]
}</code></pre>
		     
		        <h2 id="iam-example-source-instance">Example: Allow a specific instance to view
                resources in other AWS services</h2>
		        <p>The following is an example of a policy that you might attach to an IAM role. The
            policy allows an instance to view resources in various AWS services. It uses the
                <code class="code">ec2:SourceInstanceARN</code> condition key to specify that the instance from
            which the request is made must be instance <code class="code">i-093452212644b0dd6</code>. If the same
            IAM role is associated with another instance, the other instance cannot perform any of
            these actions.</p>
                <p>The <code class="code">ec2:SourceInstanceARN</code> key is an AWS global condition key,
            therefore it can be used for other service actions, not just Amazon EC2.</p>
		        
		        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
              <span>{</span>
            "Effect": "Allow",
            "Action": [
                "ec2:DescribeVolumes",
                "s3:ListAllMyBuckets",
                "dynamodb:ListTables",
                "rds:DescribeDBInstances"
            ],
            "Resource": [
                "*"
            ],
            "Condition": <span>{</span>
                "ArnEquals": <span>{</span>
                    "ec2:SourceInstanceARN": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:instance/i-093452212644b0dd6"
                }
            }
        }
    ]
}</code></pre>
		     
		        <h2 id="iam-example-launch-templates">Example: Work with launch
                templates</h2>
		        <p>The following policy allows users to create a launch template version and modify a
                    launch template, but only for a specific launch template
                        (<code class="code">lt-<code class="replaceable">09477bcd97b0d3abc</code></code>). Users cannot work with other launch
                    templates.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
   <span>{</span>
      "Action": [
        "ec2:CreateLaunchTemplateVersion",
        "ec2:ModifyLaunchTemplate"
      ],
      "Effect": "Allow",
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/lt-<code class="replaceable">09477bcd97b0d3abc</code>"
    }
  ]
}</code></pre>
                <p>The following policy allows users to delete any launch template and launch
            template version, provided that the launch template has the tag
                <code class="code">Purpose</code>=<code class="code">Testing</code>.</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
       <span>{</span>
      "Action": [
        "ec2:DeleteLaunchTemplate",
        "ec2:DeleteLaunchTemplateVersions"
      ],
      "Effect": "Allow",
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account-id</code>:launch-template/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:ResourceTag/Purpose": "Testing"
        }
      }
    }
  ]
}</code></pre>
		     
    <h2 id="iam-example-instance-metadata">Work with instance metadata</h2>
    <p>The following policies ensure that users can only retrieve <a href="./ec2-instance-metadata.html">instance metadata</a> using Instance Metadata Service Version 2
      (IMDSv2). You can combine the following four policies into one policy with four
      statements. When combined as one policy, you can use the policy as a service control policy
      (SCP). It can work equally well as a <em>deny</em> policy that you
      apply to an existing IAM policy (taking away and limiting existing permission), or as an SCP
      that is applied globally across an account, an organizational unit (OU), or an entire
      organization.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The following RunInstances metadata options policies must be used in conjunction with a
        policy that gives the principal permissions to launch an instance with RunInstances. If the
        principal does not also have RunInstances permissions, it will not be able to launch an
        instance. For more information, see the policies in <a href="#iam-example-instances">Work with instances</a> and <a href="#iam-example-runinstances">Launch instances (RunInstances)</a>.</p></div></div>
    
    <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>If you use Auto Scaling groups and you need to require the use of IMDSv2 on all new
        instances, your Auto Scaling groups must use <em>launch
        templates</em>.</p><p>When an Auto Scaling group uses a launch template, the <code class="code">ec2:RunInstances</code> permissions
        of the IAM principal are checked when a new Auto Scaling group is created. They are also checked
        when an existing Auto Scaling group is updated to use a new launch template or a new version of a
        launch template.</p><p>Restrictions
        on the use of IMDSv1 on IAM principals for <code class="code">RunInstances</code> are only
        checked when an Auto Scaling group that is using a launch template, is created or updated. For an
        Auto Scaling group that is configured to use the <code class="code">Latest</code> or <code class="code">Default</code> launch
        template, the permissions are not checked when a new version of the launch template is
        created. For permissions to be checked, you must configure the Auto Scaling group to use a <em>specific version</em> of the launch template.</p><div class="orderedlist">
        <h6>To enforce the use of IMDSv2 on instances launched by Auto Scaling groups, the
          following additional steps are required:</h6>
         
         
         
         
         
      <ol><li>
          <p>Disable the use of launch configurations for all accounts in your organization by
            using either service control policies (SCPs) or IAM permissions boundaries for new
            principals that are created. For existing IAM principals with Auto Scaling group permissions,
            update their associated policies with this condition key. To disable the use of launch
            configurations, create or modify the relevant SCP, permissions boundary, or IAM policy
            with the <code class="code">"autoscaling:LaunchConfigurationName"</code> condition key with the value
            specified as <code class="code">null</code>.</p>
        </li><li>
          <p>For new launch templates, configure the instance metadata options in the launch
            template. For existing launch templates, create a new version of the launch template and
            configure the instance metadata options in the new version.</p>
        </li><li>
          <p>In the policy that gives any principal the permission to use a launch template,
            restrict association of <code class="code">$latest</code> and <code class="code">$default</code> by specifying
              <code class="code">"autoscaling:LaunchTemplateVersionSpecified": "true"</code>. By restricting the
            use to a specific version of a launch template, you can ensure that new instances will
            be launched using the version in which the instance metadata options are configured. For
            more information, see <a href="https://docs.aws.amazon.com/autoscaling/ec2/APIReference/API_LaunchTemplateSpecification.html">LaunchTemplateSpecification</a> in the <em>Amazon EC2 Auto Scaling API Reference</em>, specifically the <code class="code">Version</code> parameter.</p>
        </li><li>
          <p>For an Auto Scaling group that uses a launch configuration, replace the launch configuration
            with a launch template. For more information, see <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/replace-launch-config.html">Replacing a Launch
              Configuration with a Launch Template</a> in the <em>Amazon EC2 Auto Scaling User Guide</em>.</p>
        </li><li>
          <p>For an Auto Scaling group that uses a launch template, make sure that it uses a new launch
            template with the instance metadata options configured, or uses a new version of the
            current launch template with the instance metadata options configured. For more
            information, see <a href="https://docs.aws.amazon.com/cli/latest/reference/autoscaling/update-auto-scaling-group.html">update-auto-scaling-group </a> in the <em>AWS CLI Command Reference</em>.</p>
        </li></ol></div></div></div>
    
    <div class="highlights" id="inline-topiclist"><h6>Examples</h6><ul><li><a href="#iam-example-instance-metadata-requireIMDSv2">Require the use of
          IMDSv2</a></li><li><a href="#iam-example-instance-metadata-denyoptoutIMDSv2">Deny opt-out of
                    IMDSv2</a></li><li><a href="#iam-example-instance-metadata-maxHopLimit">Specify maximum hop limit</a></li><li><a href="#iam-example-instance-metadata-limit-modify-IMDS-options">Limit who can modify the
          instance metadata options</a></li><li><a href="#iam-example-instance-metadata-require-roles-to-use-IMDSv2-credentials">Require role
          credentials to be retrieved from IMDSv2</a></li></ul></div>
    
     
      <h3 id="iam-example-instance-metadata-requireIMDSv2">Require the use of
          IMDSv2</h3>
    <p>The following policy specifies that you cant call the RunInstances API unless the
      instance is also opted in to require the use of IMDSv2 (indicated by
        <code class="code">"ec2:MetadataHttpTokens": "required"</code>). If you do not specify that the instance
      requires IMDSv2, you get an <code class="code">UnauthorizedOperation</code> error when you call the
      RunInstances API.</p>
    
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
               <span>{</span>
            "Sid": "RequireImdsV2",
            "Effect": "Deny",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:*:*:instance/*",
            "Condition": <span>{</span>
                "StringNotEquals": <span>{</span>
                    "ec2:MetadataHttpTokens": "required"
                }
            }
        }
    ]
}</code></pre>
     
         
            <h3 id="iam-example-instance-metadata-denyoptoutIMDSv2">Deny opt-out of
                    IMDSv2</h3>
            <p>The following policy specifies that you cannot call the
                    <code class="code">ModifyInstanceMetadataOptions</code> API and allow the option of
                IMDSv1 or IMDSv2. If you call the
                    <code class="code">ModifyInstanceMetadataOptions</code> API, the <code class="code">HttpTokens</code>
                attribute must be set to <code class="code">required</code>. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [<span>{</span>
        "Sid": "DenyIMDSv1ConfurationModification",
        "Effect": "Deny",
        "Action": "ec2:ModifyInstanceMetadataOptions",
        "Resource": "arn:aws:ec2:*:*:instance/*",
        "Condition": <span>{</span>
            "StringEquals": <span>{</span>
                "ec2:Attribute": "HttpTokens"
            },
            "StringNotEquals": <span>{</span>
                "ec2:Attribute/HttpTokens": "required"
            }
        }
    }]
}</code></pre>
         
    
     
      <h3 id="iam-example-instance-metadata-maxHopLimit">Specify maximum hop limit</h3>
    <p>The following policy specifies that you cant call the RunInstances API unless you also
      specify a hop limit, and the hop limit cant be more than 3. If you fail to do that, you get
      an <code class="code">UnauthorizedOperation</code> error when you call the RunInstances API.</p>

    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
               <span>{</span>
            "Sid": "MaxImdsHopLimit",
            "Effect": "Deny",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:*:*:instance/*",
            "Condition": <span>{</span>
                "NumericGreaterThan": <span>{</span>
                    "ec2:MetadataHttpPutResponseHopLimit": "3"
                }
            }
        }
    ]
}</code></pre>
     
    
     
      <h3 id="iam-example-instance-metadata-limit-modify-IMDS-options">Limit who can modify the
          instance metadata options</h3>
    <p>The following policy permits only users with the role <code class="code">ec2-imds-admins</code> to make
                changes to the instance metadata options. If any principal other than the
                    <code class="code">ec2-imds-admins</code> role tries to call the
                ModifyInstanceMetadataOptions API, it will get an <code class="code">UnauthorizedOperation</code>
                error. This statement could be used to control the use of the
                ModifyInstanceMetadataOptions API; there are currently no fine-grained access
                controls (conditions) for the ModifyInstanceMetadataOptions API.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
               <span>{</span>
            "Sid": "AllowOnlyImdsAdminsToModifySettings",
            "Effect": "Deny",
            "Action": "ec2:ModifyInstanceMetadataOptions",
            "Resource": "*",
            "Condition": <span>{</span>
                "StringNotLike": <span>{</span>
                    "aws:PrincipalARN": "arn:aws:iam::*:role/ec2-imds-admins"
                }
            }
        }
    ]
}</code></pre>
     
    
     
      <h3 id="iam-example-instance-metadata-require-roles-to-use-IMDSv2-credentials">Require role
          credentials to be retrieved from IMDSv2</h3>
    <p>The following policy specifies that if this policy is applied to a role, and the role is
      assumed by the EC2 service and the resulting credentials are used to sign a request, then the
      request must be signed by EC2 role credentials retrieved from IMDSv2. Otherwise, all
      of its API calls will get an <code class="code">UnauthorizedOperation</code> error. This statement/policy
      can be applied generally because, if the request is not signed by EC2 role credentials, it has
      no effect.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
               <span>{</span>
            "Sid": "RequireAllEc2RolesToUseV2",
            "Effect": "Deny",
            "Action": "*",
            "Resource": "*",
            "Condition": <span>{</span>
                "NumericLessThan": <span>{</span>
                    "ec2:RoleDelivery": "2.0"
                }
            }
        }
    ]
}</code></pre>
   

  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./control-access-with-tags.html">Control access to EC2 resources using
					resource tags</div><div id="next" class="next-link" accesskey="n" href="./iam-policies-ec2-console.html">Example policies for the console</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>