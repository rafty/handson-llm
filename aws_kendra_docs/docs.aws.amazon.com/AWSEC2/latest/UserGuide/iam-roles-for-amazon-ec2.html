<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>IAM roles for Amazon EC2 - Amazon Elastic Compute Cloud</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="iam-roles-for-amazon-ec2" /><meta name="default_state" content="iam-roles-for-amazon-ec2" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" /><meta name="description" content="Allow applications to make secure API requests by creating IAM roles and assigning them to your EC2 instances." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Elastic Compute Cloud" /><meta name="guide" content="User Guide for Linux Instances" /><meta name="abstract" content="Use Amazon EC2 to configure, launch, and manage virtual servers in the AWS cloud." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" hreflang="x-default" /><meta name="feedback-item" content="EC2" /><meta name="this_doc_product" content="Amazon Elastic Compute Cloud" /><meta name="this_doc_guide" content="User Guide for Linux Instances" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'ec2'}"></script><meta id="panorama-serviceSubSection" value="User Guide for Linux Instances" /><meta id="panorama-serviceConsolePage" value="IAM roles for Amazon EC2" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>IAM roles for Amazon EC2 - Amazon Elastic Compute Cloud</title><meta name="pdf" content="/pdfs/AWSEC2/latest/UserGuide/ec2-ug.pdf#iam-roles-for-amazon-ec2" /><meta name="github" content="https://github.com/awsdocs/amazon-ec2-user-guide/tree/master/doc_source/iam-roles-for-amazon-ec2.md" /><meta name="rss" content="amazon-ec2-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=30" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" /><meta name="keywords" content="EC2,Amazon EC2,EC2 instance,instance,VM,virtual machine" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon EC2",
        "item" : "https://docs.aws.amazon.com/ec2/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide for Linux Instances",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Security in Amazon EC2",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Identity and access management for Amazon EC2",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-iam.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "IAM roles for Amazon EC2",
        "item" : "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-iam.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/AWSEC2/latest/UserGuide/ec2-ug.pdf#iam-roles-for-amazon-ec2" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/amazon-ec2-user-guide/tree/master/doc_source/iam-roles-for-amazon-ec2.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/ec2/index.html">Amazon EC2</a><a href="concepts.html">User Guide for Linux Instances</a></div><div id="page-toc-src"><a href="#ec2-instance-profile">Instance profiles</a><a href="#instance-metadata-security-credentials">Retrieve security
					credentials from instance metadata</a><a href="#permission-to-pass-iam-roles">Grant a user permission to pass an IAM role to
					an instance</a><a href="#working-with-iam-roles">Work with IAM roles</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="iam-roles-for-amazon-ec2">IAM roles for Amazon EC2</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Applications must sign their API requests with AWS credentials. Therefore, if you
			are an application developer, you need a strategy for managing credentials for your
			applications that run on EC2 instances. For example, you can securely distribute your
			AWS credentials to the instances, enabling the applications on those instances to use
			your credentials to sign requests, while protecting your credentials from other users.
			However, it's challenging to securely distribute credentials to each instance,
			especially those that AWS creates on your behalf, such as Spot Instances or instances
			in Auto Scaling groups. You must also be able to update the credentials on each instance when
			you rotate your AWS credentials.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>For your Amazon EC2 workloads, we recommend that you retrieve session credentials using 
				the method described below. These credentials should enable your workload to make 
				AWS API requests, without needing to use <code class="code">sts:AssumeRole</code> to assume the 
				same role that is already associated with the instance. Unless you need to pass session 
				tags for attribute-based access control (ABAC) or pass a session policy to further 
				restrict permissions of the role, such role assumption calls are unnecessary as they 
				create a new set of the same temporary role session credentials.</p><p>If your workload uses a role to assume itself, you must create a trust policy that 
				explicitly allows that role to assume itself. If you do not create the trust policy, 
				you get the <code class="code">AccessDenied</code> error. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/roles-managingrole-editing-console.html#roles-managingrole_edit-trust-policy">
					Modifying a role trust policy</a> in the <em>IAM User Guide</em>.</p></div></div><p>We designed IAM roles so that your applications can securely make API requests from
			your instances, without requiring you to manage the security credentials that the
			applications use. Instead of creating and distributing your AWS credentials, you can
			delegate permission to make API requests using IAM roles as follows:</p><div class="orderedlist">
			 
			 
			 
			 
			 
		<ol><li>
				<p>Create an IAM role.</p>
			</li><li>
				<p>Define which accounts or AWS services can assume the role.</p>
			</li><li>
				<p>Define which API actions and resources the application can use after assuming
					the role.</p>
			</li><li>
				<p>Specify the role when you launch your instance, or attach the role to an
					existing instance.</p>
			</li><li>
				<p>Have the application retrieve a set of temporary credentials and use
					them.</p>
			</li></ol></div><p>For example, you can use IAM roles to grant permissions to applications running on your
			instances that need to use a bucket in Amazon S3. You can specify permissions for IAM roles
			by creating a policy in JSON format. These are similar to the policies that you create
			for users. If you change a role, the change is propagated to all instances.</p><p>When creating IAM roles, associate least privilege IAM policies that
			restrict access to the specific API calls the application requires.</p><p>You can only attach one IAM role to an instance, but you can attach the same role to
			many instances. For more information about creating and using IAM roles, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/WorkingWithRoles.html">Roles</a> in the
				<em>IAM User Guide</em>.</p><p>You can apply resource-level permissions to your IAM policies to control the users'
			ability to attach, replace, or detach IAM roles for an instance. For more information,
			see <a href="./iam-policy-structure.html#ec2-supported-iam-actions-resources">Supported resource-level
						permissions for Amazon EC2 API actions</a> and the following example:
				<a href="./ExamplePolicies_EC2.html#iam-example-iam-roles">Example: Work with IAM roles</a>.</p><div class="highlights" id="inline-topiclist"><h6>Contents</h6><ul><li><a href="#ec2-instance-profile">Instance profiles</a></li><li><a href="#instance-metadata-security-credentials">Retrieve security
					credentials from instance metadata</a></li><li><a href="#permission-to-pass-iam-roles">Grant a user permission to pass an IAM role to
					an instance</a></li><li><a href="#working-with-iam-roles">Work with IAM roles</a></li></ul></div>
			<h2 id="ec2-instance-profile">Instance profiles</h2>

			<p>Amazon EC2 uses an <em>instance profile</em> as a container for an IAM
				role. When you create an IAM role using the IAM console, the console creates an
				instance profile automatically and gives it the same name as the role to which it
				corresponds. If you use the Amazon EC2 console to launch an instance with an IAM role
				or to attach an IAM role to an instance, you choose the role based on a list of
				instance profile names. </p>
			<p>If you use the AWS CLI, API, or an AWS SDK to create a role, you create the role
				and instance profile as separate actions, with potentially different names. If you
				then use the AWS CLI, API, or an AWS SDK to launch an instance with an IAM role or
				to attach an IAM role to an instance, specify the instance profile name. </p>
			<p>An instance profile can contain only one IAM role. This limit cannot be
				increased.</p>
			<p>For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/instance-profiles.html">Instance Profiles</a> in the <em>IAM User Guide</em>.</p>
		 
			<h2 id="instance-metadata-security-credentials">Retrieve security
					credentials from instance metadata</h2>

			<p>An application on the instance retrieves the security credentials provided by the
				role from the instance metadata item
					<code class="code">iam/security-credentials/</code><em>role-name</em>. The
				application is granted the permissions for the actions and resources that you've
				defined for the role through the security credentials associated with the role.
				These security credentials are temporary and we rotate them automatically. We make
				new credentials available at least five minutes before the expiration of the old
				credentials.</p>
			<div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p>If you use services that use instance metadata with IAM roles, ensure that
					you don't expose your credentials when the services make HTTP calls on your
					behalf. The types of services that could expose your credentials include HTTP
					proxies, HTML/CSS validator services, and XML processors that support XML
					inclusion.</p></div></div>
			<p>The following command retrieves the security credentials for an IAM role named
					<code class="code">s3access</code>.</p>

			<awsdocs-tabs><dl style="display: none">
				<dt>IMDSv2</dt><dd tab-id="imdsv2">
						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><code class="userinput">TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"` \
&amp;&amp; curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/iam/security-credentials/s3access</code></code></pre>
						
						
					</dd>
				<dt>IMDSv1</dt><dd tab-id="imdsv1">
						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><code class="userinput">curl http://169.254.169.254/latest/meta-data/iam/security-credentials/s3access</code></code></pre>
						
					</dd>
			</dl></awsdocs-tabs>

			<p>The following is example output.</p>
			<pre class="programlisting"><div class="code-btn-container"></div><code class="json "><span>{</span>
  "Code" : "Success",
  "LastUpdated" : "2012-04-26T16:39:16Z",
  "Type" : "AWS-HMAC",
  "AccessKeyId" : "ASIAIOSFODNN7EXAMPLE",
  "SecretAccessKey" : "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
  "Token" : "<em>token</em>",
  "Expiration" : "2017-05-17T15:09:54Z"
}</code></pre>
			<p>For applications, AWS CLI, and Tools for Windows PowerShell commands that run on the instance, you do not
				have to explicitly get the temporary security credentials—the AWS SDKs,
				AWS CLI, and Tools for Windows PowerShell automatically get the credentials from the EC2 instance metadata
				service and use them. To make a call outside of the instance using temporary
				security credentials (for example, to test IAM policies), you must provide the
				access key, secret key, and the session token. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html">Using Temporary
					Security Credentials to Request Access to AWS Resources</a> in the
					<em>IAM User Guide</em>.</p>
			<p>For more information about instance metadata, see <a href="./ec2-instance-metadata.html">Instance metadata and user data</a>. For
				information about the instance metadata IP address, see <a href="./instancedata-data-retrieval.html">Retrieve instance metadata</a>.</p>
		 
			<h2 id="permission-to-pass-iam-roles">Grant a user permission to pass an IAM role to
					an instance</h2>

			<p>To enable a user to launch an instance with an IAM role or to attach or replace an IAM
				role for an existing instance, you must grant the user permission to use the
				following API actions:</p>
			<div class="itemizedlist">
				 
				 
				 
			<ul class="itemizedlist"><li class="listitem">
					<p><code class="code">iam:PassRole</code></p>
				</li><li class="listitem">
					<p><code class="code">ec2:AssociateIamInstanceProfile</code>
					</p>
				</li><li class="listitem">
					<p><code class="code">ec2:ReplaceIamInstanceProfileAssociation</code></p>
				</li></ul></div>

			<p>For example, the following IAM policy grants users permission to launch
				instances with an IAM role, or to attach or replace an IAM role for an existing
				instance using the AWS CLI.</p>

			<div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>If you want the policy to grant users access to all of your roles, specify the resource as
						<code class="code">*</code> in the policy. However, please consider the principle of
						<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">least privilege</a> as a best-practice .</p></div></div>
			<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
         "ec2:RunInstances",
         "ec2:AssociateIamInstanceProfile",
         "ec2:ReplaceIamInstanceProfileAssociation"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "arn:aws:iam::123456789012:role/DevTeam*"
    }
  ]
}</code></pre>

			<p>To grant users permission to launch instances with an IAM role, or to attach or
				replace an IAM role for an existing instance using the Amazon EC2 console, you must
				grant them permission to use <code class="code">iam:ListInstanceProfiles</code>,
					<code class="code">iam:PassRole</code>, <code class="code">ec2:AssociateIamInstanceProfile</code>, and
					<code class="code">ec2:ReplaceIamInstanceProfileAssociation</code> in addition to any other
				permissions they might need. For example policies, see <a href="./iam-policies-ec2-console.html">Example policies for working in the Amazon EC2
			console</a>.</p>
		 
			<h2 id="working-with-iam-roles">Work with IAM roles</h2>

			<p>You can create an IAM role and attach it to an instance during or after launch.
				You can also replace or detach an IAM role for an instance.</p>
			<div class="highlights" id="inline-topiclist"><h6>Contents</h6><ul><li><a href="#create-iam-role">Create an IAM role</a></li><li><a href="#launch-instance-with-role">Launch an instance with an IAM
						role</a></li><li><a href="#attach-iam-role">Attach an IAM role to an instance</a></li><li><a href="#replace-iam-role">Replace an IAM role</a></li><li><a href="#detach-iam-role">Detach an IAM role</a></li><li><a href="#generate-policy-for-iam-role">Generate a policy for your IAM
						role based on access activity</a></li></ul></div>
			 
				<h3 id="create-iam-role">Create an IAM role</h3>

				<p>You must create an IAM role before you can launch an instance with that role
					or attach it to an instance.</p>
				
				<awsdocs-tabs><dl style="display: none">
					
					<dt>Console</dt><dd tab-id="console">
							<div class="procedure"><a id="create-iam-role-console"></a><h6>To create an IAM role using the
									IAM console</h6><ol><li><p>Open the IAM console at
         <a href="https://console.aws.amazon.com/iam/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/iam/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
									<p>In the navigation pane, choose <b>Roles</b> then choose 
										<b>Create role</b>.</p>
								</li><li>
									<p>On the <b>Select trusted entity</b> page, choose
										<b>AWS service</b>, and then select the 
										<b>EC2</b> use case.
										Choose <b>Next</b>.</p>
								</li><li>
									<p>On the <b>Add permissions</b> page, select the policies 
										that grants your instances access to the resources that they need. 
										Choose <b>Next</b>.</p>
								</li><li>
									<p>On the <b>Name, review, and create</b> page, enter a name 
										and description for the role. Optionally, add tags to the role. Choose 
										<b>Create role</b>.</p>
								</li></ol></div>
						</dd>
					
					<dt>Command line</dt><dd tab-id="command-line">
							<p>The followingexample creates an IAM role with a policy that allows the role to use an Amazon S3
								bucket.</p>
							<div class="procedure"><a id="create-iam-role-cli"></a><h6>To create an IAM role and instance
									profile (AWS CLI)</h6><ol><li>
									<p>Create the following trust policy and save it in a text file named
										<code>ec2-role-trust-policy.json</code>.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span> "Service": "ec2.amazonaws.com"},
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
								</li><li>
									<p>Create the <code class="code">s3access</code> role and specify the trust policy
										that you created using the <a href="https://docs.aws.amazon.com/cli/latest/reference/iam/create-role.html">create-role</a>
										command.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws iam create-role \
    --role-name s3access \
    --assume-role-policy-document file://ec2-role-trust-policy.json</code></pre>
									<p>Example response</p>
									<pre class="programlisting"><div class="code-btn-container"></div><code class="JSON "><span>{</span>
    "Role": <span>{</span>
        "AssumeRolePolicyDocument": <span>{</span>
            "Version": "2012-10-17",
            "Statement": [
                <span>{</span>
                    "Action": "sts:AssumeRole",
                    "Effect": "Allow",
                    "Principal": <span>{</span>
                        "Service": "ec2.amazonaws.com"
                    }
                }
            ]
        },
        "RoleId": "AROAIIZKPBKS2LEXAMPLE",
        "CreateDate": "2013-12-12T23:46:37.247Z",
        "RoleName": "s3access",
        "Path": "/",
        "Arn": "arn:aws:iam::123456789012:role/s3access"
    }
}</code></pre>
								</li><li>
									<p>Create an access policy and save it in a text file named
										<code>ec2-role-access-policy.json</code>. For example, this
										policy grants administrative permissions for Amazon S3 to applications
										running on the instance.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": ["s3:*"],
      "Resource": ["*"]
    }
  ]
}</code></pre>
								</li><li>
									<p>Attach the access policy to the role using the <a href="https://docs.aws.amazon.com/cli/latest/reference/iam/put-role-policy.html">put-role-policy</a>
										command.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws iam put-role-policy \
    --role-name s3access \
    --policy-name S3-Permissions \
    --policy-document file://ec2-role-access-policy.json</code></pre>
								</li><li>
									<p>Create an instance profile named <code class="code">s3access-profile</code> using
										the <a href="https://docs.aws.amazon.com/cli/latest/reference/iam/create-instance-profile.html">create-instance-profile</a> command.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws iam create-instance-profile --instance-profile-name s3access-profile</code></pre>
									<p>Example response</p>
									<pre class="programlisting"><div class="code-btn-container"></div><code class="JSON "><span>{</span>
    "InstanceProfile": <span>{</span>
        "InstanceProfileId": "AIPAJTLBPJLEGREXAMPLE",
        "Roles": [],
        "CreateDate": "2013-12-12T23:53:34.093Z",
        "InstanceProfileName": "s3access-profile",
        "Path": "/",
        "Arn": "arn:aws:iam::123456789012:instance-profile/s3access-profile"
    }
}</code></pre>
								</li><li>
									<p>Add the <code class="code">s3access</code> role to the
										<code class="code">s3access-profile</code> instance profile.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws iam add-role-to-instance-profile \
    --instance-profile-name s3access-profile \
    --role-name s3access</code></pre>
								</li></ol></div>
							
							<p>Alternatively, you can use the following AWS Tools for Windows PowerShell commands:</p>
							<div class="itemizedlist">
								 
								 
								 
							<ul class="itemizedlist"><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/New-IAMRole.html">New-IAMRole</a></p>
								</li><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Register-IAMRolePolicy.html">Register-IAMRolePolicy</a></p>
								</li><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/New-IAMInstanceProfile.html">New-IAMInstanceProfile</a></p>
								</li></ul></div>
						</dd>
				</dl></awsdocs-tabs> 
				

				
			 

			 
				<h3 id="launch-instance-with-role">Launch an instance with an IAM
						role</h3>

				<p>After you've created an IAM role, you can launch an instance, and associate
					that role with the instance during launch.</p>
				<div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>After you create an IAM role, it might take several seconds for the permissions to
						propagate. If your first attempt to launch an instance with a role fails,
						wait a few seconds before trying again. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/RolesTroubleshooting.html">Troubleshooting IAM
							roles</a> in the <em>IAM User Guide</em>.</p></div></div>
				
				<awsdocs-tabs><dl style="display: none">
					<dt>New console</dt><dd tab-id="new-console">
							<div class="procedure"><a id="launch-instance-with-role-console"></a><h6>To launch an instance with
									an IAM role (console)</h6><ol><li>
									<p>Follow the procedure to <a href="./ec2-launch-instance-wizard.html#liw-quickly-launch-instance">launch an instance</a>.</p>
								</li><li>
									<p>Expand <b>Advanced details</b>, and for
										<b>IAM instance profile</b>, select the IAM role that you
										created.</p>
									<div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The <b>IAM instance profile</b> list displays the name of the
											instance profile that you created when you created your IAM role.
											If you created your IAM role using the console, the instance
											profile was created for you and given the same name as the role. If
											you created your IAM role using the AWS CLI, API, or an AWS SDK,
											you may have named your instance profile differently.</p></div></div>
								</li><li>
									<p>Configure any other details that you require for your instance or accept the
										defaults, and select a key pair. For information about the
										fields in the launch instance wizard, see <a href="./ec2-launch-instance-wizard.html#liw-launch-instance-with-defined-parameters">Launch an instance using defined parameters</a>.</p>
								</li><li>
									<p>In the <b>Summary</b> panel, review your instance
										configuration, and then choose <b>Launch
											instance</b>.</p>
								</li><li>
									<p>If you are using the Amazon EC2 API actions in your application, retrieve
										the AWS security credentials made available on the instance and use
										them to sign the requests. The AWS SDK does this for you.</p>
									
									<div class="option container"><div class="optionselector"><span class="optionanchor" id=""><span class="option  selected" data-tab="imdsv2">IMDSv2</span></span><span class="optionanchor" id=""><span class="option " data-tab="imdsv1">IMDSv1</span></span></div><dl><dt>IMDSv2</dt><dd class="selected" data-tab="imdsv2"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><code class="userinput">TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"` \
&amp;&amp; curl -H "X-aws-ec2-metadata-token: $TOKEN" –v http://169.254.169.254/latest/meta-data/iam/security-credentials/<code class="replaceable">role_name</code></code></code></pre></dd><dt>IMDSv1</dt><dd class="" data-tab="imdsv1"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><code class="userinput">curl http://169.254.169.254/latest/meta-data/iam/security-credentials/<code class="replaceable">role_name</code></code></code></pre></dd></dl></div>
									
								</li></ol></div>
						</dd>
					<dt>Old console</dt><dd tab-id="old-console">
							<div class="procedure"><h6>To launch an instance with
						an IAM role (console)</h6><ol><li><p>Open the Amazon EC2 console at
         <a href="https://console.aws.amazon.com/ec2/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/ec2/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
						<p>On the dashboard, choose <b>Launch instance</b>.</p>
					</li><li>
						<p>Select an AMI and instance type and then choose <b>Next:
								Configure Instance Details</b>.</p>
					</li><li>
						<p>On the <b>Configure Instance Details</b> page, for
								<b>IAM role</b>, select the IAM role that you
							created. </p>
						<div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The <b>IAM role</b> list displays the name of the
								instance profile that you created when you created your IAM role.
								If you created your IAM role using the console, the instance
								profile was created for you and given the same name as the role. If
								you created your IAM role using the AWS CLI, API, or an AWS SDK,
								you may have named your instance profile differently. </p></div></div>
					</li><li>
						<p>Configure any other details, then follow the instructions through the
							rest of the wizard, or choose <b>Review and Launch</b> to
							accept default settings and go directly to the <b>Review Instance
								Launch</b> page.</p>
					</li><li>
						<p>Review your settings, then choose <b>Launch</b> to
							choose a key pair and launch your instance.</p>
					</li><li>
						<p>If you are using the Amazon EC2 API actions in your application, retrieve
							the AWS security credentials made available on the instance and use
							them to sign the requests. The AWS SDK does this for you.</p>

						<div class="option container"><div class="optionselector"><span class="optionanchor" id=""><span class="option  selected" data-tab="imdsv2">IMDSv2</span></span><span class="optionanchor" id=""><span class="option " data-tab="imdsv1">IMDSv1</span></span></div><dl><dt>IMDSv2</dt><dd class="selected" data-tab="imdsv2"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><code class="userinput">TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"` \
&amp;&amp; curl -H "X-aws-ec2-metadata-token: $TOKEN" –v http://169.254.169.254/latest/meta-data/iam/security-credentials/<code class="replaceable">role_name</code></code></code></pre></dd><dt>IMDSv1</dt><dd class="" data-tab="imdsv1"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><code class="userinput">curl http://169.254.169.254/latest/meta-data/iam/security-credentials/<code class="replaceable">role_name</code></code></code></pre></dd></dl></div>

					</li></ol></div>
						</dd>
					<dt>Command line</dt><dd tab-id="command-line">
							<p>You can use the AWS CLI to associate a role with an instance
								during launch. You must specify the instance profile in the command.</p>
							<div class="procedure"><a id="launch-instance-with-role-cli"></a><h6>To launch an instance with an
									IAM role (AWS CLI)</h6><ol><li>
									<p>Use the <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/run-instances.html">run-instances</a> command to launch an instance using the
										instance profile. The following example shows how to launch an instance
										with the instance profile. </p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws ec2 run-instances \
    --image-id ami-11aa22bb \
    --iam-instance-profile Name="s3access-profile" \
    --key-name my-key-pair \
    --security-groups my-security-group \
    --subnet-id subnet-1a2b3c4d</code></pre>
									<p>Alternatively, use the <a href="https://docs.aws.amazon.com/powershell/latest/reference/items/New-EC2Instance.html">New-EC2Instance</a> Tools for Windows PowerShell command.</p>
								</li><li>
									<p>If you are using the Amazon EC2 API actions in your application, retrieve
										the AWS security credentials made available on the instance and use
										them to sign the requests. The AWS SDK does this for you.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">curl http://169.254.169.254/latest/meta-data/iam/security-credentials/</code><code class="replaceable">role_name</code></code></pre>
								</li></ol></div>
						</dd>
				</dl></awsdocs-tabs>
				
				
			 
			 
				<h3 id="attach-iam-role">Attach an IAM role to an instance</h3>

				<p>To attach an IAM role to an instance that has no role, the instance can be
					in the <code class="code">stopped</code> or <code class="code">running</code> state.</p>

				<awsdocs-tabs><dl style="display: none">
					
					<dt>Console</dt><dd tab-id="console">
							<div class="procedure"><a id="attach-iam-role-console"></a><h6>To attach an IAM role to
									an instance</h6><ol><li><p>Open the Amazon EC2 console at
         <a href="https://console.aws.amazon.com/ec2/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/ec2/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
									<p>In the navigation pane, choose
											<b>Instances</b>.</p>
								</li><li>
									<p>Select the instance, choose <b>Actions</b>,
											<b>Security</b>, <b>Modify IAM
											role</b>.</p>
								</li><li>
									<p>Select the IAM role to attach to your instance, and
										choose <b>Save</b>.</p>
								</li></ol></div>
						</dd>

					
					
					<dt>Command line</dt><dd tab-id="command-line">
							<div class="procedure"><a id="attach-iam-role-instance-cli"></a><h6>To attach an IAM role to an
									instance (AWS CLI)</h6><ol><li>
									<p>If required, describe your instances to get the ID of the instance to
										which to attach the role.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws ec2 describe-instances</code></pre>
								</li><li>
									<p>Use the <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/associate-iam-instance-profile.html">associate-iam-instance-profile</a> command to attach the IAM
										role to the instance by specifying the instance profile. You can use the
										Amazon Resource Name (ARN) of the instance profile, or you can use its
										name.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws ec2 associate-iam-instance-profile \
    --instance-id <code class="replaceable">i-1234567890abcdef0</code> \
    --iam-instance-profile Name="<code class="replaceable">TestRole-1</code>"</code></pre>
									<p>Example response</p>
									<pre class="programlisting"><div class="code-btn-container"></div><code class="JSON "><span>{</span>
    "IamInstanceProfileAssociation": <span>{</span>
        "InstanceId": "i-1234567890abcdef0", 
        "State": "associating", 
        "AssociationId": "iip-assoc-0dbd8529a48294120", 
        "IamInstanceProfile": <span>{</span>
            "Id": "AIPAJLNLDX3AMYZNWYYAY", 
            "Arn": "arn:aws:iam::123456789012:instance-profile/TestRole-1"
        }
    }
}</code></pre>
								</li></ol></div>
							<p>Alternatively, use the following Tools for Windows PowerShell commands:</p>
							<div class="itemizedlist">
								 
								 
							<ul class="itemizedlist"><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Get-EC2Instance.html">Get-EC2Instance</a></p>
								</li><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Register-EC2IamInstanceProfile.html">Register-EC2IamInstanceProfile</a></p>
								</li></ul></div>
						</dd>
					
				</dl></awsdocs-tabs>

			 

			 
				<h3 id="replace-iam-role">Replace an IAM role</h3>

				<p>To replace the IAM role on an instance that already has an attached IAM
					role, the instance must be in the <code class="code">running</code> state. You can do this if
					you want to change the IAM role for an instance without detaching the existing
					one first. For example, you can do this to ensure that API actions performed by
					applications running on the instance are not interrupted.</p>

				<awsdocs-tabs><dl style="display: none">

					<dt>Console</dt><dd tab-id="console">
							<div class="procedure"><a id="replace-iam-role-console"></a><h6>To replace an IAM role
									for an instance </h6><ol><li><p>Open the Amazon EC2 console at
         <a href="https://console.aws.amazon.com/ec2/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/ec2/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
									<p>In the navigation pane, choose
											<b>Instances</b>.</p>
								</li><li>
									<p>Select the instance, choose <b>Actions</b>,
											<b>Security</b>, <b>Modify IAM
											role</b>.</p>
								</li><li>
									<p>Select the IAM role to attach to your instance, and
										choose <b>Save</b>.</p>
								</li></ol></div>
						</dd>

					
					
					<dt>Command line</dt><dd tab-id="command-line">
							<div class="procedure"><a id="replace-iam-role-cli"></a><h6>To replace an IAM role for an instance
									(AWS CLI)</h6><ol><li>
									<p>If required, describe your IAM instance profile associations to get
										the association ID for the IAM instance profile to replace.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws ec2 describe-iam-instance-profile-associations</code></pre>
								</li><li>
									<p>Use the <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/replace-iam-instance-profile-association.html">replace-iam-instance-profile-association</a> command to replace
										the IAM instance profile by specifying the association ID for the
										existing instance profile and the ARN or name of the instance profile
										that should replace it.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws ec2 replace-iam-instance-profile-association \
    --association-id <code class="replaceable">iip-assoc-0044d817db6c0a4ba</code> \
    --iam-instance-profile Name="<code class="replaceable">TestRole-2</code>"</code></pre>
									<p>Example response</p>
									<pre class="programlisting"><div class="code-btn-container"></div><code class="JSON "><span>{</span>
    "IamInstanceProfileAssociation": <span>{</span>
        "InstanceId": "i-087711ddaf98f9489", 
        "State": "associating", 
        "AssociationId": "iip-assoc-09654be48e33b91e0", 
        "IamInstanceProfile": <span>{</span>
            "Id": "AIPAJCJEDKX7QYHWYK7GS", 
            "Arn": "arn:aws:iam::123456789012:instance-profile/TestRole-2"
        }
    }
}</code></pre>
								</li></ol></div>
							<p>Alternatively, use the following Tools for Windows PowerShell commands:</p>
							<div class="itemizedlist">
								 
								 
							<ul class="itemizedlist"><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Get-EC2IamInstanceProfileAssociation.html">Get-EC2IamInstanceProfileAssociation</a></p>
								</li><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Set-EC2IamInstanceProfileAssociation.html">Set-EC2IamInstanceProfileAssociation</a></p>
								</li></ul></div>
						</dd>

				</dl></awsdocs-tabs>
				
			 

			 
				<h3 id="detach-iam-role">Detach an IAM role</h3>

				<p>You can detach an IAM role from a running or stopped instance.</p>

				<awsdocs-tabs><dl style="display: none">
					
					<dt>Console</dt><dd tab-id="console">
							<div class="procedure"><a id="detach-iam-role-console"></a><h6>To detach an IAM role
									from an instance </h6><ol><li><p>Open the Amazon EC2 console at
         <a href="https://console.aws.amazon.com/ec2/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/ec2/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></li><li>
									<p>In the navigation pane, choose
											<b>Instances</b>.</p>
								</li><li>
									<p>Select the instance, choose <b>Actions</b>,
											<b>Security</b>, <b>Modify IAM
											role</b>.</p>
								</li><li>
									<p>For <b>IAM role</b>, choose <b>No IAM
											Role</b>. Choose
										<b>Save</b>.</p>
								</li><li>
									<p>In the confirmation dialog box, enter <b>
											Detach</b>, and then choose
											<b>Detach</b>.</p>
								</li></ol></div>
						</dd>

					
					
					<dt>Command line</dt><dd tab-id="command-line">
							<div class="procedure"><a id="detach-iam-role-cli"></a><h6>To detach an IAM role from an instance
									(AWS CLI)</h6><ol><li>
									<p>If required, use <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-iam-instance-profile-associations.html">describe-iam-instance-profile-associations</a> to describe your
										IAM instance profile associations and get the association ID for the
										IAM instance profile to detach.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">aws ec2 describe-iam-instance-profile-associations</code></pre>
									<p>Example response</p>
									<pre class="programlisting"><div class="code-btn-container"></div><code class="JSON "><span>{</span>
    "IamInstanceProfileAssociations": [
        <span>{</span>
            "InstanceId": "i-088ce778fbfeb4361", 
            "State": "associated", 
            "AssociationId": "iip-assoc-0044d817db6c0a4ba", 
            "IamInstanceProfile": <span>{</span>
                "Id": "AIPAJEDNCAA64SSD265D6", 
                "Arn": "arn:aws:iam::123456789012:instance-profile/TestRole-2"
            }
        }
    ]
}</code></pre>
								</li><li>
									<p>Use the <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/disassociate-iam-instance-profile.html">disassociate-iam-instance-profile</a> command to detach the
										IAM instance profile using its association ID.</p>
									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws ec2 disassociate-iam-instance-profile --association-id <code class="replaceable">iip-assoc-0044d817db6c0a4ba</code></code></pre>
									<p>Example response</p>
									<pre class="programlisting"><div class="code-btn-container"></div><code class="JSON "><span>{</span>
    "IamInstanceProfileAssociation": <span>{</span>
        "InstanceId": "i-087711ddaf98f9489", 
        "State": "disassociating", 
        "AssociationId": "iip-assoc-0044d817db6c0a4ba", 
        "IamInstanceProfile": <span>{</span>
            "Id": "AIPAJEDNCAA64SSD265D6", 
            "Arn": "arn:aws:iam::123456789012:instance-profile/TestRole-2"
        }
    }
}</code></pre>
								</li></ol></div>
							<p>Alternatively, use the following Tools for Windows PowerShell commands:</p>
							<div class="itemizedlist">
								 
								 
							<ul class="itemizedlist"><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Get-EC2IamInstanceProfileAssociation.html">Get-EC2IamInstanceProfileAssociation</a></p>
								</li><li class="listitem">
									<p><a href="https://docs.aws.amazon.com/powershell/latest/reference/items/Unregister-EC2IamInstanceProfile.html">Unregister-EC2IamInstanceProfile</a></p>
								</li></ul></div>
						</dd>
					
				</dl></awsdocs-tabs>

			 

			 
				<h3 id="generate-policy-for-iam-role">Generate a policy for your IAM
						role based on access activity</h3>
				<p>When you first create an IAM role for your applications, you might sometimes grant
					permissions beyond what is required. Before launching your application in your
					production environment, you can generate an IAM policy that is based on the
					access activity for an IAM role. IAM Access Analyzer reviews your AWS CloudTrail logs and
					generates a policy template that contains the permissions that have been used by
					the role in your specified date range. You can use the template to create a
					managed policy with fine-grained permissions and then attach it to the IAM
					role. That way, you grant only the permissions that the role needs to interact
					with AWS resources for your specific use case. This helps you adhere to the
					best practice of <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">granting least privilege</a>. To learn more, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_generate-policy.html">Generate
						policies based on access activity</a> in the
						<em>IAM User Guide</em>.</p>
			 

		<awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./security-iam-awsmanpol.html">AWS managed policies</div><div id="next" class="next-link" accesskey="n" href="./authorizing-access-to-an-instance.html">Network access</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=https://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>