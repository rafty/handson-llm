<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Monitor and control actions taken with assumed roles - AWS Identity and Access Management</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="id_credentials_temp_control-access_monitor" /><meta name="default_state" content="id_credentials_temp_control-access_monitor" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" /><meta name="description" content="Use AWS CloudTrail logs to monitor who performed actions with your IAM roles by requiring that users set a source identity when assuming a role." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Identity and Access Management" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Control access to your AWS resources with user identity (authentication) and with policies that define specific permissions (authorization)." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" hreflang="x-default" /><meta name="feedback-item" content="IAM" /><meta name="this_doc_product" content="AWS Identity and Access Management" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'iam'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Monitor and control actions taken with assumed roles" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Monitor and control actions taken with assumed roles - AWS Identity and Access Management</title><meta name="pdf" content="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#id_credentials_temp_control-access_monitor" /><meta name="github" content="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/id_credentials_temp_control-access_monitor.md" /><meta name="rss" content="aws-iam-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=76" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html" /><meta name="keywords" content="IAM,AWS Identity and Access Management,IAM user,user,IAM group,group,IAM role,role,permission policy,trust policy,policy,access key,password" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Identity and Access Management",
        "item" : "https://docs.aws.amazon.com/iam/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "IAM Identities (users, user groups, and roles)",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Temporary security credentials in IAM",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Controlling permissions for temporary security credentials",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Monitor and control actions taken with assumed roles",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#id_credentials_temp_control-access_monitor" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/id_credentials_temp_control-access_monitor.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iam/index.html">AWS Identity and Access Management</a><a href="introduction.html">User Guide</a></div><div id="page-toc-src"><a href="#id_credentials_temp_control-access_monitor-setup">Setting up</a><a href="#id_credentials_temp_control-access_monitor-know">Things to know</a><a href="#id_credentials_temp_control-access_monitor-perms">Permissions required to set source identity</a><a href="#id_credentials_temp_control-access_monitor-specify-sourceid">Specifying a
                source identity when assuming a role</a><a href="#id_credentials_temp_control-access_monitor-assume-role">AssumeRole</a><a href="#id_credentials_temp_control-access_monitor-assume-role-saml">AssumeRoleWithSAML</a><a href="#id_credentials_temp_control-access_monitor-assume-role-web-id">AssumeRoleWithWebIdentity</a><a href="#id_credentials_temp_control-access_monitor-control-access">Control access using source identity</a><a href="#id_credentials_temp_control-access_monitor-ct">Viewing source identity in AWS CloudTrail</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="id_credentials_temp_control-access_monitor">Monitor and control actions
            taken with assumed roles</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>An <a href="./id_roles.html">IAM role</a> is an object in IAM that is assigned <a href="./access_policies.html">permissions</a>. When you <a href="./id_roles_use.html">assume that role</a> using an IAM identity or an identity from outside of AWS,
        you receive a session with the permissions that are assigned to the role. </p><p>When you perform actions in AWS, the information about your session can be logged to
        AWS CloudTrail for your account administrator to monitor. Administrators can configure roles to require
        identities to pass a custom string that identifies the person or application that is
        performing actions in AWS. This identity information is stored as the <em>source
            identity</em> in AWS CloudTrail. When the administrator reviews activity in CloudTrail, they
        can view the source identity information to determine who or what performed actions with
        assumed role sessions.</p><p>After a source identity is set, it is present in requests for any AWS action taken
        during the role session. The value that is set persists when a role is used to assume
        another role through the AWS CLI or AWS API, known as <a href="./id_roles_terms-and-concepts.html#iam-term-role-chaining">role chaining</a>. The value that is set cannot be changed during the role session.
        Administrators can configure granular permissions based on the presence or value of the
        source identity to further control AWS actions that are taken with shared roles. You can
        decide whether the source identity attribute can be used, whether it is required, and what
        value can be used.</p><p></p><p>The way that you use source identity differs from role session name and session tags in an
        important way. The source identity value can't be changed after it is set, and it persists
        for any additional actions that are taken with the role session. Here's how you can use
        session tags and role session name: </p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p><span class="topcom">Session tags</span> – You can pass session tags
                when you assume a role or federate a user. Session tags are present when a role is
                assumed. You can define policies that use tag condition keys to grant permissions to
                your principals based on their tags. Then you can use CloudTrail to view the requests made
                to assume roles or federate users. To learn more about session tags, see <a href="./id_session-tags.html">Passing session tags in AWS STS</a>.</p>
        </li><li class="listitem">
            <p><span class="topcom">Role session name</span> – You can use the
                    <code class="code">sts:RoleSessionName</code> condition key in a role trust policy to require
                that your users provide a specific session name when they assume a role. Role
                session name can be used to differentiate role sessions when a role is used by
                different principals. To learn more about role session name, see <a href="./reference_policies_iam-condition-keys.html#ck_rolesessionname">sts:RoleSessionName</a>.</p>
        </li></ul></div><p>We recommend that you use source identity when you want to control the identity that
        assumes a role. Source identity is also useful for mining CloudTrail logs to determine who
        used the role to perform actions. </p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#id_credentials_temp_control-access_monitor-setup">Setting up to use
                source identity</a></li><li><a href="#id_credentials_temp_control-access_monitor-know">Things to know about
                source identity</a></li><li><a href="#id_credentials_temp_control-access_monitor-perms">Permissions required
                to set source identity</a></li><li><a href="#id_credentials_temp_control-access_monitor-specify-sourceid">Specifying a
                source identity when assuming a role</a></li><li><a href="#id_credentials_temp_control-access_monitor-assume-role">Using source
                identity with AssumeRole</a></li><li><a href="#id_credentials_temp_control-access_monitor-assume-role-saml">Using
                source identity with AssumeRoleWithSAML</a></li><li><a href="#id_credentials_temp_control-access_monitor-assume-role-web-id">Using
                source identity with AssumeRoleWithWebIdentity</a></li><li><a href="#id_credentials_temp_control-access_monitor-control-access">Control
                access using source identity information</a></li><li><a href="#id_credentials_temp_control-access_monitor-ct">Viewing source identity
                in CloudTrail </a></li></ul></div>
        <h2 id="id_credentials_temp_control-access_monitor-setup">Setting up to use
                source identity</h2>
        <p>The way that you set up to use source identity depends on the method used when your
            roles are assumed. For example, your IAM users might assume roles directly using the
                <code class="code">AssumeRole</code> operation. If you have enterprise identities, also known as
            workforce identities, they might access your AWS resources using
                <code class="code">AssumeRoleWithSAML</code>. If end users access your mobile or web
            applications, they might do so using <code class="code">AssumeRoleWithWebIdentity</code>. The
            following is a high-level workflow overview to help you understand how you can set up to
            utilize source identity information in your existing environment.</p>
        <div class="orderedlist">
             
             
             
             
             
             
        <ol><li>
                <p><span class="topcom">Configure test users and roles</span> – Using a
                    preproduction environment, configure test users and roles and configure their
                    policies to allow setting a source identity.</p>
                <p>If you use an identity provider (IdP) for your federated identities, configure
                    your IdP to pass a user attribute of your choice for source identity in the
                    assertion or token.</p>
            </li><li>
                <p><span class="topcom">Assume the role</span> – Test assuming roles
                    and passing a source identity with the users and roles that you set up for
                    testing.</p>
            </li><li>
                <p><span class="topcom">Review CloudTrail</span> – Review the source identity
                    information for your test roles in your CloudTrail logs.</p>
            </li><li>
                <p><span class="topcom">Train your users</span> – After you've tested
                    in your preproduction environment, ensure that your users know how to pass in
                    the source identity information, if necessary. Set a deadline for when you will
                    require your users to provide a source identity in your production
                    environment.</p>
            </li><li>
                <p><span class="topcom">Configure production policies</span> –
                    Configure your policies for your production environment, and then add them to
                    your production users and roles.</p>
            </li><li>
                <p><span class="topcom">Monitor activity</span> – Monitor your
                    production role activity using CloudTrail logs.</p>
            </li></ol></div>
     
        <h2 id="id_credentials_temp_control-access_monitor-know">Things to know about
                source identity</h2>
        <p>Keep the following in mind when working with source identity.</p>
        <div class="itemizedlist">
             
            
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Trust policies for all roles connected to an identity provider (IdP) must have
                    the <code class="code">sts:SetSourceIdentity</code> permission. For roles that don't have
                    this permission in the role trust policy, the <code class="code">AssumeRole*</code> operation
                    will fail. If you don't want to update the role trust policy for each role, you
                    can use a separate IdP instance for passing source identity. Then add the
                        <code class="code">sts:SetSourceIdentity</code> permission to only the roles that are
                    connected to the separate IdP.</p>
            </li><li class="listitem">
                <p>When an identity sets a source identity, the <code class="code">sts:SourceIdentity</code>
                    key is present in the request. For subsequent actions taken during the role
                    session, the <code class="code">aws:SourceIdentity</code> key is present in the request.
                    AWS doesn’t control the value of the source identity in either the
                        <code class="code">sts:SourceIdentity</code> or <code class="code">aws:SourceIdentity</code> keys. If
                    you choose to require a source identity, you must choose an attribute that you
                    want your users or IdP to provide. For security purposes, you must ensure that
                    you can control how those values are provided.</p>
            </li><li class="listitem">
                <p>The value of source identity must be between 2 and 64 characters long, can
                    contain only alphanumeric characters, underscores, and the following characters:
                        <b>. , + = @ -</b> (hyphen). You cannot use a
                    value that begins with the text <code class="userinput">aws:</code>. This prefix is
                    reserved for AWS internal use.</p>
            </li><li class="listitem">
                <p>The source identity information is not captured by CloudTrail when an AWS service
                    or service-linked role carries out an action on behalf of a federated or
                    workforce identity. </p>
            </li></ul></div>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>You cannot switch to a role in the AWS Management Console that requires a source identity to be
                set when the role is assumed. To assume such a role, you can use the AWS CLI or AWS
                API to call the <code class="code">AssumeRole</code> operation and specify the source identity
                parameter.</p></div></div>
     
        <h2 id="id_credentials_temp_control-access_monitor-perms">Permissions required
                to set source identity</h2>
        <p>In addition to the action that matches the API operation, you must have the following
            permissions-only action in your policy: </p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">sts:SetSourceIdentity</code></code></pre>
        <div class="itemizedlist">
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>To specify a source identity, principals (IAM users and roles) must have
                    permissions to <code class="code">sts:SetSourceIdentity</code>. As the administrator, you can
                    configure this in the role trust policy and in the principal’s permissions
                    policy.</p>
            </li><li class="listitem">
                <p>When you assume a role with another role, called <a href="./id_roles_terms-and-concepts.html#iam-term-role-chaining">role chaining</a>, permissions for
                        <code class="code">sts:SetSourceIdentity</code> are required in both the permissions
                    policy of the principal who is assuming the role and in the role trust policy of
                    the target role. Otherwise, the assume role operation will fail.</p>
            </li><li class="listitem">
                <p>When using source identity, the role trust policies for all roles connected to
                    an IdP must have the <code class="code">sts:SetSourceIdentity</code> permission. The
                        <code class="code">AssumeRole*</code> operation will fail for any role connected to an
                    IdP without this permission. If you don't want to update the role trust policy
                    for each role, you can use a separate IdP instance for passing source identity
                    and add the <code class="code">sts:SetSourceIdentity</code> permission to only the roles that
                    are connected to the separate IdP.</p>
            </li><li class="listitem">
                <p>To set a source identity across account boundaries, you must include the
                        <code class="code">sts:SetSourceIdentity</code> permission in two places. It must be in
                    the permissions policy of the principal in the originating account and in the
                    role trust policy of the role in the target account. You might need to do this,
                    for example, when a role is used to assume a role in another account with <a href="./id_roles_terms-and-concepts.html#iam-term-role-chaining">role chaining</a>.</p>
            </li></ul></div>
        <p>As the account administrator, imagine that you want to allow the IAM user
                <code class="code">DevUser</code> in your account to assume the <code class="code">Developer_Role</code> in
            the same account. But you want to allow this action only if the user has set the source
            identity to their IAM user name. You can attach the following policy to the IAM
            user.</p>
        <div class="example"><h6>Example identity-based policy attached to DevUser</h6><div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AssumeRole",
      "Effect": "Allow",
      "Action": "sts:AssumeRole",
      "Resource": "arn:aws:iam::<code class="replaceable">123456789012</code>:role/<code class="replaceable">Developer_Role</code>"
    },
    <span>{</span>
      "Sid": "SetAwsUserNameAsSourceIdentity",
      "Effect": "Allow",
      "Action": "sts:SetSourceIdentity",
      "Resource": "arn:aws:iam::<code class="replaceable">123456789012</code>:role/<code class="replaceable">Developer_Role</code>",
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "sts:SourceIdentity": "$<span>{</span>aws:username}"
        }
      }
    }
  ]
}</code></pre></div></div>
        <p>To enforce the acceptable source identity values, you can configure the following role
            trust policy. The policy gives the IAM user <code class="code">DevUser</code> permissions to assume
            the role and set a source identity. The <code class="code">sts:SourceIdentity</code> condition key
            defines the acceptable source identity value.</p>
        <div class="example"><h6>Example role trust policy for source identity</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AllowDevUserAssumeRole",
      "Effect": "Allow",
      "Principal": <span>{</span>
        "AWS": "arn:aws:iam::<code class="replaceable">123456789012</code>:user/<code class="replaceable">DevUser</code>"
      },
      "Action": [
        "sts:AssumeRole",
        "sts:SetSourceIdentity"
      ],
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "sts:SourceIdentity": "<code class="replaceable">DevUser</code>"
        }
      }
    }
  ]
}</code></pre>
        <p>Using the credentials for the IAM user <code class="code">DevUser</code>, the user attempts to
            assume the <code class="code">DeveloperRole</code> using the following AWS CLI request.</p>
        <div class="example"><h6>Example AssumeRole CLI request</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="http ">aws sts assume-role \
--role-arn arn:aws:iam::123456789012:role/Developer_Role \
--role-session-name Dev-project \ 
--source-identity DevUser \
</code></pre>
        <p>When AWS evaluates the request, the request context contains the
                <code class="code">sts:SourceIdentity</code> of <code class="code">DevUser</code>.</p>
     
        <h2 id="id_credentials_temp_control-access_monitor-specify-sourceid">Specifying a
                source identity when assuming a role</h2>
        <p>You can specify a source identity when you use one of the AWS STS
                <code class="code">AssumeRole*</code> API operations to get temporary security credentials for a
            role. The API operation that you use differs depending on your use case. For example, if
            you use IAM roles to give IAM users access to AWS resources that they don’t
            normally have access to, you might use the <code class="code">AssumeRole</code> operation. If you use
            enterprise identity federation to manage your workforce users, you might use the
                <code class="code">AssumeRoleWithSAML</code> operation. If you use web identity federation to
            allow end users to access your mobile or web applications, you might use the
                <code class="code">AssumeRoleWithWebIdentity</code> operation. The following sections explain how
            to use source identity with each operation. To learn more about common scenarios for
            temporary credentials, see <a href="./id_credentials_temp.html#sts-introduction">Common scenarios for temporary credentials</a>.</p>
     
        <h2 id="id_credentials_temp_control-access_monitor-assume-role">Using source
                identity with AssumeRole</h2>
        <p>The <code class="code">AssumeRole</code> operation returns a set of temporary credentials that you
            can use to access AWS resources. You can use IAM user or role credentials to call
                <code class="code">AssumeRole</code>. To pass source identity while assuming a role, use the
                <code class="code">-–source-identity</code> AWS CLI option or the <code class="code">SourceIdentity</code> AWS
            API parameter. The following example shows how to specify the source identity using the
            AWS CLI.</p>
        <div class="example"><h6>Example AssumeRole CLI request</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="http ">aws sts assume-role \
--role-arn arn:aws:iam::123456789012:role/developer \
--role-session-name Audit \ 
--source-identity Admin \
            </code></pre>
     
        <h2 id="id_credentials_temp_control-access_monitor-assume-role-saml">Using
                source identity with AssumeRoleWithSAML</h2>
        <p>The principal calling the <code class="code">AssumeRoleWithSAML</code> operation is authenticated
            using SAML-based federation. This operation returns a set of temporary credentials that
            you can use to access AWS resources. For more information about using SAML-based
            federation for AWS Management Console access, see <a href="./id_roles_providers_enable-console-saml.html">Enabling SAML 2.0 federated users to
      access the AWS Management Console</a>. For details about AWS CLI or
            AWS API access, see <a href="./id_roles_providers_saml.html">About SAML 2.0-based federation</a>. For a tutorial of setting up SAML
            federation for your Active Directory users, see <a href="http://aws.amazon.com/blogs/security/aws-federated-authentication-with-active-directory-federation-services-ad-fs/" rel="noopener noreferrer" target="_blank"><span>AWS Federated Authentication with Active Directory Federation Services
                (ADFS)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the AWS Security Blog. </p>
        <p>As an administrator, you can allow members of your company directory to federate into
            AWS using the AWS STS <code class="code">AssumeRoleWithSAML</code> operation. To do this, you must
            complete the following tasks:</p>
        <div class="orderedlist">
             
             
             
             
        <ol><li>
                <p><a href="./id_roles_providers_saml_3rd-party.html">Configure a SAML provider in
                        your organization</a>.</p>
            </li><li>
                <p><a href="./id_roles_providers_create_saml.html">Create a SAML provider in
                        IAM</a>.</p>
            </li><li>
                <p><a href="./id_roles_create_for-idp_saml.html">Configure a role and its
                        permissions in AWS for your federated users</a>.</p>
            </li><li>
                <p><a href="./id_roles_providers_create_saml_assertions.html">Finish configuring
                        the SAML IdP and create assertions for the SAML authentication
                        response</a>.</p>
            </li></ol></div>
        <p>To set a SAML attribute for source identity, include the <code class="code">Attribute</code>
            element with the <code class="code">Name</code> attribute set to
                <code class="code">https://aws.amazon.com/SAML/Attributes/SourceIdentity</code>. Use the
                <code class="code">AttributeValue</code> element to specify the value of the source identity. For
            example, assume that you want to pass the following identity attribute as the source
            identity. </p>
        <p><code class="code">SourceIdentity:DiegoRamirez</code></p>
        <p>To pass this attribute, include the following element in your SAML assertion.</p>
        <div class="example"><h6>Example snippet of a SAML assertion</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">&lt;Attribute Name="https://aws.amazon.com/SAML/Attributes/SourceIdentity"&gt;
&lt;AttributeValue&gt;DiegoRamirez&lt;/AttributeValue&gt;
&lt;/Attribute&gt;</code></pre>
     
        <h2 id="id_credentials_temp_control-access_monitor-assume-role-web-id">Using
                source identity with AssumeRoleWithWebIdentity</h2>
        <p>The principal calling the <code class="code">AssumeRoleWithWebIdentity</code> operation is
            authenticated using OpenID Connect (OIDC)-compliant web identity federation. This
            operation returns a set of temporary credentials that you can use to access AWS
            resources. For more information about using web identity federation for AWS Management Console
            access, see <a href="./id_roles_providers_oidc.html">About web identity federation</a>.</p>
        <p>To pass source identity from OpenID Connect (OIDC), you must include the source
            identity in the JSON Web Token (JWT). Include source identity in the <code class="code"><a href="https://aws.amazon.com/" rel="noopener noreferrer" target="_blank"><span>https://aws.amazon.com/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>source_identity</code> namespace in the token
            when you submit the <code class="code">AssumeRoleWithWebIdentity</code> request. To learn more about
            OIDC tokens and claims, see <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-with-identity-providers.html">Using Tokens with User Pools</a> in the <em>Amazon Cognito
                Developer Guide</em>.</p>
        <p>For example, the following decoded JWT is a token that is used to call
                <code class="code">AssumeRoleWithWebIdentity</code> with the <code class="code">Admin</code> source
            identity.</p>
        <div class="example"><h6>Example decoded JSON Web Token</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "sub": "johndoe",
    "aud": "ac_oic_client",
    "jti": "ZYUCeRMQVtqHypVPWAN3VB",
    "iss": "https://xyz.com",
    "iat": 1566583294,
    "exp": 1566583354,
    "auth_time": 1566583292,
    "https://aws.amazon.com/source_identity":"Admin"
}</code></pre>
     
        <h2 id="id_credentials_temp_control-access_monitor-control-access">Control
                access using source identity information</h2>
        <p>When a source identity is initially set, the <a href="./reference_policies_iam-condition-keys.html#ck_sourceidentity">sts:SourceIdentity</a> key is present in the request. After a source identity is
            set, the <a href="./reference_policies_condition-keys.html#condition-keys-sourceidentity">aws:SourceIdentity</a> key is
            present in all subsequent requests made during the role session. As the administrator,
            you can write policies that grant conditional authorization to perform AWS actions
            based on the existence or value of the source identity attribute.</p>
        <p>Imagine that you want to require your developers to set a source identity to assume a
            critical role that has permission to write to a production critical AWS resource. Also
            imagine that you grant AWS access to your workforce identities using
                <code class="code">AssumeRoleWithSAML</code>. You only want senior developers Saanvi and Diego to
            have access to the role, so you create the following trust policy for the role.</p>
        <div class="example"><h6>Example role trust policy for source identity (SAML)</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "SAMLProviderAssumeRoleWithSAML",
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Federated": "arn:aws:iam::<code class="replaceable">111122223333</code>:saml-provider/name-of-identity-provider"
      },
      "Action": [
        "sts:AssumeRoleWithSAML"
      ],
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "SAML:aud": "https://signin.aws.amazon.com/saml"
        }
      }
    },
    <span>{</span>
      "Sid": "SetSourceIdentitySrEngs",
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Federated": "arn:aws:iam::<code class="replaceable">111122223333</code>:saml-provider/name-of-identity-provider"
      },
      "Action": [
        "sts:SetSourceIdentity"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "sts:SourceIdentity": [
            "Saanvi",
            "Diego"
          ]
        }
      }
    }
  ]
}</code></pre>
        <p>The trust policy contains a condition for <code class="code">sts:SourceIdentity</code> that
            requires a source identity of Saanvi or Diego to assume the critical role.</p>
        <p>Alternatively, if you use an OIDC provider for web identity federation and users are
            authenticated with <code class="code">AssumeRoleWithWebIdentity</code>, your role trust policy might
            look as follows.</p>
        <div class="example"><h6>Example role trust policy for source identity (OIDC provider)</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Federated": "arn:aws:iam::<code class="replaceable">111122223333</code>:oidc-provider/<code class="replaceable">server.example.com</code>"
      },
      "Action": [
        "sts:AssumeRoleWithWebIdentity",
        "sts:SetSourceIdentity"
      ],
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "<code class="replaceable">server.example.com</code>:aud": "<code class="replaceable">oidc-audience-id</code>"
        },
        "StringLike": <span>{</span>
          "sts:SourceIdentity": [
            "Saanvi",
            "Diego"
          ]
        }
      }
    }
  ]
}</code></pre>
         
            <h3 id="id_credentials_temp_control-access_monitor-chain">Role chaining and
                    cross-account requirements</h3>
            <p>Imagine that you want to allow users who have assumed <code class="code">CriticalRole</code> to
                assume a <code class="code">CriticalRole_2</code> in another account. The role session
                credentials that were obtained to assume <code class="code">CriticalRole</code> are used to <a href="./id_roles_terms-and-concepts.html#iam-term-role-chaining">role chain</a> to a second role,
                    <code class="code">CriticalRole_2</code>, in a different account. The role is being assumed
                across an account boundary. Therefore, the <code class="code">sts:SetSourceIdentity</code>
                permission must be granted in both the permissions policy on
                    <code class="code">CriticalRole</code> and in the role trust policy on
                    <code class="code">CriticalRole_2</code>.</p>
            <div class="example"><h6>Example permissions policy on CriticalRole</h6><div class="example-contents"></div></div>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AssumeRoleAndSetSourceIdentity",
      "Effect": "Allow",
      "Action": [
        "sts:AssumeRole",
        "sts:SetSourceIdentity"
      ],
      "Resource": "arn:aws:iam::<code class="replaceable">222222222222</code>:role/CriticalRole_2"
    }
  ]
}</code></pre>
            <p>To secure setting source identity across the account boundary, the following role
                trust policy trusts only the role principal for <code class="code">CriticalRole</code> to set the
                source identity.</p>
            <div class="example"><h6>Example role trust policy on CriticalRole_2</h6><div class="example-contents"></div></div>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "AWS": "arn:aws:iam::<code class="replaceable">111111111111</code>:role/CriticalRole"
      },
      "Action": [
        "sts:AssumeRole",
        "sts:SetSourceIdentity"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "aws:SourceIdentity": ["Saanvi","Diego"]
        }
      }
    }
  ]
}</code></pre>
            <p>The user makes the following call using role session credentials obtained from
                assuming CriticalRole. The source identity was set during the assumption of
                CriticalRole, so it does not need to be explicitly set again. If the user attempts
                to set a source identity that is different from the value set when
                    <code class="code">CriticalRole</code> was assumed, the assume role request will be
                denied.</p>
            <div class="example"><h6>Example AssumeRole CLI request</h6><div class="example-contents"></div></div>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="http ">aws sts assume-role \ 
--role-arn arn:aws:iam::<code class="replaceable">222222222222</code>:role/CriticalRole_2 \
--role-session-name Audit \

</code></pre>
            <p>When the calling principal assumes the role, the source identity in the request
                persists from the first assumed role session. Therefore, both the
                    <code class="code">aws:SourceIdentity</code> and <code class="code">sts:SourceIdentity</code> keys are
                present in the request context.</p>
         
     
        <h2 id="id_credentials_temp_control-access_monitor-ct">Viewing source identity
                in CloudTrail </h2>
        <p>You can use CloudTrail to view the requests made to assume roles or federate users. You can
            also view the role or user requests to take actions in AWS. The CloudTrail log file includes
            information about the source identity set for the assumed-role or federated user
            session. For more information, see <a href="./cloudtrail-integration.html">Logging IAM and AWS STS API calls
      with AWS CloudTrail</a></p>
        <p>For example, assume that a user makes an AWS STS <code class="code">AssumeRole</code> request, and
            sets a source identity. You can find the <code class="code">sourceIdentity</code> information in the
                <code class="code">requestParameters</code> key in your CloudTrail log.</p>
        <div class="example"><h6>Example requestParameters section in an AWS CloudTrail log</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"eventVersion": "1.05",
    "userIdentity": <span>{</span>
        "type": "AWSAccount",
        "principalId": "AIDAJ45Q7YFFAREXAMPLE",
        "accountId": "111122223333"
    },
    "eventTime": "2020-04-02T18:20:53Z",
    "eventSource": "sts.amazonaws.com",
    "eventName": "AssumeRole",
    "awsRegion": "us-east-1",
    "sourceIPAddress": "203.0.113.64",
    "userAgent": "aws-cli/1.16.96 Python/3.6.0 Windows/10 botocore/1.12.86",
    "requestParameters": <span>{</span>
        "roleArn": "arn:aws:iam::123456789012:role/DevRole",
        "roleSessionName": "Dev1",
        "sourceIdentity": "<code class="replaceable">source-identity-value-set</code>"
    }</code></pre>
        <p>If the user uses the assumed role session to perform an action, the source identity
            information is present in the <code class="code">userIdentity</code> key in the CloudTrail log.</p>
        <div class="example"><h6>Example userIdentity key in an AWS CloudTrail log</h6><div class="example-contents"></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "eventVersion": "1.08",
  "userIdentity": <span>{</span>
    "type": "AssumedRole",
    "principalId": "AROAJ45Q7YFFAREXAMPLE:Dev1",
    "arn": "arn:aws:sts::123456789012:assumed-role/DevRole/Dev1",
    "accountId": "123456789012",
    "accessKeyId": "ASIAIOSFODNN7EXAMPLE",
    "sessionContext": <span>{</span>
      "sessionIssuer": <span>{</span>
        "type": "Role",
        "principalId": "AROAJ45Q7YFFAREXAMPLE",
        "arn": "arn:aws:iam::123456789012:role/DevRole",
        "accountId": "123456789012",
        "userName": "DevRole"
      },
      "webIdFederationData": <span>{</span>},
      "attributes": <span>{</span>
        "mfaAuthenticated": "false",
        "creationDate": "2021-02-21T23:46:28Z"
      },
      "sourceIdentity": "source-identity-value-present"
    }
  }
}</code></pre>
        <p>To see example AWS STS API events in CloudTrail logs, see <a href="./cloudtrail-integration.html#cloudtrail-integration_examples-iam-api">Example IAM API events in CloudTrail
        log</a>. For more details about
            the information contained in CloudTrail log files, see <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/eventreference.html">CloudTrail Event Reference</a> in the
                <em>AWS CloudTrail User Guide</em>.</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./id_credentials_temp_control-access_assumerole.html">Permissions for AssumeRole API operations</div><div id="next" class="next-link" accesskey="n" href="./id_credentials_temp_control-access_getfederationtoken.html">Permissions for
      GetFederationToken</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_temp_control-access_monitor.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>