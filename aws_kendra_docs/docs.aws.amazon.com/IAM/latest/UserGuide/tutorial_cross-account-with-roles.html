<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>IAM tutorial: Delegate access across AWS accounts using IAM roles - AWS Identity and Access Management</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="tutorial_cross-account-with-roles" /><meta name="default_state" content="tutorial_cross-account-with-roles" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" /><meta name="description" content="Learn the steps for delegating API access in your AWS account to an AWS Identity and Access Management (IAM) user in another account. (First of four)." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Identity and Access Management" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Control access to your AWS resources with user identity (authentication) and with policies that define specific permissions (authorization)." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" hreflang="x-default" /><meta name="feedback-item" content="IAM" /><meta name="this_doc_product" content="AWS Identity and Access Management" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'iam'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="IAM tutorial: Delegate access across AWS accounts using IAM roles" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>IAM tutorial: Delegate access across AWS accounts using IAM roles - AWS Identity and Access Management</title><meta name="pdf" content="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#tutorial_cross-account-with-roles" /><meta name="github" content="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/tutorial_cross-account-with-roles.md" /><meta name="rss" content="aws-iam-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=76" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" /><meta name="keywords" content="IAM,AWS Identity and Access Management,IAM user,user,IAM group,group,IAM role,role,permission policy,trust policy,policy,access key,password" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Identity and Access Management",
        "item" : "https://docs.aws.amazon.com/iam/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "IAM tutorials",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorials.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "IAM tutorial: Delegate access across AWS accounts using IAM roles",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorials.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#tutorial_cross-account-with-roles" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/tutorial_cross-account-with-roles.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iam/index.html">AWS Identity and Access Management</a><a href="introduction.html">User Guide</a></div><div id="page-toc-src"><a href="#tutorial_cross-account-with-roles-prereqs">Prerequisites</a><a href="#tutorial_cross-account-with-roles-1">Step 1: Create a role in the
            Production Account</a><a href="#tutorial_cross-account-with-roles-2">Step 2: Grant access to the
            role</a><a href="#tutorial_cross-account-with-roles-3">Step 3: Test access by switching
            roles</a><a href="#tutorial_cross-account-with-roles-related">Related resources</a><a href="#tutorial_cross-account-with-roles-summary">Summary</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="tutorial_cross-account-with-roles">IAM tutorial: Delegate access across AWS
         accounts using IAM roles</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>This tutorial teaches you how to use a role to delegate access to resources in different
      AWS accounts that you own called <b>Production</b> and <b>Development</b>. You share resources in one account with users in a
      different account. By setting up cross-account access in this way, you don't have to create
      individual IAM users in each account. In addition, users don't have to sign out of one
      account and sign in to another account to access resources in different AWS accounts. After
      configuring the role, you see how to use the role from the AWS Management Console, the AWS CLI, and the
      API.</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>IAM roles and resource-based policies delegate access across accounts only within a
         single partition. For example, assume that you have an account in US West (N. California) in the
         standard <code class="code">aws</code> partition. You also have an account in China (Beijing) in the
            <code class="code">aws-cn</code> partition. You can't use an Amazon S3 resource-based policy in your
         account in China (Beijing) to allow access for users in your standard <code class="code">aws</code>
         account.</p></div></div><p>In this tutorial, the <b>Production</b> account manages live
      applications. Developers and testers use the <b>Development</b>
      account as a sandbox to freely test applications. In each account, you store application
      information in Amazon S3 buckets. You manage IAM users in the <b>Development</b> account, where you have two IAM user groups: <b>Developers</b> and <b>Testers</b>. Users in
      both user groups have permissions to work in the Development account and access resources
      there. From time to time, a developer must update the live applications in the <b>Production</b> account. The developers store these applications in an
      Amazon S3 bucket called <code class="code">productionapp</code>. </p><p>At the end of this tutorial, you have the following:</p><div class="itemizedlist">
       
       
       
   <ul class="itemizedlist"><li class="listitem">
         <p>Users in the <b>Development</b> account (the trusted
            account) allowed to assume a specific role in the <b>Production</b> account.</p>
      </li><li class="listitem">
         <p>A role in the <b>Production</b> account (the trusting
            account) allowed to access a specific Amazon S3 bucket. </p>
      </li><li class="listitem">
         <p>The <code class="code">productionapp</code> bucket in the <b>Production</b> account.</p>
      </li></ul></div><p>Developers can use the role in the AWS Management Console to access the <code class="code">productionapp</code>
      bucket in the <b>Production</b> account. They can also access the
      bucket by using API calls authenticated by temporary credentials provided by the role. Similar
      attempts by a Tester to use the role fail.</p><p>This workflow has three basic steps:</p><div class="mediaobject">
       
         <img src="/images/IAM/latest/UserGuide/images/tutorial-cross-accounts.png" class="aws-docs-img-whiteBg aws-docs-img-padding" style="max-width:100%" />
       
   </div><div class="variablelist">
       
       
       
   <dl>
         <dt><b><span class="term"><a href="#tutorial_cross-account-with-roles-1">Step 1: Create a role in the
            Production Account</a></span></b></dt>
         <dd>
            <p>First, you use the AWS Management Console to establish trust between the <b>Production</b> account (ID number 999999999999) and the
                  <b>Development</b> account (ID number
               111111111111). You start by creating an IAM role named
                  <em>UpdateApp</em>. When you create the role, you define the <b>Development</b> account as a trusted entity and specify a
               permissions policy that allows trusted users to update the <code class="code">productionapp</code>
               bucket.</p>
         </dd>
      
         <dt><b><span class="term"><a href="#tutorial_cross-account-with-roles-2">Step 2: Grant access to the
            role</a></span></b></dt>
         <dd>
            <p>In this step of the tutorial, you modify the IAM user group policy to deny
               Testers access to the <code class="code">UpdateApp</code> role. Because Testers have PowerUser
               access in this scenario, and you must explicitly <em>deny</em> the
               ability to use the role.</p>
         </dd>
      
         <dt><b><span class="term"><a href="#tutorial_cross-account-with-roles-3">Step 3: Test access by switching
            roles</a></span></b></dt>
         <dd>
            <p>Finally, as a Developer, you use the <code class="code">UpdateApp</code> role to update the
                  <code class="code">productionapp</code> bucket in the <b>Production</b> account. You see how to access the role through the AWS
               console, the AWS CLI, and the API.</p>
         </dd>
      </dl></div>
      <h2 id="tutorial_cross-account-with-roles-prereqs">Prerequisites</h2>
      <p>This tutorial assumes that you have the following already in place:</p>
      <div class="itemizedlist">
          
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p><b>Two</b> separate AWS accounts that you can use, one
               to represent the <b>Development</b> account, and one to
               represent the <b>Production</b> account.</p>
         </li><li class="listitem">
            <p>Users and user groups in the <b>Development</b> account
               created and configured as follows:</p>
            <div class="table-container"><div class="table-contents"><table id="w340aac13c10c21b5b3b3"><thead>
                     <tr>
                        <th>User</th>
                        <th>User group</th>
                        <th>Permissions</th>
                     </tr>
                  </thead>
                     <tr>
                        <td>David</td>
                        <td>Developers</td>
                        <td rowspan="2">Both users can sign in and use the AWS Management Console in the
                              <b>Development</b> account.</td>
                     </tr>
                     <tr>
                        
                        <td>Jane</td>
                        <td>Testers</td>
                     </tr>
                  </table></div></div>
         </li><li class="listitem">
            <p>You do not need any users or user groups created in the <b>Production</b> account.</p>
         </li><li class="listitem">
            <p>An Amazon S3 bucket created in the <b>Production</b> account.
               You can call it <code class="code">ProductionApp</code> in this tutorial, but because S3 bucket
               names must be globally unique, you must use a bucket with a different name.</p>
         </li></ul></div>
    
      <h2 id="tutorial_cross-account-with-roles-1">Step 1: Create a role in the
            Production Account</h2>
      <p>You can allow users from one AWS account to access resources in another AWS account.
         To do this, create a role that defines who can access it and what permissions it grants to
         users that switch to it.</p>
      <p>In this step of the tutorial, you create the role in the <b>Production</b> account and specify the <b>Development</b> account as a trusted entity. You also limit the role permissions
         to only read and write access to the <code class="code">productionapp</code> bucket. Anyone granted
         permission to use the role can read and write to the <code class="code">productionapp</code>
         bucket.</p>
      <p>Before you can create a role, you need the <em>account ID</em> of the
            <b>Development</b> AWS account. Each AWS account has a
         unique account ID identifier assigned to it.</p>
      <div class="procedure"><h6>To obtain the Development AWS account ID</h6><ol><li>
            <p>Sign in to the AWS Management Console as an administrator of the <b>Development</b> account, and open the IAM console at <a href="https://console.aws.amazon.com/iam/" rel="noopener noreferrer" target="_blank"><span>https://console.aws.amazon.com/iam/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p>
         </li><li>
            <p>

In the navigation bar, choose <b>Support</b>, and then <b>Support Center</b>. Your currently signed-in 12-digit account number (ID) appears 
in the <b>Support Center</b> navigation pane.
 For this scenario, you can use the account ID
               111111111111 for the <b>Development</b> account.
               However, you should use a valid account ID if you use this scenario in your test
               environment.</p>
         </li></ol></div>
      <div class="procedure"><h6>To create a role in the production account that can be used by the <b>Development</b> account</h6><ol><li>
            <p>Sign in to the AWS Management Console as an administrator of the <b>Production</b> account, and open the IAM console.</p>
         </li><li>
            <p>Before creating the role, prepare the managed policy that defines the permissions
               for the role requirements. You attach this policy to the role in a later step. </p>
            <p>You want to set read and write access to the <code class="code">productionapp</code> bucket.
               Although AWS provides some Amazon S3 managed policies, there isn't one that provides
               read and write access to a single Amazon S3 bucket. You can create your own policy
               instead.</p>
            <p>In the navigation pane, choose <b>Policies</b> and then choose
                  <b>Create policy</b>.</p>
         </li><li>
            <p>Choose the <b>JSON</b> tab and copy the text from the following JSON
               policy document. Paste this text into the <b>JSON</b> text box,
               replacing the resource ARN (<code class="code">arn:aws:s3:::productionapp</code>) with the
               real one for your Amazon S3 bucket.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "s3:ListAllMyBuckets",
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket",
        "s3:GetBucketLocation"
       ],
      "Resource": "<code class="replaceable">arn:aws:s3:::productionapp</code>"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": "<code class="replaceable">arn:aws:s3:::productionapp/*</code>"
    }
  ]
}</code></pre>
            <p>The <code class="code">ListBucket</code> permission allows users to view objects in the
                  <code class="code">productionapp</code> bucket. The <code class="code">GetObject</code>,
                  <code class="code">PutObject</code>, <code class="code">DeleteObject</code> permissions allows users to
               view, update, and delete contents in the <code class="code">productionapp</code> bucket.</p>
         </li><li>
            <p>
Resolve any security warnings, errors, or general warnings generated during <a href="./access_policies_policy-validator.html">policy validation</a>, and then choose <b>Next</b>.
</p>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>You can switch between the <b>Visual</b> and
                     <b>JSON</b> editor options anytime. However, if you make changes
                  or choose <b>Next</b> in the <b>Visual</b> editor,
                  IAM might restructure your policy to optimize it for the visual editor. For more
                  information, see <a href="./troubleshoot_policies.html#troubleshoot_viseditor-restructure">Policy restructuring</a>.</p></div></div>
         </li><li>
            <p>On the <b>Review and create</b> page, type
                  <code class="userinput">read-write-app-bucket</code> for the policy name. Review the
               permissions granted by your policy, and then choose <b>Create
                  policy</b> to save your work.</p>
            <p>The new policy appears in the list of managed policies.</p>
         </li><li>
            <p>In the navigation pane, choose <b>Roles</b> and then choose
                  <b>Create role</b>.</p>
         </li><li>
            <p>Choose the <b>An AWS account</b> role type.</p>
         </li><li>
            <p>For <b>Account ID</b>, type the <b>Development</b> account ID.</p>
            <p>This tutorial uses the example account ID
                  <code class="userinput">111111111111</code> for the <b>Development</b> account. You should use a valid account ID. If you use an
               invalid account ID, such as <code class="userinput">111111111111</code>, IAM does
               not let you create the new role.</p>
            <p>For now you do not need to require an external ID, or require users to have
               multi-factor authentication (MFA) in order to assume the role. Leave these options
               unselected. For more information, see <a href="./id_credentials_mfa.html">Using multi-factor authentication (MFA) in AWS</a>.</p>
         </li><li>
            <p>Choose <b>Next: Permissions</b> to set the permissions associated
               with the role.</p>
         </li><li>
            <p>Select the check box next to the policy that you created previously.</p>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Tip</h6></div><div class="awsdocs-note-text"><p>For <b>Filter</b>, choose <b>Customer managed</b>
                  to filter the list to include only the policies that you created. This hides the
                  AWS created policies and makes it much easier to find the one you need.</p></div></div>
            <p>Then, choose <b>Next</b>. </p>
         </li><li>
            <p>(Optional) Add metadata to the user by attaching tags as key-value pairs. For more
               information about using tags in IAM, see <a href="./id_tags.html">Tagging IAM resources</a>.</p>
         </li><li>
            <p>(Optional) For <b>Description</b>, enter a description for the new
               role.</p>
         </li><li>
            <p>After reviewing the role, choose <b>Create role</b>.</p>
            <p> </p>
            <p>The <code class="code">UpdateApp</code> role appears in the list of roles.</p>
         </li></ol></div>
      <p>Now you must obtain the Amazon Resource Name (ARN) of the role, a unique identifier for
         the role. When you modify the Developers and Testers user group policy, you specify the
         role ARN to grant or deny permissions.</p>
      <div class="procedure"><h6>To obtain the ARN for UpdateApp</h6><ol><li>
            <p>In the navigation pane of the IAM console, choose
               <b>Roles</b>.</p>
         </li><li>
            <p>In the list of roles, choose the <code class="code">UpdateApp</code> role.</p>
         </li><li>
            <p>In the <b>Summary</b> section of the details pane, copy the
                  <b>Role ARN</b> value.</p>
            <p>The Production account has an account ID of 999999999999, so the role
               ARN is <code class="code">arn:aws:iam::999999999999:role/UpdateApp</code>. Ensure
               that you provide the real AWS account ID for the Production account.</p>
         </li></ol></div>
      <p>At this point, you have established trust between the <b>Production</b> and <b>Development</b> accounts. You
         did this by creating a role in the <b>Production</b> account that
         identifies the <b>Development</b> account as a trusted principal.
         You also defined what the users who switch to the <code class="code">UpdateApp</code> role can
         do.</p>
      <p>Next, modify the permissions for the user groups.</p>
    
      <h2 id="tutorial_cross-account-with-roles-2">Step 2: Grant access to the
            role</h2>
      <p>At this point, both Testers and Developers user group members have permissions that
         allow them to freely test applications in the <b>Development</b>
         account. Use the following required steps for adding permissions to allow switching to the
         role. </p>
      <div class="procedure"><h6>To modify the Developers user group to allow them to switch to the UpdateApp
            role</h6><ol><li>
            <p>Sign in as an administrator in the <b>Development</b>
               account, and open the IAM console.</p>
         </li><li>
            <p>Choose <b>User groups</b>, and then choose
                  <b>Developers</b>.</p>
         </li><li>
            <p>Choose the <b>Permissions</b> tab, choose <b>Add
                  permissions</b>, and then choose <b>Create inline
               policy</b>.</p>
         </li><li>
            <p>Choose the <b>JSON</b> tab.</p>
         </li><li>
            <p>Add the following policy statement to allow the <code class="code">AssumeRole</code> action on
               the <code class="code">UpdateApp</code> role in the Production account. Be sure that you change
                  <code class="replaceable">PRODUCTION-ACCOUNT-ID</code> in the <code class="code">Resource</code>
               element to the actual AWS account ID of the Production account.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Action": "sts:AssumeRole",
    "Resource": "arn:aws:iam::<code class="replaceable">PRODUCTION-ACCOUNT-ID</code>:role/UpdateApp"
  }
}</code></pre>
            <p>The <code class="code">Allow</code> effect explicitly allows the Developers group access to the
                  <code class="code">UpdateApp</code> role in the Production account. Any developer who tries to
               access the role succeeds.</p>
         </li><li>
            <p>Choose <b>Review policy</b>.</p>
         </li><li>
            <p>Type a <b>Name</b> such as
                  <code class="userinput">allow-assume-S3-role-in-production</code>.</p>
         </li><li>
            <p>Choose <b>Create policy</b>.</p>
         </li></ol></div>
      <p>In most environments, you may not need the following procedure. If, however, you use
         PowerUserAccess permissions, then some groups might already be able to switch roles. The
         following procedure shows how to add a <code class="code">"Deny"</code> permission to the Testers group
         to ensure that they cannot assume the role. If you do not need this procedure in your
         environment, then we recommend that you do not add it. <code class="code">"Deny"</code> permissions make
         the overall permissions picture more complicated to manage and understand. Use
            <code class="code">"Deny"</code> permissions only when you do not have a better option.</p>
      <div class="procedure"><h6>To modify the testers user group to deny permission to assume the
               <code class="code">UpdateApp</code> role</h6><ol><li>
            <p>Choose <b>User groups</b>, and then choose
                  <b>Testers</b>.</p>
         </li><li>
            <p>Choose the <b>Permissions</b> tab, choose <b>Add
                  permissions</b>, and then choose <b>Create inline
               policy</b>.</p>
         </li><li>
            <p>Choose the <b>JSON</b> tab.</p>
         </li><li>
            <p>Add the following policy statement to deny the <code class="code">AssumeRole</code> action on
               the <code class="code">UpdateApp</code> role. Be sure that you change
                  <code class="replaceable">PRODUCTION-ACCOUNT-ID</code> in the <code class="code">Resource</code>
               element to the actual AWS account ID of the Production account.</p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Deny",
    "Action": "sts:AssumeRole",
    "Resource": "arn:aws:iam::<code class="replaceable">PRODUCTION-ACCOUNT-ID</code>:role/UpdateApp"
  }
}</code></pre>
            <p>The <code class="code">Deny</code> effect explicitly denies the Testers group access to the
                  <code class="code">UpdateApp</code> role in the Production account. Any tester who tries to
               access the role receives an access denied message.</p>
         </li><li>
            <p>Choose <b>Review policy</b>.</p>
         </li><li>
            <p>Type a <b>Name</b> like
                  <code class="userinput">deny-assume-S3-role-in-production</code>.</p>
         </li><li>
            <p>Choose <b>Create policy</b>.</p>
         </li></ol></div>
      <p>The Developers user group now has permissions to use the <code class="code">UpdateApp</code> role in
         the Production account. The Testers user group is prevented from using the
            <code class="code">UpdateApp</code> role.</p>
      <p>Next, you can see how David, a developer, can access the <code class="code">productionapp</code>
         bucket in the Production account. David can access the bucket from the AWS Management Console, the
         AWS CLI, or the AWS API.</p>
    
      <h2 id="tutorial_cross-account-with-roles-3">Step 3: Test access by switching
            roles</h2>
      <p>After completing the first two steps of this tutorial, you have a role that grants
         access to a resource in the <b>Production</b> account. You also
         have one user group in the <b>Development</b> account with users
         allowed to use that role. This step discusses how to test switching to that role from the
         AWS Management Console, the AWS CLI, and the AWS API.</p>
      <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>You can switch to a role only after you sign in as an IAM user or a federated user.
            Additionally, if you launch an Amazon EC2 instance to run an application, the application can
            assume a role through its instance profile. You cannot switch to a role when you sign in
            as the AWS account root user.</p></div></div>
       
         <h3 id="switch-tutorial_cross-account-with-roles">Switch roles
               (console)</h3>
         <p>If David needs to work within the <b>Production</b>
            environment in the AWS Management Console, he can do so by using <b>Switch Role</b>. He
            specifies the account ID or alias and the role name, and his permissions immediately
            switch to those permitted by the role. He can then use the console to work with the
               <code class="code">productionapp</code> bucket, but cannot work with any other resources in
               <b>Production</b>. While David uses the role, he also
            cannot make use of his power-user privileges in the <b>Development</b> account. That's because only one set of permissions can be in
            effect at a time.</p>
         <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>Switching roles using the AWS Management Console only works with accounts that do not require
               an <code class="code">ExternalId</code>. For example, assume that you grant access to your account
               to a third party and require an <code class="code">ExternalId</code> in a <code class="code">Condition</code>
               element in your permissions policy. In that case, the third party can access your
               account only by using the AWS API or a command line tool. The third party cannot
               use the console because it cannot supply a value for <code class="code">ExternalId</code>. For
               more information about this scenario, see <a href="./id_roles_create_for-user_externalid.html">How to use an external ID when granting
      access to your AWS resources to a third party</a>, and <a href="http://aws.amazon.com/blogs/security/how-to-enable-cross-account-access-to-the-aws-management-console" rel="noopener noreferrer" target="_blank"><span>How to Enable Cross-Account Access to the AWS Management Console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> in the AWS Security
               Blog.</p></div></div>
         <p>IAM provides two ways that David can use to enter the <b>Switch
               Role</b> page:</p>
         <div class="itemizedlist">
             
             
         <ul class="itemizedlist"><li class="listitem">
               <p>David receives a link from their administrator that points to a predefined
                  Switch Role configuration. The link is provided to the administrator on the final
                  page of the <b>Create role</b> wizard or on the <b>Role
                     Summary</b> page for a cross-account role. Choosing this link takes
                  David to the <b>Switch Role</b> page with the <b>Account
                     ID</b> and <b>Role name</b> fields already filled in. All
                  David needs to do is choose <b>Switch Roles</b>.</p>
            </li><li class="listitem">
               <p>The administrator does not send the link in email, but instead sends the
                     <b>Account ID</b> number and <b>Role Name</b>
                  values. To switch roles, David must manually enter the values. This is illustrated
                  in the following procedure.</p>
            </li></ul></div>
         <div class="procedure"><h6>To assume a role</h6><ol><li>
               <p>David signs into the AWS Management Console using his normal user in the <b>Development</b> user group.</p>
            </li><li>
               <p>They choose the link that the administrator emailed to them. This takes David
                  to the <b>Switch Role</b> page with the account ID or alias and the
                  role name information already filled in.</p>
               <p>—or—</p>
               <p>David chooses their name (the Identity menu) on the navigation bar, and then
                  chooses <b>Switch Roles</b>. </p>
               <p>If this is the first time that David tries to access the Switch Role page this
                  way, he first lands on a first-run <b>Switch Role</b> page. This
                  page provides additional information on how switching roles can permit users to
                  manage resources across AWS accounts. David must choose <b>Switch
                     Role</b> on this page to complete the rest of this procedure.</p>
            </li><li>
               <p>Next, in order to access the role, David must manually type the Production
                  account ID number (<code class="code">999999999999</code>) and the role name
                     (<code class="code">UpdateApp</code>).</p>
               <p>Also, David wants to monitor which roles and associated permissions currently
                  active in IAM. To keep track of this information, he types
                     <code class="code">PRODUCTION</code> in the <b>Display Name</b> text box,
                  chooses the red color option, and then chooses <b>Switch
                  Role</b>.</p>
            </li><li>
               <p>David can now use the Amazon S3 console to work with the Amazon S3 bucket, or any other
                  resource to which the <code class="code">UpdateApp</code> role has permissions.</p>
            </li><li>
               <p>When done, David can return to their original permissions. To do that, they
                  choose the <b>PRODUCTION </b>role display name on the navigation bar
                  and then choose <b>Back to David @
                  111111111111</b>.</p>
            </li><li>
               <p>The next time that David wants to switch roles and chooses the
                     <b>Identity</b> menu in the navigation bar, he sees the
                  PRODUCTION entry still there from last time. He can simply choose that entry to
                  switch roles immediately without reentering the account ID and role name.</p>
            </li></ol></div>
       
       
         <h3 id="switch-cli-tutorial_cross-account-with-roles">Switch roles
               (AWS CLI)</h3>
         <p> If David needs to work in the <b>Production</b>
            environment at the command line, he can do so by using the <a href="http://aws.amazon.com/cli/" rel="noopener noreferrer" target="_blank"><span>AWS CLI</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>. He runs the <code class="code">aws sts
               assume-role</code> command and passes the role ARN to get temporary security
            credentials for that role. He then configures those credentials in environment variables
            so subsequent AWS CLI commands work using the role's permissions. While David uses the
            role, he cannot use his power-user privileges in the <b>Development</b> account, because only one set of permissions can be in effect
            at a time.</p>
         <p>Note that all access keys and tokens are examples only and cannot be used as shown.
            Replace with the appropriate values from your live environment.</p>
         <div class="procedure"><h6>To assume a role</h6><ol><li>
               <p>David opens a command prompt window, and confirms that the AWS CLI client is
                  working by running the command:</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws help</code></pre>
               <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>David's default environment uses the <code class="code">David</code> user credentials
                     from his default profile that he created with the <code class="code">aws configure</code>
                     command. For more information, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html#cli-quick-configuration">Configuring the AWS Command Line Interface</a> in the
                        <em>AWS Command Line Interface User Guide</em>.</p></div></div>
            </li><li>
               <p>He begins the switch role process by running the following command to switch to
                  the <code class="code">UpdateApp</code> role in the <b>Production</b>
                  account. He received the role ARN from the administrator that created the role.
                  The command requires that you provide a session name as well, you can choose any
                  text you like for that.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws sts assume-role --role-arn "arn:aws:iam::999999999999:role/UpdateApp" --role-session-name "David-ProdUpdate"</code></pre>
               <p>David then sees the following in the output:</p>
               <pre class="programlisting"><div class="code-btn-container"></div><code class="json "><span>{</span>
    "Credentials": <span>{</span>
        "SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
        "SessionToken": "AQoDYXdzEGcaEXAMPLE2gsYULo+Im5ZEXAMPLEeYjs1M2FUIgIJx9tQqNMBEXAMPLE
CvSRyh0FW7jEXAMPLEW+vE/7s1HRpXviG7b+qYf4nD00EXAMPLEmj4wxS04L/uZEXAMPLECihzFB5lTYLto9dyBgSDy
EXAMPLE9/g7QRUhZp4bqbEXAMPLENwGPyOj59pFA4lNKCIkVgkREXAMPLEjlzxQ7y52gekeVEXAMPLEDiB9ST3Uuysg
sKdEXAMPLE1TVastU1A0SKFEXAMPLEiywCC/Cs8EXAMPLEpZgOs+6hz4AP4KEXAMPLERbASP+4eZScEXAMPLEsnf87e
NhyDHq6ikBQ==",
        "Expiration": "2014-12-11T23:08:07Z",
        "AccessKeyId": "AKIAIOSFODNN7EXAMPLE"
    }
}</code></pre>
            </li><li>
               <p>David sees the three pieces that they need in the Credentials section of the
                  output.</p>
               <div class="itemizedlist">
                   
                   
                   
               <ul class="itemizedlist"><li class="listitem">
                     <p><code class="code">AccessKeyId</code></p>
                  </li><li class="listitem">
                     <p><code class="code">SecretAccessKey</code></p>
                  </li><li class="listitem">
                     <p><code class="code">SessionToken</code></p>
                  </li></ul></div>
               <p>David needs to configure the AWS CLI environment to use these parameters in
                  subsequent calls. For information about the various ways to configure your
                  credentials, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html#config-settings-and-precedence">Configuring the AWS Command Line Interface</a>. You cannot use the <code class="code">aws
                     configure</code> command because it does not support capturing the session
                  token. However, you can manually enter the information into a configuration file.
                  Because these are temporary credentials with a relatively short expiration time,
                  it is easiest to add them to the environment of your current command line
                  session.</p>
            </li><li>
               <p>To add the three values to the environment, David cuts and pastes the output of
                  the previous step into the following commands. You might want to cut and paste
                  into a simple text editor to address line wrap issues in the output of the session
                  token. It must be added as a single long string, even though it is shown line
                  wrapped here for clarity.</p>
               <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The following example shows commands given in the Windows environment, where
                     "set" is the command to create an environment variable. On a Linux or macOS
                     computer, you would use the command "export" instead. All other parts of the
                     example are valid in all three environments.</p></div></div>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">set AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
set AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
set AWS_SESSION_TOKEN=AQoDYXdzEGcaEXAMPLE2gsYULo+Im5ZEXAMPLEeYjs1M2FUIgIJx9tQqNMBEXAMPLECvS
Ryh0FW7jEXAMPLEW+vE/7s1HRpXviG7b+qYf4nD00EXAMPLEmj4wxS04L/uZEXAMPLECihzFB5lTYLto9dyBgSDyEXA
MPLEKEY9/g7QRUhZp4bqbEXAMPLENwGPyOj59pFA4lNKCIkVgkREXAMPLEjlzxQ7y52gekeVEXAMPLEDiB9ST3UusKd
EXAMPLE1TVastU1A0SKFEXAMPLEiywCC/Cs8EXAMPLEpZgOs+6hz4AP4KEXAMPLERbASP+4eZScEXAMPLENhykxiHen
DHq6ikBQ==</code></pre>
               <p>At this point, any following commands run under the permissions of the role
                  identified by those credentials. In David's case, the <code class="code">UpdateApp</code>
                  role.</p>
            </li><li>
               <p>Run the command to access the resources in the Production account. In this
                  example, David lists the contents of their S3 bucket with the following
                  command.</p>
               <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws s3 ls s3://productionapp</code></pre>
               <p>Because Amazon S3 bucket names are universally unique, there is no need to specify
                  the account ID that owns the bucket. To access resources for other AWS services,
                  refer to the AWS CLI documentation for that service for the commands and syntax
                  required to reference its resources.</p>
            </li></ol></div>
       
       
         <h3 id="api-tutorial_cross-account-with-roles">Using AssumeRole (AWS
               API)</h3>
         <p>When David needs to make an update to the <b>Production</b>
            account from code, he makes an <code class="code">AssumeRole</code> call to assume the
               <code class="code">UpdateApp</code> role. The call returns temporary credentials that he can use
            to access the <code class="code">productionapp</code> bucket in the <b>Production</b> account. With those credentials, David can make API calls to
            update the <code class="code">productionapp</code> bucket. However, he cannot make API calls to
            access any other resources in the <b>Production</b> account,
            even though he has power-user permissions in the <b>Development</b> account.</p>
         <div class="procedure"><h6>To assume a role</h6><ol><li>
               <p>David calls <code class="code">AssumeRole</code> as part of an application. They must
                  specify the <code class="code">UpdateApp</code> ARN:
                     <code class="code">arn:aws:iam::999999999999:role/UpdateApp</code>.</p>
               <p>The response from the <code class="code">AssumeRole</code> call includes the temporary
                  credentials with an <code class="code">AccessKeyId</code> and a <code class="code">SecretAccessKey</code>.
                  It also includes an <code class="code">Expiration</code> time that indicates when the
                  credentials expire and you must request new ones. </p>
            </li><li>
               <p>With the temporary credentials, David makes an <code class="code">s3:PutObject</code> call
                  to update the <code class="code">productionapp</code> bucket. They would pass the credentials
                  to the API call as the <code class="code">AuthParams</code> parameter. Because the temporary
                  role credentials have only read and write access to the <code class="code">productionapp</code>
                  bucket, any other actions in the Production account are denied.</p>
            </li></ol></div>
         <p>For a code example (using Python), see <a href="./id_roles_use_switch-role-api.html">Switching to an IAM role (AWS API)</a>.</p>
       
    
      <h2 id="tutorial_cross-account-with-roles-related">Related resources</h2>
      <div class="itemizedlist">
          
          
          
      <ul class="itemizedlist"><li class="listitem">
            <p>For more information about IAM users and user groups, see <a href="./id.html">IAM Identities (users, user groups, and roles)</a>.</p>
         </li><li class="listitem">
            <p>For more information about Amazon S3 buckets, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html">Create a Bucket</a> in the
                  <em>Amazon Simple Storage Service User Guide</em>.</p>
         </li><li class="listitem">
            <p>
To learn whether principals in accounts outside of your zone of trust (trusted organization or account) have access to assume your roles, see 
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/what-is-access-analyzer.html">What is IAM Access Analyzer?</a>.</p>
         </li></ul></div>
    
      <h2 id="tutorial_cross-account-with-roles-summary">Summary</h2>
      <p>You have completed the cross-account API access tutorial. You created a role to
         establish trust with another account and defined what actions trusted entities can take.
         Then, you modified a user group policy to control which IAM users can access the role. As
         a result, developers from the <b>Development</b> account can make
         updates to the <code class="code">productionapp</code> bucket in the <b>Production</b> account by using temporary credentials.</p>
   <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./tutorial_billing.html">Grant access to the billing console</div><div id="next" class="next-link" accesskey="n" href="./tutorial_managed-policies.html">Create a customer managed policy</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>