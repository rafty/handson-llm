<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configuring MFA-protected API access - AWS Identity and Access Management</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="id_credentials_mfa_configure-api-require" /><meta name="default_state" content="id_credentials_mfa_configure-api-require" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" /><meta name="description" content="Configure IAM so that users must authenticate using MFA before they make programmatic calls to AWS services." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Identity and Access Management" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Control access to your AWS resources with user identity (authentication) and with policies that define specific permissions (authorization)." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" hreflang="x-default" /><meta name="feedback-item" content="IAM" /><meta name="this_doc_product" content="AWS Identity and Access Management" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'iam'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Configuring MFA-protected API access" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Configuring MFA-protected API access - AWS Identity and Access Management</title><meta name="pdf" content="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#id_credentials_mfa_configure-api-require" /><meta name="github" content="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/id_credentials_mfa_configure-api-require.md" /><meta name="rss" content="aws-iam-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=76" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html" /><meta name="keywords" content="IAM,AWS Identity and Access Management,IAM user,user,IAM group,group,IAM role,role,permission policy,trust policy,policy,access key,password" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Identity and Access Management",
        "item" : "https://docs.aws.amazon.com/iam/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "IAM Identities (users, user groups, and roles)",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "IAM users",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Using multi-factor authentication (MFA) in AWS",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Configuring MFA-protected API access",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#id_credentials_mfa_configure-api-require" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/id_credentials_mfa_configure-api-require.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iam/index.html">AWS Identity and Access Management</a><a href="introduction.html">User Guide</a></div><div id="page-toc-src"><a href="#MFAProtectedAPI-overview">Overview</a><a href="#MFAProtectedAPI-cross-account-delegation">Scenario: MFA protection for
        cross-account delegation</a><a href="#MFAProtectedAPI-user-mfa">Scenario: MFA protection for access to API
        operations in the current account</a><a href="#MFAProtectedAPI-resource-policies">Scenario: MFA protection for resources
        that have resource-based policies</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="id_credentials_mfa_configure-api-require">Configuring MFA-protected API
      access</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>With IAM policies, you can specify which API operations a user is allowed to call. In some
    cases, you might want the additional security of requiring users to be authenticated with AWS
    multi-factor authentication (MFA) before you allow them to perform particularly sensitive
    actions.</p><p>For example, you might have a policy that allows a user to perform the Amazon EC2
      <code class="code">RunInstances</code>, <code class="code">DescribeInstances</code>, and <code class="code">StopInstances</code>
    actions. But you might want to restrict a destructive action like
      <code class="code">TerminateInstances</code> and ensure that users can perform that action only if they
    authenticate with an AWS MFA device.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#MFAProtectedAPI-overview">Overview</a></li><li><a href="#MFAProtectedAPI-cross-account-delegation">Scenario: MFA protection for
        cross-account delegation</a></li><li><a href="#MFAProtectedAPI-user-mfa">Scenario: MFA protection for access to API
        operations in the current account</a></li><li><a href="#MFAProtectedAPI-resource-policies">Scenario: MFA protection for resources
        that have resource-based policies</a></li></ul></div>
    <h2 id="MFAProtectedAPI-overview">Overview</h2>



    <p>Adding MFA protection to API operations involves these tasks:</p>
    <div class="orderedlist">
       
       
       
    <ol><li>
        <p>The administrator configures an AWS MFA device for each user who needs to make API
          requests that require MFA authentication. This process is described at <a href="./id_credentials_mfa_enable.html">Enabling MFA devices for users in AWS</a>. </p>
      </li><li>
        <p>The administrator creates policies for the users that include a <code class="code">Condition</code>
          element that checks whether the user authenticated with an AWS MFA device.</p>
      </li><li>
        <p>The user calls one of the AWS STS API operations that support the MFA parameters <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">AssumeRole</a> or <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html">GetSessionToken</a>, depending on the
          scenario for MFA protection, as explained later. As part of the call, the user includes
          the device identifier for the device that's associated with the user. The user also
          includes the time-based one-time password (TOTP) that the device generates. In either
          case, the user gets back temporary security credentials that the user can then use to make
          additional requests to AWS.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>MFA protection for a service's API operations is available only if the service
            supports temporary security credentials. For a list of these services, see <a href="https://docs.aws.amazon.com/STS/latest/UsingSTS/UsingTokens.html"> Using Temporary Security Credentials to Access
              AWS</a>.</p></div></div>


      </li></ol></div>

    <p>If authorization fails, AWS returns an access denied error message (as it does for any
      unauthorized access). With MFA-protected API policies in place, AWS denies access to the API
      operations specified in the policies if the user attempts to call an API operation without
      valid MFA authentication. The operation is also denied if the time stamp of the request for
      the API operation is outside of the allowed range specified in the policy. The user must be
      reauthenticated with MFA by requesting new temporary security credentials with an MFA code and
      device serial number.</p>


     
      <h3 id="MFAProtectedAPI-policies">IAM policies with MFA conditions</h3>


      <p>Policies with MFA conditions can be attached to the following:</p>

      <div class="itemizedlist">
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>An IAM user or group</p>
        </li><li class="listitem">
          <p>A resource such as an Amazon S3 bucket, Amazon SQS queue, or Amazon SNS topic</p>
        </li><li class="listitem">
          <p>The trust policy of an IAM role that can be assumed by a user</p>
        </li></ul></div>

      <p>You can use an MFA condition in a policy to check the following properties:</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>Existence—To simply verify that the user did authenticate with MFA, check that
            the <code class="code">aws:MultiFactorAuthPresent</code> key is <code class="code">True</code> in a
              <code class="code">Bool</code> condition. The key is only present when the user authenticates with
            short-term credentials. Long-term credentials, such as access keys, do not include this
            key.</p>
        </li><li class="listitem">
          <p>Duration—If you want to grant access only within a specified time after MFA
            authentication, use a numeric condition type to compare the
              <code class="code">aws:MultiFactorAuthAge</code> key's age to a value (such as 3600 seconds). Note
            that the <code class="code">aws:MultiFactorAuthAge</code> key is not present if MFA was not
            used.</p>
        </li></ul></div>

      <p>The following example shows the trust policy of an IAM role that includes an MFA
        condition to test for the existence of MFA authentication. With this policy, users from the
        AWS account specified in the <code class="code">Principal</code> element (replace
          <code class="code">ACCOUNT-B-ID</code> with a valid AWS account ID) can assume the role that this
        policy is attached to. However such users can only assume the role if the user is
        authenticated using MFA.</p>

      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Principal": <span>{</span>"AWS": "<code class="replaceable">ACCOUNT-B-ID</code>"},
    "Action": "sts:AssumeRole",
    "Condition": <span>{</span>"Bool": <span>{</span>"aws:MultiFactorAuthPresent": "true"}}
  }
}</code></pre>
      <p>For more information on the condition types for MFA, see <a href="./reference_policies_condition-keys.html">AWS global condition context
            keys</a>, <a href="./reference_policies_elements_condition_operators.html#Conditions_Numeric">Numeric condition operators</a>, and <a href="./reference_policies_elements_condition_operators.html#Conditions_Null">Condition operator to check existence of condition keys
      </a>. </p>
     

     
      <h3 id="scenarios">Choosing between GetSessionToken and AssumeRole</h3>
      <p>AWS STS provides two API operations that let users pass MFA information:
          <code class="code">GetSessionToken</code> and <code class="code">AssumeRole</code>. The API operation that the user
        calls to get temporary security credentials depends on which of the following scenarios
        applies. </p>
      <p><b>Use <code class="code">GetSessionToken</code> for the following
          scenarios:</b></p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>Call API operations that access resources in the same AWS account as the IAM user
            who makes the request. Note that temporary credentials from a
              <code class="code">GetSessionToken</code> request can access IAM and AWS STS API operations
              <em>only</em> if you include MFA information in the request
            for credentials. Because temporary credentials returned by <code class="code">GetSessionToken</code>
            include MFA information, you can check for MFA in individual API operations made by the
            credentials. </p>
        </li><li class="listitem">
          <p>Access to resources that are protected with resource-based policies that include an
            MFA condition.</p>
        </li></ul></div>
      <p>The purpose of the <code class="code">GetSessionToken</code> operation is to authenticate the user
        using MFA. You cannot use policies to control authentication operations.</p>
      <p><b>Use <code class="code">AssumeRole</code> for the following
          scenarios:</b></p>
      <div class="itemizedlist">
         
      <ul class="itemizedlist"><li class="listitem">
          <p>Call API operations that access resources in the same or a different AWS account.
            The API calls can include any IAM or AWS STS API. Note that to protect access you
            enforce MFA at the time when the user assumes the role. The temporary credentials
            returned by <code class="code">AssumeRole</code> do not include MFA information in the context, so
            you cannot check individual API operations for MFA. This is why you must use
              <code class="code">GetSessionToken</code> to restrict access to resources protected by
            resource-based policies.</p>
        </li></ul></div>
      <p>Details about how to implement these scenarios are provided later in this
        document.</p>
     

     
      <h3 id="MFAProtectedAPI-important-points">Important points about MFA-protected API
          access</h3>


      <p>It's important to understand the following aspects of MFA protection for API
        operations:</p>

      <div class="itemizedlist">
         
         
         
         
         
         
         
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>MFA protection is available only with temporary security credentials, which must be
            obtained with <code class="code">AssumeRole</code> or <code class="code">GetSessionToken</code>. </p>
        </li><li class="listitem">
          <p>You cannot use MFA-protected API access with AWS account root user credentials.</p>
        </li><li class="listitem">
          <p>You cannot use MFA-protected API access with U2F security keys.</p>
        </li><li class="listitem">
          <p>Federated users cannot be assigned an MFA device for use with AWS services, so
            they cannot access AWS resources controlled by MFA. (See next point.) </p>
        </li><li class="listitem">
          <p>Other AWS STS API operations that return temporary credentials do not support
            MFA. For <code class="code">AssumeRoleWithWebIdentity</code> and <code class="code">AssumeRoleWithSAML</code>, the
            user is authenticated by an external provider and AWS cannot determine whether that
            provider required MFA. For <code class="code">GetFederationToken</code>, MFA is not necessarily
            associated with a specific user. </p>
        </li><li class="listitem">
          <p>Similarly, long-term credentials (IAM user access keys and root user access keys)
            cannot be used with MFA-protected API access because they don't expire.</p>
        </li><li class="listitem">
          <p><code class="code">AssumeRole</code> and <code class="code">GetSessionToken</code> can also be called without
            MFA information. In that case, the caller gets back temporary security credentials, but
            the session information for those temporary credentials does not indicate that the user
            authenticated with MFA.</p>
          
        </li><li class="listitem">
          <p>To establish MFA protection for API operations, you add MFA conditions to policies.
            A policy must include the <code class="code">aws:MultiFactorAuthPresent</code> condition key to
            enforce the use of MFA. For cross-account delegation, the role's trust policy must
            include the condition key.</p>
        </li><li class="listitem">
          <p>When you allow another AWS account to access resources in your account, the
            security of your resources depends on the configuration of the trusted account (the
            other account, not yours). This is true even when you require multi-factor
            authentication. Any identity in the trusted account that has permission to create
            virtual MFA devices can construct an MFA claim to satisfy that part of your role's trust
            policy. Before you allow members of another account access to your AWS resources that
            require multi-factor authentication, you should ensure that the trusted account's owner
            follows security best practices. For example, the trusted account should restrict access
            to sensitive API operations, such as MFA device-management API operations, to specific,
            trusted identities.</p>
        </li><li class="listitem">
          <p>If a policy includes an MFA condition, a request is denied if users have not been
            MFA authenticated, or if they provide an invalid MFA device identifier or invalid
            TOTP.</p>
        </li></ul></div>
     
   
    <h2 id="MFAProtectedAPI-cross-account-delegation">Scenario: MFA protection for
        cross-account delegation</h2>

    <p>In this scenario, you want to delegate access to IAM users in another account, but only
      if the users are authenticated with an AWS MFA device. (For more information about
      cross-account delegation, see <a href="./id_roles_terms-and-concepts.html">Roles terms and concepts</a>. </p>
    <p>Imagine that you have account A (the trusting account that owns the resource to be
      accessed), with the IAM user Anaya, who has administrator permission. She wants to grant
      access to user Richard in account B (the trusted account), but wants to make sure that Richard
      is authenticated with MFA before he assumes the role. </p>

    <div class="orderedlist">
       

       

       

       

       
    <ol><li>
        <p>In the trusting account A, Anaya creates an IAM role named
            <code class="code">CrossAccountRole</code> and sets the principal in the role's trust policy to the
          account ID of account B. The trust policy grants permission to the AWS STS
            <code class="code">AssumeRole</code> action. Anaya also adds an MFA condition to the trust policy, as
          in the following example. </p>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Principal": <span>{</span>"AWS": "<code class="replaceable">ACCOUNT-B-ID</code>"},
    "Action": "sts:AssumeRole",
    "Condition": <span>{</span>"Bool": <span>{</span>"aws:MultiFactorAuthPresent": "true"}}
  }
}</code></pre>
      </li><li>
        <p>Anaya adds a permissions policy to the role that specifies what the role is allowed to
          do. The permissions policy for a role with MFA protection is no different than any other
          role-permission policy. The following example shows the policy that Anaya adds to the
          role; it allows an assuming user to perform any Amazon DynamoDB action on the table
            <code class="code">Books</code> in account A. This policy also allows the
            <code class="code">dynamodb:ListTables</code> action, which is required to perform actions in the
          console. </p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The permissions policy does not include an MFA condition. It is important to
            understand that the MFA authentication is used only to determine whether a user can
            assume the role. Once the user has assumed the role, no further MFA checks are made.
          </p></div></div>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "TableActions",
            "Effect": "Allow",
            "Action": "dynamodb:*",
            "Resource": "arn:aws:dynamodb:*:<code class="replaceable">ACCOUNT-A-ID</code>:table/Books"
        },
        <span>{</span>
            "Sid": "ListTables",
            "Effect": "Allow",
            "Action": "dynamodb:ListTables",
            "Resource": "*"
        }
    ]
}</code></pre>
      </li><li>
        <p>In trusted account B, the administrator makes sure that IAM user Richard is
          configured with an AWS MFA device and that he knows the ID of the device. The device ID
          is the serial number if it's a hardware MFA device, or the device's ARN if it's a virtual
          MFA device.</p>
      </li><li>
        <p>In account B, the administrator attaches the following policy to user Richard (or a
          group that he's a member of) that allows him to call the <code class="code">AssumeRole</code> action.
          The resource is set to the ARN of the role that Anaya created in step 1. Notice that this
          policy does not contain an MFA condition.</p>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [<span>{</span>
    "Effect": "Allow",
    "Action": ["sts:AssumeRole"],
    "Resource": ["arn:aws:iam::<code class="replaceable">ACCOUNT-A-ID</code>:role/CrossAccountRole"]
  }]
}</code></pre>

      </li><li>
        <p>In account B, Richard (or an application that Richard is running) calls
            <code class="code">AssumeRole</code>. The API call includes the ARN of the role to assume
              (<code class="code">arn:aws:iam::<code class="replaceable">ACCOUNT-A-ID</code>:role/CrossAccountRole</code>),
          the ID of the MFA device, and the current TOTP that Richard gets from his device. </p>

        <p>When Richard calls <code class="code">AssumeRole</code>, AWS determines whether he has valid
          credentials, including the requirement for MFA. If so, Richard successfully assumes the
          role and can perform any DynamoDB action on the table named <code class="code">Books</code> in account A
          while using the role's temporary credentials. </p>

        <p>For an example of a program that calls <code class="code">AssumeRole</code>, see <a href="./id_credentials_mfa_sample-code.html#MFAProtectedAPI-example-assumerole">Calling AssumeRole with MFA
                authentication</a>.</p>
      </li></ol></div>
   
    <h2 id="MFAProtectedAPI-user-mfa">Scenario: MFA protection for access to API
        operations in the current account</h2>

    <p>In this scenario, you should ensure that a user in your AWS account can access sensitive
      API operations only when the user is authenticated using an AWS MFA device.</p>

    <p>Imagine that you have account A that contains a group of developers who need to work with
      EC2 instances. Ordinary developers can work with the instances, but they are not granted
      permissions for the <code class="code">ec2:StopInstances</code> or <code class="code">ec2:TerminateInstances</code>
      actions. You want to limit those "destructive" privileged actions to just a few trusted users,
      so you add MFA protection to the policy that allows these sensitive Amazon EC2 actions. </p>
    <p>In this scenario, one of those trusted users is user Sofía. User Anaya is an administrator
      in account A. </p>

    <div class="orderedlist">

       

       

       

       

       
    <ol><li>
        <p>Anaya makes sure that Sofía is configured with an AWS MFA device and that Sofía
          knows the ID of the device. The device ID is the serial number if it's a hardware MFA
          device, or the device's ARN if it's a virtual MFA device. </p>
      </li><li>
        <p>Anaya creates a group named <code class="code">EC2-Admins</code> and adds user Sofía to the
          group.</p>
      </li><li>
        <p>Anaya attaches the following policy to the <code class="code">EC2-Admins</code> group. This policy
          grants users permission to call the Amazon EC2 <code class="code">StopInstances</code> and
            <code class="code">TerminateInstances</code> actions only if the user has authenticated using MFA. </p>

        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [<span>{</span>
    "Effect": "Allow",
    "Action": [
      "ec2:StopInstances",
      "ec2:TerminateInstances"
    ],
    "Resource": ["*"],
    "Condition": <span>{</span>"Bool": <span>{</span>"aws:MultiFactorAuthPresent": "true"}}
  }]
}</code></pre>
      </li><li>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>For this policy to take effect, users must first sign out and then sign in
            again.</p></div></div>

        <p>If user Sofía needs to stop or terminate an Amazon EC2 instance, she (or an application
          that she is running) calls <code class="code">GetSessionToken</code>. This API operation passes the ID
          of the MFA device and the current TOTP that Sofía gets from her device.</p>
      </li><li>
        <p>User Sofía (or an application that Sofía is using) uses the temporary credentials
          provided by <code class="code">GetSessionToken</code> to call the Amazon EC2 <code class="code">StopInstances</code> or
            <code class="code">TerminateInstances</code> action. </p>

        <p>For an example of a program that calls <code class="code">GetSessionToken</code>, see <a href="./id_credentials_mfa_sample-code.html#MFAProtectedAPI-example-getsessiontoken">Calling GetSessionToken with
                MFA authentication</a> later in this document.</p>
      </li></ol></div>
   
    <h2 id="MFAProtectedAPI-resource-policies">Scenario: MFA protection for resources
        that have resource-based policies</h2>

    <p>In this scenario, you are the owner of an S3 bucket, an SQS queue, or an SNS topic. You
      want to make sure that any user from any AWS account who accesses the resource is
      authenticated by an AWS MFA device. </p>

    <p>This scenario illustrates a way to provide cross-account MFA protection without requiring
      users to assume a role first. In this case, the user can access the resource if three
      conditions are met: The user must be authenticated by MFA, be able to get temporary security
      credentials from <code class="code">GetSessionToken</code>, and be in an account that is trusted by the
      resource's policy. </p>

    <p>Imagine that you are in account A and you create an S3 bucket. You want to grant access to
      this bucket to users who are in several different AWS accounts, but only if those users are
      authenticated with MFA.</p>
    <p>In this scenario, user Anaya is an administrator in account A. User Nikhil is an IAM user
      in account C.</p>


    <div class="orderedlist">
       

       
       
       

       
    <ol><li>
        <p>In account A, Anaya creates a bucket named <code class="code">Account-A-bucket</code>.</p>
      </li><li>
        <p>Anaya adds the bucket policy to the bucket. The policy allows any user in account A,
          account B, or account C to perform the Amazon S3 <code class="code">PutObject</code> and
            <code class="code">DeleteObject</code> actions in the bucket. The policy includes an MFA condition. </p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [<span>{</span>
    "Effect": "Allow",
    "Principal": <span>{</span>"AWS": [
      "ACCOUNT-A-ID",
      "ACCOUNT-B-ID",
      "ACCOUNT-C-ID"
    ]},
    "Action": [
      "s3:PutObject",
      "s3:DeleteObject"
    ],
    "Resource": ["arn:aws:s3:::<code class="replaceable">ACCOUNT-A-BUCKET-NAME</code>/*"],
    "Condition": <span>{</span>"Bool": <span>{</span>"aws:MultiFactorAuthPresent": "true"}}
  }]
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Amazon S3 offers an MFA Delete feature for <em>root</em> account access
            (only). You can enable Amazon S3 MFA Delete when you set the versioning state of the bucket.
            Amazon S3 MFA Delete cannot be applied to an IAM user, and is managed independently from
            MFA-protected API access. An IAM user with permissions to delete a bucket cannot delete
            a bucket with Amazon S3 MFA Delete enabled. For more information on Amazon S3 MFA Delete, see
              <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/MultiFactorAuthenticationDelete.html">MFA
            Delete</a>.</p></div></div>
      </li><li>

        <p>In account C, an administrator makes sure that user Nikhil is configured with an AWS
          MFA device and that he knows the ID of the device. The device ID is the serial number if
          it's a hardware MFA device, or the device's ARN if it's a virtual MFA device. </p>
      </li><li>
        <p>In account C, Nikhil (or an application that he is running) calls
            <code class="code">GetSessionToken</code>. The call includes the ID or ARN of the MFA device and the
          current TOTP that Nikhil gets from his device. </p>
      </li><li>
        <p>Nikhil (or an application that he is using) uses the temporary credentials returned by
            <code class="code">GetSessionToken</code> to call the Amazon S3 <code class="code">PutObject</code> action to upload a
          file to <code class="code">Account-A-bucket</code>. </p>
        <p>For an example of a program that calls <code class="code">GetSessionToken</code>, see <a href="./id_credentials_mfa_sample-code.html#MFAProtectedAPI-example-getsessiontoken">Calling GetSessionToken with
                MFA authentication</a> later in this document.</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>The temporary credentials that <code class="code">AssumeRole</code> returns won't work in this
            case. Although the user can provide MFA information to assume a role, the temporary
            credentials returned by <code class="code">AssumeRole</code> don't include the MFA information. That
            information is required in order to meet the MFA condition in the policy. </p></div></div>
      </li></ol></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./id_credentials_mfa_lost-or-broken.html">What if an MFA device is lost or stops
      working?</div><div id="next" class="next-link" accesskey="n" href="./id_credentials_mfa_sample-code.html">Sample code: MFA</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>