<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Sample code: Requesting credentials with multi-factor authentication - AWS Identity and Access Management</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="id_credentials_mfa_sample-code" /><meta name="default_state" content="id_credentials_mfa_sample-code" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" /><meta name="description" content="Examine sample code to see how to request temporary security credentials that enforce multi-factor authentication (MFA)." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Identity and Access Management" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Control access to your AWS resources with user identity (authentication) and with policies that define specific permissions (authorization)." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" hreflang="x-default" /><meta name="feedback-item" content="IAM" /><meta name="this_doc_product" content="AWS Identity and Access Management" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'iam'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Sample code: Requesting credentials with multi-factor authentication" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Sample code: Requesting credentials with multi-factor authentication - AWS Identity and Access Management</title><meta name="pdf" content="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#id_credentials_mfa_sample-code" /><meta name="github" content="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/id_credentials_mfa_sample-code.md" /><meta name="rss" content="aws-iam-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=76" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html" /><meta name="keywords" content="IAM,AWS Identity and Access Management,IAM user,user,IAM group,group,IAM role,role,permission policy,trust policy,policy,access key,password" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Identity and Access Management",
        "item" : "https://docs.aws.amazon.com/iam/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "IAM Identities (users, user groups, and roles)",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "IAM users",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Using multi-factor authentication (MFA) in AWS",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "Sample code: Requesting credentials with multi-factor authentication",
        "item" : "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/IAM/latest/UserGuide/iam-ug.pdf#id_credentials_mfa_sample-code" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/iam-user-guide/tree/main/doc_source/id_credentials_mfa_sample-code.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/iam/index.html">AWS Identity and Access Management</a><a href="introduction.html">User Guide</a></div><div id="page-toc-src"><a href="#MFAProtectedAPI-example-getsessiontoken">Calling GetSessionToken with
                MFA authentication</a><a href="#MFAProtectedAPI-example-assumerole">Calling AssumeRole with MFA
                authentication</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="id_credentials_mfa_sample-code">Sample code: Requesting credentials with
            multi-factor authentication</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>The following examples show how to call <code class="code">GetSessionToken</code> and
            <code class="code">AssumeRole</code> operations and pass MFA authentication parameters. No
        permissions are required to call <code class="code">GetSessionToken</code>, but you must have a policy
        that allows you to call <code class="code">AssumeRole</code>. The credentials returned are then used to
        list all S3 buckets in the account.</p>
        <h2 id="MFAProtectedAPI-example-getsessiontoken">Calling GetSessionToken with
                MFA authentication</h2>
        <p>The following example shows how to call <code class="code">GetSessionToken</code> and pass MFA
            authentication information. The temporary security credentials returned by the
                <code class="code">GetSessionToken</code> operation are then used to list all S3 buckets in the
            account.</p>
        <p>The policy attached to the user who runs this code (or to a group that the user is in)
            provides the permissions for the returned temporary credentials. For this example code,
            the policy must grant the user permission to request the Amazon S3 <code class="code">ListBuckets</code>
            operation. </p>
        
<p>The following code example shows how to get a session token with AWS STS and use it to perform a service action that requires an MFA token.</p>

        <awsdocs-tabs><dl style="display: none">
    <dt>Python</dt><dd tab-id="python">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for Python (Boto3)</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/python/example_code/sts#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p>Get a session token by passing an MFA token and use it to list Amazon S3 buckets for the account.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">def list_buckets_with_session_token_with_mfa(mfa_serial_number, mfa_totp, sts_client):
    """
    Gets a session token with MFA credentials and uses the temporary session
    credentials to list Amazon S3 buckets.

    Requires an MFA device serial number and token.

    :param mfa_serial_number: The serial number of the MFA device. For a virtual MFA
                              device, this is an Amazon Resource Name (ARN).
    :param mfa_totp: A time-based, one-time password issued by the MFA device.
    :param sts_client: A Boto3 STS instance that has permission to assume the role.
    """
    if mfa_serial_number is not None:
        response = sts_client.get_session_token(
            SerialNumber=mfa_serial_number, TokenCode=mfa_totp)
    else:
        response = sts_client.get_session_token()
    temp_credentials = response['Credentials']

    s3_resource = boto3.resource(
        's3',
        aws_access_key_id=temp_credentials['AccessKeyId'],
        aws_secret_access_key=temp_credentials['SecretAccessKey'],
        aws_session_token=temp_credentials['SessionToken'])

    print(f"Buckets for the account:")
    for bucket in s3_resource.buckets.all():
        print(bucket.name)

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/boto3/sts-2011-06-15/GetSessionToken">GetSessionToken</a>
                        in <em>AWS SDK for Python (Boto3) API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
</dl></awsdocs-tabs>
     
        <h2 id="MFAProtectedAPI-example-assumerole">Calling AssumeRole with MFA
                authentication</h2>
        <p>The following examples show how to call <code class="code">AssumeRole</code> and pass MFA
            authentication information. The temporary security credentials returned by
                <code class="code">AssumeRole</code> are then used to list all Amazon S3 buckets in the
            account.</p>
        <p>For more information about this scenario, see <a href="./id_credentials_mfa_configure-api-require.html#MFAProtectedAPI-cross-account-delegation">Scenario: MFA protection for
        cross-account delegation</a>. </p>
        
<p>The following code examples show how to assume a role with AWS STS.</p>

        <awsdocs-tabs><dl style="display: none">
    <dt>.NET</dt><dd tab-id=".net">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">AWS SDK for .NET</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/dotnetv3/STS#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="csharp ">using Amazon;
using Amazon.SecurityToken;
using Amazon.SecurityToken.Model;
using System;
using System.Threading.Tasks;

namespace AssumeRoleExample
<span>{</span>
    class AssumeRole
    <span>{</span>
        /// &lt;summary&gt;
        /// This example shows how to use the AWS Security Token
        /// Service (AWS STS) to assume an IAM role.
        /// 
        /// NOTE: It is important that the role that will be assumed has a
        /// trust relationship with the account that will assume the role.
        /// 
        /// Before you run the example, you need to create the role you want to
        /// assume and have it trust the IAM account that will assume that role.
        /// 
        /// See https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create.html
        /// for help in working with roles.
        /// &lt;/summary&gt;

        private static readonly RegionEndpoint REGION = RegionEndpoint.USWest2;

        static async Task Main()
        <span>{</span>
            // Create the SecurityToken client and then display the identity of the
            // default user.
            var roleArnToAssume = "arn:aws:iam::123456789012:role/testAssumeRole";

            var client = new Amazon.SecurityToken.AmazonSecurityTokenServiceClient(REGION);

            // Get and display the information about the identity of the default user.
            var callerIdRequest = new GetCallerIdentityRequest();
            var caller = await client.GetCallerIdentityAsync(callerIdRequest);
            Console.WriteLine($"Original Caller: <span>{</span>caller.Arn}");

            // Create the request to use with the AssumeRoleAsync call.
            var assumeRoleReq = new AssumeRoleRequest()
            <span>{</span>
                DurationSeconds = 1600,
                RoleSessionName = "Session1",
                RoleArn = roleArnToAssume
            };

            var assumeRoleRes = await client.AssumeRoleAsync(assumeRoleReq);

            // Now create a new client based on the credentials of the caller assuming the role.
            var client2 = new AmazonSecurityTokenServiceClient(credentials: assumeRoleRes.Credentials);

            // Get and display information about the caller that has assumed the defined role.
            var caller2 = await client2.GetCallerIdentityAsync(callerIdRequest);
            Console.WriteLine($"AssumedRole Caller: <span>{</span>caller2.Arn}");
        }
    }
}

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/DotNetSDKV3/sts-2011-06-15/AssumeRole">AssumeRole</a>
                        in <em>AWS SDK for .NET API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>C++</dt><dd tab-id="c++">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for C++</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/cpp/example_code/sts#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="cpp ">bool AwsDoc::STS::assumeRole(const Aws::String &amp;roleArn,
                             const Aws::String &amp;roleSessionName,
                             const Aws::String &amp;externalId,
                             Aws::Auth::AWSCredentials &amp;credentials,
                             const Aws::Client::ClientConfiguration &amp;clientConfig) <span>{</span>
    Aws::STS::STSClient sts(clientConfig);
    Aws::STS::Model::AssumeRoleRequest sts_req;

    sts_req.SetRoleArn(roleArn);
    sts_req.SetRoleSessionName(roleSessionName);
    sts_req.SetExternalId(externalId);

    const Aws::STS::Model::AssumeRoleOutcome outcome = sts.AssumeRole(sts_req);

    if (!outcome.IsSuccess()) <span>{</span>
        std::cerr &lt;&lt; "Error assuming IAM role. " &lt;&lt;
                  outcome.GetError().GetMessage() &lt;&lt; std::endl;
    }
    else <span>{</span>
        std::cout &lt;&lt; "Credentials successfully retrieved." &lt;&lt; std::endl;
        const Aws::STS::Model::AssumeRoleResult result = outcome.GetResult();
        const Aws::STS::Model::Credentials &amp;temp_credentials = result.GetCredentials();

        // Store temporary credentials in return argument.
        // Note: The credentials object returned by assumeRole differs
        // from the AWSCredentials object used in most situations.
        credentials.SetAWSAccessKeyId(temp_credentials.GetAccessKeyId());
        credentials.SetAWSSecretKey(temp_credentials.GetSecretAccessKey());
        credentials.SetSessionToken(temp_credentials.GetSessionToken());
    }

    return outcome.IsSuccess();
}

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/SdkForCpp/sts-2011-06-15/AssumeRole">AssumeRole</a>
                        in <em>AWS SDK for C++ API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>Java</dt><dd tab-id="java">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for Java 2.x</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/sts#readme" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="java ">    public static void assumeGivenRole(StsClient stsClient, String roleArn, String roleSessionName) <span>{</span>

        try <span>{</span>
            AssumeRoleRequest roleRequest = AssumeRoleRequest.builder()
                .roleArn(roleArn)
                .roleSessionName(roleSessionName)
                .build();

           AssumeRoleResponse roleResponse = stsClient.assumeRole(roleRequest);
           Credentials myCreds = roleResponse.credentials();

           // Display the time when the temp creds expire.
           Instant exTime = myCreds.expiration();
           String tokenInfo = myCreds.sessionToken();

           // Convert the Instant to readable date.
           DateTimeFormatter formatter =
                   DateTimeFormatter.ofLocalizedDateTime( FormatStyle.SHORT )
                           .withLocale( Locale.US)
                           .withZone( ZoneId.systemDefault() );

           formatter.format( exTime );
           System.out.println("The token "+tokenInfo + "  expires on " + exTime );

       } catch (StsException e) <span>{</span>
           System.err.println(e.getMessage());
           System.exit(1);
       }
   }

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/SdkForJavaV2/sts-2011-06-15/AssumeRole">AssumeRole</a>
                        in <em>AWS SDK for Java 2.x API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>JavaScript</dt><dd tab-id="javascript">
            <div class="variablelist">
     
     
<dl>
        <dt><b><span class="term">SDK for JavaScript (v3)</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javascriptv3/example_code/sts#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p>Create the client.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="javascript ">import <span>{</span> STSClient } from "@aws-sdk/client-sts";
// Set the AWS Region.
const REGION = "us-east-1";
// Create an AWS STS service client object.
export const client = new STSClient(<span>{</span> region: REGION });

</code></pre>
             
             
                <p>Assume the IAM role.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="javascript ">import <span>{</span> AssumeRoleCommand } from "@aws-sdk/client-sts";

import <span>{</span> client } from "../libs/client.js";

export const main = async () =&gt; <span>{</span>
  try <span>{</span>
    // Returns a set of temporary security credentials that you can use to
    // access Amazon Web Services resources that you might not normally 
    // have access to.
    const command = new AssumeRoleCommand(<span>{</span>
      // The Amazon Resource Name (ARN) of the role to assume.
      RoleArn: "ROLE_ARN",
      // An identifier for the assumed role session.
      RoleSessionName: "session1",
      // The duration, in seconds, of the role session. The value specified
      // can range from 900 seconds (15 minutes) up to the maximum session 
      // duration set for the role.
      DurationSeconds: 900,
    });
    const response = await client.send(command);
    console.log(response);
  } catch (err) <span>{</span>
    console.error(err);
  }
};

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-sts/classes/assumerolecommand.html">AssumeRole</a>
                        in <em>AWS SDK for JavaScript API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    
        <dt><b><span class="term">SDK for JavaScript (v2)</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javascript/example_code/sts#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="javascript ">// Load the AWS SDK for Node.js
const AWS = require('aws-sdk');
// Set the region 
AWS.config.update(<span>{</span>region: 'REGION'});

var roleToAssume = <span>{</span>RoleArn: 'arn:aws:iam::123456789012:role/RoleName',
                    RoleSessionName: 'session1',
                    DurationSeconds: 900,};
var roleCreds;

// Create the STS service object    
var sts = new AWS.STS(<span>{</span>apiVersion: '2011-06-15'});

//Assume Role
sts.assumeRole(roleToAssume, function(err, data) <span>{</span>
    if (err) console.log(err, err.stack);
    else<span>{</span>
        roleCreds = <span>{</span>accessKeyId: data.Credentials.AccessKeyId,
                     secretAccessKey: data.Credentials.SecretAccessKey,
                     sessionToken: data.Credentials.SessionToken};
        stsGetCallerIdentity(roleCreds);
    }
});

//Get Arn of current identity
function stsGetCallerIdentity(creds) <span>{</span>
    var stsParams = <span>{</span>credentials: creds };
    // Create STS service object
    var sts = new AWS.STS(stsParams);
        
    sts.getCallerIdentity(<span>{</span>}, function(err, data) <span>{</span>
        if (err) <span>{</span>
            console.log(err, err.stack);
        }
        else <span>{</span>
            console.log(data.Arn);
        }
    });    
}

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/AWSJavaScriptSDK/sts-2011-06-15/AssumeRole">AssumeRole</a>
                        in <em>AWS SDK for JavaScript API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>Python</dt><dd tab-id="python">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for Python (Boto3)</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/python/example_code/sts#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p>Assume an IAM role that requires an MFA token and use temporary credentials to list Amazon S3 buckets for the account.</p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="python ">def list_buckets_from_assumed_role_with_mfa(
        assume_role_arn, session_name, mfa_serial_number, mfa_totp, sts_client):
    """
    Assumes a role from another account and uses the temporary credentials from
    that role to list the Amazon S3 buckets that are owned by the other account.
    Requires an MFA device serial number and token.

    The assumed role must grant permission to list the buckets in the other account.

    :param assume_role_arn: The Amazon Resource Name (ARN) of the role that
                            grants access to list the other account's buckets.
    :param session_name: The name of the STS session.
    :param mfa_serial_number: The serial number of the MFA device. For a virtual MFA
                              device, this is an ARN.
    :param mfa_totp: A time-based, one-time password issued by the MFA device.
    :param sts_client: A Boto3 STS instance that has permission to assume the role.
    """
    response = sts_client.assume_role(
        RoleArn=assume_role_arn,
        RoleSessionName=session_name,
        SerialNumber=mfa_serial_number,
        TokenCode=mfa_totp)
    temp_credentials = response['Credentials']
    print(f"Assumed role <span>{</span>assume_role_arn} and got temporary credentials.")

    s3_resource = boto3.resource(
        's3',
        aws_access_key_id=temp_credentials['AccessKeyId'],
        aws_secret_access_key=temp_credentials['SecretAccessKey'],
        aws_session_token=temp_credentials['SessionToken'])

    print(f"Listing buckets for the assumed role's account:")
    for bucket in s3_resource.buckets.all():
        print(bucket.name)

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/boto3/sts-2011-06-15/AssumeRole">AssumeRole</a>
                        in <em>AWS SDK for Python (Boto3) API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>Ruby</dt><dd tab-id="ruby">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for Ruby</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/ruby/example_code/iam#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="ruby ">  # Creates an AWS Security Token Service (AWS STS) client with specified credentials.
  # This is separated into a factory function so that it can be mocked for unit testing.
  #
  # @param key_id [String] The ID of the access key used by the STS client.
  # @param key_secret [String] The secret part of the access key used by the STS client.
  def create_sts_client(key_id, key_secret)
    Aws::STS::Client.new(access_key_id: key_id, secret_access_key: key_secret)
  end

  # Gets temporary credentials that can be used to assume a role.
  #
  # @param role_arn [String] The ARN of the role that is assumed when these credentials
  #                          are used.
  # @param sts_client [AWS::STS::Client] An AWS STS client.
  # @return [Aws::AssumeRoleCredentials] The credentials that can be used to assume the role.
  def assume_role(role_arn, sts_client)
    credentials = Aws::AssumeRoleCredentials.new(
      client: sts_client,
      role_arn: role_arn,
      role_session_name: "create-use-assume-role-scenario"
    )
    puts("Assumed role '#<span>{</span>role_arn}', got temporary credentials.")
    credentials
  end

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.aws.amazon.com/goto/SdkForRubyV3/sts-2011-06-15/AssumeRole">AssumeRole</a>
                        in <em>AWS SDK for Ruby API Reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>Rust</dt><dd tab-id="rust">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for Rust</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>This documentation is for an SDK in preview release. The SDK is subject to change and should not be used in production.</p></div></div>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/rust_dev_preview/sts/#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="rust ">async fn assume_role(
    config: &amp;SdkConfig,
    region: Region,
    role_name: String,
    session_name: Option&lt;String&gt;,
) -&gt; Result&lt;(), Error&gt; <span>{</span>
    match config.credentials_provider() <span>{</span>
        Some(credential) =&gt; <span>{</span>
            let provider = aws_config::sts::AssumeRoleProvider::builder(role_name)
                .region(region)
                .session_name(session_name.unwrap_or_else(|| String::from("rust-assume-role")))
                .build(credential.clone());
            let local_config = aws_config::from_env()
                .credentials_provider(provider)
                .load()
                .await;
            let client = Client::new(&amp;local_config);
            let req = client.get_caller_identity();
            let resp = req.send().await;
            match resp <span>{</span>
                Ok(e) =&gt; <span>{</span>
                    println!("UserID :               <span>{</span>}", e.user_id().unwrap_or_default());
                    println!("Account:               <span>{</span>}", e.account().unwrap_or_default());
                    println!("Arn    :               <span>{</span>}", e.arn().unwrap_or_default());
                }
                Err(e) =&gt; println!("<span>{</span>:?}", e),
            }
        }
        None =&gt; <span>{</span>
            println!("No config provided");
        }
    }
    Ok(())
}

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://docs.rs/releases/search?query=aws-sdk" rel="noopener noreferrer" target="_blank"><span>AssumeRole</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                        in <em>AWS SDK for Rust API reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
    <dt>Swift</dt><dd tab-id="swift">
            <div class="variablelist">
     
<dl>
        <dt><b><span class="term">SDK for Swift</span></b></dt>
        <dd>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>This is prerelease documentation for an SDK in preview release. It is subject to change.</p></div></div>
            <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>
                    There's more on GitHub. Find the complete example and learn how to set up and run in the
                    <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/swift/example_code/iam#code-examples" rel="noopener noreferrer" target="_blank"><span>AWS Code Examples Repository</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                </p></div></div>
             
                <p></p>
                
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="swift ">    public func assumeRole(role: IAMClientTypes.Role, sessionName: String)
                    async throws -&gt; STSClientTypes.Credentials <span>{</span>
        let input = AssumeRoleInput(
            roleArn: role.arn,
            roleSessionName: sessionName
        )
        do <span>{</span>
            let output = try await stsClient.assumeRole(input: input)

            guard let credentials = output.credentials else <span>{</span>
                throw ServiceHandlerError.authError
            }

            return credentials
        } catch <span>{</span>
            throw error
        }
    }

</code></pre>
             
            <div class="itemizedlist">
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>
                        For API details, see
                        <a href="https://awslabs.github.io/aws-sdk-swift/reference/0.x" rel="noopener noreferrer" target="_blank"><span>AssumeRole</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                        in <em>AWS SDK for Swift API reference</em>.
                    </p>
                </li></ul></div>
        </dd>
    </dl></div>
        </dd>
</dl></awsdocs-tabs>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./id_credentials_mfa_configure-api-require.html">Configuring MFA-protected API
      access</div><div id="next" class="next-link" accesskey="n" href="./id_credentials_finding-unused.html">Finding unused credentials</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/en_us/IAM/latest/UserGuide/id_credentials_mfa_sample-code.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>