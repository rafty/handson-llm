<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Connecting to AWS KMS through a VPC endpoint - AWS Key Management Service</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="kms-vpc-endpoint" /><meta name="default_state" content="kms-vpc-endpoint" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/kms/latest/developerguide/kms-vpc-endpoint.html" /><meta name="description" content="Learn how to connect to AWS KMS) from a private endpoint in your VPC." /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Key Management Service" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Learn how to use AWS Key Management Service (AWS KMS) to securely store and manage encryption keys and perform encryption and decryption of user data." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/kms/latest/developerguide/kms-vpc-endpoint.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/kms/latest/developerguide/kms-vpc-endpoint.html" hreflang="x-default" /><meta name="feedback-item" content="Key Management Service (KMS)" /><meta name="this_doc_product" content="AWS Key Management Service" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'kms'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="Connecting to AWS KMS through a VPC endpoint" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Connecting to AWS KMS through a VPC endpoint - AWS Key Management Service</title><meta name="pdf" content="/pdfs/kms/latest/developerguide/kms-dg.pdf#kms-vpc-endpoint" /><meta name="github" content="https://github.com/awsdocs/aws-kms-developer-guide/tree/master/doc_source/kms-vpc-endpoint.md" /><meta name="rss" content="aws-kms-document-history.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=182" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Key%20Management%20Service%20%28KMS%29&amp;topic_url=http://docs.aws.amazon.com/en_us/kms/latest/developerguide/kms-vpc-endpoint.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/kms/latest/developerguide/kms-vpc-endpoint.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/kms/latest/developerguide/kms-vpc-endpoint.html" /><meta name="keywords" content="KMS,key management service,encryption key management,encryption key,,envelope encryption" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS KMS",
        "item" : "https://docs.aws.amazon.com/kms/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/kms/latest/developerguide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Authentication and access control for AWS KMS",
        "item" : "https://docs.aws.amazon.com/kms/latest/developerguide/control-access.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Connecting to AWS KMS through a VPC endpoint",
        "item" : "https://docs.aws.amazon.com/kms/latest/developerguide/control-access.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/kms/latest/developerguide/kms-dg.pdf#kms-vpc-endpoint" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/aws-kms-developer-guide/tree/master/doc_source/kms-vpc-endpoint.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/kms/index.html">AWS KMS</a><a href="overview.html">Developer Guide</a></div><div id="page-toc-src"><a href="#vpce-considerations">Considerations for AWS KMS VPC endpoints</a><a href="#vpce-create-endpoint">Creating a VPC endpoint for AWS KMS</a><a href="#vpce-connect">Connecting to a VPC endpoint</a><a href="#vpce-policy">Controlling access to a VPC endpoint</a><a href="#vpce-policy-condition">Using a VPC endpoint in a policy statement</a><a href="#vpce-logging">Logging your VPC endpoint</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="kms-vpc-endpoint">Connecting to AWS KMS through a VPC endpoint</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>You can connect directly to AWS KMS through a private interface endpoint in your virtual
    private cloud (VPC). When you use an interface VPC endpoint, communication between your VPC and
    AWS KMS is conducted entirely within the AWS network.</p><p>AWS KMS supports Amazon Virtual Private Cloud (Amazon VPC) endpoints powered by <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/">AWS PrivateLink</a>. Each VPC endpoint is represented by one or more <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html">Elastic Network Interfaces</a> (ENIs) with private IP
    addresses in your VPC subnets. </p><p>The interface VPC endpoint connects your VPC directly to AWS KMS without an internet gateway,
    NAT device, VPN connection, or AWS Direct Connect connection. The instances in your VPC do not need
    public IP addresses to communicate with AWS KMS. </p><a id="vpc-regions"></a>
    <h6>Regions</h6>
    <p>AWS KMS supports VPC endpoints and VPC endpoint policies in all AWS Regions in which
        <a href="https://docs.aws.amazon.com/general/latest/gr/kms.html">AWS KMS</a> is supported.</p>
  <div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#vpce-considerations">Considerations for AWS KMS VPC endpoints</a></li><li><a href="#vpce-create-endpoint">Creating a VPC endpoint for AWS KMS</a></li><li><a href="#vpce-connect">Connecting to an AWS KMS VPC endpoint</a></li><li><a href="#vpce-policy">Controlling access to a VPC endpoint</a></li><li><a href="#vpce-policy-condition">Using a VPC endpoint in a policy statement</a></li><li><a href="#vpce-logging">Logging your VPC endpoint</a></li></ul></div>
    <h2 id="vpce-considerations">Considerations for AWS KMS VPC endpoints</h2>
    <p>Before you set up an interface VPC endpoint for AWS KMS, review the <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#vpce-interface-limitations">Interface endpoint
        properties and limitations</a> topic in the <em>AWS PrivateLink Guide</em>.</p>
    <p>AWS KMS support for a VPC endpoint includes the following.</p>
    <div class="itemizedlist">
       
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>You can use your VPC endpoint to call all <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_Operations.html">AWS KMS API operations</a> from your
          VPC.</p>
      </li><li class="listitem">
        <p>You can create an interface VPC endpoint that connects to an AWS KMS region endpoint or an <a href="https://docs.aws.amazon.com/general/latest/gr/kms.html">AWS KMS FIPS
          endpoint</a>.</p>
      </li><li class="listitem">
        <p>You can use AWS CloudTrail logs to audit your use of KMS keys through the VPC endpoint.
          For details, see <a href="#vpce-logging">Logging your VPC endpoint</a>.</p>
      </li></ul></div>
   
    <h2 id="vpce-create-endpoint">Creating a VPC endpoint for AWS KMS</h2>
    <p>You can create a VPC endpoint for AWS KMS by using the Amazon VPC console or the Amazon VPC API. For
      more information, see <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#create-interface-endpoint">Create an interface
        endpoint</a> in the <em>AWS PrivateLink Guide</em>.</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>To create a VPC endpoint for AWS KMS, use the following service name: </p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">com.amazonaws.<code class="replaceable">region</code>.kms</code></pre>
        <p>For example, in the US West (Oregon) Region (<code class="code">us-west-2</code>), the service
          name would be:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">com.amazonaws.us-west-2.kms</code></pre>
      </li><li class="listitem">
        <p>To create a VPC endpoint that connects to an <a href="https://docs.aws.amazon.com/general/latest/gr/kms.html">AWS KMS FIPS
          endpoint</a>, use the following service name:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">com.amazonaws.<code class="replaceable">region</code>.kms-fips</code></pre>
        <p>For example, in the US West (Oregon) Region (<code class="code">us-west-2</code>), the service
          name would be:</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight ">com.amazonaws.us-west-2.kms-fips</code></pre>
      </li></ul></div>
    <p>To make it easier to use the VPC endpoint, you can enable a <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/verify-domains.html">private DNS name</a> for your VPC
      endpoint. If you select the <b>Enable DNS Name</b> option, the standard AWS KMS
      DNS hostname resolves to your VPC endpoint. For example,
        <code class="code">https://kms.us-west-2.amazonaws.com</code> would resolve to a VPC endpoint connected
      to service name <code class="code">com.amazonaws.us-west-2.kms</code>.</p>
    <p>This option makes it easier to use the VPC endpoint. The AWS SDKs and AWS CLI use the
      standard AWS KMS DNS hostname by default, so you do not need to specify the VPC endpoint URL in
      applications and commands.</p>
    <p>For more information, see <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#access-service-though-endpoint">Accessing a
        service through an interface endpoint</a> in the
        <em>AWS PrivateLink Guide</em>.</p>
   
    <h2 id="vpce-connect">Connecting to an AWS KMS VPC endpoint</h2>
    <p>You can connect to AWS KMS through the VPC endpoint by using an AWS SDK, the AWS CLI or
      AWS Tools for PowerShell. To specify the VPC endpoint, use its DNS name. </p>
    <p>For example, this <a href="https://docs.aws.amazon.com/cli/latest/reference/kms/list-keys.html">list-keys</a> command
      uses the <code class="code">endpoint-url</code> parameter to specify the VPC endpoint. To use a command
      like this, replace the example VPC endpoint ID with one in your account.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash "><code class="prompt" copy="false">$ </code><code class="userinput">aws kms list-keys --endpoint-url <code class="replaceable">https://vpce-1234abcdf5678c90a-09p7654s-us-east-1a.ec2.us-east-1.vpce.amazonaws.com</code></code></code></pre>
    <p>If you enabled private hostnames when you created your VPC endpoint, you do not need to
      specify the VPC endpoint URL in your CLI commands or application configuration. The standard
      AWS KMS DNS hostname resolves to your VPC endpoint. The AWS CLI and SDKs use this hostname by
      default, so you can begin using the VPC endpoint to connect to an AWS KMS regional endpoint
      without changing anything in your scripts and applications. </p>
    <p>To use private hostnames, the <code class="code">enableDnsHostnames</code> and
        <code class="code">enableDnsSupport</code> attributes of your VPC must be set to <code class="code">true</code>. To
      set these attributes, use the <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifyVpcAttribute.html">ModifyVpcAttribute</a> operation. For details, see <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html#vpc-dns-updating">View and update DNS attributes for your
        VPC</a> in the <em>Amazon VPC User Guide</em>.</p>
   
    <h2 id="vpce-policy">Controlling access to a VPC endpoint</h2>
    <p>To control access to your VPC endpoint for AWS KMS, attach a <em>VPC
        endpoint policy</em> to your VPC endpoint. The endpoint policy determines whether
      principals can use the VPC endpoint to call AWS KMS operations on AWS KMS resources.</p>
    <p>You can create a VPC endpoint policy when you create your endpoint, and you can change the
      VPC endpoint policy at any time. Use the VPC management console, or the <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateVpcEndpoint.html">CreateVpcEndpoint</a> or <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifyVpcEndpoint.html">ModifyVpcEndpoint</a> operations. You can
      also create and change a VPC endpoint policy by <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpcendpoint.html">using an AWS CloudFormation template</a>.
      For help using the VPC management console, see <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#create-interface-endpoint">Create an interface
        endpoint</a> and <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#modify-interface-endpoint">Modifying an
        interface endpoint</a> in the <em>AWS PrivateLink Guide</em>.</p>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>AWS KMS supports VPC endpoint policies beginning in July 2020. VPC endpoints for AWS KMS
        that were created before that date have the <a href="#vpce-default-policy">default VPC
          endpoint policy</a>, but you can change it at any time.</p></div></div>
    <p>For help writing and formatting a JSON policy document, see the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies.html">IAM JSON Policy Reference</a> in the <em>IAM User Guide</em>.</p>
    <div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#vpce-policy-about">About VPC endpoint policies</a></li><li><a href="#vpce-default-policy">Default VPC endpoint policy</a></li><li><a href="#vpce-policy-create">Creating a VPC endpoint policy</a></li><li><a href="#vpce-policy-get">Viewing a VPC endpoint policy</a></li></ul></div>

     
      <h3 id="vpce-policy-about">About VPC endpoint policies</h3>
      <p>For an AWS KMS request that uses a VPC endpoint to be successful, the principal requires
        permissions from two sources:</p>
      <div class="itemizedlist">
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>A <a href="./key-policies.html">key policy</a>, <a href="./iam-policies.html">IAM
              policy</a>, or <a href="./grants.html">grant</a> must give principal permission
            to call the operation on the resource (KMS key or alias).</p>
        </li><li class="listitem">
          <p>A VPC endpoint policy must give the principal permission to use the endpoint to make
            the request.</p>
        </li></ul></div>
      <p>For example, a key policy might give a principal permission to call <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html">Decrypt</a> on a particular KMS key. However,
        the VPC endpoint policy might not allow that principal to call <code class="code">Decrypt</code> on that
        KMS key by using the endpoint.</p>
      <p>Or a VPC endpoint policy might allow a principal to use the endpoint to call <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_DisableKey.html">DisableKey</a> on certain KMS keys. But if
        the principal doesn't have those permissions from a key policy, IAM policy, or grant, the
        request fails.</p>
     

     
      <h3 id="vpce-default-policy">Default VPC endpoint policy</h3>
      <p>Every VPC endpoint has a VPC endpoint policy, but you are not required to specify the
        policy. If you don't specify a policy, the default endpoint policy allows all operations by
        all principals on all resources over the endpoint. </p>
      <p>However, for AWS KMS resources, the principal must also have permission to call the
        operation from a <a href="./key-policies.html">key policy</a>, <a href="./iam-policies.html">IAM policy</a>, or <a href="./grants.html">grant</a>.
        Therefore, in practice, the default policy says that if a principal has permission to call
        an operation on a resource, they can also call it by using the endpoint.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement": [
    <span>{</span>
      "Action": "*", 
      "Effect": "Allow", 
      "Principal": "*", 
      "Resource": "*"
    }
  ]
}</code></pre>
      <p> To allow principals to use the VPC endpoint for only a subset of their permitted
        operations, <a href="#vpce-policy-create">create or update the VPC endpoint
          policy</a>.</p>
     


     
      <h3 id="vpce-policy-create">Creating a VPC endpoint policy</h3>
      <p>A VPC endpoint policy determines whether a principal has permission to use the VPC
        endpoint to perform operations on a resource. For AWS KMS resources, the principal must also
        have permission to perform the operations from a <a href="./key-policies.html">key
          policy</a>, <a href="./iam-policies.html">IAM policy</a>, or <a href="./grants.html">grant</a>.</p>
      <p>Each VPC endpoint policy statement requires the following elements:</p>
      <div class="itemizedlist">
         
         
         
      <ul class="itemizedlist"><li class="listitem">
          <p>The principal that can perform actions</p>
        </li><li class="listitem">
          <p>The actions that can be performed</p>
        </li><li class="listitem">
          <p>The resources on which actions can be performed</p>
        </li></ul></div>
      <p>The policy statement doesn't specify the VPC endpoint. Instead, it applies to any VPC
        endpoint to which the policy is attached. For more information, see <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints-access.html">Controlling access to services with VPC
          endpoints</a> in the <em>Amazon VPC User Guide</em>. </p>
       
        <p>The following is an example of a VPC endpoint policy for AWS KMS. When attached to a VPC
          endpoint, this policy allows <code class="code">ExampleUser</code> to use the VPC endpoint to call the
          specified operations on the specified KMS keys. Before using a policy like this one,
          replace the example principal and <a href="./concepts.html#key-id-key-ARN">key ARN</a> with valid
          values from your account.</p>
       
      
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Statement":[
      <span>{</span>
         "Sid": "AllowDecryptAndView",
         "Principal": <span>{</span>"AWS": "<code class="replaceable">arn:aws:iam::111122223333:user/ExampleUser</code>"},
         "Effect":"Allow",
         "Action": [ 
             "kms:Decrypt",
             "kms:DescribeKey",  
             "kms:ListAliases", 
             "kms:ListKeys"
          ],
         "Resource": "<code class="replaceable">arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab</code>"
      }
   ]
}</code></pre>
      <p>AWS CloudTrail logs all operations that use the VPC endpoint. However, your CloudTrail logs
        donâ€™t include operations requested by principals in other accounts or operations for
        KMS keys in other accounts.</p>
      <p>As such, you might want to create a VPC endpoint policy that prevents principals in
        external accounts from using the VPC endpoint to call any AWS KMS operations on any keys in
        the local account.</p>
      <p>The following example uses the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-principalaccount">aws:PrincipalAccount</a> global condition key to deny access to all principals for
        all operations on all KMS keys unless the principal is in the local account. Before using
        a policy like this one, replace the example account ID with a valid one.</p>
      
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Statement": [
    <span>{</span>
      "Sid": "AccessForASpecificAccount",
      "Principal": <span>{</span>"AWS": "*"},
      "Action": "kms:*",
      "Effect": "Deny",
      "Resource": "arn:aws:kms:*:<code class="replaceable">111122223333</code>:key/*",
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:PrincipalAccount": "<code class="replaceable">111122223333</code>"
        }
      }
    }
  ]
}</code></pre>
     


     
      <h3 id="vpce-policy-get">Viewing a VPC endpoint policy</h3>
      <p>To view the VPC endpoint policy for an endpoint, use the <a href="https://console.aws.amazon.com/vpc/" rel="noopener noreferrer" target="_blank"><span>VPC management console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> or the <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeVpcEndpoints.html">DescribeVpcEndpoints</a>
        operation.</p>
      <p>The following AWS CLI command gets the policy for the endpoint with the specified VPC
        endpoint ID. </p>
      <p>Before using this command, replace the example endpoint ID with a valid one from your
        account.</p>
      <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="bash "><code class="prompt" copy="false">$ </code><code class="userinput">aws ec2 describe-vpc-endpoints \
--query 'VpcEndpoints[?VpcEndpointId==`<code class="replaceable">vpce-1234abcdf5678c90a</code>`].[PolicyDocument]'
--output text</code></code></pre>
     
   
    <h2 id="vpce-policy-condition">Using a VPC endpoint in a policy statement</h2>

    <p>You can control access to AWS KMS resources and operations when the request comes from VPC
      or uses a VPC endpoint. To do so, use one of the following <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#AvailableKeys">global condition
        keys</a> in a <a href="./key-policies.html">key policy</a> or <a href="./iam-policies.html">IAM policy</a>.</p>
    <div class="itemizedlist">
       
       
    <ul class="itemizedlist"><li class="listitem">
        <p>Use the <code class="code">aws:sourceVpce</code> condition key to grant or restrict access based on
          the VPC endpoint.</p>
      </li><li class="listitem">
        <p>Use the <code class="code">aws:sourceVpc</code> condition key to grant or restrict access based on
          the VPC that hosts the private endpoint.</p>
      </li></ul></div>
    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Use caution when creating key policies and IAM policies based on your VPC endpoint. If
        a policy statement requires that requests come from a particular VPC or VPC endpoint,
        requests from integrated AWS services that use an AWS KMS resource on your behalf might
        fail. For help, see <a href="./conditions-aws.html#conditions-aws-vpce">Using VPC endpoint conditions in policies with AWS KMS
          permissions</a>.</p><p>Also, the <code class="code">aws:sourceIP</code> condition key is not effective when the request
        comes from an <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html">Amazon VPC endpoint</a>. To
        restrict requests to a VPC endpoint, use the <code class="code">aws:sourceVpce</code> or
          <code class="code">aws:sourceVpc</code> condition keys. For more information, see <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-iam.html">Identity and access management for VPC
          endpoints and VPC endpoint services</a> in the <em>AWS PrivateLink Guide</em>. </p></div></div>

    <p>You can use these global condition keys to control access to AWS KMS keys (KMS keys),
      aliases, and to operations like <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_CreateKey.html">CreateKey</a>
      that don't depend on any particular resource.</p>
    <p>For example, the following sample key policy allows a user to perform some cryptographic
      operations with a KMS key only when the request uses the specified VPC endpoint. When a user
      makes a request to AWS KMS, the VPC endpoint ID in the request is compared to the
        <code class="code">aws:sourceVpce</code> condition key value in the policy. If they do not match, the
      request is denied. </p>
    <p>To use a policy like this one, replace the placeholder AWS account ID and VPC endpoint
      IDs with valid values for your account.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Id": "example-key-1",
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "Enable IAM policies",
            "Effect": "Allow",
            "Principal": <span>{</span>"AWS":["<code class="replaceable">111122223333</code>"]},
            "Action": ["kms:*"],
            "Resource": "*"
        },
        <span>{</span>
            "Sid": "Restrict usage to my VPC endpoint",
            "Effect": "Deny",
            "Principal": "*",
            "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*"
            ],
            "Resource": "*",
            "Condition": <span>{</span>
                "StringNotEquals": <span>{</span>
                    "aws:sourceVpce": "<code class="replaceable">vpce-1234abcdf5678c90a</code>"
                }
            }
        }

    ]
}</code></pre>
    <p>You can also use the <code class="code">aws:sourceVpc</code> condition key to restrict access to your
      KMS keys based on the VPC in which VPC endpoint resides. </p>
    <p>The following sample key policy allows commands that manage the KMS key only when they
      come from <code class="code">vpc-12345678</code>. In addition, it allows commands that use the KMS key
      for cryptographic operations only when they come from <code class="code">vpc-2b2b2b2b</code>. You might use
      a policy like this one if an application is running in one VPC, but you use a second, isolated
      VPC for management functions. </p>
    <p>To use a policy like this one, replace the placeholder AWS account ID and VPC endpoint
      IDs with valid values for your account.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Id": "example-key-2",
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "Allow administrative actions from <code class="replaceable">vpc-12345678</code>",
            "Effect": "Allow",
            "Principal": <span>{</span>"AWS": "<code class="replaceable">111122223333</code>"},
            "Action": [
                "kms:Create*","kms:Enable*","kms:Put*","kms:Update*",
                "kms:Revoke*","kms:Disable*","kms:Delete*",
                "kms:TagResource", "kms:UntagResource"
            ],
            "Resource": "*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:sourceVpc": "<code class="replaceable">vpc-12345678</code>"
                }
            }
        },
        <span>{</span>
            "Sid": "Allow key usage from <code class="replaceable">vpc-2b2b2b2b</code>",
            "Effect": "Allow",
            "Principal": <span>{</span>"AWS": "<code class="replaceable">111122223333</code>"},
            "Action": [
                "kms:Encrypt","kms:Decrypt","kms:GenerateDataKey*"
            ],
            "Resource": "*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:sourceVpc": "<code class="replaceable">vpc-2b2b2b2b</code>"
                }
            }
        },
        <span>{</span>
            "Sid": "Allow read actions from everywhere",
            "Effect": "Allow",
            "Principal": <span>{</span>"AWS": "<code class="replaceable">111122223333</code>"},
            "Action": [
                "kms:Describe*","kms:List*","kms:Get*"
            ],
            "Resource": "*",
        }
    ]
}</code></pre>
   
    <h2 id="vpce-logging">Logging your VPC endpoint</h2>
    <p>AWS CloudTrail logs all operations that use the VPC endpoint. When a request to AWS KMS uses a VPC
      endpoint, the VPC endpoint ID appears in the <a href="./logging-using-cloudtrail.html">AWS CloudTrail
        log</a> entry that records the request. You can use the endpoint ID to audit the use of
      your AWS KMS VPC endpoint.</p>
    <p>However, your CloudTrail logs don't include operations requested by principals in other accounts
      or requests for AWS KMS operations on KMS keys and aliases in other accounts. Also, to protect
      your VPC, requests that are denied by a <a href="#vpce-policy">VPC endpoint
      policy</a>, but otherwise would have been allowed, are not recorded in <a href="./logging-using-cloudtrail.html">AWS CloudTrail</a>.</p>
    <p>For example, this sample log entry records a <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_GenerateDataKey.html">GenerateDataKey</a> request that used the
      VPC endpoint. The <code class="code">vpcEndpointId</code> field appears at the end of the log entry.</p>
    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "eventVersion":"1.05",
  "userIdentity": <span>{</span>
    "type": "IAMUser",
    "principalId": "EX_PRINCIPAL_ID",
    "arn": "arn:aws:iam::111122223333:user/Alice",
    "accessKeyId": "EXAMPLE_KEY_ID",
    "accountId": "111122223333",
    "userName": "Alice"
  },
  "eventTime":"2018-01-16T05:46:57Z",
  "eventSource":"kms.amazonaws.com",
  "eventName":"GenerateDataKey",
  "awsRegion":"eu-west-1",
  "sourceIPAddress":"172.01.01.001",
  "userAgent":"aws-cli/1.14.23 Python/2.7.12 Linux/4.9.75-25.55.amzn1.x86_64 botocore/1.8.27",
  "requestParameters":<span>{</span>
    "keyId":"1234abcd-12ab-34cd-56ef-1234567890ab",
    "numberOfBytes":128
  },
  "responseElements":null,
  "requestID":"a9fff0bf-fa80-11e7-a13c-afcabff2f04c",
  "eventID":"77274901-88bc-4e3f-9bb6-acf1c16f6a7c",
  "readOnly":true,
  "resources":[<span>{</span>
    "ARN":"arn:aws:kms:eu-west-1:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab",
    "accountId":"111122223333",
    "type":"AWS::KMS::Key"
  }],
  "eventType":"AwsApiCall",
  "recipientAccountId":"111122223333",
  <b>"vpcEndpointId": "vpce-1234abcdf5678c90a"</b>
}</code></pre>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./grant-manage.html">Managing grants</div><div id="next" class="next-link" accesskey="n" href="./policy-conditions.html">Condition keys</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Key Management Service (KMS)&amp;topic_url=https://docs.aws.amazon.com/en_us/kms/latest/developerguide/kms-vpc-endpoint.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Key Management Service (KMS)&amp;topic_url=https://docs.aws.amazon.com/en_us/kms/latest/developerguide/kms-vpc-endpoint.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>