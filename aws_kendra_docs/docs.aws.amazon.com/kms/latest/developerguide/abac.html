<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ABAC for AWS KMS - AWS Key Management Service</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="abac" /><meta name="default_state" content="abac" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/kms/latest/developerguide/abac.html" /><meta name="description" content="Learn how to use attribute-based access control (ABAC) for AWS KMS keys" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Key Management Service" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Learn how to use AWS Key Management Service (AWS KMS) to securely store and manage encryption keys and perform encryption and decryption of user data." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/kms/latest/developerguide/abac.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kms/latest/developerguide/abac.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kms/latest/developerguide/abac.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kms/latest/developerguide/abac.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kms/latest/developerguide/abac.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/kms/latest/developerguide/abac.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/kms/latest/developerguide/abac.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kms/latest/developerguide/abac.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kms/latest/developerguide/abac.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kms/latest/developerguide/abac.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kms/latest/developerguide/abac.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kms/latest/developerguide/abac.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kms/latest/developerguide/abac.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kms/latest/developerguide/abac.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kms/latest/developerguide/abac.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kms/latest/developerguide/abac.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kms/latest/developerguide/abac.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kms/latest/developerguide/abac.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kms/latest/developerguide/abac.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/kms/latest/developerguide/abac.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/kms/latest/developerguide/abac.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/kms/latest/developerguide/abac.html" hreflang="x-default" /><meta name="feedback-item" content="Key Management Service (KMS)" /><meta name="this_doc_product" content="AWS Key Management Service" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'kms'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="ABAC for AWS KMS" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>ABAC for AWS KMS - AWS Key Management Service</title><meta name="pdf" content="/pdfs/kms/latest/developerguide/kms-dg.pdf#abac" /><meta name="github" content="https://github.com/awsdocs/aws-kms-developer-guide/tree/master/doc_source/abac.md" /><meta name="rss" content="aws-kms-document-history.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=182" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Key%20Management%20Service%20%28KMS%29&amp;topic_url=http://docs.aws.amazon.com/en_us/kms/latest/developerguide/abac.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/kms/latest/developerguide/abac.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/kms/latest/developerguide/abac.html" /><meta name="keywords" content="KMS,key management service,encryption key management,encryption key,,envelope encryption" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS KMS",
        "item" : "https://docs.aws.amazon.com/kms/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/kms/latest/developerguide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Authentication and access control for AWS KMS",
        "item" : "https://docs.aws.amazon.com/kms/latest/developerguide/control-access.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "ABAC for AWS KMS",
        "item" : "https://docs.aws.amazon.com/kms/latest/developerguide/control-access.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/kms/latest/developerguide/kms-dg.pdf#abac" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/aws-kms-developer-guide/tree/master/doc_source/abac.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/kms/index.html">AWS KMS</a><a href="overview.html">Developer Guide</a></div><div id="page-toc-src"><a href="#about-abac-kms">ABAC condition keys for AWS KMS</a><a href="#abac-tag-or-alias">Tags or aliases?</a><a href="#troubleshooting-tags-aliases">Troubleshooting ABAC for AWS KMS</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="abac">ABAC for AWS KMS</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Attribute-based access control (ABAC) is an authorization strategy that defines
        permissions based on attributes. AWS KMS supports ABAC by allowing you to control access to
        your customer managed keys based on the tags and aliases associated with the KMS keys. The tag and
        alias condition keys that enable ABAC in AWS KMS provide a powerful and flexible way to
        authorize principals to use KMS keys without editing policies or managing grants. But you
        should use these feature with care so principals aren't inadvertently allowed or denied
        access. </p><p>If you use ABAC, be aware that permission to manage tags and aliases is now an access
        control permission. Be sure that you know the existing tags and aliases on all KMS keys
        before you deploy a policy that depends on tags or aliases. Take reasonable precautions when
        adding, deleting, and updating aliases, and when tagging and untagging keys. Give
        permissions to manage tags and aliases only to principals who need them, and limit the tags
        and aliases they can manage. </p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Notes</h6></div><div class="awsdocs-note-text"><p>When using ABAC for AWS KMS, be cautious about giving principals permission to manage
            tags and aliases. Changing a tag or alias might allow or deny permission to a KMS key.
            Key administrators who don't have permission to change key policies or create grants can
            control access to KMS keys if they have permission to manage tags or aliases. </p><p>It might take up to five minutes for tag and alias changes to affect KMS key authorization. Recent changes might be visible in API operations before they affect authorization.</p><p>To control access to a KMS key based on its alias, you must use a condition key. You
            cannot use an alias to represent a KMS key in the <code class="code">Resource</code> element of a
            policy statement. When an alias appears in the <code class="code">Resource</code> element, the policy
            statement applies to the alias, not to the associated KMS key.</p></div></div><p><b>Learn more</b></p><div class="itemizedlist">
         
         
    <ul class="itemizedlist"><li class="listitem">
            <p>For details about AWS KMS support for ABAC, including examples, see <a href="./alias-authorization.html">Using aliases to control access to KMS keys</a> and <a href="./tag-authorization.html">Using tags to control access to KMS keys</a>.</p>
        </li><li class="listitem">
            <p>For more general information about using tags to control access to AWS
                resources, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_attribute-based-access-control.html">What is
                    ABAC for AWS?</a> and <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_tags.html">Controlling Access to AWS Resources Using Resource Tags</a> in the
                    <em>IAM User Guide</em>.</p>
        </li></ul></div>
        <h2 id="about-abac-kms">ABAC condition keys for AWS KMS</h2>
        <p>To authorize access to KMS keys based on their tags and aliases, use the following
            condition keys in a key policy or IAM policy.</p>
        <div class="table-container"><div class="table-contents"><table id="w261aab9c32c13b5"><thead>
                    <tr>
                        <th>ABAC condition key</th>
                        <th>Description</th>
                        <th>Policy type</th>
                        <th>AWS KMS operations</th>
                    </tr>
                </thead>
                    <tr>
                        <td><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-resourcetag">aws:ResourceTag</a></td>
                        <td>Tag (key and value) on the KMS key matches the tag (key and value)
                            or tag pattern in the policy</td>
                        <td>IAM policy only</td>
                        <td>KMS key resource operations <sup>2</sup></td>
                    </tr>
                    <tr>
                        <td><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-requesttag">aws:RequestTag/<em>tag-key</em></a></td>
                        <td>Tag (key and value) in the request matches the tag (key and value) or
                            tag pattern in the policy</td>
                        <td>Key policy and IAM policies<sup>1</sup></td>
                        <td><a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_TagResource.html">TagResource</a>,
                                <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_UntagResource.html">UntagResource</a></td>
                    </tr>
                    <tr>
                        <td><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-tagkeys">aws:TagKeys</a></td>
                        <td>Tag keys in the request match the tag keys in the policy</td>
                        <td>Key policy and IAM policies<sup>1</sup></td>
                        <td><a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_TagResource.html">TagResource</a>,
                                <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_UntagResource.html">UntagResource</a></td>
                    </tr>
                    <tr>
                        <td><a href="./conditions-kms.html#conditions-kms-resource-aliases">kms:ResourceAliases</a></td>
                        <td>Aliases associated with the KMS key match the aliases or alias
                            patterns in the policy</td>
                        <td>IAM policy only</td>
                        <td>KMS key resource operations <sup>2</sup></td>
                    </tr>
                    <tr>
                        <td><a href="./conditions-kms.html#conditions-kms-request-alias">kms:RequestAlias</a></td>
                        <td>Alias that represents the KMS key in the request matches the alias
                            or alias patterns in the policy.</td>
                        <td>Key policy and IAM policies<sup>1</sup></td>
                        <td><a href="./concepts.html#cryptographic-operations">Cryptographic
                                operations</a>, <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_DescribeKey.html">DescribeKey</a>, <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_GetPublicKey.html">GetPublicKey</a></td>
                    </tr>
                </table></div></div>
        <p><sup>1</sup>Any condition key that can be used in a key policy can
            also be used in an IAM policy, but only if <a href="./key-policy-default.html#key-policy-default-allow-root-enable-iam">the key policy allows
            it</a>.</p>
        <p><sup>2</sup>A <em>KMS key resource
                operation</em> is an operation authorized for a particular KMS key. To
            identify the KMS key resource operations, in the <a href="./kms-api-permissions-reference.html#kms-api-permissions-reference-table">AWS KMS permissions table</a>, look
            for a value of KMS key in the <code class="code">Resources</code> column for the operation. </p>
        <p>For example, you can use these condition keys to create the following policies.</p>
        <div class="itemizedlist">
             
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>An IAM policy with <code class="code">kms:ResourceAliases</code> that allows permission
                    to use KMS keys with a particular alias or alias pattern. This is a bit
                    different from policies that rely on tags: Although you can use alias patterns
                    in a policy, each alias must be unique in an AWS account and Region. This
                    allows you to apply a policy to a select set of KMS keys without listing the
                    key ARNs of the KMS keys in the policy statement. To add or remove KMS keys
                    from the set, change the alias of the KMS key.</p>
            </li><li class="listitem">
                <p>A key policy with <code class="code">kms:RequestAlias</code> that allows principals to use
                    a KMS key in a <code class="code">Encrypt</code> operation, but only when the
                        <code class="code">Encrypt</code> request uses that alias to identify the
                    KMS key.</p>
            </li><li class="listitem">
                <p>An IAM policy with <code class="code">aws:ResourceTag/<em>tag-key</em></code> that denies permission to use KMS keys with
                    a particular tag key and tag value. This lets you apply a policy to a select set
                    of KMS keys without listing the key ARNs of the KMS keys in the policy
                    statement. To add or remove KMS keys from the set, tag or untag the
                    KMS key.</p>
            </li><li class="listitem">
                <p>An IAM policy with <code class="code">aws:RequestTag/<em>tag-key</em></code> that allows principals to delete only
                        <code class="code">"Purpose"="Test"</code> KMS key tags. </p>
            </li><li class="listitem">
                <p>An IAM policy with <code class="code">aws:TagKeys</code> that denies permission to tag or
                    untag a KMS key with a <code class="code">Restricted</code> tag key.</p>
            </li></ul></div>
        <p>ABAC makes access management flexible and scalable. For example, you can use the
                    <code class="code">aws:ResourceTag/<em>tag-key</em></code>
            condition key to create an IAM policy that allows principals to use a KMS key for
            specified operations only when the KMS key has a <code class="code">Purpose=Test</code> tag. The
            policy applies to all KMS keys in all Regions of the AWS account.</p>
        <p>When attached to a user or role, the following IAM policy allows principals to use
            all existing KMS keys with a <code class="code">Purpose=Test</code> tag for the specified
            operations. To provide this access to new or existing KMS keys, you don't need to
            change the policy. Just attach the <code class="code">Purpose=Test</code> tag to the KMS keys.
            Similarly, to remove this access from KMS keys with a <code class="code">Purpose=Test</code> tag,
            edit or delete the tag. </p>
        
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AliasBasedIAMPolicy",
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt",
        "kms:Encrypt",
        "kms:GenerateDataKey*",
        "kms:DescribeKey"
      ],
      "Resource": "arn:aws:kms:*:111122223333:key/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:ResourceTag/Purpose": "Test"
        }
      }
    }
  ]
}</code></pre>
        <p>However, if you use this feature, be careful when managing tags and aliases. Adding,
            changing, or deleting a tag or alias can inadvertently allow or deny access to a
            KMS key. Key administrators who don't have permission to change key policies or create
            grants can control access to KMS keys if they have permission to manage tags and
            aliases. To mitigate this risk, consider <a href="./tag-permissions.html#tag-permissions-conditions">limiting permissions to manage tags</a> and <a href="./alias-access.html#alias-access-limiting">aliases</a>. For example, you might want to allow
            only select principals to manage <code class="code">Purpose=Test</code> tags. For details, see <a href="./alias-authorization.html">Using aliases to control access to KMS keys</a> and <a href="./tag-authorization.html">Using tags to control access to KMS keys</a>.</p>
     
        <h2 id="abac-tag-or-alias">Tags or aliases?</h2>
        <p>AWS KMS supports ABAC with tags and aliases. Both options provide a flexible, scalable
            access control strategy, but they're slightly different from each other. </p>
        <p>You might decide to use tags or use aliases based on your particular AWS use
            patterns. For example, if you have already given tagging permissions to most
            administrators, it might be easier to control an authorization strategy based on
            aliases. Or, if you are close to the quota for <a href="./resource-limits.html#aliases-per-key">aliases
                per KMS key</a>, you might prefer an authorization strategy based on tags. </p>
        <p>The following benefits are of general interest.</p>
        <p><b> Benefits of tag-based access control</b></p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Same authorization mechanism for different types of AWS resources. </p>
                <p>You can use the same tag or tag key to control access to multiple resource
                    types, such as an Amazon Relational Database Service (Amazon RDS) cluster, an Amazon Elastic Block Store (Amazon EBS) volume, and a KMS key. This feature enables several different authorization models that are
                    more flexible than traditional role-based access control.</p>
            </li><li class="listitem">
                <p>Authorize access to a group of KMS keys.</p>
                <p>You can use tags to manage access to a group of KMS keys in the same
                    AWS account and Region. Assign the same tag or tag key to the KMS keys that
                    you choose. Then create a simple, easy-to-maintain policy statement that is
                    based on the tag or tag key. To add or remove a KMS key from your
                    authorization group, add or remove the tag; you don't need to edit the
                    policy.</p>
            </li></ul></div>
        <p><b>Benefits of alias-based access control</b></p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>Authorize access to cryptographic operations based on aliases.</p>
                <p>Most request-based policy conditions for attributes, including <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-requesttag">aws:RequestTag/<em>tag-key</em></a>,
                    affect only operations that add, edit, or delete the attribute. But the <a href="./conditions-kms.html#conditions-kms-request-alias">kms:RequestAlias</a> condition key
                    controls access to cryptographic operations based on the alias used to identify
                    the KMS key in the request. For example, you can give a principal permission
                    to use a KMS key in a <code class="code">Encrypt</code> operation but only when the value
                    of the <code class="code">KeyId</code> parameter is <code class="code">alias/restricted-key-1</code>. To
                    satisfy this condition requires all of the following:</p>
                <div class="itemizedlist">
                     

                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>The KMS key must be associated with that alias.</p>
                    </li><li class="listitem">
                        <p>The request must use the alias to identify the KMS key.</p>
                    </li><li class="listitem">
                        <p>The principal must have permission to use the KMS key subject to the
                                <code class="code">kms:RequestAlias</code> condition. </p>
                    </li></ul></div>
                <p>This is particularly useful if your applications commonly use alias names or
                    alias ARNs to refer to KMS keys.</p>
            </li><li class="listitem">
                <p>Provide very limited permissions.</p>
                <p>An alias must be unique in an AWS account and Region. As a result, giving
                    principals access to a KMS key based on an alias can be much more restrictive
                    than giving them access based on a tag. Unlike aliases, tags can be assigned to
                    multiple KMS keys in the same account and Region. If you choose, you can use
                    an alias pattern, such as <code class="code">alias/test*</code>, to give principals access to
                    a group of KMS keys in the same account and Region. However, allowing or
                    denying access to a particular alias allows very strict control on
                    KMS keys.</p>
            </li></ul></div>
     
        <h2 id="troubleshooting-tags-aliases">Troubleshooting ABAC for AWS KMS</h2>
        <p>Controlling access to KMS keys based on their tags and aliases is convenient and
            powerful. However, it's prone to a few predictable errors that you'll want to
            prevent.</p>

         
            <h3 id="access-denied-tag">Access changed due to tag change</h3>
            <p>If a tag is deleted or its value is changed, principals who have access to a
                KMS key based only on that tag will be denied access to the KMS key. This can
                also happen when a tag that is included in a deny policy statement is added to a
                KMS key. Adding a policy-related tag to a KMS key can allow access to principals
                who should be denied access to a KMS key.</p>
            <p>For example, suppose that a principal has access to a KMS key based on the
                    <code class="code">Project=Alpha</code> tag, such as the permission provided by the following
                example IAM policy statement. </p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "IAMPolicyWithResourceTag",
      "Effect": "Allow",
      "Action": [
        "kms:GenerateDataKeyWithoutPlaintext",
        "kms:Decrypt"
      ],
      "Resource": "arn:aws:kms:ap-southeast-1:111122223333:key/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:ResourceTag/Project": "Alpha"
        }
      }
    }
  ]
}</code></pre>
            <p>If the tag is deleted from that KMS key or the tag value is changed, the
                principal no longer has permission to use the KMS key for the specified
                operations. This might become evident when the principal tries to read or write data
                in an AWS service that uses a customer managed key To trace the tag change, review your CloudTrail
                logs for <a href="./ct-tagresource.html">TagResource</a> or <a href="./ct-untagresource.html">UntagResource entries</a>.</p>
            <p>To restore access without updating the policy, change the tags on the KMS key.
                This action has minimal impact other than a brief period while it is taking effect
                throughout AWS KMS. To prevent an error like this one, give tagging and untagging
                permissions only to principals who need it and <a href="./tag-permissions.html#tag-permissions-conditions">limit their tagging permissions</a> to
                tags they need to manage. Before changing a tag, search policies to detect access
                that depends on the tag, and get KMS keys in all Regions that have the tag. You
                might consider creating an Amazon CloudWatch alarm when particular tags are changed.</p>
         

         
            <h3 id="access-denied-alias">Access change due to alias change</h3>
            <p>If an alias is deleted or associated with a different KMS key, principals who
                have access to the KMS key based only on that alias will be denied access to the
                KMS key. This can also happen when an alias that is associated with a KMS key is
                included in a deny policy statement. Adding a policy-related alias to a KMS key
                can also allow access to principals who should be denied access to a
                KMS key.</p>
            <p>For example, the following IAM policy statement uses the <a href="./conditions-kms.html#conditions-kms-resource-aliases">kms:ResourceAliases</a> condition
                key to allow access to KMS keys in different Regions of the account with any of
                the specified aliases.</p>
            
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AliasBasedIAMPolicy",
      "Effect": "Allow",
      "Action": [
        "kms:List*",
        "kms:Describe*",
        "kms:Decrypt"
      ],
      "Resource": "arn:aws:kms:*:111122223333:key/*",
      "Condition": <span>{</span>
        "ForAnyValue:StringEquals": <span>{</span>
          "kms:ResourceAliases": [
            "alias/ProjectAlpha",
            "alias/ProjectAlpha_Test",
            "alias/ProjectAlpha_Dev"
          ]
        }
      }
    }
  ]
}</code></pre>
            <p>To trace the alias change, review your CloudTrail logs for <a href="./ct-createalias.html">CreateAlias</a>, <a href="./ct-updatealias.html">UpdateAlias</a>, and <a href="./ct-deletealias.html">DeleteAlias</a>
                entries.</p>
            <p>To restore access without updating the policy, change the alias associated with
                the KMS key. Because each alias can be associated with only one KMS key in an
                account and Region, managing aliases is a bit more difficult than managing tags.
                Restoring access to some principals on one KMS key can deny the same or other
                principals access to a different KMS key. </p>
            <p>To prevent this error, give alias management permissions only to principals who
                need it and <a href="./alias-access.html#alias-access-limiting">limit their alias-management
                    permissions</a> to aliases they need to manage. Before updating or deleting
                an alias, search policies to detect access that depends on the alias, and find
                KMS keys in all Regions that are associated with the alias.</p>
         

         
            <h3 id="access-denied-alias-quota">Access denied due to alias quota</h3>
            <p>Users who are authorized to use a KMS key by an <a href="./conditions-kms.html#conditions-kms-resource-aliases">kms:ResourceAliases</a> condition
                will get an <code class="code">AccessDenied</code> exception if the KMS key exceeds the default
                    <a href="./resource-limits.html#aliases-per-key">aliases per KMS key</a> quota for that
                account and Region. </p>
            <p>To restore access, delete aliases that are associated with the KMS key so it
                complies with the quota. Or use an alternate mechanism to give users access to the
                KMS key. </p>
         

         
            <h3 id="tag-alias-auth-delay">Delayed authorization change</h3>
            <p>Changes that you make to tags and aliases might take up to five minutes to affect
                the authorization of KMS keys. As a result, a tag or alias change might be
                reflected in the responses from API operations before they affect authorization.
                This delay is likely to be longer than the brief eventual consistency delay that
                affects most AWS KMS operations. </p>
            <p>For example, you might have an IAM policy that allows certain principals to use
                any KMS key with a <code class="code">"Purpose"="Test"</code> tag. Then you add the
                    <code class="code">"Purpose"="Test"</code> tag to a KMS key. Although the <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_TagResource.html">TagResource</a> operation completes
                and <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_ListResourceTags.html">ListResourceTags</a>
                response confirms that the tag is assigned to the KMS key, the principals might
                not have access to the KMS key for up to five minutes.</p>
            <p>To prevent errors, build this expected delay into your code. </p>
         


         
            <h3 id="failed-requests">Failed requests due to alias updates</h3>
            <p>When you update an alias, you associate an existing alias with a different
                KMS key. </p>
            <p><a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html">Decrypt</a> and <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html">ReEncrypt</a> requests that specify
                the <a href="./concepts.html#key-id-alias-name">alias name</a> or <a href="./concepts.html#key-id-alias-ARN">alias ARN</a> might fail because the alias is now
                associated with a KMS key that didn't encrypt the ciphertext. This situation
                typically returns an <code class="code">IncorrectKeyException</code> or
                    <code class="code">NotFoundException</code>. Or if the request has no <code class="code">KeyId</code> or
                    <code class="code">DestinationKeyId</code> parameter, the operation might fail with
                    <code class="code">AccessDenied</code> exception because the caller no longer has access to
                the KMS key that encrypted the ciphertext. </p>
            <p>You can trace the change by looking at CloudTrail logs for <a href="./ct-createalias.html">CreateAlias</a>, <a href="./ct-updatealias.html">UpdateAlias</a>, and <a href="./ct-deletealias.html">DeleteAlias</a> log
                entries. You can also use the value of the <code class="code">LastUpdatedDate</code> field in the
                    <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_ListAliases.html">ListAliases</a> response to
                detect a change. </p>
            <p>For example, the following <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_ListAliases.html">ListAliases</a> example response shows that the
                    <code class="code">ProjectAlpha_Test</code> alias in the <code class="code">kms:ResourceAliases</code>
                condition was updated. As a result, the principals who have access based on the
                alias lose access to the previously associated KMS key. Instead, they have access
                to the newly associated KMS key. </p>
            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="prompt" copy="false">$ </code>aws kms list-aliases --query 'Aliases[?starts_with(AliasName, `alias/ProjectAlpha`)]'

<code class="computeroutput" copy="false"><span>{</span>
    "Aliases": [
        <span>{</span>
            "AliasName": "alias/ProjectAlpha_Test",
            "AliasArn": "arn:aws:kms:us-west-2:111122223333:alias/ProjectAlpha_Test",
            "TargetKeyId": "0987dcba-09fe-87dc-65ba-ab0987654321",
            "CreationDate": 1566518783.394,
            <b>"LastUpdatedDate": 1605308931.903</b>
        },
        <span>{</span>
            "AliasName": "alias/ProjectAlpha_Restricted",
            "AliasArn": "arn:aws:kms:us-west-2:111122223333:alias/ProjectAlpha_Restricted",
            "TargetKeyId": "1234abcd-12ab-34cd-56ef-1234567890ab",
            "CreationDate": 1553410800.010,
            "LastUpdatedDate": 1553410800.010
        }
    ]
}</code></code></pre>
            <p>The remedy for this change isn't simple. You can update the alias again to
                associate it with the original KMS key. However, before you act, you need to
                consider the effect of that change on the currently associated KMS key. If
                principals used the latter KMS key in cryptographic operations, they might need
                continued access to it. In this case, you might want to update the policy to ensure
                that principals have permission to use both of the KMS keys. </p>
            <p>You can prevent an error like this one: Before updating an alias, search policies
                to detect access that depends on the alias. Then get KMS keys in all Regions that
                are associated with the alias. Give alias management permissions only to principals
                who need it and <a href="./alias-access.html#alias-access-limiting">limit their alias-management
                    permissions</a> to aliases they need to manage.</p>
         




    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./conditions-nitro-enclaves.html">AWS KMS condition keys for AWS Nitro Enclaves</div><div id="next" class="next-link" accesskey="n" href="./key-policy-modifying-external-accounts.html">Cross-account access</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Key Management Service (KMS)&amp;topic_url=https://docs.aws.amazon.com/en_us/kms/latest/developerguide/abac.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Key Management Service (KMS)&amp;topic_url=https://docs.aws.amazon.com/en_us/kms/latest/developerguide/abac.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>