<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>IAM access roles for Amazon Kendra - Amazon Kendra</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="iam-roles" /><meta name="default_state" content="iam-roles" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html" /><meta name="description" content="The required access permissions for Amazon Kendra." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Kendra" /><meta name="guide" content="Developer Guide" /><meta name="abstract" content="Provides a conceptual overview of Amazon Kendra. Learn about Amazon Kendra features and get started indexing your documents using the console, CLI, and API." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kendra/latest/dg/iam-roles.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/kendra/latest/dg/iam-roles.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kendra/latest/dg/iam-roles.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/kendra/latest/dg/iam-roles.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kendra/latest/dg/iam-roles.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/kendra/latest/dg/iam-roles.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kendra/latest/dg/iam-roles.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/kendra/latest/dg/iam-roles.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kendra/latest/dg/iam-roles.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/kendra/latest/dg/iam-roles.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kendra/latest/dg/iam-roles.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/kendra/latest/dg/iam-roles.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kendra/latest/dg/iam-roles.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/kendra/latest/dg/iam-roles.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kendra/latest/dg/iam-roles.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/kendra/latest/dg/iam-roles.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/kendra/latest/dg/iam-roles.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/kendra/latest/dg/iam-roles.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html" hreflang="x-default" /><meta name="feedback-item" content="Kendra" /><meta name="this_doc_product" content="Amazon Kendra" /><meta name="this_doc_guide" content="Developer Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'kendra'}"></script><meta id="panorama-serviceSubSection" value="Developer Guide" /><meta id="panorama-serviceConsolePage" value="IAM access roles for Amazon Kendra" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>IAM access roles for Amazon Kendra - Amazon Kendra</title><meta name="pdf" content="/pdfs/kendra/latest/dg/kendra-dg.pdf#iam-roles" /><meta name="github" content="https://github.com/awsdocs/amazon-kendra-developer-guide/tree/master/doc_source/iam-roles.md" /><meta name="rss" content="amazon-kendra-release-notes.rss" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Kendra&amp;topic_url=http://docs.aws.amazon.com/en_us/kendra/latest/dg/iam-roles.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/kendra/latest/dg/iam-roles.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/kendra/latest/dg/iam-roles.html" /><meta name="keywords" content="Kendra,Amazon Kendra,search,intelligent search,natural language,index,question,keyword,data source,connector,FAQ,frequently asked question" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Kendra",
        "item" : "https://docs.aws.amazon.com/kendra/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Developer Guide",
        "item" : "https://docs.aws.amazon.com/kendra/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "IAM access roles for Amazon Kendra",
        "item" : "https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/kendra/latest/dg/kendra-dg.pdf#iam-roles" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/amazon-kendra-developer-guide/tree/master/doc_source/iam-roles.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/kendra/index.html">Amazon Kendra</a><a href="what-is-kendra.html">Developer Guide</a></div><div id="page-toc-src"><a href="#iam-roles-index">IAM roles for indexes</a><a href="#iam-roles-batch">IAM roles for the BatchPutDocument
        API</a><a href="#iam-roles-ds">IAM roles for data sources</a><a href="#iam-roles-ds-faq">IAM roles for frequently asked questions
        (FAQs)</a><a href="#iam-roles-query-suggestions">IAM roles for query
        suggestions</a><a href="#iam-roles-principal-mapping">IAM roles for principal mapping
        of users and groups</a><a href="#iam-roles-aws-sso">IAM roles for AWS IAM Identity Center (successor to AWS Single Sign-On)</a><a href="#iam-roles-amazon-kendra-experiences">IAM roles for Amazon Kendra experiences</a><a href="#iam-roles-custom-document-enrichment">IAM roles for Custom
        Document Enrichment</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="iam-roles">IAM access roles for Amazon Kendra</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>When you create an index, data source, or an FAQ, or any other type of resource, Amazon Kendra needs the required access permissions to create the resource. You must
    create a AWS Identity and Access Management (IAM) policy before you create the Amazon Kendra resource. When you call the operation, you provide the Amazon Resource Name (ARN)
    of the role with the policy attached. For example, if you are calling the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchPutDocument.html">BatchPutDocument</a> API to add documents from an Amazon S3 bucket, you provide
      Amazon Kendra with a role with a policy that has access to the bucket.</p><p>You can create a new IAM role in the Amazon Kendra console or choose an
      IAM existing role to use. The console displays roles that have the string
    "kendra" or "Kendra" in the role name. If you use the API, you must provide the Amazon Resource 
    Name of an IAM role that you create.</p><p>The following topics provide details for the required policies. If you create IAM roles using the Amazon Kendra console these policies are created for
    you.</p><div class="highlights" id="inline-topiclist"><h6>Topics</h6><ul><li><a href="#iam-roles-index">IAM roles for indexes</a></li><li><a href="#iam-roles-batch">IAM roles for the BatchPutDocument
        API</a></li><li><a href="#iam-roles-ds">IAM roles for data sources</a></li><li><a href="#iam-roles-ds-faq">IAM roles for frequently asked questions
        (FAQs)</a></li><li><a href="#iam-roles-query-suggestions">IAM roles for query
        suggestions</a></li><li><a href="#iam-roles-principal-mapping">IAM roles for principal mapping
        of users and groups</a></li><li><a href="#iam-roles-aws-sso">IAM roles for AWS IAM Identity Center (successor to AWS Single Sign-On)</a></li><li><a href="#iam-roles-amazon-kendra-experiences">IAM roles for Amazon Kendra experiences</a></li><li><a href="#iam-roles-custom-document-enrichment">IAM roles for Custom
        Document Enrichment</a></li></ul></div>
    <h2 id="iam-roles-index">IAM roles for indexes</h2>
    <p>When you create an index, you must provide an IAM role with permission to
      write to an Amazon CloudWatch. You must also provide a trust policy that allows Amazon Kendra to assume the role. The following are the policies that must be provided.</p>
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for indexes" id="permissions-policy" expanded="false"><p>A role policy to allow Amazon Kendra to access a CloudWatch log.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": "cloudwatch:PutMetricData",
            "Resource": "*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "cloudwatch:namespace": "AWS/Kendra"
                }
            }
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "logs:DescribeLogGroups",
            "Resource": "*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "logs:CreateLogGroup",
            "Resource": "arn:aws:logs:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:log-group:/aws/kendra/*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "logs:DescribeLogStreams",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "arn:aws:logs:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:log-group:/aws/kendra/*:log-stream:*"
        }
    ]
}</code></pre><p>A role policy to allow Amazon Kendra to access AWS Secrets Manager. If you are
          using user context with Secrets Manager as a key location, you can use the following
          policy. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Action":"cloudwatch:PutMetricData",
         "Resource":"*",
         "Condition":<span>{</span>
            "StringEquals":<span>{</span>
               "cloudwatch:namespace":"AWS/Kendra"
            }
         }
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"logs:DescribeLogGroups",
         "Resource":"*"
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":"logs:CreateLogGroup",
         "Resource":"arn:aws:logs:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:log-group:/aws/kendra/*"
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":[
            "logs:DescribeLogStreams",
            "logs:CreateLogStream",
            "logs:PutLogEvents"
         ],
         "Resource":"arn:aws:logs:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:log-group:/aws/kendra/*:log-stream:*"
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":[
            "secretsmanager:GetSecretValue"
         ],
         "Resource":[
            "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret_id</code>"
         ]
      },
      <span>{</span>
         "Effect":"Allow",
         "Action":[
            "kms:Decrypt"
         ],
         "Resource":[
            "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key_id</code>"
         ],
         "Condition":<span>{</span>
            "StringLike":<span>{</span>
               "kms:ViaService":[
                  "secretsmanager.*.amazonaws.com"
               ]
            }
         }
      }
   ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>
   
    <h2 id="iam-roles-batch">IAM roles for the BatchPutDocument
        API</h2>
    <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p>Amazon Kendra doesn't use a bucket policy that grants permissions to an Amazon Kendra principal to interact with an S3 bucket. Instead, it uses IAM
        roles. Make sure that Amazon Kendra isn't included as a trusted member in your bucket
        policy to avoid any data security issues in accidentally granting permissions to arbitrary
        principals. However, you can add a bucket policy to use an Amazon S3 bucket across
        different accounts. For more information, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html#iam-roles-ds-s3-cross-accounts">Policies to use
            Amazon S3 across accounts</a>. For information about IAM
        roles for S3 data sources, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html#iam-roles-ds-s3">IAM
        roles</a>.</p></div></div>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchPutDocument.html">BatchPutDocument</a> API to
      index documents in an Amazon S3 bucket, you must provide Amazon Kendra with an
        IAM role with access to the bucket. You must also provide a trust policy that
      allows Amazon Kendra to assume the role. If the documents in the bucket are encrypted,
      you must provide permission to use the AWS KMS customer master key (CMK) to decrypt
      the documents.</p>
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for the BatchPutDocument&#xA;            API" id="iam-roles-batch-json" expanded="false"><p>A required role policy to allow Amazon Kendra to access an Amazon S3
          bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">bucket name</code>/*"
            ]
        }
    ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
<p>It is recommended that you include <code class="code">aws:sourceAccount</code> and
            <code class="code">aws:sourceArn</code> in the trust policy. This limits permissions and securely
          checks if <code class="code">aws:sourceAccount</code> and <code class="code">aws:sourceArn</code> are the same as
          provided in the IAM role policy for the <code class="code">sts:AssumeRole</code> action.
          This prevents unauthorized entities from accessing your IAM roles and their
          permissions. For more information, see the AWS Identity and Access Management guide on the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/confused-deputy.html">confused deputy
            problem</a>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": [
                    "kendra.*.amazonaws.com"
                ]
            },
            "Action": "sts:AssumeRole",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:SourceAccount": "account ID"
                },
                "StringLike": <span>{</span>
                    "aws:SourceArn": "arn:aws:kendra:region:accountId:index/*"
                }
            }
        }
    ]
}</code></pre><p>An optional role policy to allow Amazon Kendra to use an AWS KMS
          customer master key (CMK) to decrypt documents in an Amazon S3 bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        }
    ]
}</code></pre></awsui-expandable-section></div>
   
    <h2 id="iam-roles-ds">IAM roles for data sources</h2>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_CreateDataSource.html">CreateDataSource</a> API, you
      must give Amazon Kendra an IAM role that has permission to access the
      database resources. The specific permissions required depend on the data source.</p>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Adobe Experience Manager&#xA;            data sources" id="iam-roles-ds-aem" expanded="false"><p>When you use Adobe Experience Manager, you provide a role with the following
          policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your Adobe
              Experience Manager.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Adobe Experience Manager
              connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Alfresco data&#xA;            sources" id="iam-roles-ds-alfresco" expanded="false"><p>When you use Alfresco, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Alfresco.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Alfresco connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Amazon S3 data&#xA;            sources" id="iam-roles-ds-s3" expanded="false"><div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Warning</h6></div><div class="awsdocs-note-text"><p>Amazon Kendra doesn't use a bucket policy that grants permissions to an Amazon Kendra principal to interact with an S3 bucket. Instead, it uses IAM roles. Make sure that Amazon Kendra isn't included as a trusted member in your
            bucket policy to avoid any data security issues in accidentally granting permissions to
            arbitrary principals. However, you can add a bucket policy to use an Amazon S3
            bucket across different accounts. For more information, see <a href="#iam-roles-ds-s3-cross-accounts">Policies to use Amazon S3
              across accounts</a> (scroll down).</p></div></div><p>When you use an Amazon S3 bucket as a data source, you supply a role that has
          permission to access the bucket, and to use the <code class="code">BatchPutDocument</code> and
            <code class="code">BatchDeleteDocument</code> operations. If the documents in the Amazon S3
          bucket are encrypted, you must provide permission to use the AWS KMS customer
          master key (CMK) to decrypt the documents.</p><p>A required role policy to allow Amazon Kendra to use an Amazon S3 bucket
          as a data source.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
         <span>{</span>
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">bucket name</code>/*"
            ],
            "Effect": "Allow"
        },
        <span>{</span>
            "Action": [
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">bucket name</code>"
            ],
            "Effect": "Allow"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kendra:BatchPutDocument",
                "kendra:BatchDeleteDocument"
            ],
            "Resource": [
                "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
            ]
        }
    ]
}</code></pre><p>An optional role policy to allow Amazon Kendra to use an AWS KMS
          customer master key (CMK) to decrypt documents in an Amazon S3 bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        }
    ]
}</code></pre><p>An optional role policy to allow Amazon Kendra to access an Amazon S3
          bucket, while using a Amazon VPC, and without activating AWS KMS or
          sharing AWS KMS permissions.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Action": [
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::<span>{</span><span>{</span>input_bucket_name}}/*"
      ],
      "Effect": "Allow"
    },
    <span>{</span>
      "Action": [
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::<span>{</span><span>{</span>input_bucket_name}}"
      ],
      "Effect": "Allow"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface"
      ],
      "Resource": [
        "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]",
        "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:security-group/[[security_group]]"
      ]
    },
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "ec2:CreateNetworkInterface"
        ],
        "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
        "Condition": <span>{</span>
            "StringLike": <span>{</span>
                "aws:RequestTag/AWS_KENDRA": "kendra_<span>{</span><span>{</span>account_id}}_<span>{</span><span>{</span>index_id}}_<span>{</span>datasource_id}}_*"
            }
        }
    },
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "ec2:CreateTags"
        ],
        "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
        "Condition": <span>{</span>
            "StringEquals": <span>{</span>
                "ec2:CreateAction": "CreateNetworkInterface"
            }
        }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeSubnets"
      ],
      "Resource": ["arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]"]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeNetworkInterfaces"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterfacePermission"
      ],
      "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "ec2:AuthorizedService": "kendra.amazonaws.com"
        },
        "ArnEquals": <span>{</span>
          "ec2:Subnet": [
            "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
      ],
      "Resource": [
        "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}",
        "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:BatchPutDocument",
        "kendra:BatchDeleteDocument"
      ],
      "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
    }
  ]
}
<span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "kendra.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre><p>An optional role policy to allow Amazon Kendra to access an Amazon S3
          bucket while using a Amazon VPC, and with AWS KMS permissions
          activated.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Action": [
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::<span>{</span><span>{</span>input_bucket_name}}/*"
      ],
      "Effect": "Allow"
    },
    <span>{</span>
      "Action": [
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::<span>{</span><span>{</span>input_bucket_name}}"
      ],
      "Effect": "Allow"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt"
      ],
      "Resource": [
        "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/<span>{</span><span>{</span>key_id}}"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "kms:ViaService": [
            "s3.*.amazonaws.com"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface"
      ],
      "Resource": [
        "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]",
        "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:security-group/[[security_group]]"
      ]
    },
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "ec2:CreateNetworkInterface"
        ],
        "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
        "Condition": <span>{</span>
            "StringLike": <span>{</span>
                "aws:RequestTag/AWS_KENDRA": "kendra_<span>{</span><span>{</span>account_id}}_<span>{</span><span>{</span>index_id}}_<span>{</span>datasource_id}}_*"
            }
        }
    },
    <span>{</span>
        "Effect": "Allow",
        "Action": [
            "ec2:CreateTags"
        ],
        "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
        "Condition": <span>{</span>
            "StringEquals": <span>{</span>
                "ec2:CreateAction": "CreateNetworkInterface"
            }
        }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeSubnets"
      ],
      "Resource": ["arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]"]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeNetworkInterfaces"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterfacePermission"
      ],
      "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "ec2:AuthorizedService": "kendra.amazonaws.com"
        },
        "ArnEquals": <span>{</span>
          "ec2:Subnet": [
            "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
      ],
      "Resource": [
        "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}",
        "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:BatchPutDocument",
        "kendra:BatchDeleteDocument"
      ],
      "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
    }
  ]
}

<span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Principal": <span>{</span>
        "Service": "kendra.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
 
          <h4 id="iam-roles-ds-s3-cross-accounts">Policies to use Amazon S3
              across accounts</h4>
          <p>If your Amazon S3 bucket is in a different account to the account you use
            for your Amazon Kendra index, you can create policies to use it across
            accounts.</p>
          <p>A role policy to use your Amazon S3 bucket as your data source when the
            bucket is in a different account to your Amazon Kendra index.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
         <span>{</span>
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::$BUCKET_IN_OTHER_ACCOUNT/*"
            ],
            "Effect": "Allow"
        },
        <span>{</span>
            "Action": [
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::$BUCKET_IN_OTHER_ACCOUNT/*"
            ],
            "Effect": "Allow"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kendra:BatchPutDocument",
                "kendra:BatchDeleteDocument"
            ],
            "Resource": [
                "arn:aws:kendra:$KENDRA_REGION:$KENDRA_ACCOUNT_ID:index/$KENDRA_INDEX_ID"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:PutObjectAcl"
            ],
            "Resource": "arn:aws:s3:::$BUCKET_IN_OTHER_ACCOUNT/*"
        }
    ]
}</code></pre>
          <p>A bucket policy to allow the Amazon S3 data source role to access the
              Amazon S3 bucket across accounts.</p>
          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "AWS": "$KENDRA_S3_CONNECTOR_ROLE_ARN"
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:PutObjectAcl"
            ],
            "Resource": [
                "arn:aws:s3:::$BUCKET_IN_OTHER_ACCOUNT/*"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "AWS": "$KENDRA_S3_CONNECTOR_ROLE_ARN"
            },
            "Action": "s3:ListBucket",
            "Resource": "arn:aws:s3:::$BUCKET_IN_OTHER_ACCOUNT"
        }
    ]
}</code></pre>
           
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
 
        </awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for database data&#xA;            sources" id="iam-roles-ds-jdbc" expanded="false"><p>When you use a database as a data source, you provide Amazon Kendra with a role
          that has the permissions necessary for connecting to the database. These include:</p><div class="itemizedlist">
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access the AWS Secrets Manager secret that contains the user name
              and password for the database site. For more information about the contents of the
              secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/datasource-database.html">Database data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the AWS KMS customer master key (CMK) to decrypt the
              user name and password secret stored by Secrets Manager.</p>
          </li><li class="listitem">
            <p>Permission to use the <code class="code">BatchPutDocument</code> and
                <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
          </li><li class="listitem">
            <p>Permission to access the Amazon S3 bucket that contains the SSL
              certificate used to communicate with the database site.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "secretsmanager:GetSecretValue"
            ],
            "Resource": [
                "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kendra:BatchPutDocument",
                "kendra:BatchDeleteDocument"
            ],
            "Resource": [
                "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
            "Condition": <span>{</span>
                "StringLike": <span>{</span>
                    "kms:ViaService": [
                        "kendra.*.amazonaws.com"
                    ]
                }
            }
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">bucket name</code>/*"
            ]
        }
    ]
}</code></pre><p>There are two optional policies that you might use with a database data source.</p><p>If you have encrypted the Amazon S3 bucket that contains the SSL certificate
          used to communicate with the database, provide a policy to give Amazon Kendra access
          to the key. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        }
    ]
}</code></pre><p>If you are using a VPC, provide a policy that gives Amazon Kendra access to the
          required resources. See <a href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html#iam-roles-ds">IAM roles for data 
            sources, VPC</a> for the required policy.</p>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Amazon FSx data&#xA;            sources" id="iam-roles-ds-fsx" expanded="false"><p>When you use Amazon FSx, you provide a role with the following
          policies.</p><div class="itemizedlist">
           
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
                Amazon FSx.</p>
          </li><li class="listitem">
            <p>Permission to access Amazon Virtual Private Cloud (VPC) where your Amazon FSx
              resides.</p>
          </li><li class="listitem">
            <p>Permission to get the domain name of your Active Directory for your Amazon FSx Windows file system.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Amazon FSx
              connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code> and
                <code class="code">BatchDeleteDocument</code> APIs to update the index.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
        "Statement": [
        <span>{</span>
          "Effect": "Allow",
          "Action": [
            "secretsmanager:GetSecretValue"
          ],
          "Resource": [
            "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:<span>{</span><span>{</span>secret_id}}"
          ]
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": [
            "kms:Decrypt"
          ],
          "Resource": [
            "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/<span>{</span><span>{</span>key_id}}"
          ],
          "Condition": <span>{</span>
            "StringLike": <span>{</span>
              "kms:ViaService": [
                "secretsmanager.<span>{</span><span>{</span>region}}.amazonaws.com"
              ]
            }
          }
        },
        <span>{</span>
          "Effect": "Allow",
          "Action":[
            "ec2:CreateNetworkInterface",
            "ec2:DeleteNetworkInterface"
          ],
          "Resource": [
                "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
                "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]"
          ]   
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": [
            "ec2:DescribeSubnets",
            "ec2:DescribeNetworkInterfaces"
          ],
          "Resource": "*"
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": [
            "ec2:CreateNetworkInterfacePermission"
          ],
          "Resource": "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:network-interface/*",
          "Condition": <span>{</span>
            "StringEquals": <span>{</span>
              "ec2:AuthorizedService": "kendra.*.amazonaws.com"
            },
            "ArnEquals": <span>{</span>
              "ec2:Subnet": [
                "arn:aws:ec2:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:subnet/[[subnet_ids]]"
              ]
            }
          }
        },
        <span>{</span>
          "Sid": "AllowsKendraToGetDomainNameOfActiveDirectory",
          "Effect": "Allow",
          "Action": "ds:DescribeDirectories",
          "Resource": "*"
        },
        <span>{</span>
          "Sid": "AllowsKendraToCallRequiredFsxAPIs",
          "Effect": "Allow",
          "Action": [
              "fsx:DescribeFileSystems"
          ],
          "Resource": "*"
        },
        <span>{</span>
          "Sid": "iamPassRole",
          "Effect": "Allow",
          "Action": "iam:PassRole",
          "Resource": "*",
          "Condition": <span>{</span>
            "StringEquals": <span>{</span>
              "iam:PassedToService": [
                "kendra.*.amazonaws.com"
              ]
            }
          }
        },
        <span>{</span>
          "Effect": "Allow",
          "Action": [
            "kendra:BatchPutDocument",
            "kendra:BatchDeleteDocument"
          ],
          "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
        }
        ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    
    
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for web crawler data&#xA;            sources" id="iam-roles-ds-webcrawler" expanded="false"><p>When you use Amazon Kendra Web Crawler, you provide a role with the following
          policies:</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access the AWS Secrets Manager secret that contains the user name
              and password to connect to websites or a web proxy server backed by basic
              authentication. For more information about the contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-web-crawler.html">Using a web
                crawler data source</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the AWS KMS customer master key (CMK) to decrypt the
              user name and password secret stored by Secrets Manager.</p>
          </li><li class="listitem">
            <p>Permission to use the <code class="code">BatchPutDocument</code> and
              <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Amazon WorkDocs data&#xA;            sources" id="iam-roles-workdocs" expanded="false"><p>When you use Amazon WorkDocs, you provide a role with the following policies</p><div class="itemizedlist">
           
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to verify the directory ID (organization ID) that corresponds with your
                Amazon WorkDocs site repository.</p>
          </li><li class="listitem">
            <p>Permission to get the domain name of your Active Directory that contains your
                Amazon WorkDocs site directory.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Amazon WorkDocs
              connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code> and
                <code class="code">BatchDeleteDocument</code> APIs to update the index.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AllowsKendraToGetDomainNameOfActiveDirectory",
      "Effect": "Allow",
      "Action": "ds:DescribeDirectories",
      "Resource": "*"
    },
    <span>{</span>
      "Sid": "AllowsKendraToCallRequiredWorkDocsAPIs",
      "Effect": "Allow",
      "Action": [
        "workdocs:GetDocumentPath",
        "workdocs:GetGroup",
        "workdocs:GetDocument",
        "workdocs:DownloadDocumentVersions",
        "workdocs:DescribeUsers",
        "workdocs:DescribeFolderContents",
        "workdocs:DescribeActivities",
        "workdocs:DescribeComments",
        "workdocs:GetFolder",
        "workdocs:DescribeResourcePermissions",
        "workdocs:GetFolderPath",
        "workdocs:DescribeInstances"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Sid": "iamPassRole",
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "iam:PassedToService": [
            "kendra.*.amazonaws.com"
          ]
        }
      }
    },
    <span>{</span>
      "Sid": "AllowsKendraToCallBatchPutDeleteAPIs",
      "Effect": "Allow",
      "Action": [
        "kendra:BatchPutDocument",
        "kendra:BatchDeleteDocument"
      ],
      "Resource": [
        "arn:aws:kendra:<span>{</span><span>{</span><code class="replaceable">region</code>}}:<span>{</span><span>{</span><code class="replaceable">account_id</code>}}:index/$<span>{</span><code class="replaceable">IndexId</code>}"
      ]
    }
  ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Box data sources" id="iam-roles-ds-box" expanded="false"><p>When you use Box, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Slack.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Box connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Confluence data&#xA;            sources" id="iam-roles-ds-cnf" expanded="false"><div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Confluence&#xA;                Connector v1.0" id="iam-roles-confluence-v1" expanded="false"><p>When you use a Confluence server as a data source, you provide a role with the
              following policies:</p><div class="itemizedlist">
               
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>Permission to access the AWS Secrets Manager secret that contains the
                  credentials necessary to connect to Confluence. For more information about the
                  contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-confluence.html">Confluence data sources</a>.</p>
              </li><li class="listitem">
                <p>Permission to use the AWS KMS customer master key (CMK) to decrypt
                  the user name and password secret stored by Secrets Manager.</p>
              </li><li class="listitem">
                <p>Permission to use the <code class="code">BatchPutDocument</code> and
                    <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
              </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}</code></pre><p>If you are using a VPC, provide a policy that gives Amazon Kendra access to
              the required resources. See <a href="https://docs.aws.amazon.com/kendra/latest/dg/iam-roles.html#iam-roles-ds">IAM roles for data 
                sources, VPC</a> for the required policy.</p>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div><div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Confluence&#xA;                Connector v2.0" id="iam-roles-confluence-v2" expanded="false"><p>For a Confluence connector v2.0 data source, you provide a role with the following
              policies.</p><div class="itemizedlist">
               
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>Permission to access the AWS Secrets Manager secret that contains the
                  authentication credentials for Confluence. For more information about the contents
                  of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-confluence.html">Confluence data sources</a>.</p>
              </li><li class="listitem">
                <p>Permission to use the AWS KMS customer master key (CMK) to decrypt
                  the user name and password secret stored by AWS Secrets Manager.</p>
              </li><li class="listitem">
                <p>Permission to use the <code class="code">BatchPutDocument</code> and
                    <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
              </li></ul></div><p>You must also attach a trust policy that allows Amazon Kendra to assume the
              role.</p><p>A role policy to allow Amazon Kendra to connect to Confluence.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue"
      ],
      "Resource": [
        "arn:aws:secretsmanager:region:account_id:secret:secret_id"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt"
      ],
      "Resource": [
        "arn:aws:kms:region:account_id:key/key_id"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "kms:ViaService": [
            "secretsmanager.*.amazonaws.com"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
      ],
      "Resource": [
        "arn:aws:kendra:region:account_id:index/index_id",
        "arn:aws:kendra:region:account_id:index/index_id/data-source/*"
      ]
    }
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:BatchPutDocument",
        "kendra:BatchDeleteDocument"
      ],
      "Resource": "arn:aws:kendra:region:account_id:index/index_id"
    }
  ]
}</code></pre><p>An role policy to allow Amazon Kendra to connect to Confluence with VPC
              configuration.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue"
      ],
      "Resource": [
        "arn:aws:secretsmanager:region:account_id:secret:secret_id"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt"
      ],
      "Resource": [
        "arn:aws:kms:region:account_id:key/key_id"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "kms:ViaService": [
            "secretsmanager.*.amazonaws.com"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
      ],
      "Resource": [
        "arn:aws:kendra:region:account_id:index/index_id",
        "arn:aws:kendra:region:account_id:index/index_id/data-source/*"
      ]
    }
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:BatchPutDocument",
        "kendra:BatchDeleteDocument"
      ],
      "Resource": "arn:aws:kendra:region:account_id:index/index_id"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface"
      ],
      "Resource": [
        "arn:aws:ec2:region:account_id:subnet/subnet_ids",
        "arn:aws:ec2:region:account_id:security-group/security_group"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface"
      ],
      "Resource": "arn:aws:ec2:region:account_id:network-interface/*",
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "aws:RequestTag/AWS_KENDRA": "kendra_account_id_index_id_*"
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:region:account_id:network-interface/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "ec2:CreateAction": "CreateNetworkInterface"
        }
      }
    },
    
<span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterfacePermission"
      ],
      "Resource": "arn:aws:ec2:region:account_id:network-interface/*",
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "aws:ResourceTag/AWS_KENDRA": "kendra_account_id_index_id_*"
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeNetworkInterfaces",
        "ec2:DescribeAvailabilityZones",
        "ec2:DescribeNetworkInterfaceAttribute",
        "ec2:DescribeVpcs",
        "ec2:DescribeRegions",
        "ec2:DescribeNetworkInterfacePermissions",
        "ec2:DescribeSubnets"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div></awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Dropbox data&#xA;            sources" id="iam-roles-ds-dropbox" expanded="false"><p>When you use Dropbox, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Dropbox.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Dropbox connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
"Version": "2012-10-17",
  "Statement": [
  <span>{</span>"Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>"Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>"StringLike": <span>{</span>"kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>"Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>"Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for GitHub data&#xA;            sources" id="iam-roles-ds-github" expanded="false"><p>When you use GitHub, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              GitHub.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the GitHub connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>


    
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Gmail data&#xA;            sources" id="iam-roles-ds-gmail" expanded="false"><p>When you use Gmail, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Gmail.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Gmailconnector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
"Version": "2012-10-17",
  "Statement": [
  <span>{</span>"Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>"Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>"StringLike": <span>{</span>"kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>"Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>"Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Google Drive data&#xA;            sources" id="iam-roles-ds-gd" expanded="false"><p>When you use a Google Workspace Drive data source, you provide Amazon Kendra with
          a role that has the permissions necessary for connecting to the site. These include: </p><div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to get and decrypt the AWS Secrets Manager secret that contains the
              client account email, admin account email, and private key necessary to connect to the
              Google Drive site. For more information about the contents of the secret, see 
              <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-google-drive.html">Google Drive data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchPutDocument.html">BatchPutDocument</a>
              and <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchDeleteDocument.html">BatchDeleteDocument</a> APIs.</p>
          </li></ul></div><p>The following IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Jira data sources" id="iam-roles-ds-jira" expanded="false"><p>When you use Jira, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Jira.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Jira connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Microsoft Exchange&#xA;            data sources" id="iam-roles-ds-exchange" expanded="false"><p>When you use a Microsoft Exchange data source, you provide Amazon Kendra with a
          role that has the permissions necessary for connecting to the site. These include: </p><div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to get and decrypt the AWS Secrets Manager secret that contains the
              application ID and secret key necessary to connect to the Microsoft Exchange site. For
              more information about the contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-exchange.html">Microsoft Exchange data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchPutDocument.html">BatchPutDocument</a>
              and <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchDeleteDocument.html">BatchDeleteDocument</a> APIs.</p>
          </li></ul></div><p>The following IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre><p>If you are storing the list of users to index in an Amazon S3 bucket, you must
          also provide permission to use the S3 <code class="code">GetObject</code> operation. The following
            IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Action": [
      "s3:GetObject"
    ],
    "Resource": [
      "arn:aws:s3:::<code class="replaceable">input_bucket_name</code>/*"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/[[key IDs]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com",
          "s3.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Microsoft OneDrive data&#xA;            sources" id="iam-roles-ds-on" expanded="false"><p>When you use a Microsoft OneDrive data source, you provide Amazon Kendra with a
          role that has the permissions necessary for connecting to the site. These include: </p><div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to get and decrypt the AWS Secrets Manager secret that contains the
              application ID and secret key necessary to connect to the OneDrive site. For more
              information about the contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-onedrive.html">Microsoft OneDrive data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchPutDocument.html">BatchPutDocument</a>
              and <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchDeleteDocument.html">BatchDeleteDocument</a> APIs.</p>
          </li></ul></div><p>The following IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre><p>If you are storing the list of users to index in an Amazon S3 bucket, you must
          also provide permission to use the S3 <code class="code">GetObject</code> operation. The following
            IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Action": [
      "s3:GetObject"
    ],
    "Resource": [
      "arn:aws:s3:::<code class="replaceable">input_bucket_name</code>/*"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/[[key IDs]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com",
          "s3.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Microsoft SharePoint data&#xA;            sources" id="iam-roles-ds-spo" expanded="false"><div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for SharePoint&#xA;                Connector v1.0" id="iam-roles-sharepoint-v1" expanded="false"><p>For a Microsoft SharePoint connector v1.0 data source, you provide a role with the
              following policies.</p><div class="itemizedlist">
               
               
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>Permission to access the AWS Secrets Manager secret that contains the user
                  name and password for the SharePoint site. For more information about the contents
                  of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-sharepoint.html">Microsoft SharePoint data sources</a>.</p>
              </li><li class="listitem">
                <p>Permission to use the AWS KMS customer master key (CMK) to decrypt
                  the user name and password secret stored by AWS Secrets Manager.</p>
              </li><li class="listitem">
                <p>Permission to use the <code class="code">BatchPutDocument</code> and
                    <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
              </li><li class="listitem">
                <p>Permission to access the Amazon S3 bucket that contains the SSL
                  certificate used to communicate with the SharePoint site.</p>
              </li></ul></div><p>You must also attach a trust policy that allows Amazon Kendra to assume the
              role.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "secretsmanager:GetSecretValue"
            ],
            "Resource": [
                "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kendra:BatchPutDocument",
                "kendra:BatchDeleteDocument"
            ],
            "Resource": [
                "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
            ],
            "Condition": <span>{</span>
                "StringLike": <span>{</span>
                    "kms:ViaService": [
                        "kendra.*.amazonaws.com"
                    ]
                }
            }
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">bucket name</code>/*"
            ]
        }
    ]
}</code></pre><p>If you have encrypted the Amazon S3 bucket that contains the SSL
              certificate used to communicate with the SharePoint site, provide a policy to give
                Amazon Kendra access to the key. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        }
    ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div><div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for SharePoint&#xA;                Connector v2.0" id="iam-roles-sharepoint-v2" expanded="false"><p>For a Microsoft SharePoint connector v2.0 data source, you provide a role with the
              following policies.</p><div class="itemizedlist">
               
               
               
               
            <ul class="itemizedlist"><li class="listitem">
                <p>Permission to access the AWS Secrets Manager secret that contains the
                  authentication credentials for the SharePoint site. For more information about the
                  contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-sharepoint.html">Microsoft SharePoint data sources</a>.</p>
              </li><li class="listitem">
                <p>Permission to use the AWS KMS customer master key (CMK) to decrypt
                  the user name and password secret stored by AWS Secrets Manager.</p>
              </li><li class="listitem">
                <p>Permission to use the <code class="code">BatchPutDocument</code> and
                    <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
              </li><li class="listitem">
                <p>Permission to access the Amazon S3 bucket that contains the SSL
                  certificate used to communicate with the SharePoint site.</p>
              </li></ul></div><p>You must also attach a trust policy that allows Amazon Kendra to assume the
              role.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue"
      ],
      "Resource": [
        "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:secret:<code class="replaceable">secret_id</code>"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kms:Decrypt"
      ],
      "Resource": [
        "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:key/<code class="replaceable">key_id</code>"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "kms:ViaService": [
            "secretsmanager.*.amazonaws.com"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
      ],
      "Resource": [
        "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:index/<code class="replaceable">index_id</code>",
        "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:index/<code class="replaceable">index_id</code>/data-source/*"
      ]
    },
    <span>{</span>
      "Action": [
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::<code class="replaceable">input_bucket_name</code>/<code class="replaceable">input_key_name</code>"
      ],
      "Effect": "Allow"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "kendra:BatchPutDocument",
        "kendra:BatchDeleteDocument"
      ],
      "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:index/<code class="replaceable">index_id</code>"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface"
      ],
      "Resource": [
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:subnet/<code class="replaceable">subnet_ids</code>",
        "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:security-group/<code class="replaceable">security_group</code>"
      ]
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:network-interface/*",
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "aws:RequestTag/AWS_KENDRA": "kendra_<code class="replaceable">account_id</code>_<code class="replaceable">index_id</code>_*"
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateTags"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:network-interface/*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "ec2:CreateAction": "CreateNetworkInterface"
        }
      }
    },
    
<span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterfacePermission"
      ],
      "Resource": "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account_id</code>:network-interface/*",
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "aws:ResourceTag/AWS_KENDRA": "kendra_<code class="replaceable">account_id</code>_<code class="replaceable">index_id</code>_*"
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeNetworkInterfaces",
        "ec2:DescribeAvailabilityZones",
        "ec2:DescribeNetworkInterfaceAttribute",
        "ec2:DescribeVpcs",
        "ec2:DescribeRegions",
        "ec2:DescribeNetworkInterfacePermissions",
        "ec2:DescribeSubnets"
      ],
      "Resource": "*"
    }
  ]
}</code></pre><p>If you have encrypted the Amazon S3 bucket that contains the SSL
              certificate used to communicate with the SharePoint site, provide a policy to give
                Amazon Kendra access to the key. </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ]
        }
    ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div></awsui-expandable-section></div>

    

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Microsoft Teams data&#xA;            sources" id="iam-roles-ds-teams" expanded="false"><p>When you use a Microsoft Teams data source, you provide Amazon Kendra with a role
          that has the permissions necessary for connecting to the site. These include: </p><div class="itemizedlist">
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to get and decrypt the AWS Secrets Manager secret that contains the
              client ID and client secret necessary to connect to Microsoft Teams. For more
              information about the contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-teams.html">Microsoft Teams data sources</a>.</p>
          </li></ul></div><p>The following IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">client ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
        </code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Microsoft Yammer data&#xA;            sources" id="iam-roles-ds-yammer" expanded="false"><p>When you use a Microsoft Yammer data source, you provide Amazon Kendra with a
          role that has the permissions necessary for connecting to the site. These include: </p><div class="itemizedlist">
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to get and decrypt the AWS Secrets Manager secret that contains the
              application ID and secret key necessary to connect to the Microsoft Yammer site. For
              more information about the contents of the secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-yammer.html">Microsoft Yammer data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchPutDocument.html">BatchPutDocument</a>
              and <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_BatchDeleteDocument.html">BatchDeleteDocument</a> APIs.</p>
          </li></ul></div><p>The following IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre><p>If you are storing the list of users to index in an Amazon S3 bucket, you must
          also provide permission to use the S3 <code class="code">GetObject</code> operation. The following
            IAM policy provides the necessary permissions:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Action": [
      "s3:GetObject"
    ],
    "Resource": [
      "arn:aws:s3:::<code class="replaceable">input_bucket_name</code>/*"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/[[key IDs]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com",
          "s3.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Quip data sources" id="iam-roles-ds-quip" expanded="false"><p>When you use Quip, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Quip.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Quip connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Salesforce data&#xA;            sources" id="iam-roles-ds-sf" expanded="false"><p>When you use a Salesforce as a data source, you provide a role with the following
          policies:</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access the AWS Secrets Manager secret that contains the user name
              and password for the Salesforce site. For more information about the contents of the
              secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-salesforce.html">Salesforce data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the AWS KMS customer master key (CMK) to decrypt the
              user name and password secret stored by Secrets Manager.</p>
          </li><li class="listitem">
            <p>Permission to use the <code class="code">BatchPutDocument</code> and
                <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>


    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for ServiceNow data&#xA;            sources" id="iam-roles-ds-sn" expanded="false"><p>When you use a ServiceNow as a data source, you provide a role with the following
          policies:</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access the Secrets Manager secret that contains the user name and
              password for the ServiceNow site. For more information about the contents of the
              secret, see <a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source-servicenow.html">ServiceNow data sources</a>.</p>
          </li><li class="listitem">
            <p>Permission to use the AWS KMS customer master key (CMK) to decrypt the
              user name and password secret stored by Secrets Manager.</p>
          </li><li class="listitem">
            <p>Permission to use the <code class="code">BatchPutDocument</code> and
                <code class="code">BatchDeleteDocument</code> operations to update the index.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:secret:<code class="replaceable">secret ID</code>"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:index/<code class="replaceable">index ID</code>"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Slack data&#xA;            sources" id="iam-roles-ds-slack" expanded="false"><p>When you use Slack, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Slack.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Slack connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Zendesk data&#xA;            sources" id="iam-roles-ds-zendesk" expanded="false"><p>When you use Zendesk, you provide a role with the following policies.</p><div class="itemizedlist">
           
           
           
        <ul class="itemizedlist"><li class="listitem">
            <p>Permission to access your AWS Secrets Manager secret to authenticate your
              Zendesk Suite.</p>
          </li><li class="listitem">
            <p>Permission to call the required public APIs for the Zendesk connector.</p>
          </li><li class="listitem">
            <p>Permission to call the <code class="code">BatchPutDocument</code>,
                <code class="code">BatchDeleteDocument</code>, <code class="code">PutPrincipalMapping</code>,
                <code class="code">DeletePrincipalMapping</code>, <code class="code">DescribePrincipalMapping</code>, and
                <code class="code">ListGroupsOlderThanOrderingId</code> APIs.</p>
          </li></ul></div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "secretsmanager:GetSecretValue"
    ],
    "Resource": [
      "arn:aws:secretsmanager:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:secret:[[secret_id]]"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:key/[[key_id]]"
    ],
    "Condition": <span>{</span>
      "StringLike": <span>{</span>
        "kms:ViaService": [
          "secretsmanager.*.amazonaws.com"
        ]
      }
    }
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
        "kendra:PutPrincipalMapping",
        "kendra:DeletePrincipalMapping",
        "kendra:ListGroupsOlderThanOrderingId",
        "kendra:DescribePrincipalMapping"
    ],
    "Resource": ["arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}", "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}/data-source/*"]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kendra:BatchPutDocument",
      "kendra:BatchDeleteDocument"
    ],
    "Resource": "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>index_id}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>

    

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="Virtual private cloud (VPC) IAM&#xA;            role" id="iam-roles-vpc" expanded="false"><p>If you use a virtual private cloud (VPC) to connect to your data source, you must
          provide the following permissions.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterface",
        "ec2:DescribeNetworkInterfaces",
        "ec2:DeleteNetworkInterface"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:CreateNetworkInterfacePermission"
      ],
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "ec2:AuthorizedService": "kendra.*.amazonaws.com"
        },
        "ArnEquals": <span>{</span>
          "ec2:Subnet": [
            "arn:aws:ec2:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:subnet/<code class="replaceable">subnet IDs</code>"
          ]
        }
      }
    },
    <span>{</span>
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeSubnets"
      ],
      "Resource": "*"
    },
    <span>{</span>
      "Sid": "iamPassRole",
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "iam:PassedToService": [
            "kendra.*.amazonaws.com"
          ]
        }
      }
    }
  ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>
   
    <h2 id="iam-roles-ds-faq">IAM roles for frequently asked questions
        (FAQs)</h2>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_CreateFaq.html">CreateFaq</a> API to load questions
      and answers into an index, you must provide Amazon Kendra with an IAM role
      with access to the Amazon S3 bucket that contains the source files. If the source
      files are encrypted, you must provide permission to use the AWS KMS customer master
      key (CMK) to decrypt the files.</p>

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for FAQs" id="iam-roles-faq" expanded="false"><p>A required role policy to allow Amazon Kendra to access an Amazon S3
          bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::<code class="replaceable">bucket name</code>/*"
            ]
        }
    ]
}</code></pre><p>An optional role policy to allow Amazon Kendra to use an AWS KMS
          customer master key (CMK) to decrypt files in an Amazon S3 bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">account ID</code>:key/<code class="replaceable">key ID</code>"
            ],
            "Condition": <span>{</span>
                "StringLike": <span>{</span>
                    "kms:ViaService": [
                        "kendra.*.amazonaws.com"
                    ]
                }
            }
        }
    ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>
   
    <h2 id="iam-roles-query-suggestions">IAM roles for query
        suggestions</h2>
    <p>When you use an Amazon S3 file as a query suggestions block list, you supply a
      role that has permission to access the Amazon S3 file and the Amazon S3
      bucket. If the block list text file (the Amazon S3 file) in the Amazon S3
      bucket is encrypted, you must provide permission to use the AWS KMS customer master
      key (CMK) to decrypt the documents.</p>
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for query&#xA;            suggestions" id="iam-roles-query-sugestions-json" expanded="false"><p>A required role policy to allow Amazon Kendra to use the Amazon S3 file
          as your query suggestions block list.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>"Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::bucket name/*"
            ]
        }
    ]
}
</code></pre><p>An optional role policy to allow Amazon Kendra to use an AWS KMS
          customer master key (CMK) to decrypt documents in an Amazon S3 bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>"Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:region:account ID:key/key ID"
            ]
        }
    ]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>
   
    <h2 id="iam-roles-principal-mapping">IAM roles for principal mapping
        of users and groups</h2>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_PutPrincipalMapping.html">PutPrincipalMapping</a>
      API to map users to their groups for filtering search results by user context, you need to
      provide a list of users or sub groups that belong to a group. If your list is more than 1000
      users or sub groups for a group, you need to supply a role that has permission to access the
        Amazon S3 file of your list and the Amazon S3 bucket. If the text file (the
        Amazon S3 file) of the list in the Amazon S3 bucket is encrypted, you must
      provide permission to use the AWS KMS customer master key (CMK) to decrypt the
      documents.</p>

    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for principal&#xA;            mapping" id="iam-roles-principal-mapping-json" expanded="false"><p>A required role policy to allow Amazon Kendra to use the Amazon S3 file
          as your list of users and sub groups that belong to a group.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>"Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::bucket name/*"
            ]
        }
    ]
}
</code></pre><p>An optional role policy to allow Amazon Kendra to use an AWS KMS
          customer master key (CMK) to decrypt documents in an Amazon S3 bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>"Effect": "Allow",
            "Action": [
                "kms:Decrypt"
            ],
            "Resource": [
                "arn:aws:kms:region:account ID:key/key ID"
            ]
        }
    ]
}
</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
<p>It is recommended that you include <code class="code">aws:sourceAccount</code> and
            <code class="code">aws:sourceArn</code> in the trust policy. This limits permissions and securely
          checks if <code class="code">aws:sourceAccount</code> and <code class="code">aws:sourceArn</code> are the same as
          provided in the IAM role policy for the <code class="code">sts:AssumeRole</code> action.
          This prevents unauthorized entities from accessing your IAM roles and their
          permissions. For more information, see the AWS Identity and Access Management guide on the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/confused-deputy.html">confused deputy
            problem</a>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": [
                    "kendra.*.amazonaws.com"
                ]
            },
            "Action": "sts:AssumeRole",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:SourceAccount": "account ID"
                },
                "StringLike": <span>{</span>
                    "aws:SourceArn": "arn:aws:kendra:region:accountId:index/*"
                }
            }
        }
    ]
}</code></pre></awsui-expandable-section></div>
   
    <h2 id="iam-roles-aws-sso">IAM roles for AWS IAM Identity Center (successor to AWS Single Sign-On)</h2>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_UserGroupResolutionConfiguration.html">UserGroupResolutionConfiguration</a> object to fetch access levels of groups and users
      from an AWS IAM Identity Center (successor to AWS Single Sign-On) identity source, you need to supply a role that has permission
      to access IAM Identity Center.</p>
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for AWS IAM Identity Center (successor to AWS Single Sign-On)" id="iam-roles-aws-sso-json" expanded="false"><p>A required role policy to allow Amazon Kendra to access IAM Identity Center.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "sso-directory:SearchUsers",
                "sso-directory:ListGroupsForUser",
                "sso-directory:DescribeGroups",
                "sso:ListDirectoryAssociations"
            ],
            "Resource": [
                 "*"
            ]
        },
        <span>{</span>
          "Sid": "iamPassRole",
          "Effect": "Allow",
          "Action": "iam:PassRole",
          "Resource": "*",
          "Condition": <span>{</span>
            "StringEquals": <span>{</span>
              "iam:PassedToService": [
                "kendra.*.amazonaws.com"
              ]
            }
          }
        }
     ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
</awsui-expandable-section></div>
   
    <h2 id="iam-roles-amazon-kendra-experiences">IAM roles for Amazon Kendra experiences</h2>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_CreateExperience.html">CreateExperience</a> or
        <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_UpdateExperience.html">UpdateExperience</a> APIs to create or update a search application, you must supply a
      role that has permission to access the necessary operations and IAM Identity Center.</p>
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for Amazon Kendra search experience" id="iam-roles-search-app-experience" expanded="false"><p>A required role policy to allow Amazon Kendra to access <code class="code">Query</code>
          operations, <code class="code">QuerySuggestions</code> operations, <code class="code">SubmitFeedback</code>
          operations, and IAM Identity Center that stores your user and group information.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "AllowsKendraSearchAppToCallKendraApi",
      "Effect": "Allow",
      "Action": [
        "kendra:GetQuerySuggestions",
        "kendra:Query",
        "kendra:DescribeIndex",
        "kendra:ListFaqs",
        "kendra:DescribeDataSource",
        "kendra:ListDataSources",
        "kendra:DescribeFaq",
        "kendra:SubmitFeedback"
      ],
      "Resource": [
        "arn:aws:kendra:<span>{</span><span>{</span>region}}:<span>{</span><span>{</span>account_id}}:index/<span>{</span><span>{</span>IndexId}}"
      ]
    },
    <span>{</span>
      "Sid": "AllowKendraSearchAppToDescribeDataSourcesAndFaq",
      "Effect": "Allow",
      "Action": [
        "kendra:DescribeDataSource",
        "kendra:DescribeFaq"
      ],
      "Resource": [
        "arn:aws:kendra:<span>{</span><span>{</span><code class="replaceable">region</code>}}:<span>{</span><span>{</span><code class="replaceable">account_id</code>}}:index/<span>{</span><span>{</span><code class="replaceable">IndexId</code>}}/data-source/<span>{</span><span>{</span><code class="replaceable">DataSourceId</code>}}",
        "arn:aws:kendra:<span>{</span><span>{</span><code class="replaceable">region</code>}}:<span>{</span><span>{</span><code class="replaceable">account_id</code>}}:index/<span>{</span><span>{</span><code class="replaceable">IndexId</code>}}/faq/<span>{</span><span>{</span><code class="replaceable">FaqId</code>}}"
      ]
    },
    <span>{</span>
      "Sid": "AllowKendraSearchAppToCallSSODescribeUsersAndGroups",
      "Effect": "Allow",
      "Action": [
        "sso-directory:ListGroupsForUser",
        "sso-directory:SearchGroups",
        "sso-directory:SearchUsers",
        "sso-directory:DescribeUser",
        "sso-directory:DescribeGroup",
        "sso-directory:DescribeGroups",
        "sso-directory:DescribeUsers",
        "sso:ListDirectoryAssociations"
      ],
      "Resource": [
        "*"
      ],
      "Condition": <span>{</span>
        "StringLike": <span>{</span>
          "kms:ViaService": [
            "kendra.*.amazonaws.com"
          ]
        }
      }
    }
  ]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
<p>It is recommended that you include <code class="code">aws:sourceAccount</code> and
            <code class="code">aws:sourceArn</code> in the trust policy. This limits permissions and securely
          checks if <code class="code">aws:sourceAccount</code> and <code class="code">aws:sourceArn</code> are the same as
          provided in the IAM role policy for the <code class="code">sts:AssumeRole</code> action.
          This prevents unauthorized entities from accessing your IAM roles and their
          permissions. For more information, see the AWS Identity and Access Management guide on the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/confused-deputy.html">confused deputy
            problem</a>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": [
                    "kendra.*.amazonaws.com"
                ]
            },
            "Action": "sts:AssumeRole",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:SourceAccount": "account ID"
                },
                "StringLike": <span>{</span>
                    "aws:SourceArn": "arn:aws:kendra:region:accountId:index/*"
                }
            }
        }
    ]
}</code></pre></awsui-expandable-section></div>
   
    <h2 id="iam-roles-custom-document-enrichment">IAM roles for Custom
        Document Enrichment</h2>
    <p>When you use the <a href="https://docs.aws.amazon.com/kendra/latest/APIReference/API_CustomDocumentEnrichmentConfiguration.html">CustomDocumentEnrichmentConfiguration</a> object to apply advanced alterations of your
      document metadata and content, you must supply a role that has the required permissions to run
        <code class="code">PreExtractionHookConfiguration</code> and/or
        <code class="code">PostExtractionHookConfiguration</code>. You configure a Lambda function for
        <code class="code">PreExtractionHookConfiguration</code> and/or
        <code class="code">PostExtractionHookConfiguration</code> to apply advanced alterations of your document
      metadata and content during the ingestion process. If you choose to activate Server Side
      Encryption for your Amazon S3 bucket, you must provide permission to use the AWS KMS customer master key (CMK) to encrypt and decrypt the objects stored in your
        Amazon S3 bucket.</p>
    <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="IAM roles for&#xA;            Custom Document Enrichment" id="iam-roles-custom-document-enrichment-json" expanded="false"><p>A required role policy to allow Amazon Kendra to run
            <code class="code">PreExtractionHookConfiguration</code> and
            <code class="code">PostExtractionHookConfiguration</code> with encryption for your Amazon S3
          bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [<span>{</span>
    "Action": [
      "s3:GetObject",
      "s3:PutObject"
    ],
    "Resource": [
      "arn:aws:s3:::<span>{</span><span>{</span><code class="replaceable">input_bucket_name</code>}}/*"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Action": [
      "s3:ListBucket"
    ],
    "Resource": [
      "arn:aws:s3:::<span>{</span><span>{</span><code class="replaceable">input_bucket_name</code>}}"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "kms:Decrypt",
      "kms:GenerateDataKey"
    ],
    "Resource": [
      "arn:aws:kms:<span>{</span><span>{</span><code class="replaceable">region</code>}}:<span>{</span><span>{</span><code class="replaceable">account_id</code>}}:key/<span>{</span><span>{</span><code class="replaceable">key_id</code>}}"
    ]
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "lambda:InvokeFunction"
    ],
    "Resource": "arn:aws:lambda:<span>{</span><span>{</span><code class="replaceable">region</code>}}:<span>{</span><span>{</span><code class="replaceable">account_id</code>}}:function:<span>{</span><span>{</span><code class="replaceable">lambda_function</code>}}"
  }]
}</code></pre><p>An optional role policy to allow Amazon Kendra to run
            <code class="code">PreExtractionHookConfiguration</code> and
            <code class="code">PostExtractionHookConfiguration</code> without encryption for your Amazon S3 bucket.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [<span>{</span>
    "Action": [
      "s3:GetObject",
      "s3:PutObject"
    ],
    "Resource": [
      "arn:aws:s3:::<span>{</span><span>{</span><code class="replaceable">input_bucket_name</code>}}/*"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Action": [
      "s3:ListBucket"
    ],
    "Resource": [
      "arn:aws:s3:::<span>{</span><span>{</span><code class="replaceable">input_bucket_name</code>}}"
    ],
    "Effect": "Allow"
  },
  <span>{</span>
    "Effect": "Allow",
    "Action": [
      "lambda:InvokeFunction"
    ],
    "Resource": "arn:aws:lambda:<span>{</span><span>{</span><code class="replaceable">region</code>}}:<span>{</span><span>{</span><code class="replaceable">account_id</code>}}:function:<span>{</span><span>{</span><code class="replaceable">lambda_function</code>}}"
  }]
}</code></pre>
   <p>A trust policy to allow Amazon Kendra to assume a role.</p>
   <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
   "Version":"2012-10-17",
   "Statement":[
      <span>{</span>
         "Effect":"Allow",
         "Principal":<span>{</span>
            "Service":"kendra.amazonaws.com"
         },
         "Action":"sts:AssumeRole"
      }
   ]
}</code></pre>
<p>It is recommended that you include <code class="code">aws:sourceAccount</code> and
            <code class="code">aws:sourceArn</code> in the trust policy. This limits permissions and securely
          checks if <code class="code">aws:sourceAccount</code> and <code class="code">aws:sourceArn</code> are the same as
          provided in the IAM role policy for the <code class="code">sts:AssumeRole</code> action.
          This prevents unauthorized entities from accessing your IAM roles and their
          permissions. For more information, see the AWS Identity and Access Management guide on the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/confused-deputy.html">confused deputy
            problem</a>.</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": [
                    "kendra.*.amazonaws.com"
                ]
            },
            "Action": "sts:AssumeRole",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:SourceAccount": "account ID"
                },
                "StringLike": <span>{</span>
                    "aws:SourceArn": "arn:aws:kendra:region:accountId:index/*"
                }
            }
        }
    ]
}</code></pre></awsui-expandable-section></div>
  <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./aws-kendra-set-up-sdks.html">Setting up the AWS SDKs</div><div id="next" class="next-link" accesskey="n" href="./deploying.html">Deploying Amazon Kendra</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Kendra&amp;topic_url=https://docs.aws.amazon.com/en_us/kendra/latest/dg/iam-roles.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Kendra&amp;topic_url=https://docs.aws.amazon.com/en_us/kendra/latest/dg/iam-roles.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>