<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Checking object integrity - Amazon Simple Storage Service</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="checking-object-integrity" /><meta name="default_state" content="checking-object-integrity" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/checking-object-integrity.html" /><meta name="description" content="Verify the integrity of objects uploaded and downloaded to Amazon S3." /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Simple Storage Service" /><meta name="guide" content="User Guide" /><meta name="abstract" content="Learn how to use Amazon Simple Storage Service (Amazon S3) to store and retrieve any amount of data from anywhere. This guide explains Amazon S3 concepts, such as buckets, objects, and related configurations, and includes code examples for common operations." /><meta name="guide-locale" content="en_us" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/checking-object-integrity.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/checking-object-integrity.html" hreflang="x-default" /><meta name="feedback-item" content="S3" /><meta name="this_doc_product" content="Amazon Simple Storage Service" /><meta name="this_doc_guide" content="User Guide" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'s3'}"></script><meta id="panorama-serviceSubSection" value="User Guide" /><meta id="panorama-serviceConsolePage" value="Checking object integrity" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>Checking object integrity - Amazon Simple Storage Service</title><meta name="pdf" content="/pdfs/AmazonS3/latest/userguide/s3-userguide.pdf#checking-object-integrity" /><meta name="github" content="https://github.com/awsdocs/amazon-s3-userguide/tree/main/doc_source/checking-object-integrity.md" /><meta name="rss" content="s3-userguide-rss-updates.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=24" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=S3&amp;topic_url=http://docs.aws.amazon.com/en_us/AmazonS3/latest/userguide/checking-object-integrity.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/AmazonS3/latest/userguide/checking-object-integrity.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/AmazonS3/latest/userguide/checking-object-integrity.html" /><meta name="keywords" content="S3,Amazon S3,S3 User Guide,Amazon S3 User Guide,Amazon User Guide,s3 bucket,s3 object,cloud storage,data storage" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Simple Storage Service (S3)",
        "item" : "https://docs.aws.amazon.com/s3/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "User Guide",
        "item" : "https://docs.aws.amazon.com/AmazonS3/latest/userguide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Uploading, downloading, and working with objects in Amazon S3",
        "item" : "https://docs.aws.amazon.com/AmazonS3/latest/userguide/uploading-downloading-objects.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Checking object integrity",
        "item" : "https://docs.aws.amazon.com/AmazonS3/latest/userguide/uploading-downloading-objects.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="/pdfs/AmazonS3/latest/userguide/s3-userguide.pdf#checking-object-integrity" target="_blank" rel="noopener noreferrer" title="Open PDF"></a><a href="https://github.com/awsdocs/amazon-s3-userguide/tree/main/doc_source/checking-object-integrity.md" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">Documentation</a><a href="/s3/index.html">Amazon Simple Storage Service (S3)</a><a href="Welcome.html">User Guide</a></div><div id="page-toc-src"><a href="#using-additional-checksums">Using supported checksum algorithms</a><a href="#checking-object-integrity-md5">Using Content-MD5 when uploading objects</a><a href="#checking-object-integrity-etag-and-md5">Using Content-MD5 and the ETag
                to verify uploaded objects</a><a href="#trailing-checksums">Using trailing checksums</a><a href="#large-object-checksums">Using part-level checksums for multipart uploads</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="checking-object-integrity">Checking object integrity</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>Amazon S3 uses checksum values to verify the integrity of data that you upload to or download
        from Amazon S3. In addition, you can request that another checksum value be calculated for any
        object that you store in Amazon S3. You can select from one of several checksum algorithms to use
        when uploading or copying your data. Amazon S3 uses this algorithm to compute an additional
        checksum value and store it as part of the object metadata. To learn more about how to use additional checksums to
        verify data integrity, see <a href="http://aws.amazon.com/getting-started/hands-on/amazon-s3-with-additional-checksums/?ref=docs_gateway/amazons3/checking-object-integrity.html" rel="noopener noreferrer" target="_blank"><span>Tutorial: Checking the integrity of data in Amazon S3 with additional checksums</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p><p>When you upload an object, you can optionally include a precalculated checksum as part of
        your request. Amazon S3 compares the provided checksum to the checksum that it calculates by
        using your specified algorithm. If the two values don't match, Amazon S3 reports an error.</p>
        <h2 id="using-additional-checksums">Using supported checksum algorithms</h2>
        <p>Amazon S3 offers you the option to choose the checksum algorithm that is used to validate
            your data during upload or download. You can select one of the following Secure Hash
            Algorithms (SHA) or Cyclic Redundancy Check (CRC) data-integrity check algorithms:</p>
        <div class="itemizedlist">
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>CRC32</p>
            </li><li class="listitem">
                <p>CRC32C</p>
            </li><li class="listitem">
                <p>SHA-1</p>
            </li><li class="listitem">
                <p>SHA-256</p>
            </li></ul></div>
        <p>When you upload an object, you can specify the algorithm that you want to use: </p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>When you're using the AWS Management Console</b>, you select
                    the checksum algorithm that you want to use. When you do, you can optionally
                    specify the checksum value of the object. When Amazon S3 receives the object, it
                    calculates the checksum by using the algorithm that you specified. If the two
                    checksum values don't match, Amazon S3 generates an error.</p>
            </li><li class="listitem">
                <p><b>When you're using an SDK</b>, you can set the
                    value of the <code class="code">x-amz-sdk-checksum-algorithm</code> parameter to the
                    algorithm that you want Amazon S3 to use when calculating the checksum. Amazon S3
                    automatically calculates the checksum value. </p>
            </li><li class="listitem">
                <p><b>When you're using the REST API</b>, you don't use
                    the <code class="code">x-amz-sdk-checksum-algorithm</code> parameter. Instead, you use one of
                    the algorithm-specific headers (for example, <code class="code">x-amz-checksum-crc32</code>).</p>
            </li></ul></div>
        <p>For more information about uploading objects, see <a href="./upload-objects.html">Uploading objects</a>.</p>
        <p>To apply any of these checksum values to objects that are already uploaded to Amazon S3,
            you can copy the object. When you copy an object, you can specify whether you want to use
            the existing checksum algorithm or use a new one. You can specify a checksum algorithm when
            using any supported mechanism for copying objects, including S3 Batch Operations. For more
            information about S3 Batch Operations, see <a href="./batch-ops.html">Performing large-scale batch operations on Amazon S3 objects</a>.</p>
        
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>If you're using a multipart upload with additional checksums, the multipart part
                numbers must use consecutive part numbers. When using additional checksums, if you
                try to complete a multipart upload request with nonconsecutive part numbers, Amazon S3
                generates an HTTP <code class="code">500 Internal Server Error</code> error.</p></div></div>
        
        <p>After uploading objects, you can get the checksum value and compare it to a
            precalculated or previously stored checksum value calculated using the same algorithm.</p>
        
        <div class="collapsible" data-expand-section="_collapse_all_"><awsui-expandable-section variant="container" header="Using the S3 console" id="CheckObjectIntegrityConsole" expanded="false"><p>To learn more about using the console and specifying checksum algorithms to
                    use when uploading objects, see <a href="./upload-objects.html">Uploading objects</a> and <a href="http://aws.amazon.com/getting-started/hands-on/amazon-s3-with-additional-checksums/?ref=docs_gateway/amazons3/checking-object-integrity.html" rel="noopener noreferrer" target="_blank"><span>Tutorial: Checking the integrity of data in Amazon S3 with additional checksums</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.</p></awsui-expandable-section><awsui-expandable-section variant="container" header="Using the AWS SDKs" id="CheckObjectIntegritySDK" expanded="false"><p>The following example shows how you can use the AWS SDKs to upload a large file with multipart upload,
                    download a large file, and validate a multipart upload file, all with using SHA-256 for file validation.</p><awsdocs-tabs><dl style="display: none">
                    <dt>Java</dt><dd tab-id="java">
                            <div class="example"><h6>Example: Uploading, downloading, and verifying a large file with SHA-256</h6><div class="example-contents"><p>For instructions on creating and testing a working sample, see <a href="./UsingTheMPJavaAPI.html#TestingJavaSamples">Testing the Amazon S3 Java Code Examples</a>.
                                </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="java ">    import software.amazon.awssdk.auth.credentials.AwsCredentials;
    import software.amazon.awssdk.auth.credentials.AwsCredentialsProvider;
    import software.amazon.awssdk.core.ResponseInputStream;
    import software.amazon.awssdk.core.sync.RequestBody;
    import software.amazon.awssdk.regions.Region;
    import software.amazon.awssdk.services.s3.S3Client;
    import software.amazon.awssdk.services.s3.model.AbortMultipartUploadRequest;
    import software.amazon.awssdk.services.s3.model.ChecksumAlgorithm;
    import software.amazon.awssdk.services.s3.model.ChecksumMode;
    import software.amazon.awssdk.services.s3.model.CompleteMultipartUploadRequest;
    import software.amazon.awssdk.services.s3.model.CompleteMultipartUploadResponse;
    import software.amazon.awssdk.services.s3.model.CompletedMultipartUpload;
    import software.amazon.awssdk.services.s3.model.CompletedPart;
    import software.amazon.awssdk.services.s3.model.CreateMultipartUploadRequest;
    import software.amazon.awssdk.services.s3.model.CreateMultipartUploadResponse;
    import software.amazon.awssdk.services.s3.model.GetObjectAttributesRequest;
    import software.amazon.awssdk.services.s3.model.GetObjectAttributesResponse;
    import software.amazon.awssdk.services.s3.model.GetObjectRequest;
    import software.amazon.awssdk.services.s3.model.GetObjectResponse;
    import software.amazon.awssdk.services.s3.model.GetObjectTaggingRequest;
    import software.amazon.awssdk.services.s3.model.ObjectAttributes;
    import software.amazon.awssdk.services.s3.model.PutObjectTaggingRequest;
    import software.amazon.awssdk.services.s3.model.Tag;
    import software.amazon.awssdk.services.s3.model.Tagging;
    import software.amazon.awssdk.services.s3.model.UploadPartRequest;
    import software.amazon.awssdk.services.s3.model.UploadPartResponse;
     
    import java.io.File;
    import java.io.FileInputStream;
    import java.io.FileOutputStream;
    import java.io.IOException;
    import java.io.InputStream;
    import java.io.OutputStream;
    import java.nio.ByteBuffer;
    import java.security.MessageDigest;
    import java.security.NoSuchAlgorithmException;
    import java.util.ArrayList;
    import java.util.Base64;
    import java.util.List;
     
    public class LargeObjectValidation <span>{</span>
        private static String FILE_NAME = "sample.file";
        private static String BUCKET = "sample-bucket";
        //Optional, if you want a method of storing the full multipart object checksum in S3.
        private static String CHECKSUM_TAG_KEYNAME = "fullObjectChecksum";
        //If you have existing full-object checksums that you need to validate against, you can do the full object validation on a sequential upload.
        private static String SHA256_FILE_BYTES = "htCM5g7ZNdoSw8bN/mkgiAhXt5MFoVowVg+LE9aIQmI=";
        //Example Chunk Size - this must be greater than or equal to 5MB.
        private static int CHUNK_SIZE = 5 * 1024 * 1024;
     
        public static void main(String[] args) <span>{</span>
            S3Client s3Client = S3Client.builder()
                    .region(Region.US_EAST_1)
                    .credentialsProvider(new AwsCredentialsProvider() <span>{</span>
                        @Override
                        public AwsCredentials resolveCredentials() <span>{</span>
                            return new AwsCredentials() <span>{</span>
                                @Override
                                public String accessKeyId() <span>{</span>
                                    return Constants.ACCESS_KEY;
                                }
     
                                @Override
                                public String secretAccessKey() <span>{</span>
                                    return Constants.SECRET;
                                }
                            };
                        }
                    })
                    .build();
            uploadLargeFileBracketedByChecksum(s3Client);
            downloadLargeFileBracketedByChecksum(s3Client);
            validateExistingFileAgainstS3Checksum(s3Client);
        }
     
        public static void uploadLargeFileBracketedByChecksum(S3Client s3Client) <span>{</span>
            System.out.println("Starting uploading file validation");
            File file = new File(FILE_NAME);
            try (InputStream in = new FileInputStream(file)) <span>{</span>
                MessageDigest sha256 = MessageDigest.getInstance("SHA-256");
                CreateMultipartUploadRequest createMultipartUploadRequest = CreateMultipartUploadRequest.builder()
                        .bucket(BUCKET)
                        .key(FILE_NAME)
                        .checksumAlgorithm(ChecksumAlgorithm.SHA256)
                        .build();
                CreateMultipartUploadResponse createdUpload = s3Client.createMultipartUpload(createMultipartUploadRequest);
                List&lt;CompletedPart&gt; completedParts = new ArrayList&lt;CompletedPart&gt;();
                int partNumber = 1;
                byte[] buffer = new byte[CHUNK_SIZE];
                int read = in.read(buffer);
                while (read != -1) <span>{</span>
                    UploadPartRequest uploadPartRequest = UploadPartRequest.builder()
                            .partNumber(partNumber).uploadId(createdUpload.uploadId()).key(FILE_NAME).bucket(BUCKET).checksumAlgorithm(ChecksumAlgorithm.SHA256).build();
                    UploadPartResponse uploadedPart = s3Client.uploadPart(uploadPartRequest, RequestBody.fromByteBuffer(ByteBuffer.wrap(buffer, 0, read)));
                    CompletedPart part = CompletedPart.builder().partNumber(partNumber).checksumSHA256(uploadedPart.checksumSHA256()).eTag(uploadedPart.eTag()).build();
                    completedParts.add(part);
                    sha256.update(buffer, 0, read);
                    read = in.read(buffer);
                    partNumber++;
                }
                String fullObjectChecksum = Base64.getEncoder().encodeToString(sha256.digest());
                if (!fullObjectChecksum.equals(SHA256_FILE_BYTES)) <span>{</span>
                    //Because the SHA256 is uploaded after the part is uploaded; the upload is bracketed and the full object can be fully validated.
                    s3Client.abortMultipartUpload(AbortMultipartUploadRequest.builder().bucket(BUCKET).key(FILE_NAME).uploadId(createdUpload.uploadId()).build());
                    throw new IOException("Byte mismatch between stored checksum and upload, do not proceed with upload and cleanup");
                }
                CompletedMultipartUpload completedMultipartUpload = CompletedMultipartUpload.builder().parts(completedParts).build();
                CompleteMultipartUploadResponse completedUploadResponse = s3Client.completeMultipartUpload(
                        CompleteMultipartUploadRequest.builder().bucket(BUCKET).key(FILE_NAME).uploadId(createdUpload.uploadId()).multipartUpload(completedMultipartUpload).build());
                Tag checksumTag = Tag.builder().key(CHECKSUM_TAG_KEYNAME).value(fullObjectChecksum).build();
                //Optionally, if you need the full object checksum stored with the file; you could add it as a tag after completion.
                s3Client.putObjectTagging(PutObjectTaggingRequest.builder().bucket(BUCKET).key(FILE_NAME).tagging(Tagging.builder().tagSet(checksumTag).build()).build());
            } catch (IOException | NoSuchAlgorithmException e) <span>{</span>
                e.printStackTrace();
            }
            GetObjectAttributesResponse
                    objectAttributes = s3Client.getObjectAttributes(GetObjectAttributesRequest.builder().bucket(BUCKET).key(FILE_NAME)
                    .objectAttributes(ObjectAttributes.OBJECT_PARTS, ObjectAttributes.CHECKSUM).build());
            System.out.println(objectAttributes.objectParts().parts());
            System.out.println(objectAttributes.checksum().checksumSHA256());
        }
     
        public static void downloadLargeFileBracketedByChecksum(S3Client s3Client) <span>{</span>
            System.out.println("Starting downloading file validation");
            File file = new File("DOWNLOADED_" + FILE_NAME);
            try (OutputStream out = new FileOutputStream(file)) <span>{</span>
                GetObjectAttributesResponse
                        objectAttributes = s3Client.getObjectAttributes(GetObjectAttributesRequest.builder().bucket(BUCKET).key(FILE_NAME)
                        .objectAttributes(ObjectAttributes.OBJECT_PARTS, ObjectAttributes.CHECKSUM).build());
                //Optionally if you need the full object checksum, you can grab a tag you added on the upload
                List&lt;Tag&gt; objectTags = s3Client.getObjectTagging(GetObjectTaggingRequest.builder().bucket(BUCKET).key(FILE_NAME).build()).tagSet();
                String fullObjectChecksum = null;
                for (Tag objectTag : objectTags) <span>{</span>
                    if (objectTag.key().equals(CHECKSUM_TAG_KEYNAME)) <span>{</span>
                        fullObjectChecksum = objectTag.value();
                        break;
                    }
                }
                MessageDigest sha256FullObject = MessageDigest.getInstance("SHA-256");
                MessageDigest sha256ChecksumOfChecksums = MessageDigest.getInstance("SHA-256");
     
                //If you retrieve the object in parts, and set the ChecksumMode to enabled, the SDK will automatically validate the part checksum
                for (int partNumber = 1; partNumber &lt;= objectAttributes.objectParts().totalPartsCount(); partNumber++) <span>{</span>
                    MessageDigest sha256Part = MessageDigest.getInstance("SHA-256");
                    ResponseInputStream&lt;GetObjectResponse&gt; response = s3Client.getObject(GetObjectRequest.builder().bucket(BUCKET).key(FILE_NAME).partNumber(partNumber).checksumMode(ChecksumMode.ENABLED).build());
                    GetObjectResponse getObjectResponse = response.response();
                    byte[] buffer = new byte[CHUNK_SIZE];
                    int read = response.read(buffer);
                    while (read != -1) <span>{</span>
                        out.write(buffer, 0, read);
                        sha256FullObject.update(buffer, 0, read);
                        sha256Part.update(buffer, 0, read);
                        read = response.read(buffer);
                    }
                    byte[] sha256PartBytes = sha256Part.digest();
                    sha256ChecksumOfChecksums.update(sha256PartBytes);
                    //Optionally, you can do an additional manual validation again the part checksum if needed in addition to the SDK check
                    String base64PartChecksum = Base64.getEncoder().encodeToString(sha256PartBytes);
                    String base64PartChecksumFromObjectAttributes = objectAttributes.objectParts().parts().get(partNumber - 1).checksumSHA256();
                    if (!base64PartChecksum.equals(getObjectResponse.checksumSHA256()) || !base64PartChecksum.equals(base64PartChecksumFromObjectAttributes)) <span>{</span>
                        throw new IOException("Part checksum didn't match for the part");
                    }
                    System.out.println(partNumber + " " + base64PartChecksum);
                }
                //Before finalizing, do the final checksum validation.
                String base64FullObject = Base64.getEncoder().encodeToString(sha256FullObject.digest());
                String base64ChecksumOfChecksums = Base64.getEncoder().encodeToString(sha256ChecksumOfChecksums.digest());
                if (fullObjectChecksum != null &amp;&amp; !fullObjectChecksum.equals(base64FullObject)) <span>{</span>
                    throw new IOException("Failed checksum validation for full object");
                }
                System.out.println(fullObjectChecksum);
                String base64ChecksumOfChecksumFromAttributes = objectAttributes.checksum().checksumSHA256();
                if (base64ChecksumOfChecksumFromAttributes != null &amp;&amp; !base64ChecksumOfChecksums.equals(base64ChecksumOfChecksumFromAttributes)) <span>{</span>
                    throw new IOException("Failed checksum validation for full object checksum of checksums");
                }
                System.out.println(base64ChecksumOfChecksumFromAttributes);
                out.flush();
            } catch (IOException | NoSuchAlgorithmException e) <span>{</span>
                //Cleanup bad file
                file.delete();
                e.printStackTrace();
            }
        }
     
        public static void validateExistingFileAgainstS3Checksum(S3Client s3Client) <span>{</span>
            System.out.println("Starting existing file validation");
            File file = new File("DOWNLOADED_" + FILE_NAME);
            GetObjectAttributesResponse
                    objectAttributes = s3Client.getObjectAttributes(GetObjectAttributesRequest.builder().bucket(BUCKET).key(FILE_NAME)
                    .objectAttributes(ObjectAttributes.OBJECT_PARTS, ObjectAttributes.CHECKSUM).build());
            try (InputStream in = new FileInputStream(file)) <span>{</span>
                MessageDigest sha256ChecksumOfChecksums = MessageDigest.getInstance("SHA-256");
                MessageDigest sha256Part = MessageDigest.getInstance("SHA-256");
                byte[] buffer = new byte[CHUNK_SIZE];
                int currentPart = 0;
                int partBreak = objectAttributes.objectParts().parts().get(currentPart).size();
                int totalRead = 0;
                int read = in.read(buffer);
                while (read != -1) <span>{</span>
                    totalRead += read;
                    if (totalRead &gt;= partBreak) <span>{</span>
                        int difference = totalRead - partBreak;
                        byte[] partChecksum;
                        if (totalRead != partBreak) <span>{</span>
                            sha256Part.update(buffer, 0, read - difference);
                            partChecksum = sha256Part.digest();
                            sha256ChecksumOfChecksums.update(partChecksum);
                            sha256Part.reset();
                            sha256Part.update(buffer, read - difference, difference);
                        } else <span>{</span>
                            sha256Part.update(buffer, 0, read);
                            partChecksum = sha256Part.digest();
                            sha256ChecksumOfChecksums.update(partChecksum);
                            sha256Part.reset();
                        }
                        String base64PartChecksum = Base64.getEncoder().encodeToString(partChecksum);
                        if (!base64PartChecksum.equals(objectAttributes.objectParts().parts().get(currentPart).checksumSHA256())) <span>{</span>
                            throw new IOException("Part checksum didn't match S3");
                        }
                        currentPart++;
                        System.out.println(currentPart + " " + base64PartChecksum);
                        if (currentPart &lt; objectAttributes.objectParts().totalPartsCount()) <span>{</span>
                            partBreak += objectAttributes.objectParts().parts().get(currentPart - 1).size();
                        }
                    } else <span>{</span>
                        sha256Part.update(buffer, 0, read);
                    }
                    read = in.read(buffer);
                }
                if (currentPart != objectAttributes.objectParts().totalPartsCount()) <span>{</span>
                    currentPart++;
                    byte[] partChecksum = sha256Part.digest();
                    sha256ChecksumOfChecksums.update(partChecksum);
                    String base64PartChecksum = Base64.getEncoder().encodeToString(partChecksum);
                    System.out.println(currentPart + " " + base64PartChecksum);
                }
     
                String base64CalculatedChecksumOfChecksums = Base64.getEncoder().encodeToString(sha256ChecksumOfChecksums.digest());
                System.out.println(base64CalculatedChecksumOfChecksums);
                System.out.println(objectAttributes.checksum().checksumSHA256());
                if (!base64CalculatedChecksumOfChecksums.equals(objectAttributes.checksum().checksumSHA256())) <span>{</span>
                    throw new IOException("Full object checksum of checksums don't match S3");
                }
     
            } catch (IOException | NoSuchAlgorithmException e) <span>{</span>
                e.printStackTrace();
            }
        }
    }</code></pre></div></div>
                        </dd>
                </dl></awsdocs-tabs></awsui-expandable-section><awsui-expandable-section variant="container" header="Using the REST API" id="CheckObjectIntegrityREST" expanded="false"><p>You can send REST requests to upload an object with a checksum value to verify the integrity of the data with
                    <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html">PutObject</a>. You can also retrieve the checksum value for
                    objects using <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html">GetObject</a> or <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_HeadObject.html">HeadObject</a>.</p></awsui-expandable-section><awsui-expandable-section variant="container" header="Using the AWS CLI" id="CheckObjectIntegrityCLI" expanded="false"><p>You can send a <code class="code">PUT</code> request to upload an object of up to 5 GB in a single operation. For more information, see the <a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/put-object.html#examples"><code class="code">PutObject</code></a> in the <em>AWS CLI Command Reference</em>. You can also use <a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/get-object.html"><code class="code">get-object</code></a>
                    and <a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/get-object.html"><code class="code">head-object</code></a> to retrieve the checksum of
                    an already-uploaded object to verify the integrity of the data.</p></awsui-expandable-section></div>
     
        <h2 id="checking-object-integrity-md5">Using Content-MD5 when uploading objects</h2>
        <p>Another way to verify the integrity of your object after uploading is to provide an
            MD5 digest of the object when you upload it. If you calculate the MD5 digest for your
            object, you can provide the digest with the <code class="code">PUT</code> command by using the
                <code class="code">Content-MD5</code> header. </p>
        <p>After uploading the object, Amazon S3 calculates the MD5 digest of the object and compares
            it to the value that you provided. The request succeeds only if the two digests match. </p>
        <p>Supplying an MD5 digest isn't required, but you can use it to verify the integrity of
            the object as part of the upload process.</p>
     
        <h2 id="checking-object-integrity-etag-and-md5">Using Content-MD5 and the ETag
                to verify uploaded objects</h2>
        <p>The entity tag (ETag) for an object represents a specific version of that object. Keep
            in mind that the ETag reflects changes only to the content of an object, not to its
            metadata. If only the metadata of an object changes, the ETag remains the same. </p>
        <p>Depending on the object, the ETag of the object might be an MD5 digest of the object
            data:</p>
        <div class="itemizedlist">
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>If an object is created by the <code class="code">PUT Object</code>, <code class="code">POST
                        Object</code>, or <code class="code">Copy</code> operation, or through the AWS Management Console, and
                    that object is also plaintext or encrypted by server-side encryption with Amazon S3
                    managed keys (SSE-S3), that object has an ETag that is an MD5 digest of its
                    object data.</p>
            </li><li class="listitem">
                <p>If an object is created by the <code class="code">PUT Object</code>, <code class="code">POST
                        Object</code>, or <code class="code">Copy</code> operation, or through the AWS Management Console, and
                    that object is encrypted by server-side encryption with customer-provided keys
                    (SSE-C) or server-side encryption with AWS Key Management Service (AWS KMS) keys (SSE-KMS), that
                    object has an ETag that is not an MD5 digest of its object data.</p>
            </li><li class="listitem">
                <p>If an object is created by either the <code class="code">Multipart Upload</code> or
                        <code class="code">Part Copy</code> operation, the object's ETag is not an MD5 digest,
                    regardless of the method of encryption. If an object is larger than 16 MB, the
                    AWS Management Console uploads or copies that object as a multipart upload, and therefore the
                    ETag isn't an MD5 digest.</p>
            </li></ul></div>
        
        <p>For objects where the ETag is the <code class="code">Content-MD5</code> digest of the object, you
            can compare the ETag value of the object with a calculated or previously stored
                <code class="code">Content-MD5</code> digest.</p>
     
        <h2 id="trailing-checksums">Using trailing checksums</h2>
        <p>When uploading objects to Amazon S3, you can either provide a precalculated checksum for
            the object or use an AWS SDK to automatically create trailing checksums on your
            behalf. If you decide to use a trailing checksum, Amazon S3 automatically generates the
            checksum by using your specified algorithm and uses it to validate the integrity of the
            object during upload. </p>
        <p>To create a trailing checksum when using an AWS SDK, populate the
                <code class="code">ChecksumAlgorithm</code> parameter with your preferred algorithm. The SDK uses
            that algorithm to calculate the checksum for your object (or object parts) and
            automatically appends it to the end of your upload request. This behavior saves you time
            because Amazon S3 performs both the verification and upload of your data in a single pass.
        </p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>If you're using S3 Object Lambda, all requests to S3 Object Lambda are signed using
                <code class="code">s3-object-lambda</code> instead of <code class="code">s3</code>. This behavior affects
                the signature of trailing checksum values. For more information about S3 Object Lambda, see <a href="./transforming-objects.html">Transforming objects with S3 Object Lambda</a>.</p></div></div>
     
        <h2 id="large-object-checksums">Using part-level checksums for multipart uploads</h2>
        <p>When objects are uploaded to Amazon S3, they can either be uploaded as a single object or through the multipart
            upload process. Objects that are larger than 16 MB and uploaded through the console are automatically
            uploaded using multipart uploads. For more information about multipart uploads, see <a href="./mpuoverview.html">Uploading and copying objects using multipart upload</a>.</p>
        <p>When an object is uploaded as a multipart upload, the ETag for the object is not an
            MD5 digest of the entire object. Amazon S3 calculates the MD5 digest of each individual part
            as it is uploaded. The MD5 digests are used to determine the ETag for the final object.
            Amazon S3 concatenates the bytes for the MD5 digests together and then calculates the MD5
            digest of these concatenated values. The final step for creating the ETag is when Amazon S3
            adds a dash with the total number of parts to the end. </p>
        <p>For example, consider an object uploaded with a multipart upload that has an ETag of
                <code class="code">C9A5A6878D97B48CC965C1E41859F034-14</code>. In this case,
                <code class="code">C9A5A6878D97B48CC965C1E41859F034</code> is the MD5 digest of all the digests
            concatenated together. The <code class="code">-14</code> indicates that there are 14 parts associated
            with this object's multipart upload.</p>
        <p>If you've enabled additional checksum values for your multipart object, Amazon S3
            calculates the checksum for each individual part by using the specified checksum
            algorithm. The checksum for the completed object is calculated in the same way that Amazon S3
            calculates the MD5 digest for the multipart upload. You can use this checksum to verify
            the integrity of the object. </p>
        <p>To retrieve information about the object, including how many parts make up the entire
            object, you can use the <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObjectAttributes.html">GetObjectAttributes</a> operation. With additional checksums, you can also
            recover information for each individual part that includes each part's checksum value. </p>
        <p>Alternatively, you can get an individual part's checksum by using the <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html">GetObject</a> or <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_HeadObject.html">HeadObject</a> operation and specifying a
            part number or byte range that aligns to a single part. With this method, you can use
            that checksum to validate the individual part without needing to wait for all of the
            parts to finish uploading before verifying the data integrity. When you use this method,
            you can also request only the individual parts that failed the integrity test.</p>
        <p>Because of how Amazon S3 calculates the checksum for multipart objects, the checksum value
            for the object might change if you copy it. If you're using an SDK or the REST API and
            you call <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html">CopyObject</a>, Amazon S3 copies
            any object up to the size limitations of the <code class="code">CopyObject</code> API operation. Amazon S3
            does this copy as a single action, regardless of whether the object was uploaded in a
            single request or as part of a multipart upload. With a copy command, the checksum of
            the object is a direct checksum of the full object. If the object was originally
            uploaded using a multipart upload, then the checksum value changes even though the data
            has not.</p>


        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>Note</h6></div><div class="awsdocs-note-text"><p>Objects that are larger than the size limitations of the <code class="code">CopyObject</code>
                API operation must use multipart copy commands.</p></div></div>
        
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>Important</h6></div><div class="awsdocs-note-text"><p>When you perform some operations using the AWS Management Console, Amazon S3 uses a multipart upload if
                the object is greater than 16 MB in size. In this case, the checksum is not a direct
                checksum of the full object, but rather a calculation based on the checksum values of
                each individual part. </p><p>For example, consider an object 100 MB in size that you uploaded as a single-part
                direct upload using the REST API. The checksum in this case is a checksum of the
                entire object. If you later use the console to rename that object, copy it, change
                the storage class, or edit the metadata, Amazon S3 uses the multipart upload
                functionality to update the object. As a result, Amazon S3 creates a new checksum value
                for the object that is calculated based on the checksum values of the individual
                parts.</p><p><b>The preceding list of console operations is not a complete
                    list of all the possible actions that you can take in the AWS Management Console that result
                    in Amazon S3 updating the object using the multipart upload functionality.</b>
                Keep in mind that whenever you use the console to act on objects over 16 MB in size,
                the checksum value might not be the checksum of the entire object.</p></div></div>        
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p><p>To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./download-objects.html">Downloading an object</div><div id="next" class="next-link" accesskey="n" href="./DeletingObjects.html">Deleting objects</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">Did this page help you? - Yes</div><div class="content"><p>Thanks for letting us know we're doing a good job!</p><p>If you've got a moment, please tell us what we did right so we can do more of it.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=S3&amp;topic_url=https://docs.aws.amazon.com/en_us/AmazonS3/latest/userguide/checking-object-integrity.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">Did this page help you? - No</div><div class="content"><p>Thanks for letting us know this page needs work. We're sorry we let you down.</p><p>If you've got a moment, please tell us how we can make the documentation better.</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=S3&amp;topic_url=https://docs.aws.amazon.com/en_us/AmazonS3/latest/userguide/checking-object-integrity.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>