<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>亚马逊。 KendraSearchIntent - Amazon Lex</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="built-in-intent-kendra-search" /><meta name="default_state" content="built-in-intent-kendra-search" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="description" content="要搜索您使用亚马逊 Kendra 编制索引的文档，请使用 inten AMAZON.KendraSearchIntent t。当 Amazon Lex V2 无法确定与用户的对话中的下一步操作时，它会触发搜索意图。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="Amazon Lex" /><meta name="guide" content="V2 开发人员指南" /><meta name="abstract" content="提供Amazon Lex V2 的概念性概述。包括使用各种功能（例如流媒体对话）的详细说明，并提供了 V2 API 的完整参考。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/lexv2/latest/dg/built-in-intent-kendra-search.html" hreflang="x-default" /><meta name="feedback-item" content="Lex" /><meta name="this_doc_product" content="Amazon Lex" /><meta name="this_doc_guide" content="V2 开发人员指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'lex'}"></script><meta id="panorama-serviceSubSection" value="V2 开发人员指南" /><meta id="panorama-serviceConsolePage" value="亚马逊。 KendraSearchIntent" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>亚马逊。 KendraSearchIntent - Amazon Lex</title><meta name="pdf" content="lex2.0.pdf#built-in-intent-kendra-search" /><meta name="rss" content="amazon-lex-v2-document-history.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=251" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=http://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Lex",
        "item" : "https://docs.aws.amazon.com/lex/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "V2 开发人员指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "建造机器人",
        "item" : "https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/building-bots.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "内置意图和插槽类型",
        "item" : "https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "内置目的",
        "item" : "https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/howitworks-builtins-intents.html"
      },
      {
        "@type" : "ListItem",
        "position" : 7,
        "name" : "亚马逊。 KendraSearchIntent",
        "item" : "https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/howitworks-builtins-intents.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="lex2.0.pdf#built-in-intent-kendra-search" target="_blank" rel="noopener noreferrer" title="打开 PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/lex/index.html">Amazon Lex</a><a href="what-is.html">V2 开发人员指南</a></div><div id="page-toc-src"><a href="#kendra-search-iam">IAM 策略</a><a href="#kendra-search-filter">使用请求和会话属性作为筛选器</a><a href="#kendra-search-response">使用搜索响应</a><a href="#kendra-search-lambda">使用 Lambda 函数管理请求和响应</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><awsui-alert class="awsdocs-page-banner awsui-util-mb-l"><p>本文属于机器翻译版本。若本译文内容与英语原文存在差异，则一律以英文原文为准。</p></awsui-alert><h1 class="topictitle" id="built-in-intent-kendra-search">亚马逊。 KendraSearchIntent</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>要搜索您使用亚马逊 Kendra 编制索引的文档，请使用 inten<code class="code">AMAZON.KendraSearchIntent</code> t。当 Amazon Lex V2 无法确定与用户的对话中的下一步操作时，它会触发搜索意图。</p><p><code class="code">AMAZON.KendraSearchIntent</code>仅在英语（弗吉尼亚北部）、美国东部（弗吉尼亚北部）、美国西部（弗吉尼亚北部）、美国西部（弗吉尼亚北部）、美国西部（弗吉尼亚北部）、美国西部（弗吉尼亚北部）、美国西部（弗吉尼亚北部</p><p>Amazon Kendra 是一项 machine-learning-based 搜索服务，用于索引 PDF 文档或微软 Word 文件等自然语言文档。它可以搜索已编制索引的文档并为问题返回以下类型的响应：</p><div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>答案 </p>
                </li><li class="listitem">
                    <p>可能是问题答案的常见问题解答条目</p>
                </li><li class="listitem">
                    <p>与问题相关的文档</p>
                </li></ul></div><p>有关使用 <code class="code">AMAZON.KendraSearchIntent</code> 的示例，请参阅<a href="./faq-bot-kendra-search.html">示例：为Amazon Kendra 索引创建常见问题解答机器人</a>。</p><p>如果您为机器人配置<code class="code">AMAZON.KendraSearchIntent</code>意图，则 Amazon Lex V2 会在无法确定用户对意图的说法时调用意图。如果 Amazon Kendra 没有回应，对话将按照机器人中的配置继续进行。</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p> Amazon Lex V2 目前不支持在老虎机激励<code class="code">AMAZON.KendraSearchIntent</code>期间使用。如果 Amazon Lex V2 无法确定用户对某一插槽的话语，它会调用<code class="code">AMAZON.FallbackIntent</code>。</p></div></div><p>当您在同一个机器人<code class="code">AMAZON.FallbackIntent</code>中使用和时，Amazon Lex V2 使用的意图如下：<code class="code">AMAZON.KendraSearchIntent</code></p><div class="orderedlist">
                 
                 
                 
                 
            <ol><li>
                    <p>Amazon Lex V2 称为<code class="code">AMAZON.KendraSearchIntent</code>。意图称之为Amazon Kendra<code class="code">Query</code> 行动。</p>
                </li><li>
                    <p>如果Amazon Kendra 返回响应，Amazon Lex V2 会向用户显示结果。</p>
                </li><li>
                    <p>如果Amazon Kendra 没有回应，Amazon Lex V2 会重新提示用户。下一个操作取决于用户的响应。</p>
                    <div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p>如果用户的回复包含 Amazon Lex V2 能识别的话语，例如填充空位值或确认意图，则与用户的对话将按照为机器人配置的方式进行。</p>
                        </li><li class="listitem">
                            <p>如果用户的响应不包含 Amazon Lex V2 能识别的话语，则 Amazon Lex V2 会再次调用该<code class="code">Query</code>操作。</p>
                        </li></ul></div>
                </li><li>
                    <p>如果在配置的重试次数后没有响应，Amazon Lex V2 会调用<code class="code">AMAZON.FallbackIntent</code>并结束与用户的对话。</p>
                </li></ol></div><p>有三种方法可以使用<code class="code">AMAZON.KendraSearchIntent</code>向Amazon Kendra 发出请求：</p><div class="itemizedlist">
                 
                 
                 
            <ul class="itemizedlist"><li class="listitem">
                    <p>让搜索意图为您提出请求。Amazon Lex V2 使用用户的话语作为搜索字符串调用 Amazon Kendra。在创建 Intent 时，您可以定义一个查询筛选字符串来限制 Amazon Kendra 返回的响应数量。Amazon Lex V2 在查询请求中使用筛选条件。</p>
                </li><li class="listitem">
                    <p>使用您的 Lambda 函数向请求添加其他查询参数以缩小搜索结果范围。您将一个包含 Amazon Kendra 查询参数的<code class="code">kendraQueryFilterString</code>字段添加到<code class="code">delegate</code>对话框操作中。当您使用 Lambda 函数向请求添加查询参数时，它们的优先级高于您在创建 Intent 时定义的查询过滤器。</p>
                </li><li class="listitem">
                    <p>使用 Lambda 函数创建新建 Lambda 函数新建。您可以创建由Amazon Lex V2 发送的完整亚马逊 Kendra 查询请求。您可以在 <code class="code">delegate</code> 对话操作的 <code class="code">kendraQueryRequestPayload</code> 字段中指定查询。<code class="code">kendraQueryRequestPayload</code> 字段优先于 <code class="code">kendraQueryFilterString</code> 字段。</p>
                </li></ul></div><p>要在创建机器人时指定<code class="code">queryFilterString</code>参数，或者在对话框 Lambda 函数中调用<code class="code">delegate</code>操作时指定<code class="code">kendraQueryFilterString</code>字段，您需要指定一个用作 Amazon Kendra 查询的属性筛选器的字符串。如果字符串不是有效的属性筛选器，您将在运行时收到 <code class="code">InvalidBotConfigException</code> 异常。有关属性筛选器的更多信息，请参阅 <em>Amazon Kendra 开发者指南</em>中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">使用文档属性筛选查询</a>。</p><p>要控制 Amazon Lex V2 发送给Amazon Kendra 的查询，您可以在 Lambda 函数的<code class="code">kendraQueryRequestPayload</code>字段中指定查询。如果查询无效，Amazon Lex V2 会返回异<code class="code">InvalidLambdaResponseException</code>常。有关更多信息，请参阅 <em>Amazon Kendra 开发者指南</em>中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html">查询操作</a>。</p><p>有关如何使用 <code class="code">AMAZON.KendraSearchIntent</code> 的示例，请参阅<a href="./faq-bot-kendra-search.html">示例：为Amazon Kendra 索引创建常见问题解答机器人</a>。</p>
                <h2 id="kendra-search-iam">Amazon Kendra 搜索的 IAM 政策</h2>
                <p>要使用<code class="code">AMAZON.KendraSearchIntent</code> Intent，您必须使用提供AWS Identity and Access Management (IAM) 策略的角色，使 Amazon Lex V2 能够代入有权调用 Amazon Kendra inten<code class="code">Query</code> t 的运行时角色。您使用的 IAM 设置取决于您是使用 Amazon Lex V2 控制台创建，还是使用 AWS 开发工具包或AWS Command Line Interface (AWS CLI) 创建。<code class="code">AMAZON.KendraSearchIntent</code>使用控制台时，您可以选择向 Amazon Lex V2 服务关联角色添加调用 Amazon Kendra 的权限，也可以选择使用专门用于调用 Amazon Kendra<code class="code">Query</code> 操作的角色。使用 AWS CLI 或软件开发工具包创建目的时，必须使用专门用于调用 <code class="code">Query</code> 操作的角色。</p>
                 
                    <h3 id="kendra-iam-attach">附加权限 </h3>
                    <p>您可以使用控制台将访问 Amazon Kendra<code class="code">Query</code> 操作的权限附加到默认 Amazon Lex V2 服务关联角色。当您为服务相关角色附加权限时，您不必专门创建和管理连接到 Amazon Kendra 索引的运行时角色。</p>
                    <p>您用于访问 Amazon Lex V2 控制台的用户、角色或群组必须具有管理角色策略的权限。将以下 IAM 策略附加到控制台访问角色。当您授予这些权限时，角色将有权更改现有服务相关角色策略。</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "iam:AttachRolePolicy",
                "iam:PutRolePolicy",
                "iam:GetRolePolicy"
            ],
            "Resource": "arn:aws:iam::*:role/aws-service-role/lexv2.amazonaws.com/AWSServiceRoleForLexBots*"
        },
        <span>{</span>
            "Effect": "Allow",
            "Action": "iam:ListRoles",
            "Resource": "*"
        }
    ]
}</code></pre>
                 
                 
                    <h3 id="kendra-iam-role">指定角色 </h3>
                    <p>您可以使用控制台AWS CLI、或 API 来指定在调用 Amazon Kendra<code class="code">Query</code> 操作时使用的运行时角色。</p>
                    <p>用于指定运行时角色的用户、角色或组必须具有<code class="code">iam:PassRole</code>权限。以下策略定义权限。您可以使用 <code class="code">iam:AssociatedResourceArn</code> 和 <code class="code">iam:PassedToService</code> 条件上下文键进一步限制权限的范围。有关更多信息，请参阅<em>AWS Identity and Access Management用户指南</em><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_iam-condition-keys.html">中的 IAM 和AWS STS条件上下文密钥</a>。</p>
                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": "iam:PassRole",
            "Resource": "arn:aws:iam::<code class="replaceable">account</code>:role/<code class="replaceable">role</code>"
        }
    ]
}</code></pre>
                    <p>Amazon Lex V2 调用 Amazon Kendra 所需的运行时角色必须具有<code class="code">kendra:Query</code>权限。当您使用现有 IAM 角色获得调用 Amazon Kendra<code class="code">Query</code> 操作的权限时，该角色必须附加以下策略。</p>
                    <p>您可以使用 IAM 控制台、IAM API 创建策略并将其附加到角色。AWS CLI这些说明使用 AWS CLI 创建角色和策略。</p>
                    <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>以下代码针对 Linux 和 macOS 编排了格式。对于 Windows，将 Linux 行继续符 (\) 替换为脱字号 (^)。</p></div></div>
                    <div class="procedure"><h6>向角色添加 Query 操作权限</h6><ol><li>
                            <p>在当前目录中创建一个名为 <code class="userinput">KendraQueryPolicy.json</code> 的文档，向其中添加以下代码并保存</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Allow",
            "Action": [
                "kendra:Query"
            ],
            "Resource": [
                "arn:aws:kendra:<code class="replaceable">region</code>:<code class="replaceable">account</code>:index/<code class="replaceable">index ID</code>"
            ]
        }
    ]
}</code></pre>
                        </li><li>
                            <p>在中AWS CLI，运行以下命令创建用于运行 Amazon Kendra<code class="code">Query</code> 操作的 IAM 策略。</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iam create-policy \
    --policy-name <code class="replaceable">query-policy-name</code> \
    --policy-document file://KendraQueryPolicy.json</code></pre>
                        </li><li>
                            <p>将策略附加到您用于调用<code class="code">Query</code>操作的 IAM 角色。</p>
                            <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">aws iam attach-role-policy \
    --policy-arn arn:aws:iam::<code class="replaceable">account-id</code>:policy/<code class="replaceable">query-policy-name</code>
    --role-name <code class="replaceable">role-name</code></code></pre>
                        </li></ol></div>
                    <p>您可以选择更新 Amazon Lex V2 服务相关角色，也可以选择使用您在<code class="code">AMAZON.KendraSearchIntent</code>为机器人创建时创建的角色。以下过程展示如何选择要使用的 IAM 角色。</p>
                    <div class="procedure"><h6>为亚马逊指定运行时角色。 KendraSearchIntent</h6><ol><li>
                            <p>登录到，AWS Management Console然后通过以下网址打开 Amazon Lex 控制台<a href="https://console.aws.amazon.com/lex/" rel="noopener noreferrer" target="_blank"><span>：https://console.aws.amazon.com/lex/</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>。</p>
                        </li><li>
                            <p>选择要向其添加 <code class="code">AMAZON.KendraSearchIntent</code> 的自动程序。</p>
                        </li><li>
                            <p>选择<b>目的</b>旁边的加号 (+)。</p>
                        </li><li>
                            <p>在<b>添加目的</b>中，选择<b>搜索现有目的</b>。</p>
                        </li><li>
                            <p>在<b>搜索目的</b>中，输入 <code class="userinput">AMAZON.KendraSearchIntent</code>，然后选择<b>添加</b>。</p>
                        </li><li>
                            <p>在<b>复制内置目的</b>中，输入目的的名称，如 <code class="userinput">KendraSearchIntent</code>，然后选择<b>添加</b>。</p>
                        </li><li>
                            <p>打开 <b>Amazon Kendra 查询</b>部分。</p>
                        </li><li>
                            <p>对于 <b>IAM 角色</b>，选择下列选项之一：</p>
                            <div class="itemizedlist">
                                 
                                 
                            <ul class="itemizedlist"><li class="listitem">
                                    <p>要更新 Amazon Lex V2 服务关联角色以使您的机器人能够查询Amazon Kendra 索引，请选择<b>添加Amazon Kendra 权限</b>。</p>
                                </li><li class="listitem">
                                    <p>要使用有权调用 Amazon Kendra<code class="code">Query</code> 操作的角色，请选择<b>使用现有角色</b>。</p>
                                </li></ul></div>
                        </li></ol></div>
                 
             
                <h2 id="kendra-search-filter">使用请求和会话属性作为筛选器</h2>
                <p>要筛选 Amazon Kendra 对与当前对话相关的项目的回应，请在创建机器人时添加<code class="code">queryFilterString</code>参数，使用会话和请求属性作为筛选条件。您在创建意图时为属性指定占位符，然后 Amazon Lex V2 在调用 Amazon Kendra 之前替换一个值。有关请求属性的更多信息，请参阅<a href="./context-mgmt-request-attribs.html">设置请求属性</a>。有关会话属性的更多信息，请参阅 <a href="./context-mgmt-session-attribs.html">设置会话属性</a>。</p>
                <p>以下是使用字符串筛选 Amazon Kendra 查询的<code class="code">queryFilterString</code>参数示例。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "City", "value": <span>{</span>"stringValue": "Seattle"}}}"</code></pre>
                <p>以下是使用名<code class="code">"SourceURI"</code>为的会话属性筛选 Amazon Kendra 查询的<code class="code">queryFilterString</code>参数示例。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "SourceURI","value": <span>{</span>"stringValue": "[FileURL]"}}}"</code></pre>
                <p>以下是使用名<code class="code">"DepartmentName"</code>为的请求属性筛选 Amazon Kendra 查询的<code class="code">queryFilterString</code>参数示例。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"<span>{</span>"equalsTo": <span>{</span>"key": "Department","value": <span>{</span>"stringValue": "((DepartmentName))"}}}"</code></pre>
                <p><code class="code">AMAZON.KendraSearchInteng</code>过滤器使用与Amazon Kendra 搜索筛选器相同的格式。有关更多信息，请参阅 <em>Amazon Kendra 开发者指南</em>中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">使用文档属性筛选搜索结果</a>。</p>
                <p>与一起使用的查询筛选器字符串<code class="code">AMAZON.KendraSearchIntent</code>必须使用小写字母作为每个过滤器的首字母。例如，以下是一个有效的查询过滤器<code class="code">AMAZON.KendraSearchIntent</code>。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "andAllFilters": [
        <span>{</span>
            "equalsTo": <span>{</span>
                "key": "City",
                "value": <span>{</span>
                    "stringValue": "Seattle"
                }
            }
        },
        <span>{</span>
            "equalsTo": <span>{</span>
                "key": "State",
                "value": <span>{</span>
                    "stringValue": "Washington"
                }
            }
        }
    ]
}</code></pre>
             
                <h2 id="kendra-search-response">使用搜索响应</h2>
                <p>Amazon Kendra 将对搜索的回复作为意图<code class="code">IntentClosingSetting</code>声明的回复返回。除非 Lambda 函数生成结束响应消息，否则 Intent 必须有<code class="code">closingResponse</code>语句。</p>
                <p>Amazon Kendra 有五种回复类型。</p>
                <div class="itemizedlist">
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>以下两个回复需要为您的Amazon Kendra 索引设置常见问题解答。有关更多详细信息，请参阅<a href="https://docs.aws.amazon.com/kendra/latest/dg/in-creating-faq.html">将问题和答案直接添加到索引</a>。</p>
                        <div class="itemizedlist">
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p> <code class="code">x-amz-lex:kendra-search-response-question_answer-question-&lt;N&gt;</code>— 常见问题解答中与搜索相匹配的问题。</p>
                            </li><li class="listitem">
                                <p> <code class="code">x-amz-lex:kendra-search-response-question_answer-answer-&lt;N&gt;</code>— 来自与搜索相匹配的常见问题解答的答案。</p>
                            </li></ul></div>                        
                    </li><li class="listitem">
                        <p>以下三个回复需要为您的Amazon Kendra 索引设置数据源。有关更多信息，请参阅<a href="https://docs.aws.amazon.com/kendra/latest/dg/data-source.html">创建数据源</a>。</p>
                        <div class="itemizedlist">
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">x-amz-lex:kendra-search-response-document-&lt;N&gt;</code>— 索引中与话语文本相关的文档摘录。</p>
                            </li><li class="listitem">
                                <p><code class="code">x-amz-lex:kendra-search-response-document-link-&lt;N&gt;</code>— 索引中与话语文本相关的文档的 URL。</p>
                            </li><li class="listitem">
                                <p><code class="code">x-amz-lex:kendra-search-response-answer-&lt;N&gt;</code>— 索引中回答问题的文档的摘录。</p>
                            </li></ul></div>
                    </li></ul></div>
                <p>在 <code class="code">request</code> 属性中返回响应。每个属性最多可以具有五个响应，编号为 1 到 5。有关回复的更多信息，请参阅 <em>Amazon Kendra 开发者指南</em>中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/response-types.html">回复类型</a>。</p>
                <p><code class="code">closingResponse</code> 语句必须具有一个或多个消息组。每个消息组都包含一条或多条消息。每条消息可以包含一个或多个占位符变量，这些变量在来自 Amazon Kendra 的响应中被请求属性替换。消息组中必须至少有一条消息的所有变量都由运行时响应中的请求属性值替换，或者组中必须有一条没有占位符变量的消息。请求属性使用双括号（“((”“))”）进行设置。以下消息组消息与Amazon Kendra 的任何回复相匹配：</p>
                <div class="itemizedlist">
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>“我为你找到了一个常见问题解kendra-search-response-question答问题：((x-amz-lex: _answer-question-1))，答案是 ((x-amz-lex:kendra-search-response-question _answer-answer-1))”</p>
                    </li><li class="listitem">
                        <p>“我找到了一份有用文档的摘录：((x-amz-lex:kendra-search-response-document -1))”</p>
                    </li><li class="listitem">
                        <p>“我认为你的问题的答案是 ((x-amz-lex:kendra-search-response-answer -1))”</p>
                    </li></ul></div>
             
                <h2 id="kendra-search-lambda">使用 Lambda 函数管理请求和响应</h2>
                <p><code class="code">AMAZON.KendraSearchIntent</code>Intent 可以使用您的对话框代码挂钩和配送代码挂钩来管理发给 Amazon Kendra 的请求和响应。当您想要修改发送给 Amazon Kendra 的查询时，请使用对话框代码挂钩 Lambda 函数；当您想要修改响应时，使用配送代码挂接 Lambda 函数。</p>
                 
                    <h3 id="kendra-search-lambda-dialog">使用对话代码挂钩创建查询</h3>
                    <p>您可以使用对话框代码挂钩创建要发送给Amazon Kendra 的查询。使用对话代码挂钩是可选的。如果您未指定对话框代码挂钩，Amazon Lex V2 会根据用户话语构造查询<code class="code">queryFilterString</code>，并使用您在配置意图时提供的查询（如果您提供了 Intent）。</p>
                    <p>您可以使用对话框代码挂接响应中的两个字段来修改对 Amazon Kendra 的请求：</p>
                    <div class="itemizedlist">
                         
                         
                    <ul class="itemizedlist"><li class="listitem">
                            <p><code class="code">kendraQueryFilterString</code>— 使用此字符串为Amazon Kendra 请求指定属性筛选条件。您可以使用索引中定义的任何索引字段筛选查询。有关筛选字符串的结构，请参阅 <em>Amazon Kendra 开发者指南</em>中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/filtering.html#search-filtering">使用文档属性筛选查询</a>。如果指定的筛选器字符串无效，则会出现 <code class="code">InvalidLambdaResponseException</code> 异常。<code class="code">kendraQueryFilterString</code> 字符串将覆盖为目的配置的 <code class="code">queryFilterString</code> 中指定的任何查询字符串。</p>
                        </li><li class="listitem">
                            <p><code class="code">kendraQueryRequestPayload</code>— 使用此字符串指定Amazon Kendra 查询。您的查询可以使用Amazon Kendra 的任何功能。如果您没有指定有效的查询，则会出现 <code class="code">InvalidLambdaResponseException</code> 异常。有关更多信息，请参阅 <em>Amazon Kendra 开发者指南</em>中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html">查询</a>。</p>
                        </li></ul></div>
                    <p>创建筛选器或查询字符串后，将响应发送到 Amazon Lex V2，并将响应<code class="code">dialogAction</code>字段设置为<code class="code">delegate</code>。Amazon Lex V2 将查询发送到Amazon Kendra，然后将查询响应返回到配送代码挂钩。</p>
                 
                 
                    <h3 id="kendra-search-lambda-fulfillment">对响应使用实现代码挂钩</h3>
                    <p>Amazon Lex V2 向Amazon Kendra a 发送查询后，查询响应将返回到<code class="code">AMAZON.KendraSearchIntent</code>配送 Lambda 函数。代码挂钩的输入事件包含来自Amazon Kendra 的完整响应。查询数据的结构与 Amazon Kendra<code class="code">Query</code> 操作返回的数据结构相同。有关更多信息，请参阅《<em>Amazon Kendra 开发者指南</em>》中的<a href="https://docs.aws.amazon.com/kendra/latest/dg/API_Query.html#API_Query_ResponseSyntax">查询响应语法</a>。</p>
                    <p>实现代码挂钩是可选的。如果一个语句不存在，或者如果代码挂钩没有在响应中返回消息，Amazon Lex V2 会使用该<code class="code">closingResponse</code>语句进行响应。</p>
                 
            <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./built-in-intent-help.html">亚马逊。 HelpIntent</div><div id="next" class="next-link" accesskey="n" href="./faq-bot-kendra-search.html">示例：为Amazon Kendra 索引创建常见问题解答机器人</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lex&amp;topic_url=https://docs.aws.amazon.com/zh_cn/lexv2/latest/dg/built-in-intent-kendra-search.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>