<!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>AWS 全局条件上下文密钥 - AWS Identity and Access Management</title><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="assets_root" content="/assets" /><meta name="target_state" content="reference_policies_condition-keys" /><meta name="default_state" content="reference_policies_condition-keys" /><link rel="icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="shortcut icon" type="image/ico" href="/assets/images/favicon.ico" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="description" content="描述可在 IAM policy 中使用的每个 AWS 全局条件键。" /><meta name="deployment_region" content="IAD" /><meta name="product" content="AWS Identity and Access Management" /><meta name="guide" content="用户指南" /><meta name="abstract" content="通过用户身份（身份验证）定义特定权限的策略（授权）控制对您的 AWS 资源的访问。" /><meta name="guide-locale" content="zh_cn" /><meta name="tocs" content="toc-contents.json" /><link rel="canonical" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="id-id" /><link rel="alternative" href="https://docs.aws.amazon.com/id_id/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="id" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="de-de" /><link rel="alternative" href="https://docs.aws.amazon.com/de_de/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="de" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="en-us" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="en" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="es-es" /><link rel="alternative" href="https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="es" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="fr-fr" /><link rel="alternative" href="https://docs.aws.amazon.com/fr_fr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="fr" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="it-it" /><link rel="alternative" href="https://docs.aws.amazon.com/it_it/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="it" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ja-jp" /><link rel="alternative" href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ja" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ko-kr" /><link rel="alternative" href="https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="ko" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="pt-br" /><link rel="alternative" href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="pt" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="zh-cn" /><link rel="alternative" href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="zh-tw" /><link rel="alternative" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" hreflang="x-default" /><meta name="feedback-item" content="IAM" /><meta name="this_doc_product" content="AWS Identity and Access Management" /><meta name="this_doc_guide" content="用户指南" /><script defer="" src="/assets/r/vendor4.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor3.js?version=2021.12.02"></script><script defer="" src="/assets/r/vendor1.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02"></script><script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02"></script><link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet" /><link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet" /><script async="" id="awsc-panorama-bundle" type="text/javascript" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'iam'}"></script><meta id="panorama-serviceSubSection" value="用户指南" /><meta id="panorama-serviceConsolePage" value="AWS 全局条件上下文密钥" /></head><body class="awsdocs awsui"><div class="awsdocs-container"><awsdocs-header></awsdocs-header><awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)"><div id="guide-toc" dom-region="navigation"><awsdocs-toc></awsdocs-toc></div><div id="main-column" dom-region="content" tabindex="-1"><awsdocs-view class="awsdocs-view"><div id="awsdocs-content"><head><title>AWS 全局条件上下文密钥 - AWS Identity and Access Management</title><meta name="pdf" content="iam-ug.pdf#reference_policies_condition-keys" /><meta name="rss" content="aws-iam-release-notes.rss" /><meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=76" /><meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=http://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html" /><meta name="keywords" content="IAM,AWS Identity and Access Management,IAM 用户,user,IAM 组,group,IAM 角色,role,权限策略,信任策略,策略,访问密钥,password,资源 OU ID" /><script type="application/ld+json">
{
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "AWS Identity and Access Management",
        "item" : "https://docs.aws.amazon.com/iam/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "用户指南",
        "item" : "https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "AWS Identity and Access Management 的参考信息",
        "item" : "https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "IAM JSON 策略参考",
        "item" : "https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "AWS 全局条件上下文密钥",
        "item" : "https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies.html"
      }
    ]
}
</script></head><body><div id="main"><div style="display: none"><a href="iam-ug.pdf#reference_policies_condition-keys" target="_blank" rel="noopener noreferrer" title="打开 PDF"></a></div><div id="breadcrumbs" class="breadcrumb"><a href="https://aws.amazon.com">AWS</a><a href="/index.html">文档</a><a href="/iam/index.html">AWS Identity and Access Management</a><a href="introduction.html">用户指南</a></div><div id="page-toc-src"><a href="#condition-keys-calledvia">CalledVia</a><a href="#condition-keys-calledviafirst">CalledViaFirst</a><a href="#condition-keys-calledvialast">CalledViaLast</a><a href="#condition-keys-currenttime">CurrentTime</a><a href="#condition-keys-ec2instancesourcevpc">Ec2InstanceSourceVpc</a><a href="#condition-keys-ec2instancesourceprivateip4">Ec2InstanceSourcePrivateIPv4</a><a href="#condition-keys-epochtime">EpochTime</a><a href="#condition-keys-federatedprovider">FederatedProvider</a><a href="#condition-keys-multifactorauthage">MultiFactorAuthAge</a><a href="#condition-keys-multifactorauthpresent">MultiFactorAuthPresent</a><a href="#condition-keys-principalaccount">PrincipalAccount</a><a href="#condition-keys-principalarn">PrincipalArn</a><a href="#condition-keys-principalisawsservice">PrincipalIsAWSService</a><a href="#condition-keys-principalorgid">PrincipalOrgID</a><a href="#condition-keys-principalorgpaths">PrincipalOrgPaths</a><a href="#condition-keys-principalservicename">PrincipalServiceName</a><a href="#condition-keys-principalservicenameslist">PrincipalServiceNamesList</a><a href="#condition-keys-principaltag">PrincipalTag</a><a href="#condition-keys-principaltype">PrincipalType</a><a href="#condition-keys-referer">Referer</a><a href="#condition-keys-requestedregion">RequestedRegion</a><a href="#condition-keys-requesttag">RequestTag</a><a href="#condition-keys-resourceaccount">ResourceAccount</a><a href="#condition-keys-resourceorgid">ResourceOrgID</a><a href="#condition-keys-resourceorgpaths">ResourceOrgPaths</a><a href="#condition-keys-resourcetag">ResourceTag</a><a href="#condition-keys-securetransport">SecureTransport</a><a href="#condition-keys-sourceaccount">SourceAccount</a><a href="#condition-keys-sourcearn">SourceArn</a><a href="#condition-keys-sourceidentity">SourceIdentity</a><a href="#condition-keys-sourceip">SourceIp</a><a href="#condition-keys-sourcevpc">SourceVpc</a><a href="#condition-keys-sourcevpce">SourceVpce</a><a href="#condition-keys-tagkeys">TagKeys</a><a href="#condition-keys-tokenissuetime">TokenIssueTime</a><a href="#condition-keys-useragent">UserAgent</a><a href="#condition-keys-userid">Userid</a><a href="#condition-keys-username">Username</a><a href="#condition-keys-viaawsservice">ViaAWSService</a><a href="#condition-keys-vpcsourceip">VpcSourceIp</a><a href="#condition-keys-other">其他跨服务键</a></div><div id="main-content" class="awsui-util-container"><div id="main-col-body"><awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner><h1 class="topictitle" id="reference_policies_condition-keys">AWS 全局条件上下文密钥</h1><div class="awsdocs-page-header-container"><awsdocs-page-header></awsdocs-page-header><awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector></div><p>当<a href="./intro-structure.html#intro-structure-principal">主体</a>向 AWS 发出<a href="./intro-structure.html#intro-structure-request">请求</a>时，AWS 会将请求信息收集到<a href="./intro-structure.html#intro-structure-request">请求上下文</a>中。您可以使用 JSON 策略的 <code class="code">Condition</code> 元素将请求上下文中的键与您在策略中指定的键值进行比较。要了解有关在请求上下文中包含全局键的情况的更多信息，请参阅每个全局条件键的<b>可用性</b>信息。有关如何在 JSON 策略中使用 <code class="code">Condition</code> 元素的信息，请参阅<a href="./reference_policies_elements_condition.html">IAM JSON 策略元素：Condition</a>。</p><div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>如果您使用只在某些情况下可用的条件键，则可使用 <a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">IfExists</a> 版本的条件运算符。如果请求上下文中缺少条件键，则策略将无法通过评估。例如，将以下条件块与 <code class="code">...IfExists</code> 运算符结合使用以在请求来自特定 IP 范围或特定 VPC 时进行匹配。如果请求上下文中未包含这两个键或其中之一，则条件仍将返回 <code class="code">true</code>。仅当请求上下文中包含指定的键时，才检查值。</p><pre class="programlisting"><div class="code-btn-container"></div><code class="json ">"Condition": <span>{</span>
    "IpAddressIfExists": <span>{</span>"aws:SourceIp" : ["xxx"] },
    "StringEqualsIfExists" : <span>{</span>"aws:SourceVpc" : ["yyy"]} 
}</code></pre></div></div><p>全局条件键是带有 <code class="code">aws:</code> 前缀的条件键。AWS 服务既可支持全局条件键，也可提供包含服务前缀的服务特定键。例如，IAM 条件键包含 <code class="code">iam:</code> 前缀。有关更多信息，请参阅 <a href="reference_policies_actions-resources-contextkeys.html" rel="noopener noreferrer" target="_blank">AWS 服务的操作、资源和条件键</a>，然后选择要查看其键的服务。</p><div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>要将条件与具有多个键值的请求上下文进行比较，必须使用 <code class="code">ForAllValues</code> 或者 <code class="code">ForAnyValue</code> 集合运算符。仅将集合运算符用于多值条件键。不要将集合运算符用于单值条件键。有关更多信息，请参阅<a href="./reference_policies_multi-value-conditions.html">创建具有多个键或值的条件</a>。</p></div></div>
        <h2 id="condition-keys-calledvia">aws:CalledVia</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可以将策略中的服务与代表 IAM 主体（用户或角色）发出请求的服务进行比较。当主体向 AWS 服务发出请求时，该服务可能会使用主体的凭证向其他服务发出后续请求。<code class="code">aws:CalledVia</code> 键包含链中代表主体发出请求的每个服务的有序列表。</p>
        <p>例如，您可以使用 AWS CloudFormation 从 Amazon DynamoDB 表中读取和写入。然后，DynamoDB 使用 AWS Key Management Service (AWS KMS) 提供的加密操作。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> - 当支持 <code class="code">aws:CalledVia</code> 的服务使用 IAM 主体的凭证向其他服务发出请求时，此键会出现在请求中。如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用，则此键不存在。当主体直接进行调用时，此键也不存在。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 多值</p>
            </li></ul></div>
        <a id="calledvia-services"></a>
        <p>要在策略中使用 <code class="code">aws:CalledVia</code> 条件键，您必须提供服务主体以允许或拒绝 AWS 服务请求。AWS 支持将以下服务主体用于 <code class="code">aws:CalledVia</code>。</p>
        <div class="table-container"><div class="table-contents"><table id="w339aac25c19c19c13c15"><thead>
                    <tr>
                        <th>服务主体</th>
                    </tr>
                </thead>
                    <tr>
                        <td>athena.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>cloud9.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>cloudformation.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>databrew.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>dataexchange.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>dynamodb.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>kms.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>servicecatalog-appregistry.amazonaws.com</td>
                    </tr>
                    <tr>
                        <td>sqlworkbench.amazonaws.com</td>
                    </tr>
                </table></div></div>
        <p>要在<em>任何</em> 服务使用主体的凭证发出请求时允许或拒绝访问，请使用 <code class="code"><a href="#condition-keys-viaawsservice">aws:ViaAWSService</a></code> 条件键。该条件键支持 AWS 服务。</p>
        <p><code class="code">aws:CalledVia</code> 键是<a href="./reference_policies_multi-value-conditions.html">多值键</a>。但是，您不能在条件下强制使用此键进行排序。使用上面的示例，<b>User 1</b>（用户 1）向 AWS CloudFormation 发出请求，然后依次调用 DynamoDB 和调用 AWS KMS。这是三个单独的请求。对 AWS KMS 的最终调用是由用户 1 <em>通过</em> AWS CloudFormation，然后通过 DynamoDB 进行的。</p>
        <div class="mediaobject">
             
                <img src="images/condition-key-calledvia-example-diagram.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                使用 aws:CalledVia 的示例&#xA;            " style="max-width:100%" />
             
             
        </div>
        <p>在这种情况下，请求上下文中的 <code class="code">aws:CalledVia</code> 键包括 <code class="code">cloudformation.amazonaws.com</code> 和 <code class="code">dynamodb.amazonaws.com</code>（按照该顺序）。如果您只关心调用是在请求链中的某个地方通过 DynamoDB 进行的，则可以在策略中使用此条件键。</p>
        <p>例如，以下策略允许管理名为 <code class="code">my-example-key</code> 的 AWS KMS 键，但前提为 DynamoDB 是发出请求的服务之一。<code class="code"><a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">ForAnyValue:StringEquals</a></code> 条件运算符确保 DynamoDB 是发出调用的服务之一。如果主体直接调用 AWS KMS，则条件将返回 <code class="code">false</code>，且此策略不允许请求。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "KmsActionsIfCalledViaDynamodb",
            "Effect": "Allow",
            "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey",
                "kms:DescribeKey"
            ],
            "Resource": "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">111122223333</code>:key/<code class="replaceable">my-example-key</code>",
            "Condition": <span>{</span>
                "ForAnyValue:StringEquals": <span>{</span>
                    "aws:CalledVia": ["dynamodb.amazonaws.com"]
                }
            }
        }
    ]
}</code></pre>
        <p>如果要强制由哪个服务在链中进行第一个或最后一个调用，可以使用 <code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaFirst</a></code> 和 <code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaLast</a></code> 键。例如，以下策略允许管理 AWS KMS 中名为 <code class="code">my-example-key</code> 的键。仅当链中包含多个请求时，才允许执行这些 AWS KMS 操作。第一个请求必须通过 AWS CloudFormation 发出，而最后一个请求必须通过 DynamoDB 发出。如果其他服务在链的中间发出请求，则仍然允许该操作。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "KmsActionsIfCalledViaChain",
            "Effect": "Allow",
            "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey",
                "kms:DescribeKey"
            ],
            "Resource": "arn:aws:kms:<code class="replaceable">region</code>:<code class="replaceable">111122223333</code>:key/<code class="replaceable">my-example-key</code>",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:CalledViaFirst": "cloudformation.amazonaws.com",
                    "aws:CalledViaLast": "dynamodb.amazonaws.com"
                }
            }
        }
    ]
}</code></pre>
        <p>当服务使用 IAM 主体的凭证调用另一个服务时，请求中会存在 <code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaFirst</a></code> 和 <code class="code"><a href="#condition-keys-calledviafirst">aws:CalledViaLast</a></code> 键。它们表示在请求链中进行调用的第一个和最后一个服务。例如，假定 AWS CloudFormation 调用另一个名为 <code class="code">X
                Service</code> 的服务，然后依次调用 DynamoDB，然后调用 AWS KMS。对 AWS KMS 的最终调用是由 <code class="code">User 1</code> 依次<em>通过</em> AWS CloudFormation、<code class="code">X Service</code> 和 DynamoDB 进行的。首先通过 DynamoDB 进行调用，最后通过 AWS CloudFormation 进行调用。</p>
        <div class="mediaobject">
             
                <img src="images/condition-key-calledviafirstlast-example-diagram.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;                使用 aws:CalledViaFirst 和 aws:CalledViaLast 的示例&#xA;            " style="max-width:100%" />
             
             
        </div>
        
     
        <h2 id="condition-keys-calledviafirst">aws:CalledViaFirst</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可以将策略中的服务与代表 IAM 主体（用户或角色）发出请求的<em><b>第一个服务</b></em> 进行比较。有关更多信息，请参阅<code class="code"><a href="#condition-keys-calledvia">aws:CalledVia</a></code>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 当服务使用 IAM 主体的凭证向其他服务发出至少一个其他请求时，此键会出现在请求中。如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用，则此键不存在。当主体直接进行调用时，此键也不存在。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-calledvialast">aws:CalledViaLast</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可以将策略中的服务与代表 IAM 主体（用户或角色）发出请求的<em>最后一个服务</em>进行比较。有关更多信息，请参阅<code class="code"><a href="#condition-keys-calledvia">aws:CalledVia</a></code>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 当服务使用 IAM 主体的凭证向其他服务发出至少一个其他请求时，此键会出现在请求中。如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用，则此键不存在。当主体直接进行调用时，此键也不存在。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-currenttime">aws:CurrentTime</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Date">日期运算符</a>结合使用。</p>
        <p>使用此键可将请求的日期和时间与您在策略中指定的日期和时间进行比较。要查看使用此条件键的示例策略，请参阅<a href="./reference_policies_examples_aws-dates.html">AWS：允许基于日期和时间进行访问</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键始终包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-ec2instancesourcevpc">aws:Ec2InstanceSourceVpc</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>此键标识将 Amazon EC2 IAM 角色凭证传递到的 VPC。您可以在具有 <a href="#condition-keys-sourcevpc">aws:SourceVPC</a> 全局键的策略中使用此键，检查从中发出调用的 VPC (<code class="code">aws:SourceVPC</code>) 是否与将凭证传送到的 VPC (<code class="code">aws:Ec2InstanceSourceVpc</code>) 相匹配。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – 仅在请求者使用 Amazon EC2 角色凭证签署请求时，才将此键包含在请求上下文中。它可以用于 IAM 策略、服务控制策略、VPC 端点策略和资源策略。</p>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
        <p>此键可以与 VPC 标识符值一起使用，但在用作与 <code class="code">aws:SourceVpc</code> 上下文键组合的变量时最有用。只有当请求者使用 VPC 端点发出请求时，才将 <code class="code">aws:SourceVpc</code> 上下文键包含在请求上下文中。搭配使用 <code class="code">aws:Ec2InstanceSourceVpc</code> 和 <code class="code">aws:SourceVpc</code> 时，您能够更广泛地使用 <code class="code">aws:Ec2InstanceSourceVpc</code>，因为它可以比较通常一起变化的值。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>此条件键在 EC2 Classic 中不可用。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "RequireSameVPC",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
            "aws:SourceVpc": "$<span>{</span>aws:Ec2InstanceSourceVpc}"
        },
        "Null": <span>{</span>
          "ec2:SourceInstanceARN": "false"
        },
        "BoolIfExists": <span>{</span>
          "aws:ViaAWSService": "false"
        }
      }
    }
  ]
}</code></pre>
        <p>在上面的示例中，如果 <code class="code">aws:SourceVpc</code> 值不等于 <code class="code">aws:Ec2InstanceSourceVpc</code> 值，则访问将被拒绝。通过测试 <code class="code">ec2:SourceInstanceARN</code> 条件键是否存在，该策略声明仅限于用作 Amazon EC2 实例角色的角色。</p>
        <p>该策略使用 <code class="code">aws:ViaAWSService</code>，在代表您的 Amazon EC2 实例角色发出请求时允许 AWS 对请求进行授权。例如，当您从 Amazon EC2 实例向加密的 Amazon S3 存储桶发出请求时，Amazon S3 会代表您调用 AWS KMS。向 AWS KMS 发出请求时，某些键不存在。</p>
     
        <h2 id="condition-keys-ec2instancesourceprivateip4">aws:Ec2InstanceSourcePrivateIPv4</h2>
        <p>与 <a href="./reference_policies_elements_condition_operators.html#Conditions_IPAddress">IP 地址运算符</a>结合使用。</p>
        <p>此键标识 Amazon EC2 IAM 角色凭证传送到的主弹性网络接口的私有 IPv4 地址。您必须将此条件键与其配套键 <code class="code">aws:Ec2InstanceSourceVpc</code> 一起使用，以确保您拥有 VPC ID 和源私有 IP 的全局唯一组合。将此键与 <code class="code">aws:Ec2InstanceSourceVpc</code> 搭配使用可确保请求是从凭证传送到的同一私有 IP 地址发出的。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> – 仅在请求者使用 Amazon EC2 角色凭证签署请求时，才将此键包含在请求上下文中。它可以用于 IAM 策略、服务控制策略、VPC 端点策略和资源策略。</p>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>此键不应在 <code class="code">Allow</code> 语句中单独使用。顾名思义，私有 IP 地址不是全局唯一的。每次使用 <code class="code">aws:Ec2InstanceSourcePrivateIPv4</code> 键来指定可以从哪个 VPC 使用 Amazon EC2 实例凭证时，都应使用 <code class="code">aws:Ec2InstanceSourceVpc</code> 键。</p></div></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>此条件键在 EC2 Classic 中不可用。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Effect": "Deny",
            "Action":  "*",
            "Resource": "*",
            "Condition": <span>{</span>
                "StringNotEquals": <span>{</span>
                    "aws:Ec2InstanceSourceVpc": "$<span>{</span>aws:SourceVpc}"
                },                
                "Null": <span>{</span>
                    "ec2:SourceInstanceARN": "false"
                },
                "BoolIfExists": <span>{</span>
                    "aws:ViaAWSService": "false"
                }
            }
        },
        <span>{</span>
            "Effect": "Deny",
            "Action":  "*",
            "Resource": "*",
            "Condition": <span>{</span>
                "StringNotEquals": <span>{</span>
                    "aws:Ec2InstanceSourcePrivateIPv4": "$<span>{</span>aws:VpcSourceIp}"
                },                               
                "Null": <span>{</span>
                    "ec2:SourceInstanceARN": "false"
                },
                "BoolIfExists": <span>{</span>
                    "aws:ViaAWSService": "false"
                }
            }
        }
    ]
}</code></pre>
     
        <h2 id="condition-keys-epochtime">aws:EpochTime</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Date">日期运算符</a>或<a href="./reference_policies_elements_condition_operators.html#Conditions_Numeric">数字运算符</a>结合使用。</p>
        <p>使用此键可将请求的日期和时间（以纪元或 Unix 时间表示）与您在策略中指定的值进行比较。此键还接受自 1970 年 1 月 1 日以来的秒数。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键始终包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-federatedprovider">aws:FederatedProvider</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此密钥将主体的发布身份提供程序 (IdP) 与您在策略中指定的 IdP 进行比较。这意味着 IAM 角色正在使用 <code class="code">AssumeRoleWithWebIdentity</code> 或 <code class="code">AssumeRoleWithSAML</code> AWS STS 操作代入。使用生成的角色会话的临时证书发出请求时，请求上下文将标识对原始联合身份进行身份验证的 IdP。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — 当主体是角色会话主体并且该会话是使用第三方身份提供程序发出的时候，此密钥就存在。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>例如，如果用户已通过 Amazon Cognito 进行身份验证，则请求上下文将包含值 <code class="code">cognito-identity.amazonaws.com</code>。同样，如果已通过 Login with Amazon 对用户进行身份验证，则请求上下文将包含值 <code class="code">www.amazon.com</code>。</p>
        <p>您可以使用任何可用的单值条件密钥作为<a href="./reference_policies_variables.html">变量</a>。以下示例基于资源的策略使用 <code class="code">aws:FederatedProvider</code> 密钥作为资源的 ARN 中的策略变量。此策略允许使用 IdP 进行身份验证的任何主体，使用特定于发布身份提供程序的路径从 Amazon S3 存储桶获取对象。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::<code class="replaceable"><code class="replaceable">DOC-EXAMPLE-BUCKET</code></code>/$<span>{</span>aws:FederatedProvider}/*"
  }
}</code></pre>
     
        <h2 id="condition-keys-multifactorauthage">aws:MultiFactorAuthAge</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Numeric">数字运算符</a>结合使用。</p>
        <p>使用此键可将自使用 MFA 向请求主体授权以来的秒数与您在策略中指定的数量进行比较。有关 MFA 的更多信息，请参阅 <a href="./id_credentials_mfa.html">在 AWS 中使用多重身份验证 (MFA)</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在使用 MFA 对进行调用的主体进行身份验证后，才将此键包含在请求上下文中。如果未使用 MFA，则此键不存在。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-multifactorauthpresent">aws:MultiFactorAuthPresent</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">布尔值运算符</a>结合使用。</p>
        <p>使用此键可检查是否已使用多重验证 (MFA) 来验证发出请求的临时安全凭证。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在主体使用临时凭证发出请求时，才将此键包含在请求上下文中。此键在 AWS CLI、AWS API 或使用长期凭证发出的 AWS 开发工具包请求中不存在。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>临时凭证用于验证 IAM 角色、联合身份用户、具有来自 <code class="code">sts:GetSessionToken</code> 的临时令牌的 IAM 用户以及 AWS Management Console 用户。IAM 用户访问密钥是长期凭证，但在某些情况下，AWS 会代表 IAM 用户创建临时凭证以执行操作。在这些情况下，<code class="code">aws:MultiFactorAuthPresent</code> 密钥存在于请求中，并设置为值 <code class="code">false</code>。有两种常见情况可能会发生这种情形：</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p>AWS Management Console中的 IAM 用户在不知情的情况下使用了临时凭证。用户使用其作为长期凭证的用户名和密码登录控制台。但在后台，控制台代表用户生成临时凭证。</p>
            </li><li class="listitem">
                <p>如果 IAM 用户对某个 AWS 服务进行调用，则该服务将重新使用该用户的凭证向其他服务发出另一个请求。例如，当调用 Athena 以访问 Amazon S3 存储桶或使用 AWS CloudFormation 创建 Amazon EC2 实例时。对于后续请求，AWS 使用临时凭证。</p>
            </li></ul></div>
        <p>要了解哪些服务支持使用临时凭证，请参阅<a href="./reference_aws-services-that-work-with-iam.html">使用 IAM 的AWS服务</a>。</p>
        <p>在使用长期凭证（例如，用户访问密钥对）调用 API 或 CLI 命令时，不提供 <code class="code">aws:MultiFactorAuthPresent</code> 键。因此我们建议，当您检查此键时使用 <code class="code"><a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">...IfExists</a></code> 版本的条件运算符。</p>
        <p>必须理解，以下 <code class="code">Condition</code> 元素<em><b>不是</b></em> 检查请求是否使用 MFA 进行身份验证的可靠方式。</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class="json ">#####   WARNING: NOT RECOMMENDED   #####
"Effect" : "Deny",
"Condition" : <span>{</span> "Bool" : <span>{</span> "aws:MultiFactorAuthPresent" : "false" } }</code></pre>
        <p><code class="code">Deny</code> 效果、<code class="code">Bool</code> 元素和 <code class="code">false</code> 值的这一组合可拒绝可以使用但未使用 MFA 进行身份验证的请求。这仅适用于支持使用 MFA 的临时凭证。此语句不会拒绝对使用长期凭证发出的请求或使用 MFA 进行身份验证的请求的访问权限。使用此示例时务必要谨慎，因为其逻辑复杂，并且未对是否实际使用 MFA 身份验证进行测试。</p>
        <p>此外，请勿使用 <code class="code">Deny</code> 效果、<code class="code">Null</code> 元素和 <code class="code">true</code> 的组合，因为该组合行为方式相同，但逻辑更加复杂。</p>
         
            <h6>建议的组合</h6>
            <p>我们建议您使用 <a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">BoolIfExists</a> 运算符检查是否使用 MFA 对请求进行身份验证。</p>
         
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Effect" : "Deny",
"Condition" : <span>{</span> "BoolIfExists" : <span>{</span> "aws:MultiFactorAuthPresent" : "false" } }</code></pre>
        <p><code class="code">Deny</code>、<code class="code">BoolIfExists</code> 和 <code class="code">false</code> 的组合将拒绝未使用 MFA 进行身份验证的请求。具体来说，它拒绝来自不包含 MFA 的临时凭证的请求。它还拒绝使用长期凭证发出的请求，例如使用访问密钥执行的 AWS CLI 或 AWS API 操作。<code class="code">*IfExists</code> 运算符用于检查 <code class="code">aws:MultiFactorAuthPresent</code> 键是否存在以及它是否可以存在（由其存在性指示）。当您要拒绝未使用 MFA 进行身份验证的任何请求时，可使用此运算符。这是更安全的，但可能会中断使用访问密钥访问 AWS CLI 或 AWS API 的任何代码或脚本。</p>
         
            <h6>替代组合</h6>
            <p>您还可以使用 <a href="./reference_policies_elements_condition_operators.html#Conditions_IfExists">BoolIfExists</a> 运算符以允许通过 MFA 进行身份验证的请求以及使用长期凭证发出的 AWS CLI 或 AWS API 请求。</p>
         
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json ">"Effect" : "Allow",
"Condition" : <span>{</span> "BoolIfExists" : <span>{</span> "aws:MultiFactorAuthPresent" : "true" } }</code></pre>
        <p>此条件将匹配键存在<b>或</b>键不存在的情况。<code class="code">Allow</code>、<code class="code">BoolIfExists</code> 和 <code class="code">true</code> 的组合允许已使用 MFA 进行身份验证的请求或无法使用 MFA 进行身份验证的请求。这意味着，在请求者使用其长期访问密钥时，允许执行 AWS CLI、AWS API 和 AWS 开发工具包操作。该组合不允许来自临时凭证的请求，这些凭证可能包含 MFA，但未包含 MFA。</p>
        <p>在使用 IAM 控制台可视化编辑器创建策略并选择<b>需要 MFA</b> 时，将应用该组合。该设置要求使用 MFA 进行控制台访问，但允许在没有 MFA 的情况下进行编程访问。</p>
        <p>或者，您也可以使用 <code class="code">Bool</code> 运算符，以便仅在使用 MFA 进行身份验证时允许编程和控制台请求。</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class="json ">"Effect" : "Allow",
"Condition" : <span>{</span> "Bool" : <span>{</span> "aws:MultiFactorAuthPresent" : "true" } }</code></pre>
        <p><code class="code">Allow</code>、<code class="code">Bool</code> 和 <code class="code">true</code> 的组合仅允许已进行 MFA 身份验证的请求。这仅适用于支持使用 MFA 的临时凭证。该语句不允许访问使用长期访问密钥发出的请求，也不允许访问在没有 MFA 的情况下使用临时凭证发出的请求。</p>
        <p><b><em>请勿</em></b>使用策略进行类似以下的构建，以检查 MFA 密钥是否存在：</p>
        <pre class="programlisting"><div class="code-btn-container"></div><code class="json ">#####   WARNING: USE WITH CAUTION   #####

"Effect" : "Allow",
"Condition" : <span>{</span> "Null" : <span>{</span> "aws:MultiFactorAuthPresent" : "false" } }</code></pre>
        <p><code class="code">Allow</code> 效果、<code class="code">Null</code> 元素和 <code class="code">false</code> 值的组合仅允许可以使用 MFA 进行身份验证的请求，而不考虑该请求是否已实际进行身份验证。这组合允许使用临时凭证发出的所有请求，而对长期凭证拒绝访问权限。使用此示例时务必要谨慎，因为它未对是否实际使用 MFA 身份验证进行测试。</p>
     
        <h2 id="condition-keys-principalaccount">aws:PrincipalAccount</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求主体所属的账户与您在策略中指定的账户标识符进行比较。对于匿名请求，请求上下文将返回 <code class="code">anonymous</code>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 此键包含在所有请求（包括匿名请求）的请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
        <p>在以下示例中，除了拥有账号 <code class="code">123456789012</code> 的主体外，访问会被拒绝。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "DenyAccessFromPrincipalNotInSpecificAccount",
      "Action": "<code class="replaceable">service</code>:*",
      "Effect": "Deny",
      "Resource": [
        "arn:aws:<code class="replaceable">service:region:accountID:resource</code>"
      ],
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:PrincipalAccount": [
            "123456789012"
          ]
        }
      }
    }
  ]
}
        </code></pre>

     
        <h2 id="condition-keys-principalarn">aws:PrincipalArn</h2>
        <p>使用 <a href="./reference_policies_elements_condition_operators.html#Conditions_ARN">ARN 运算符</a>和<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>。</p>
        <p>使用此键可将发出请求的主体的 <a href="./reference_identifiers.html#identifiers-arns">Amazon Resource Name (ARN)</a> 与您在策略中指定的 ARN 进行比较。对于 IAM 角色，请求上下文将返回角色的 ARN，而不是已代入角色的用户的 ARN。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键包含在所有签名请求的请求上下文中。匿名请求不包括此键。您可以在此条件键中指定以下类型的主体：</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>IAM 角色</p>
                    </li><li class="listitem">
                        <p>IAM 用户</p>
                    </li><li class="listitem">
                        <p>AWS STS 联合用户会话</p>
                    </li><li class="listitem">
                        <p>AWS 账户根用户</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
        <p>下表显示了您可以在 <code class="code">aws:PrincipalArn</code> 条件键中指定的为不同类型的主体返回的请求上下文值：</p>
        <div class="itemizedlist">
             
             
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>IAM 角色</b> – 请求上下文包含条件键 <code class="code">aws:PrincipalArn</code> 的以下值。请勿将所担任角色会话 ARN 指定为此条件键的值。有关所担任角色会话主体的更多信息，请参阅 <a href="./reference_policies_elements_principal.html#principal-role-session">角色会话主体</a>。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:iam::123456789012:role/role-name</code></code></pre>
            </li><li class="listitem">
                <p><b>IAM 用户</b> – 请求上下文包含条件键 <code class="code">aws:PrincipalArn</code> 的以下值。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:iam::123456789012:user/<code class="replaceable">user-name</code></code></code></pre>
            </li><li class="listitem">
                <p><b>AWS STS 联合用户会话</b> – 请求上下文包含条件键 <code class="code">aws:PrincipalArn</code> 的以下值。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:sts::123456789012:federated-user/<code class="replaceable">user-name</code></code></code></pre>
            </li><li class="listitem">
                <p><b>AWS 账户 根用户</b> – 请求上下文包含条件键 <code class="code">aws:PrincipalArn</code> 的以下值。当您将根用户 ARN 指定为 <code class="code">aws:PrincipalArn</code> 条件键，它仅限制 AWS 账户 根用户的权限。这不同于在基于资源策略的主体元素中指定根用户 ARN，后者会将权限委托给 AWS 账户。有关在基于资源策略的主体元素中指定根用户 ARN 的更多信息，请参阅 <a href="./reference_policies_elements_principal.html#principal-accounts">AWS 账户 主体</a>。</p>
                <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="code" copy="true">arn:aws:iam::123456789012:root</code></code></pre>
                <p>您可以将根用户 ARN 指定为 AWS Organizations 服务控制策略（SCP）条件键 <code class="code">aws:PrincipalArn</code> 的值。SCP 是一种组织策略，用于管理组织中的权限，仅影响组织中的成员账户。SCP 会限制成员账户中的 IAM 用户和角色的权限，包括成员账户的根用户。有关 SCP 对权限影响的更多信息，请参阅《Organizations 用户指南》中的 <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html#scp-effects-on-permissions">SCP 对权限的影响</a><em></em>。</p>
            </li></ul></div>
        
     
        <h2 id="condition-keys-principalisawsservice">aws:PrincipalIsAWSService</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">布尔值运算符</a>结合使用。</p>
        <p>使用此密钥可检查对您资源的调用是否直接由 AWS <a href="./reference_policies_elements_principal.html#principal-services">服务主体</a>提出。例如，AWS CloudTrail 使用服务主体 <code class="code">cloudtrail.amazonaws.com</code> 将日志写入 Amazon S3 存储桶。当服务使用服务主体对资源执行直接操作时，请求上下文密钥将设置为 true。如果服务使用 IAM 主体的凭证代表主体发出请求时，上下文密钥设置为 false。如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用，则请求也会被设为 false。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — 此密钥存在于所有使用 AWS 凭证的签名 API 请求的请求上下文中。匿名请求不包括此键。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可以使用此条件键限制对可信身份和预期网络位置的访问，同时安全地授予对 AWS 服务的访问权限。</p>
        <p>在以下 Amazon S3 存储桶策略示例中，对存储桶的访问受到限制，除非请求源自 <code class="code">vpc-111bbb22</code> 或者来自服务主体，例如 CloudTrail。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "Expected-network+service-principal",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::<code class="replaceable"><code class="replaceable">DOC-EXAMPLE-BUCKET1</code></code>/AWSLogs/<code class="replaceable">AccountNumber</code>/*",
      "Condition": <span>{</span>
        "StringNotEqualsIfExists": <span>{</span>
          "aws:SourceVpc": "vpc-111bbb22"
        },
        "BoolIfExists": <span>{</span>
          "aws:PrincipalIsAWSService": "false"
        }
      }
    }
  ]
}</code></pre>
        
        <p>在以下视频中，了解有关如何在策略中使用 <code class="code">aws:PrincipalIsAWSService</code> 条件键的更多信息。</p>
        <div class="mediaobject">
             
                <iframe width="720" height="330" frameborder="0" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" sandbox="allow-scripts allow-same-origin allow-popups" src="https://www.youtube-nocookie.com/embed/gv-_H8a42G4"></iframe>
             
             
        </div>
        
        
        
     
        <h2 id="condition-keys-principalorgid">aws:PrincipalOrgID</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求主体所属的 AWS Organizations 中组织的标识符与策略中指定的标识符进行比较。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在主体是企业成员时，才将此键包含在请求上下文中。匿名请求不包括此键。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>此全局键提供了列出组织中的所有 AWS 账户的所有账户 ID 的替代方法。您可以使用此条件键来简化在<a href="./access_policies_identity-vs-resource.html">基于资源的策略</a>中指定 <code class="code">Principal</code> 元素的过程。您可以在条件元素中指定<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_org_details.html">组织 ID</a>。当您添加和删除账户时，包含 <code class="code">aws:PrincipalOrgID</code> 键的策略将自动包括正确的账户，并且不需要手动更新。</p>
        <p>例如，以下 Amazon S3 存储桶策略允许 <code class="code">o-xxxxxxxxxxx</code> 企业中的任何账户成员将对象添加到 <code class="code">policy-ninja-dev</code> 存储桶中。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="JSON "> <span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Sid": "AllowPutObject",
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:PutObject",
    "Resource": "arn:aws:s3:::policy-ninja-dev/*",
    "Condition": <span>{</span>"StringEquals":
      <span>{</span>"aws:PrincipalOrgID":"o-xxxxxxxxxxx"}
    }
  }
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>此全局条件也适用于 AWS 企业的管理账户。此策略防止指定组织之外的所有主体访问 Amazon S3 存储桶。这包括与您的内部资源交互的任何 AWS 服务，如将日志数据发送到 Amazon S3 存储桶的 AWS CloudTrail。了解如何安全地授予 AWS 服务的访问权限，请参阅 <a href="#condition-keys-principalisawsservice">aws:PrincipalIsAWSService</a>。</p></div></div>
        <p>有关 AWS Organizations 的更多信息，请参阅《AWS Organizations 用户指南》中的 <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_introduction.html">什么是 AWS Organizations？</a><em></em>。</p>
     
        <h2 id="condition-keys-principalorgpaths">aws:PrincipalOrgPaths</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将发出请求的主体的 AWS Organizations 路径与策略中的路径进行比较。该主体可以是 IAM 用户、IAM 角色、联合用户或 AWS 账户根用户。在策略中，此条件键可确保请求者是 AWS Organizations 中指定组织根或组织单位 (OU) 的账户成员。AWS Organizations 路径是 Organizations 实体结构的文本表示形式。有关使用和了解路径的更多信息，请参阅<a href="./access_policies_access-advisor-view-data-orgs.html#access_policies_access-advisor-viewing-orgs-entity-path">了解 AWS Organizations 实体路径</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在主体是企业成员时，才将此键包含在请求上下文中。匿名请求不包括此键。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 多值</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>组织 ID 是全局唯一的，但 OU ID 和根目录 ID 仅在组织内是唯一的。这意味着没有两个组织具有相同的组织 ID。但是，另一个组织可能具有与您的组织相同的 OU 或根目录 ID。我们建议您在指定 OU 或根目录时始终包含组织 ID。</p></div></div>
        
        <p>例如，以下条件返回账户中主体的 <code class="code">true</code>，该主体直接附加到 <code class="code">ou-ab12-22222222</code> OU 但不在其子 OU 中。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringEquals" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/"]
}}</code></pre>
        
        <p>以下条件为账户中的主体返回 <code class="code">true</code>，该主体直接附加到 OU 或其任何子 OU。包含通配符时，您必须使用 <code class="code">StringLike</code> 条件运算符。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/*"]
}}</code></pre>
        <p>以下条件为账户中的主体返回 <code class="code">true</code>，该主体直接附加到任意子 OU，但不会直接附加至父 OU。以前的条件适用于 OU 或任何子 OU。以下条件仅适用于子 OU（以及这些子 OU 的任何子 OU）。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/ou-*"]
}}</code></pre>
        <p>以下条件允许访问 <code class="code">o-a1b2c3d4e5</code> 组织中的各个主体，而无论其父 OU 如何。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition" : <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:PrincipalOrgPaths":["o-a1b2c3d4e5/*"]
}}</code></pre>
        <p><code class="code">aws:PrincipalOrgPaths</code> 是一个多值条件键。多值键在请求上下文中可以有多个值。在您为 <code class="code">ForAnyValue</code> 条件运算符使用多个值时，主体的路径必须与策略中列出的其中一个路径匹配。有关多值条件键的更多信息，请参阅<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">使用多个键和值</a>。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">    "Condition": <span>{</span>
        "ForAnyValue:StringLike": <span>{</span>
            "aws:PrincipalOrgPaths": [
                "o-a1b2c3d4e5/r-ab12/ou-ab12-33333333/*",
                "o-a1b2c3d4e5/r-ab12/ou-ab12-22222222/*"
            ]
        }
    }</code></pre>
     
        <h2 id="condition-keys-principalservicename">aws:PrincipalServiceName</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此密钥可以将策略中的<a href="./reference_policies_elements_principal.html#principal-services">服务主体</a>名称与正在向您的资源发出请求的服务主体进行比较。您可以使用此密钥来检查此调用是否由特定的服务主体提出。当服务主体向您的资源发出直接请求时，<code class="code">aws:PrincipalServiceName</code> 密钥将包含服务主体的名称。例如，AWS CloudTrail 服务主体的名称是 <code class="code">cloudtrail.amazonaws.com</code>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — 当调用由 AWS 服务主体提出时，此密钥将存在于请求中。此密钥不会在任何其他情况中出现，包括以下情况：</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用。</p>
                    </li><li class="listitem">
                        <p>如果服务使用 IAM 主体的凭证代表主体发出请求。</p>
                    </li><li class="listitem">
                        <p>如果调用是由 IAM 主体直接发出的。</p>
                    </li><li class="listitem">
                        <p>如果调用是由匿名请求者发出的。</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可以使用此条件键限制对可信身份和预期网络位置的访问，同时安全地授予对 AWS 服务的访问权限。</p>
        <p>在以下 Amazon S3 存储桶策略示例中，对存储桶的访问受到限制，除非请求源自 <code class="code">vpc-111bbb22</code> 或者来自服务主体，例如 CloudTrail。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "expected-network+service-principal",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::<code class="replaceable"><code class="replaceable">DOC-EXAMPLE-BUCKET1</code></code>/AWSLogs/<code class="replaceable">AccountNumber</code>/*",
      "Condition": <span>{</span>
        "StringNotEqualsIfExists": <span>{</span>
          "aws:SourceVpc": "vpc-111bbb22",
          "aws:PrincipalServiceName": "cloudtrail.amazonaws.com"
        }
      }
    }
  ]
}
        </code></pre>
     
        <h2 id="condition-keys-principalservicenameslist">aws:PrincipalServiceNamesList</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>此密钥提供了属于此服务的所有<a href="./reference_policies_elements_principal.html#principal-services">服务主体</a>名称列表。这是一个高级条件键。您可以用它来限制服务仅从特定地区访问您的资源。某些服务可能会创建区域服务主体，以指示特定区域内服务的特定实例。您可以将对资源的访问限制为服务的特定实例。当服务主体向您的资源发出直接请求时，<code class="code">aws:PrincipalServiceNamesList</code> 会包含与服务的区域实例关联的所有服务主体名称的无序列表。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — 当调用由 AWS 服务主体提出时，此密钥将存在于请求中。此密钥不会在任何其他情况中出现，包括以下情况：</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用。</p>
                    </li><li class="listitem">
                        <p>如果服务使用 IAM 主体的凭证代表主体发出请求。</p>
                    </li><li class="listitem">
                        <p>如果调用是由 IAM 主体直接发出的。</p>
                    </li><li class="listitem">
                        <p>如果调用是由匿名请求者发出的。</p>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>值类型</b>— 多值</p>
            </li></ul></div>
        <p><code class="code">aws:PrincipalServiceNamesList</code> 是一个多值条件键。多值键在请求上下文中可以有多个值。对于此键，您必须将 <code class="code">ForAnyValue</code> 或者 <code class="code">ForAllValues</code> 集合运算符与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串条件运算符</a>搭配使用。有关多值条件键的更多信息，请参阅<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">使用多个键和值</a>。</p>
     
        <h2 id="condition-keys-principaltag">aws:PrincipalTag/<em>tag-key</em></h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将附加到发出请求的主体的标签与您在策略中指定的标签进行比较。如果已为主体附加多个标签，则请求上下文会为每个附加的标签键包含一个 <code class="code">aws:PrincipalTag</code> 键。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> - 仅在主体使用具有附加标签的 IAM 用户时，才将此键包含在请求上下文中。对于主体，如果使用附加了标签或<a href="./id_session-tags.html">会话标签</a>的 IAM 角色，则应包括它。匿名请求不包括此键。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可采用键/值对的形式向用户或角色添加自定义属性。有关 IAM 标签的更多信息，请参阅 <a href="./id_tags.html">标记 IAM 资源</a>。您可以将 <code class="code">aws:PrincipalTag</code> 用于针对 AWS 主体的<a href="./access_iam-tags.html#access_iam-tags_control-principals">访问控制</a>。</p>
        <p>此示例说明如何创建基于角色的策略，以允许具有 <code class="userinput">department=hr</code> 标签的用户管理 IAM 用户、组或角色。要使用此策略，请将示例策略中的<code class="replaceable">斜体占位符文本</code>替换为您自己的信息。然后，按照<a href="./access_policies_create.html">创建策略</a>或<a href="./access_policies_manage-edit.html">编辑策略</a>中的说明操作。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Effect": "Allow",
      "Action": "iam:*",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
          "aws:PrincipalTag/<code class="replaceable">department</code>": "<code class="replaceable">hr</code>"
        }
      }
    }
  ]
}</code></pre>
        <p>此示例说明如何使用资源 ARN 中的 <code class="code">aws:PrincipalTag</code> 键创建基于资源的策略。仅当存储桶名称以 <code class="code"><code class="replaceable">team</code></code> 主体标签中的团队名称结尾时，该策略才允许 <code class="code">s3:GetObject</code> 操作。要使用此策略，请将示例策略中的<code class="replaceable">斜体占位符文本</code>替换为您自己的信息。然后，按照<a href="./access_policies_create.html">创建策略</a>或<a href="./access_policies_manage-edit.html">编辑策略</a>中的说明操作。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET</code>-$<span>{</span>aws:PrincipalTag/<code class="replaceable">team</code>}/"
  }
}</code></pre>
     
        <h2 id="condition-keys-principaltype">aws:PrincipalType</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将发出请求的主体的类型与您在策略中指定的主体类型进行比较。有关更多信息，请参阅<a href="./reference_policies_elements_principal.html#Principal_specifying">指定主体</a>。有关 <code class="code">principal</code> 密钥值的具体示例，请参阅 <a href="./reference_policies_variables.html#principaltable">主体键值</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 此键包含在所有请求（包括匿名请求）的请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-referer">aws:referer</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将在客户端浏览器中引用请求的站点与您在策略中指定的引用站点进行比较。<code class="code">aws:referer</code> 请求上下文值是由调用方在 HTTP 标头中提供的。当您在网页上选择链接时，<code class="code">Referer</code> 标题将包含在 Web 浏览器请求中。<code class="code">Referer</code> 标题包含选定链接的网页的 URL。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅当通过从浏览器中的网页 URL 链接来调用对 AWS 资源的请求时，才将此键包含在请求上下文中。编程请求不包括此键，因为它不使用浏览器链接即可访问 AWS 资源。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>例如，您可以直接使用 URL 或使用直接 API 调用访问 Amazon S3 对象。有关更多信息，请参阅<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html#example-bucket-policies-use-case-4">使用 Web 浏览器直接调用 Amazon S3 API 操作</a>。当您从网页中存在的 URL 访问 Amazon S3 对象时，源网页的 URL 将在 <code class="code">aws:referer</code> 中使用。当您通过在浏览器中键入 URL 来访问 Amazon S3 对象时，<code class="code">aws:referer</code> 不存在。直接调用 API 时，<code class="code">aws:referer</code> 也不存在。您可以使用策略中的 <code class="code">aws:referer</code> 条件键以允许来自特定引用站点发出的请求，例如公司域中网页上的链接。</p>
        <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>警告</h6></div><div class="awsdocs-note-text"><p>应谨慎使用此键。包含公共已知的引用站点标头值是非常危险的。未经授权方可能会使用修改的浏览器或自定义浏览器提供他们选择的任何 <code class="code">aws:referer</code> 值。因此，<code class="code">aws:referer</code> 不应用于阻止未经授权方直接发出 AWS 请求。提供它只是为了允许客户保护其数字内容（如存储在 Amazon S3 中的内容），以免在未经授权的第三方站点上引用。</p></div></div>
     
        <h2 id="condition-keys-requestedregion">aws:RequestedRegion</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将已在请求中调用的 AWS 区域与您在策略中指定的区域进行比较。您可以使用此全局条件键来控制可请求的区域。要查看每个服务的 AWS 区域，请参阅《Amazon Web Services 一般参考》中的 <a href="https://docs.aws.amazon.com/general/latest/gr/aws-service-information.html">服务端点和限额</a><em></em>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键始终包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>一些全球服务（如 IAM）具有单个终端节点。因为此端点的物理位置在美国东部（弗吉尼亚北部）区域，所以 IAM 调用始终会向 us-east-1 区域发出。例如，如果您创建一个策略以在请求的区域不是 us-west-2 时拒绝访问所有服务，则 IAM 调用将始终失败。要查看如何解决此问题的示例，请参阅 <a href="./reference_policies_elements_notaction.html">NotAction 与 Deny</a>。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>使用 <code class="code">aws:RequestedRegion</code> 条件键可以控制服务的哪个终端节点被调用，但不控制该操作产生的影响。一些服务具有跨区域影响。例如，Amazon S3 具有控制跨区域复制的 API 操作。您可以在一个区域中调用 <code class="code">s3:PutBucketReplication</code>（受 <code class="code">aws:RequestedRegion</code> 条件键的影响），但其他区域将会受到影响，具体取决于复制配置设置。</p></div></div>
        <p>您可以使用该上下文密钥将访问限制为一组给定区域中的 AWS 服务。例如，以下策略允许用户查看 AWS Management Console 中的所有 Amazon EC2 实例。但是，它仅允许用户更改爱尔兰 (eu-west-1)、伦敦 (eu-west-2) 或巴黎 (eu-west-3) 中的实例。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "InstanceConsoleReadOnly",
            "Effect": "Allow",
            "Action": [
                "ec2:Describe*",
                "ec2:Export*",
                "ec2:Get*",
                "ec2:Search*"
            ],
            "Resource": "*"
        },
        <span>{</span>
            "Sid": "InstanceWriteRegionRestricted",
            "Effect": "Allow",
            "Action": [
                "ec2:Associate*",
                "ec2:Import*",
                "ec2:Modify*",
                "ec2:Monitor*",
                "ec2:Reset*",
                "ec2:Run*",
                "ec2:Start*",
                "ec2:Stop*",
                "ec2:Terminate*"
            ],
            "Resource": "*",
            "Condition": <span>{</span>
                "StringEquals": <span>{</span>
                    "aws:RequestedRegion": [
                        "eu-west-1",
                        "eu-west-2",
                        "eu-west-3"
                    ]
                }
            }
        }
    ]
}       </code></pre>
     
        <h2 id="condition-keys-requesttag">aws:RequestTag/<em>tag-key</em></h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求中传递的标签键/值对与您在策略中指定的标签对进行比较。例如，您可以检查请求是否包含标签键 <code class="code">"Dept"</code> 并具有 <code class="code">"Accounting"</code> 值。有关更多信息，请参阅<a href="./access_tags.html#access_tags_control-requests">在 AWS 请求期间控制访问</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 当在请求中传递标签键值对时，将此键包含在请求上下文中。在请求中传递多个标签时，每个标签键/值对均有一个上下文密钥。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>该上下文密钥的格式为 <code class="code">"aws:RequestTag/<code class="replaceable">tag-key</code>":"<code class="replaceable">tag-value</code>"</code>，其中 <code class="replaceable">tag-key</code> 和 <code class="replaceable">tag-value</code> 是标签键值对。标签密钥和值不区分大小写。这意味着，如果您在策略的条件元素中指定 <code class="code">"aws:RequestTag/TagKey1": "Value1"</code>，则条件将匹配名为 <code class="code">TagKey1</code> 或 <code class="code">tagkey1</code> 的请求标签键，但不会同时匹配两者。</p>
        <p>这个例子表明，虽然该键是单值的，但如果键不同，您仍然可以在请求中使用多个键值对。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Effect": "Allow",
    "Action": "ec2:CreateTags",
    "Resource": "arn:aws:ec2:::instance/*",
    "Condition": <span>{</span>
      "StringEquals": <span>{</span>
        "aws:RequestTag/environment": [
          "preprod",
          "production"
        ],
        "aws:RequestTag/team": [
          "engineering"
        ]
      }
    }
  }
}
</code></pre>
     
        <h2 id="condition-keys-resourceaccount">aws:ResourceAccount</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键，将策略中所请求的资源所有者的 <a href="https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html">AWS 账户 ID</a> 与资源账户进行比较。然后，您可以根据拥有该资源的账户来允许或拒绝对该资源的访问。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 对于大多数服务操作，此键始终包含在请求上下文中。以下操作不支持此键：</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon Elastic Block Store – 所有操作</p>
                    </li><li class="listitem">
                        <p>Amazon EC2</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">ec2:AcceptTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CopySnapshot</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVolume</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcEndpoint</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcPeeringConnection</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon EventBridge – 所有操作</p>
                    </li><li class="listitem">
                        <p>Amazon Route 53</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">route53:AssociateVpcWithHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:CreateVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DeleteVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DisassociateVPCFromHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:ListHostedZonesByVPC</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon WorkSpaces</p>
                        <div class="itemizedlist">
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">workspaces:DescribeWorkspaceImages</code></p>
                            </li></ul></div>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>有关上述不支持的操作的其他注意事项，请参阅 <a href="https://github.com/aws-samples/data-perimeter-policy-examples" rel="noopener noreferrer" target="_blank"><span>Data Perimeter Policy Examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 存储库。</p></div></div>
        <p>此键等于包含请求中受评估资源的账户的 AWS 账户 ID。</p>
        <p>对于您的账户中的大多数资源，<a href="./reference_policies_elements_condition_operators.html#Conditions_ARN">ARN</a> 包含该资源的所有者账户 ID。对于某些资源（如 Amazon S3 存储桶），资源 ARN 不包含该账户 ID。以下两个示例显示了在 ARN 中具有账户 ID 的资源与没有账户 ID 的 Amazon S3 ARN 之间的区别：</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><code class="code">arn:aws:iam::123456789012:role/AWSExampleRole</code> – 在账户 123456789012 中创建和拥有的 IAM 角色。</p>
            </li><li class="listitem">
                <p><code class="code">arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET2</code></code> – 在账户 <code class="code">111122223333</code> 中创建且拥有的 Amazon S3 存储桶，在 ARN 中不显示。</p>
            </li></ul></div>
        <p>使用 AWS 控制台、API 或 CLI 查找您的所有资源和相应的 ARN。</p>
        <p>您编写的策略根据资源所有者的账户 ID 拒绝对资源的权限。例如，如果<em>指定资源</em>不属于<em>指定账户</em>，以下基于身份的策略会拒绝访问该资源。</p>
        <p>要使用此策略，请将示例策略中的<em>斜体占位符文本</em>替换为您的账户信息。</p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>该策略不允许进行任何操作。相反，该策略会使用 <code class="code">Deny</code> 效果，这会显式拒绝访问语句中列出而不属于已列出账户的所有资源。将此策略与允许访问特定资源的其他策略结合使用。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "DenyInteractionWithResourcesNotInSpecificAccount",
      "Action": "<code class="replaceable">service</code>:*",
      "Effect": "Deny",
      "Resource": [
        "arn:aws:<code class="replaceable">service</code>:<code class="replaceable">region</code>:<code class="replaceable">account</code>:<code class="replaceable">*</code>"
      ],
      "Condition": <span>{</span>
        "StringNotEquals": <span>{</span>
          "aws:ResourceAccount": [
            "<code class="replaceable">account</code>"
          ]
        }
      }
    }
  ]
}</code></pre>
        <p>此策略会拒绝对特定 AWS 服务所有资源的访问，除非指定 AWS 账户 拥有该资源。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>某些 AWS 服务 需要访问托管在其他 AWS 中的 AWS 账户 所拥有的资源。在基于身份的策略中使用 <code class="code">aws:ResourceAccount</code> 可能会影响您的身份访问这些资源的能力。</p></div></div>
        <p>某些 AWS 服务，例如 AWS Data Exchange，依赖于对您的 AWS 账户 以外的资源的访问来进行正常操作。如果您在策略中使用元素 <code class="code">aws:ResourceAccount</code>，请在策略中包含额外声明来为这些服务创建豁免。示例策略 <a href="./reference_policies_examples_resource_account_data_exch.html">AWS：拒绝访问您账户之外的 Amazon S3 资源，AWS Data Exchange 除外。</a> 演示了如何根据资源账户拒绝访问，同时定义对于服务拥有的资源的例外情况。</p>
        <p>将此策略示例用作创建自己的自定义策略的模板。参阅服务<a href="https://docs.aws.amazon.com/index.html">文档</a>以了解更多信息。</p>
     
        <h2 id="condition-keys-resourceorgid">aws:ResourceOrgID</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将被请求资源所属的 AWS Organizations 中组织的标识符与策略中指定的标识符进行比较。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在拥有资源的账户是企业成员时，才将此键包含在请求上下文中。此全局条件键不支持以下操作：</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon Elastic Block Store – 所有操作</p>
                    </li><li class="listitem">
                        <p>Amazon EC2</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">ec2:AcceptTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CopySnapshot</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVolume</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcEndpoint</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcPeeringConnection</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon EventBridge – 所有操作</p>
                    </li><li class="listitem">
                        <p>Amazon Route 53</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">route53:AssociateVpcWithHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:CreateVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DeleteVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DisassociateVPCFromHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:ListHostedZonesByVPC</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon WorkSpaces</p>
                        <div class="itemizedlist">
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">workspaces:DescribeWorkspaceImages</code></p>
                            </li></ul></div>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>有关上述不支持的操作的其他注意事项，请参阅 <a href="https://github.com/aws-samples/data-perimeter-policy-examples" rel="noopener noreferrer" target="_blank"><span>Data Perimeter Policy Examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 存储库。</p></div></div>
        <p>此全局键会返回给定请求的资源组织 ID。它允许您创建适用于组织中所有资源的规则，这些资源在<a href="./access_policies_identity-vs-resource.html">基于身份的策略</a>的 <code class="code">Resource</code> 元素中指定。您可以在条件元素中指定<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_org_details.html">组织 ID</a>。当您添加和删除账户时，包含 <code class="code">aws:ResourceOrgID</code> 键的策略将自动包括正确的账户，并且不必手动更新。</p>
        <p>例如，以下策略会阻止主体将对象添加到 <code class="code">policy-genius-dev</code> 资源，除非 Amazon S3 资源与发出请求的主体属于同一组织。</p>
        <div class="awsdocs-note awsdocs-important"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>重要</h6></div><div class="awsdocs-note-text"><p>该策略不允许进行任何操作。相反，该策略会使用 <code class="code">Deny</code> 效果，这会显式拒绝访问语句中列出而不属于已列出账户的所有资源。将此策略与允许访问特定资源的其他策略结合使用。</p></div></div>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
  "Version": "2012-10-17",
  "Statement": <span>{</span>
    "Sid": "DenyPutObjectToS3ResourcesOutsideMyOrganization",
    "Effect": "Deny",
    "Action": "s3:PutObject",
    "Resource": "arn:<code class="replaceable">partition</code>:s3:::policy-genius-dev/*",
    "Condition": <span>{</span>
      "StringNotEquals": <span>{</span>
        "aws:ResourceOrgID": "$<span>{</span>aws:PrincipalOrgID}"
      }
    }
  }
}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>某些 AWS 服务 需要访问托管在其他 AWS 中的 AWS 账户 所拥有的资源。在基于身份的策略中使用 <code class="code">aws:ResourceOrgID</code> 可能会影响您的身份访问这些资源的能力。</p></div></div>
        
        <p>某些 AWS 服务，例如 AWS Data Exchange，依赖于对您的 AWS 账户 以外的资源的访问来进行正常操作。如果您在策略中使用 <code class="code">aws:ResourceOrgID</code> 键，请在策略中包含额外声明来为这些服务创建豁免。示例策略 <a href="./reference_policies_examples_resource_account_data_exch.html">AWS：拒绝访问您账户之外的 Amazon S3 资源，AWS Data Exchange 除外。</a> 演示了如何根据资源账户拒绝访问，同时定义对于服务拥有的资源的例外情况。您可以使用 <code class="code">aws:ResourceOrgID</code> 键来创建类似的策略，限制对企业内部资源的访问，同时包括服务拥有的资源。</p>
        <p>将此策略示例用作创建自己的自定义策略的模板。参阅服务<a href="https://docs.aws.amazon.com/index.html">文档</a>以了解更多信息。</p>
        
        <p>在以下视频中，了解有关如何在策略中使用 <code class="code">aws:ResourceOrgID</code> 条件键的更多信息。</p>
        <div class="mediaobject">
             
                <iframe width="720" height="330" frameborder="0" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" sandbox="allow-scripts allow-same-origin allow-popups" src="https://www.youtube-nocookie.com/embed/cWVW0xAiWwc"></iframe>
             
             
        </div>
        
        
        
     
        <h2 id="condition-keys-resourceorgpaths">aws:ResourceOrgPaths</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键来比较所访问资源的 AWS Organizations 路径与策略中的路径。在策略中，此条件键可确保该资源属于 AWS Organizations 中指定组织根或组织单位（OU）的账户成员。AWS Organizations 路径是 Organizations 实体结构的文本表示形式。有关使用和了解路径的更多信息，请参阅 <a href="./access_policies_access-advisor-view-data-orgs.html#access_policies_access-advisor-viewing-orgs-entity-path">了解 AWS Organizations 实体路径</a> </p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在拥有资源的账户是企业成员时，才将此键包含在请求上下文中。此全局条件键不支持以下操作：</p>
                <div class="itemizedlist">
                     
                     
                     
                     
                     
                <ul class="itemizedlist"><li class="listitem">
                        <p>Amazon Elastic Block Store – 所有操作</p>
                    </li><li class="listitem">
                        <p>Amazon EC2</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">ec2:AcceptTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:AcceptVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CopySnapshot</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVolume</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcEndpoint</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:CreateVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:DeleteVpcPeeringConnection</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectTransitGatewayPeeringAttachment</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcEndpointConnections</code></p>
                            </li><li class="listitem">
                                <p><code class="code">ec2:RejectVpcPeeringConnection</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon EventBridge – 所有操作</p>
                    </li><li class="listitem">
                        <p>Amazon Route 53</p>
                        <div class="itemizedlist">
                             
                             
                             
                             
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">route53:AssociateVpcWithHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:CreateVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DeleteVPCAssociationAuthorization</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:DisassociateVPCFromHostedZone</code></p>
                            </li><li class="listitem">
                                <p><code class="code">route53:ListHostedZonesByVPC</code></p>
                            </li></ul></div>
                    </li><li class="listitem">
                        <p>Amazon WorkSpaces</p>
                        <div class="itemizedlist">
                             
                        <ul class="itemizedlist"><li class="listitem">
                                <p><code class="code">workspaces:DescribeWorkspaceImages</code></p>
                            </li></ul></div>
                    </li></ul></div>
            </li><li class="listitem">
                <p><b>值类型</b>— 多值</p>
            </li></ul></div>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>有关上述不支持的操作的其他注意事项，请参阅 <a href="https://github.com/aws-samples/data-perimeter-policy-examples" rel="noopener noreferrer" target="_blank"><span>Data Perimeter Policy Examples</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> 存储库。</p></div></div>
        <p><code class="code">aws:ResourceOrgPaths</code> 是一个多值条件键。多值键在请求上下文中可以有多个值。对于此键，您必须将 <code class="code">ForAnyValue</code> 或者 <code class="code">ForAllValues</code> 集合运算符与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串条件运算符</a>搭配使用。有关多值条件键的更多信息，请参阅<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">使用多个键和值</a>。</p>
        <p>例如，对于属于组织 <code class="code">o-a1b2c3d4e5</code> 的资源，以下条件会返回为 <code class="code">True</code>。包含通配符时，您必须使用 <a href="./reference_policies_elements_condition_operators.html">StringLike</a> 条件运算符。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition": <span>{</span> 
      "ForAnyValue:StringLike": <span>{</span>
             "aws:ResourceOrgPaths":["o-a1b2c3d4e5/*"]
   }
}</code></pre>
        <p>对于具有 OU ID <code class="code">ou-ab12-11111111</code> 的资源，以下条件返回 <code class="code">True</code>。它将匹配附加到 OU ou-ab12-11111111 或任何子 OU 的账户所拥有的资源。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition": <span>{</span> "ForAnyValue:StringLike" : <span>{</span>
     "aws:ResourceOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/*"]
}}</code></pre>
        <p>对于直接附加到 OU ID <code class="code">ou-ab12-22222222</code>（而非子 OU）的账户所拥有的资源，以下条件返回 <code class="code">True</code>。下列示例使用 <a href="./reference_policies_elements_condition_operators.html">StringEquals</a> 条件运算符来指定 OU ID 的完全匹配（而非通配符匹配）要求。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="">"Condition": <span>{</span> "ForAnyValue:StringEquals" : <span>{</span>
     "aws:ResourceOrgPaths":["o-a1b2c3d4e5/r-ab12/ou-ab12-11111111/ou-ab12-22222222/"]
}}</code></pre>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p>某些 AWS 服务 需要访问托管在其他 AWS 中的 AWS 账户 所拥有的资源。在基于身份的策略中使用 <code class="code">aws:ResourceOrgPaths</code> 可能会影响您的身份访问这些资源的能力。</p></div></div>
        
        <p>某些 AWS 服务，例如 AWS Data Exchange，依赖于对您的 AWS 账户 以外的资源的访问来进行正常操作。如果您在策略中使用 <code class="code">aws:ResourceOrgPaths</code> 键，请在策略中包含额外声明来为这些服务创建豁免。示例策略 <a href="./reference_policies_examples_resource_account_data_exch.html">AWS：拒绝访问您账户之外的 Amazon S3 资源，AWS Data Exchange 除外。</a> 演示了如何根据资源账户拒绝访问，同时定义对于服务拥有的资源的例外情况。您可以使用 <code class="code">aws:ResourceOrgPaths</code> 键来创建类似的策略，限制对企业部门（OU）内部资源的访问，同时包括服务拥有的资源。</p>
        <p>将此策略示例用作创建自己的自定义策略的模板。参阅服务<a href="https://docs.aws.amazon.com/index.html">文档</a>以了解更多信息。</p>
     
        <h2 id="condition-keys-resourcetag">aws:ResourceTag/<em>tag-key</em></h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将您在策略中指定的标签键/值对与附加到资源的键/值对进行比较。例如，您可能会要求只有在资源具有附加的标签键 <code class="code">"Dept"</code> 和值 <code class="code">"Marketing"</code> 时才允许访问该资源。有关更多信息，请参阅<a href="./access_tags.html#access_tags_control-resources">控制对 AWS 资源的访问</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 当请求的资源已附加标签，或者是在利用附加包创建资源的请求中，键会包含在请求上下文中。只有<a href="./reference_aws-services-that-work-with-iam.html">支持基于标签的授权</a>的资源返回此键。每个标签键/值对均有一个上下文密钥。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>该上下文密钥的格式为 <code class="code">"aws:ResourceTag/<code class="replaceable">tag-key</code>":"<code class="replaceable">tag-value</code>"</code>，其中 <code class="replaceable">tag-key</code> 和 <code class="replaceable">tag-value</code> 是标签键值对。标签密钥和值不区分大小写。这意味着，如果您在策略的条件元素中指定 <code class="code">"aws:ResourceTag/TagKey1": "Value1"</code>，则条件将匹配名为 <code class="code">TagKey1</code> 或 <code class="code">tagkey1</code> 的资源标签键，但不会同时匹配两者。</p>
        <p>有关使用 <code class="code">aws:ResourceTag</code> 键控制对 IAM 资源的访问的示例，请参阅 <a href="./access_tags.html#access_tags_control-resources">控制对 AWS 资源的访问</a>。</p>
        <p>有关使用 <code class="code">aws:ResourceTag</code> 键控制对其他 AWS 资源的访问的示例，请参阅 <a href="./access_tags.html">使用标签控制对 AWS 资源的访问</a>。</p>
        <p>有关使用 <code class="code">aws:ResourceTag</code> 条件键进行基于属性的访问控制 (ABAC) 的教程，请参阅 <a href="./tutorial_attribute-based-access-control.html">IAM 教程：根据标签定义访问 AWS 资源的权限</a>。</p>
     
        <h2 id="condition-keys-securetransport">aws:SecureTransport</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">布尔值运算符</a>结合使用。</p>
        <p>使用此键可检查是否已使用 SSL 发送请求。请求上下文将返回 <code class="code">true</code> 或 <code class="code">false</code>。在策略中，只能在使用 SSL 发送请求时允许特定操作。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键始终包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-sourceaccount">aws:SourceAccount</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将发出服务到服务请求的资源的账户 ID 与您在策略中指定的账户 ID 进行比较。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在访问资源触发一项 AWS 服务以代表资源拥有者调用另一项服务时，将此键包含在请求上下文中。发出调用的服务必须将源的资源账户 ID 传递给被调用的服务。此账户 ID 包括源账户 ID。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可以使用此条件键来防止 AWS 服务在服务之间执行事务时被用作<a href="./confused-deputy.html">混淆代理人</a>。将此条件键的值设置为请求中资源的账户。例如，当 Amazon S3 存储桶更新触发 Amazon SNS 主题帖子时，Amazon S3 服务将调用 <code class="code">sns:Publish</code> API 操作。在允许 <code class="code">sns:Publish</code> 操作的策略中，将条件键的值设置为 Amazon S3 存储桶的账户 ID。有关如何以及建议何时使用这些条件键的信息，请参阅有关您正在使用的 AWS 服务的文档。</p>
     
        <h2 id="condition-keys-sourcearn">aws:SourceArn</h2>
        <p>与 <a href="./reference_policies_elements_condition_operators.html#Conditions_ARN">ARN 运算符</a>和<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字串运算符</a>结合使用。AWS 建议在比较 ARN 时使用 ARN 运算符而不是字符串运算符。</p>
        <p>使用此键可将发出服务到服务请求的资源的 <a href="./reference_identifiers.html#identifiers-arns">Amazon Resource Name (ARN)</a> 与您在策略中指定的 ARN 进行比较。</p>
        <p>此键不适用于发出请求的主体的 ARN。请改用 <a href="#condition-keys-principalarn">aws:PrincipalArn</a>。源的 ARN 包含账户 ID，因此不必将 <code class="code">aws:SourceAccount</code> 与 <code class="code">aws:SourceArn</code> 结合使用。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在访问资源触发一项 AWS 服务以代表资源拥有者调用另一项服务时，将此键包含在请求上下文中。调用服务必须将原始资源的 ARN 传递给被调用的服务。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可以使用此条件键来防止 AWS 服务在服务之间执行事务时被用作<a href="./confused-deputy.html">混淆代理人</a>。将此条件键的值设置为请求中资源的 ARN。例如，当 Amazon S3 存储桶更新触发 Amazon SNS 主题帖子时，Amazon S3 服务将调用 <code class="code">sns:Publish</code> API 操作。在允许 <code class="code">sns:Publish</code> 操作的策略中，将条件免邮的值设置为 Amazon S3 存储桶的 ARN。有关如何以及建议何时使用这些条件键的信息，请参阅有关您正在使用的 AWS 服务的文档。</p>
     
        <h2 id="condition-keys-sourceidentity">aws:SourceIdentity</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此密钥可将主体设置的源身份与您在策略中指定的源身份进行比较。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> — 在使用任何 AWS STS 担任角色 CLI 命令或 AWS STS <code class="code">AssumeRole</code>API 操作担任角色时设置好源身份后，此密钥将会被包含在请求中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可以在策略中使用此密钥来允许 AWS 中的主体操作，这些主体在担任角色时设置了源身份。角色指定源身份的活动显示在 <a href="./cloudtrail-integration.html#cloudtrail-integration_signin-tempcreds">AWS CloudTrail</a>。这使管理员能够更轻松地确定什么角色在 AWS 中执行了操作。</p>
        <p>与 <a href="./reference_policies_iam-condition-keys.html#ck_rolesessionname">sts:RoleSessionName</a> 不同，在设置源身份后，无法更改该值。它存在于角色执行的所有操作的请求上下文中。当您使用会话凭证担任另一个角色时，该值将保留到后续角色会话中。从一个角色代入另一个角色的过程称为<a href="./id_roles_terms-and-concepts.html#iam-term-role-chaining">角色链</a>。</p>
        <p>当主体使用任何 AWS STS 担任角色 CLI 命令或 AWS STS <code class="code">AssumeRole</code> API 操作担任角色并初次设置源身份时，<a href="./reference_policies_iam-condition-keys.html#ck_sourceidentity">sts:SourceIdentity</a> 密钥将会出现在请求中。<code class="code">aws:SourceIdentity</code>键存在于对具有源身份设置的角色会话执行的任何操作请求中。</p>
        <p>以下账户 <code class="code">111122223333</code> 中适用于 <code class="code">CriticalRole</code> 的角色信任策略包含一个条件适用于 <code class="code">aws:SourceIdentity</code> 的条件，可防止未将源身份设置为 Saanvi 或 Diego 主体担任该角色。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "AssumeRoleIfSourceIdentity",
            "Effect": "Allow",
            "Principal": <span>{</span>"AWS": "arn:aws:iam::123456789012:role/CriticalRole"},
            "Action": [
                "sts:AssumeRole",
                "sts:SetSourceIdentity"
            ],
            "Condition": <span>{</span>
                "StringLike": <span>{</span>
                    "aws:SourceIdentity": ["Saanvi","Diego"]
                }
            }
        }
    ]
}
</code></pre>
        <p>要了解有关使用源身份信息的更多信息，请参阅 <a href="./id_credentials_temp_control-access_monitor.html">监控和控制使用所担任角色执行的操作</a>。</p>
     
        <h2 id="condition-keys-sourceip">aws:SourceIp</h2>
        <p>与 <a href="./reference_policies_elements_condition_operators.html#Conditions_IPAddress">IP 地址运算符</a>结合使用。</p>
        <p>使用此键可将请求者的 IP 地址与您在策略中指定的 IP 地址进行比较。<code class="code">aws:SourceIp</code> 条件键只能用于公有 IP 地址范围。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键将包含在请求上下文中，但请求者使用 VPC 终端节点发出请求时除外。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>可在策略中使用 <code class="code">aws:SourceIp</code> 条件键以仅允许主体从指定的 IP 范围发出请求。但是，如果 AWS 服务代表主体进行调用，则此策略拒绝访问。在这种情况下，您可以将 <code class="code">aws:SourceIp</code> 与 <code class="code"><a href="#condition-keys-viaawsservice">aws:ViaAWSService</a></code> 键结合使用，以确保源 IP 限制仅适用于主体直接发出的请求。</p>
        <div class="awsdocs-note"><div class="awsdocs-note-title"><awsui-icon name="status-info" variant="link"></awsui-icon><h6>注意</h6></div><div class="awsdocs-note-text"><p> <code class="code">aws:SourceIp</code> 同时支持 IPv4 和 IPv6 地址或 IP 地址范围。有关详细信息，请参阅<a href="https://docs.aws.amazon.com/marketplace/latest/buyerguide/buyer-security-ipv6-upgrade.html">将 IAM 策略升级到 IPv6</a>。</p></div></div>
        <p>例如，您可以将以下策略附加到一个 IAM 用户。如果用户从指定的 IP 地址进行调用，则此策略允许用户将对象直接放入 <code class="code"><code class="replaceable">DOC-EXAMPLE-BUCKET3</code></code> Amazon S3 存储桶中。但是，如果用户发出另一个请求而导致服务调用 Amazon S3，则 IP 地址限制不适用。只有当请求不是由服务发出时，<code class="code">PrincipalPutObjectIfIpAddress</code> 语句才会限制 IP 地址。如果请求是由服务发出的，则 <code class="code">ServicePutObject</code> 语句允许执行此操作而没有 IP 地址限制。</p>
        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="复制"><awsui-icon name="copy"></awsui-icon></div></div><code class="json "><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "PrincipalPutObjectIfIpAddress",
            "Effect": "Allow",
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET3</code>/*",
            "Condition": <span>{</span>
                "Bool": <span>{</span>"aws:ViaAWSService": "false"},
                "IpAddress": <span>{</span>"aws:SourceIp": "<code class="replaceable">203.0.113.0</code>"}
            }
        },
        <span>{</span>
            "Sid": "ServicePutObject",
            "Effect": "Allow",
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<code class="replaceable">DOC-EXAMPLE-BUCKET</code>/*",
            "Condition": <span>{</span>
                "Bool": <span>{</span>"aws:ViaAWSService": "true"}
            }
        }
    ]
}</code></pre>
        <p>如果请求来自使用 Amazon VPC 终端节点的主机，则 <code class="code">aws:SourceIp</code> 密钥不可用。您应改用特定于 VPC 的键，例如 aws:VpcSourceIp。有关使用 VPC 端点的更多信息，请参阅《AWS PrivateLink 指南》中的 <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-iam.html">VPC 端点和 VPC 端点服务的身份和访问管理</a><em></em>。</p>
     
        <h2 id="condition-keys-sourcevpc">aws:SourceVpc</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可检查请求是否来自您在策略中指定的 VPC。在策略中，您可以使用此键以仅允许访问特定的 VPC。有关更多信息，请参阅《Amazon Simple Storage Service 用户指南》中的 <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies-vpc-endpoint.html#example-bucket-policies-restrict-access-vpc">限制对特定 VPC 的访问</a><em></em>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在请求者使用 VPC 终端节点发出请求时，才将此键包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-sourcevpce">aws:SourceVpce</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求的 VPC 终端节点标识符与您在策略中指定的终端节点 ID 进行比较。在策略中，您可以使用此键来限制对特定 VPC 的访问。有关更多信息，请参阅《Amazon Simple Storage Service 用户指南》中的 <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies-vpc-endpoint.html#example-bucket-policies-restrict-access-vpc-endpoint">限制对特定 VPC 端点的访问</a><em></em>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在请求者使用 VPC 终端节点发出请求时，才将此键包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-tagkeys">aws:TagKeys</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求中的标签键与您在策略中指定的键进行比较。我们建议当使用策略来通过标签控制访问时，请使用 <code class="code">aws:TagKeys</code> 条件键来定义允许的标签键。有关示例策略和更多信息，请参阅<a href="./access_tags.html#access_tags_control-tag-keys">根据标签键控制访问</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 仅在操作支持将标签传递到请求中时，才将此键包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 多值</p>
            </li></ul></div>
        <p>该上下文密钥的格式为 <code class="code">"aws:TagKeys":"<code class="replaceable">tag-key</code>"</code>，其中 <code class="replaceable">tag-key</code> 是没有值的标签键列表 (例如，<code class="code">["Dept","Cost-Center"]</code>)。</p>
        <p>由于可在一个请求中包含多个标签键/值对，因此，请求内容可以是<a href="./reference_policies_multi-value-conditions.html">多值</a>请求。在此情况下，您必须使用 <code class="code">ForAllValues</code> 或 <code class="code">ForAnyValue</code> 集合运算符。有关更多信息，请参阅<a href="./reference_policies_multi-value-conditions.html#reference_policies_multi-key-or-value-conditions">使用多个键和值</a>。</p>
        <p>某些服务支持同时使用标记和资源操作，例如创建、修改或删除资源。要允许在单次调用中同时使用标记和操作，您必须创建同时包含标记操作和资源修改操作的策略。然后，您可以使用 <code class="code">aws:TagKeys</code> 条件键强制在请求中使用特定标签键。例如，要在某人创建 Amazon EC2 快照时限制标签，您必须在策略中包含 <code class="code">ec2:CreateSnapshot</code>创建操作<em><b>和</b></em> <code class="code">ec2:CreateTags</code> 标记操作。要查看此使用 <code class="code">aws:TagKeys</code> 场景的策略，请参阅《适用于 Linux 实例的 Amazon EC2 用户指南》中的 <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html#iam-creating-snapshot-with-tags">创建具有标签的快照</a><em></em>。</p>
     
        <h2 id="condition-keys-tokenissuetime">aws:TokenIssueTime</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Date">日期运算符</a>结合使用。</p>
        <p>使用此键可将临时安全凭证的颁发日期和时间与您在策略中指定的日期和时间进行比较。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在主体使用临时凭证发出请求时，才将此键包含在请求上下文中。使用访问密钥发出的 AWS CLI、AWS API 或 AWS 开发工具包请求中未提供此键。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>要了解哪些服务支持使用临时凭证，请参阅<a href="./reference_aws-services-that-work-with-iam.html">使用 IAM 的AWS服务</a>。</p>
     
        <h2 id="condition-keys-useragent">aws:UserAgent</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求者的客户端应用程序与您在策略中指定的应用程序进行比较。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键始终包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <div class="awsdocs-note awsdocs-warning"><div class="awsdocs-note-title"><awsui-icon name="status-warning" variant="error"></awsui-icon><h6>警告</h6></div><div class="awsdocs-note-text"><p>应谨慎使用此键。由于 <code class="code">aws:UserAgent</code> 值由发起人在 HTTP 标头中提供，因此未经授权方可以修改或自定义浏览器以提供他们选择的任何 <code class="code">aws:UserAgent</code> 值。因此，<code class="code">aws:UserAgent</code> 不应用于阻止未经授权方直接发出 AWS 请求。您可以使用它来仅允许特定客户端应用程序，并且仅在对策略进行测试之后。</p></div></div>
     
        <h2 id="condition-keys-userid">aws:userid</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求者的主体标识符与您在策略中指定的 ID 进行比较。对于 IAM 用户，请求上下文值是用户 ID。对于 IAM 角色，此值的格式可能有所不同。有关如何为不同的主体显示信息的详细信息，请参阅<a href="./reference_policies_elements_principal.html#Principal_specifying">指定主体</a>。有关 <code class="code">principal</code> 密钥值的具体示例，请参阅 <a href="./reference_policies_variables.html#principaltable">主体键值</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）– 此键包含在所有请求（包括匿名请求）的请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-username">aws:username</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_String">字符串运算符</a>结合使用。</p>
        <p>使用此键可将请求者的用户名与您在策略中指定的用户名进行比较。有关如何为不同的主体显示信息的详细信息，请参阅<a href="./reference_policies_elements_principal.html#Principal_specifying">指定主体</a>。有关 <code class="code">principal</code> 密钥值的具体示例，请参阅 <a href="./reference_policies_variables.html#principaltable">主体键值</a>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>可用性</b> - 此键始终包含在 IAM 用户的请求上下文中。匿名请求和使用 AWS 账户根用户 或 IAM 角色发出的请求不包含此键。使用 IAM Identity Center 凭证发出的请求不会在上下文中包含此键。要了解如何控制对 IAM Identity Center 中的用户的访问权限，请参阅 <code class="code">identitystore:UserId</code><a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/using-predefined-attributes.html">将 IAM Identity Center 身份存储中的预定义属性用于 AWS 中的访问控制</a>。IAM Identity Center 中的用户是您的员工队伍中需要访问您的 AWS 账户 或云应用程序的人员。</p>
            </li><li class="listitem">
                <p><b>值类型</b> — 单值</p>
            </li></ul></div>
     
        <h2 id="condition-keys-viaawsservice">aws:ViaAWSService</h2>
        <p>与<a href="./reference_policies_elements_condition_operators.html#Conditions_Boolean">布尔值运算符</a>结合使用。</p>
        <p>使用此键检查 AWS 服务是否代表您向其他服务发出请求。</p>
        <p>当服务使用 IAM 主体的凭证代表主体发出请求时，请求上下文密钥返回 <code class="code">true</code>。如果服务使用<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-role">服务角色</a>或<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html#iam-term-service-linked-role">服务相关角色</a>代表主体进行调用，则上下文密钥返回 <code class="code">false</code>。当主体直接进行调用时，请求上下文密钥也会返回 <code class="code">false</code>。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 此键始终包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>您可以根据请求是否由服务发出，使用此条件键允许或拒绝访问。有关示例策略，请参阅<a href="./reference_policies_examples_aws_deny-ip.html">AWS：基于源 IP 拒绝对 AWS 的访问</a>。</p>
     
        <h2 id="condition-keys-vpcsourceip">aws:VpcSourceIp</h2>
        <p>与 <a href="./reference_policies_elements_condition_operators.html#Conditions_IPAddress">IP 地址运算符</a>结合使用。</p>
        <p>使用此键可将从中发出请求的 IP 地址与您在策略中指定的 IP 地址进行比较。在策略中，键仅在请求来自指定的 IP 地址并经过 VPC 终端节点时进行匹配。</p>
        <div class="itemizedlist">
             
             
        <ul class="itemizedlist"><li class="listitem">
                <p><b>Availability</b>（可用性）- 仅在使用 VPC 终端节点发出请求时，才将此键包含在请求上下文中。</p>
            </li><li class="listitem">
                <p><b>值类型</b>— 单值</p>
            </li></ul></div>
        <p>有关更多信息，请参阅《Amazon VPC 用户指南》中的 <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints-access.html">使用 VPC 端点控制对服务的访问</a><em></em>。</p>
     
        <h2 id="condition-keys-other">其他跨服务条件键</h2>
        <p>全局条件键是带 <code class="code">aws:</code> 前缀的条件键。单个服务可以创建自己的条件键。这些特定于服务的条件键包括与服务名称匹配的前缀，例如 <code class="code">iam:</code> 或 <code class="code">sts:</code>。</p>
        <p>服务可以创建服务特定键，这些键在其他服务的请求上下文中可用。这些键可在多个服务中使用，但不是全局条件键。例如，AWS STS 支持 <a href="./reference_policies_iam-condition-keys.html#condition-keys-saml"> 基于 SAML 的联合条件键</a>。当使用 SAML 联合的用户在其他服务中执行 AWS 操作时，这些键可用。其他示例包括 <code class="code"><a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/using-predefined-attributes.html">identitystore:UserId</a></code> 和 <code class="code"><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-policy-structure.html#amazon-ec2-keys">ec2:SourceInstanceArn</a></code>。</p>
        <p>要查看用于一项服务的服务特定条件键，请参阅<a href="https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html">AWS 服务的操作、资源和条件键</a>，然后选择要查看其键的服务。</p>
    <awsdocs-copyright class="copyright-print"></awsdocs-copyright><awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback></div><noscript><div><div><div><div id="js_error_message"><p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="警告" /> <strong>Javascript 在您的浏览器中被禁用或不可用。</strong></p><p>要使用 Amazon Web Services 文档，必须启用 Javascript。请参阅浏览器的帮助页面以了解相关说明。</p></div></div></div></div></noscript><div id="main-col-footer" class="awsui-util-font-size-0"><div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">文档惯例</a></div><div class="prev-next"><div id="previous" class="prev-link" accesskey="p" href="./access_policies_job-functions_create-policies.html">创建角色并附加策略（控制台）</div><div id="next" class="next-link" accesskey="n" href="./reference_policies_iam-condition-keys.html">IAM 条件键</div></div></div><awsdocs-page-utilities></awsdocs-page-utilities></div><div id="quick-feedback-yes" style="display: none;"><div class="title">此页面对您有帮助吗？- 是</div><div class="content"><p>感谢您对我们工作的肯定！</p><p>如果不耽误您的时间，请告诉我们做得好的地方，让我们做得更好。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html"></awsui-button></p></div></div><div id="quick-feedback-no" style="display: none;"><div class="title">此页面对您有帮助吗？- 否</div><div class="content"><p>感谢您告诉我们本页内容还需要完善。很抱歉让您失望了。</p><p>如果不耽误您的时间，请告诉我们如何改进文档。</p><p><awsui-button id="fblink" rel="noopener noreferrer" target="_blank" text="反馈" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=IAM&amp;topic_url=https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/reference_policies_condition-keys.html"></awsui-button></p></div></div></div></body></div></awsdocs-view><div class="page-loading-indicator" id="page-loading-indicator"><awsui-spinner size="large"></awsui-spinner></div></div><div id="tools-panel" dom-region="tools"><awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel></div></awsui-app-layout><awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner></div></body></html>